"use strict";(()=>{function pt({timelineWidth:E,minimapBarsData:v,minimapHeight:J,minimapBarHeight:K,minimapTodayX:ue,ganttScroll:Z,minimapSvg:ne,minimapViewport:_,addDocListener:fe}){function De(){let X=document.querySelector(".gantt-body .gantt-sticky-left"),L=document.querySelector(".gantt-container");X&&L&&L.style.setProperty("--sticky-left-width",X.offsetWidth+"px")}requestAnimationFrame(De),ne&&requestAnimationFrame(()=>{let X=J/(v.length+1);if(v.forEach((L,ee)=>{let f=document.createElementNS("http://www.w3.org/2000/svg","rect");f.setAttribute("class",L.classes),f.setAttribute("x",(L.startPct*E).toString()),f.setAttribute("y",(X*(ee+.5)).toString()),f.setAttribute("width",Math.max(2,(L.endPct-L.startPct)*E).toString()),f.setAttribute("height",K.toString()),f.setAttribute("rx","1"),f.setAttribute("fill",L.color),ne.insertBefore(f,_)}),ue>0&&ue<E){let L=document.createElementNS("http://www.w3.org/2000/svg","line");L.setAttribute("class","minimap-today"),L.setAttribute("x1",ue.toString()),L.setAttribute("y1","0"),L.setAttribute("x2",ue.toString()),L.setAttribute("y2",J.toString()),ne.insertBefore(L,_)}});function Ae(){if(!Z||!_||!E||!Z.scrollWidth||!Z.clientWidth)return;let X=Math.max(1,Z.scrollWidth-Z.clientWidth),L=Math.min(1,Z.scrollLeft/X),ee=Math.min(1,Z.clientWidth/Z.scrollWidth),f=Math.max(20,ee*E),me=L*(E-f);isNaN(me)||isNaN(f)||(_.setAttribute("x",me.toString()),_.setAttribute("width",f.toString()))}let ce=!1,O=0;function U(X,L=!1){if(!Z||!ne||!_)return;let ee=ne.getBoundingClientRect(),me=parseFloat(_.getAttribute("width")||"0")/E*ee.width,G=X.clientX-ee.left;L?G-=O:G-=me/2;let P=Math.max(0,Math.min(1,G/(ee.width-me))),ae=Math.max(0,Z.scrollWidth-Z.clientWidth);Z.scrollLeft=P*ae}return ne&&_&&(_.addEventListener("mousedown",X=>{X.stopPropagation(),ce=!0;let L=ne.getBoundingClientRect(),f=parseFloat(_.getAttribute("x")||"0")/E*L.width;O=X.clientX-L.left-f}),ne.addEventListener("mousedown",X=>{if(X.target===_)return;ce=!0;let L=ne.getBoundingClientRect();O=parseFloat(_.getAttribute("width")||"0")/100*L.width/2,U(X,!0)}),fe("mousemove",X=>{ce&&U(X,!0)}),fe("mouseup",()=>{ce=!1})),{updateMinimapPosition:De,updateMinimapViewport:Ae}}function yt(E){let{vscode:v,menuUndo:J,menuRedo:K,addDocListener:ue,closeOnOutsideClick:Z,announce:ne,saveState:_,updateUndoRedoButtons:fe,undoStack:De,redoStack:Ae,selectedIssues:ce,clearSelection:O,allIssueBars:U,redmineBaseUrl:X,extendedRelationTypes:L,minDateMs:ee,maxDateMs:f,timelineWidth:me,dayWidth:G,barHeight:P,ganttScroll:ae,snapToDay:ge,focusOnDependencyChain:pe,clearFocus:d,getFocusedIssueId:S,scrollToAndHighlight:b,setAllowScrollChange:C,isDraftModeEnabled:A,isPerfDebugEnabled:l}=E;function h(t,o,n){document.querySelector(".relation-picker")?.remove();let i=ce.size>1&&ce.has(n),r=i?Array.from(ce).map(M=>parseInt(M)):[parseInt(n)],D=document.createElement("div");D.className="relation-picker";let k=160,w=180,F=Math.min(t,window.innerWidth-k-10),I=Math.min(o,window.innerHeight-w-10);D.style.left=Math.max(10,F)+"px",D.style.top=Math.max(10,I)+"px";let T=document.createElement("div");T.style.padding="6px 12px",T.style.fontSize="11px",T.style.opacity="0.7",T.textContent=i?r.length+" issues selected":"#"+n,D.appendChild(T),(i?[{label:"Set % Done...",command:"bulkSetDoneRatio",bulk:!0},{label:"Clear Selection",command:"clearSelection",local:!0}]:[{label:"Update Issue...",command:"openIssue"},{label:"Open in Browser",command:"openInBrowser"},{label:"Show in Issues",command:"showInIssues"},{label:"Log Time",command:"logTime"},{label:"Set % Done",command:"setDoneRatio"},{label:"Toggle Auto-update %",command:"toggleAutoUpdate"},{label:"Toggle Ad-hoc Budget",command:"toggleAdHoc"},{label:"Toggle Precedence",command:"togglePrecedence"},{label:"Set Internal Estimate",command:"setInternalEstimate"},{label:"Copy Link",command:"copyLink",local:!0},{label:"Copy URL",command:"copyUrl"}]).forEach(M=>{let H=document.createElement("button");H.textContent=M.label,H.addEventListener("click",async()=>{if(M.command==="copyLink"){let re=document.querySelector('.issue-bar[data-issue-id="'+n+'"]')?.dataset?.subject||"Issue #"+n,he=X+"/issues/"+n,$='<a href="'+he+'">#'+n+" "+re+"</a>",ke=he;try{await navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([ke],{type:"text/plain"}),"text/html":new Blob([$],{type:"text/html"})})]),v.postMessage({command:"showStatus",message:"Copied #"+n+" link"})}catch{await navigator.clipboard.writeText(ke),v.postMessage({command:"showStatus",message:"Copied #"+n+" URL"})}}else M.local?O():M.bulk?v.postMessage({command:M.command,issueIds:r}):v.postMessage({command:M.command,issueId:parseInt(n)});D.remove()}),D.appendChild(H)}),document.body.appendChild(D),Z(D)}function B(t){let o=ee+t/me*(f-ee);return new Date(o).toISOString().slice(0,10)}function N(t){let o=ee+t/me*(f-ee)-864e5;return new Date(o).toISOString().slice(0,10)}let te=document.getElementById("dragDateTooltip"),ye=null;function oe(t){let o=new Date(t+"T00:00:00"),n=o.toLocaleDateString("en-US",{month:"short"}),i=o.getDate(),r=o.toLocaleDateString("en-US",{weekday:"short"});return n+" "+i+" ("+r+")"}function W(t,o){let n=new Date(t+"T00:00:00"),i=new Date(o+"T00:00:00"),r=n.toLocaleDateString("en-US",{month:"short"}),D=i.toLocaleDateString("en-US",{month:"short"});return r===D?r+" "+n.getDate()+"-"+i.getDate():r+" "+n.getDate()+"-"+D+" "+i.getDate()}function Ce(t){te.textContent=t,te.style.display="block",ye=t}function Ie(t){t!==ye&&(te.textContent=t,ye=t)}function Pe(t,o){let n=o-28,i=!1;n<40&&(n=o+20,i=!0),te.style.left=t+"px",te.style.top=n+"px",te.classList.toggle("flipped",i)}function xe(){te.style.display="none",ye=null}let V=4,m=4;function Te(t,o){l&&l()&&console.log("[Arrow Debug]",t,o)}function Ye(t,o,n,i,r,D=!1,k=!1){let w=n>t,F=Math.abs(n-t),I=F<30,T=Math.abs(o-i)<5,g=i>o,M=D?-1:1,H=k?1:-1,Q;T&&w?Q="sameRow-right":!T&&I?Q="nearlyVertical":w?Q="diffRow-right":T?Q="sameRow-left":Q="diffRow-left";let re;if(T&&w)re="M "+t+" "+o+" H "+n;else if(T&&!w){let $=o-P;re="M "+t+" "+o+" V "+($+m)+" q 0 "+-m+" "+M*-m+" "+-m+" H "+(n+H*12-H*m)+" q "+H*-m+" 0 "+H*-m+" "+m+" V "+i+" H "+n}else if(!T&&I){let ke=(o+i)/2;re="M "+t+" "+o+" H "+(t+M*8-M*m)+" q "+M*m+" 0 "+M*m+" "+(g?m:-m)+" V "+(ke+(g?-m:m))+" q 0 "+(g?m:-m)+" "+-M*m+" "+(g?m:-m)+" H "+(n+H*8-H*m)+" q "+H*m+" 0 "+H*m+" "+(g?m:-m)+" V "+(i+(g?-m:m))+" q 0 "+(g?m:-m)+" "+-H*m+" "+(g?m:-m)+" H "+n}else if(w){let $=D?Math.max(t-8,(t+n)/2):Math.min(t+8,(t+n)/2);re="M "+t+" "+o+" H "+($-M*m)+" q "+M*m+" 0 "+M*m+" "+(g?m:-m)+" V "+(i+(g?-m:m))+" q 0 "+(g?m:-m)+" "+-H*m+" "+(g?m:-m)+" H "+n}else{let ke=(o+i)/2;re="M "+t+" "+o+" H "+(t+M*8-M*m)+" q "+M*m+" 0 "+M*m+" "+(g?m:-m)+" V "+(ke+(g?-m:m))+" q 0 "+(g?m:-m)+" "+-M*m+" "+(g?m:-m)+" H "+(n+H*8-H*m)+" q "+H*m+" 0 "+H*m+" "+(g?m:-m)+" V "+(i+(g?-m:m))+" q 0 "+(g?m:-m)+" "+-H*m+" "+(g?m:-m)+" H "+n}let he=k?"M "+(n+V)+" "+(i-V*.6)+" L "+n+" "+i+" L "+(n+V)+" "+(i+V*.6):"M "+(n-V)+" "+(i-V*.6)+" L "+n+" "+i+" L "+(n-V)+" "+(i+V*.6);return Te("calcArrowPath",{inputs:{x1:t,y1:o,x2:n,y2:i,isScheduling:r},conditions:{goingRight:w,horizontalDist:F,nearlyVertical:I,sameRow:T,goingDown:g},pathCase:Q,path:re.substring(0,80)+(re.length>80?"...":"")}),{path:re,arrowHead:he}}function Ke(t){let o=[],n='.dependency-arrow[data-from="'+t+'"], .dependency-arrow[data-to="'+t+'"]';return document.querySelectorAll(n).forEach(i=>{let r=i.getAttribute("data-from"),D=i.getAttribute("data-to"),w=(i.getAttribute("class")||"").match(/rel-(\w+)/),F=w?w[1]:"relates",I=["blocks","precedes","finish_to_start","start_to_start","finish_to_finish","start_to_finish"].includes(F),T=document.querySelector('.issue-bar[data-issue-id="'+r+'"]'),g=document.querySelector('.issue-bar[data-issue-id="'+D+'"]');!T||!g||o.push({element:i,fromId:r,toId:D,isScheduling:I,relType:F,fromBar:T,toBar:g,linePath:i.querySelector(".arrow-line"),hitPath:i.querySelector(".arrow-hit-area"),headPath:i.querySelector(".arrow-head")})}),o}function He(t,o,n,i){t.forEach(r=>{let D=r.linePath?r.linePath.getAttribute("d"):null,k=r.fromId==o?n:parseFloat(r.fromBar.dataset.startX),w=r.fromId==o?i:parseFloat(r.fromBar.dataset.endX),F=parseFloat(r.fromBar.dataset.centerY),I=r.toId==o?n:parseFloat(r.toBar.dataset.startX),T=r.toId==o?i:parseFloat(r.toBar.dataset.endX),g=parseFloat(r.toBar.dataset.centerY),M=r.relType==="start_to_start"||r.relType==="start_to_finish",H=r.relType==="finish_to_finish"||r.relType==="start_to_finish",Q,re,he,$;r.isScheduling?(Q=M?k-2:w+2,re=F,he=H?T+2:I-2,$=g):(Q=(k+w)/2,re=F,he=(I+T)/2,$=g),Te("updateArrowPositions",{arrow:r.fromId+" -> "+r.toId,isScheduling:r.isScheduling,draggedId:o,barData:{fromStartX:r.fromBar.dataset.startX,fromEndX:r.fromBar.dataset.endX,fromY:r.fromBar.dataset.centerY,toStartX:r.toBar.dataset.startX,toEndX:r.toBar.dataset.endX,toY:r.toBar.dataset.centerY},computed:{fromStartX:k,fromEndX:w,fromY:F,toStartX:I,toEndX:T,toY:g},coords:{x1:Q,y1:re,x2:he,y2:$},originalPath:D?D.substring(0,60)+"...":null});let{path:ke,arrowHead:ie}=Ye(Q,re,he,$,r.isScheduling,M,H);r.linePath&&r.linePath.setAttribute("d",ke),r.hitPath&&r.hitPath.setAttribute("d",ke),r.headPath&&r.headPath.setAttribute("d",ie)})}let Be=document.getElementById("dragConfirmOverlay"),Fe=document.getElementById("dragConfirmMessage"),Xe=document.getElementById("dragConfirmOk"),_e=document.getElementById("dragConfirmCancel"),ve=null;function $e(t,o,n){!Be||!Fe||(Fe.textContent=t,ve={onConfirm:o,onCancel:n},C(!0),Be.style.display="flex",Xe&&Xe.focus())}function ze(){Be&&(Be.style.display="none"),ve=null}function y(){ae&&q&&(ae.scrollLeft=q.left,ae.scrollTop=q.top),q=null}Xe?.addEventListener("click",()=>{ve?.onConfirm&&ve.onConfirm(),q=null,ze()}),_e?.addEventListener("click",()=>{ve?.onCancel&&ve.onCancel(),y(),ze()}),Be?.addEventListener("click",t=>{t.target===Be&&(ve?.onCancel&&ve.onCancel(),y(),ze())}),ue("keydown",t=>{ve&&(t.key==="Escape"?(t.preventDefault(),ve.onCancel&&ve.onCancel(),y(),ze()):t.key==="Enter"&&(t.preventDefault(),ve.onConfirm&&ve.onConfirm(),q=null,ze()))});let c=null,q=null,se=!1;document.querySelectorAll(".drag-handle").forEach(t=>{t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation(),q={left:ae?.scrollLeft,top:ae?.scrollTop};let n=t.closest(".issue-bar"),i=t.classList.contains("drag-left"),r=parseInt(n.dataset.issueId),D=parseFloat(n.dataset.startX),k=parseFloat(n.dataset.endX),w=n.dataset.startDate||null,F=n.dataset.dueDate||null,I=n.querySelector(".bar-outline"),T=n.querySelector(".bar-main"),g=n.querySelector(".drag-left"),M=n.querySelector(".drag-right");n.classList.add("dragging");let H=n.querySelector(".bar-labels"),Q=H?.classList.contains("labels-left"),re=Ke(r),he=n.querySelector(".link-handle");Te("dragStart (resize)",{issueId:r,isLeft:i,connectedArrowCount:re.length,arrows:re.map(ie=>({from:ie.fromId,to:ie.toId,isScheduling:ie.isScheduling,currentPath:ie.linePath?ie.linePath.getAttribute("d")?.substring(0,60)+"...":null}))}),c={issueId:r,isLeft:i,isMove:!1,initialMouseX:o.clientX,startX:D,endX:k,oldStartDate:w,oldDueDate:F,barOutline:I,barMain:T,leftHandle:g,rightHandle:M,bar:n,barLabels:H,labelsOnLeft:Q,connectedArrows:re,linkHandle:he};let $=i?D:k,ke=i?w:F;ke&&(Ce((i?"Start: ":"Due: ")+oe(ke)),Pe(o.clientX,o.clientY))})}),document.querySelectorAll(".bar-outline").forEach(t=>{t.addEventListener("mousedown",o=>{if(o.target.classList.contains("drag-handle")||o.ctrlKey||o.metaKey||o.shiftKey)return;o.preventDefault(),o.stopPropagation(),q={left:ae?.scrollLeft,top:ae?.scrollTop};let n=t.closest(".issue-bar");if(!n)return;let i=n.dataset.issueId,r=ce.size>1&&ce.has(i),k=(r?U.filter(g=>ce.has(g.dataset.issueId)):[n]).map(g=>({issueId:g.dataset.issueId,startX:parseFloat(g.dataset.startX),endX:parseFloat(g.dataset.endX),oldStartDate:g.dataset.startDate||null,oldDueDate:g.dataset.dueDate||null,barOutline:g.querySelector(".bar-outline"),barMain:g.querySelector(".bar-main"),leftHandle:g.querySelector(".drag-left"),rightHandle:g.querySelector(".drag-right"),bar:g,barLabels:g.querySelector(".bar-labels"),labelsOnLeft:g.querySelector(".bar-labels")?.classList.contains("labels-left"),connectedArrows:Ke(g.dataset.issueId),linkHandle:g.querySelector(".link-handle")}));k.forEach(g=>g.bar.classList.add("dragging"));let w=n.querySelector(".bar-labels"),F=w?.classList.contains("labels-left"),I=Ke(i),T=n.querySelector(".link-handle");Te("dragStart (move)",{issueId:i,isBulkDrag:r,connectedArrowCount:I.length,arrows:I.map(g=>({from:g.fromId,to:g.toId,isScheduling:g.isScheduling,currentPath:g.linePath?g.linePath.getAttribute("d")?.substring(0,60)+"...":null}))}),c={issueId:parseInt(i),isLeft:!1,isMove:!0,isBulkDrag:r,bulkBars:k,initialMouseX:o.clientX,startX:parseFloat(n.dataset.startX),endX:parseFloat(n.dataset.endX),oldStartDate:n.dataset.startDate||null,oldDueDate:n.dataset.dueDate||null,barOutline:t,barMain:n.querySelector(".bar-main"),leftHandle:n.querySelector(".drag-left"),rightHandle:n.querySelector(".drag-right"),bar:n,barLabels:w,labelsOnLeft:F,connectedArrows:I,linkHandle:T},!r&&n.dataset.startDate&&n.dataset.dueDate&&(Ce(W(n.dataset.startDate,n.dataset.dueDate)),Pe(o.clientX,o.clientY))})});let z=null,de=null,we=null;function Me(){z&&(z.fromBar.classList.remove("linking-source"),document.querySelectorAll(".link-target").forEach(t=>t.classList.remove("link-target")),de&&(de.remove(),de=null),z=null,we=null,document.body.classList.remove("cursor-crosshair"))}function je(t,o,n,i,r="end",D="start"){document.querySelector(".relation-picker")?.remove();let k=document.createElement("div");k.className="relation-picker";let w=180,F=200,I=Math.min(t,window.innerWidth-w-10),T=Math.min(o,window.innerHeight-F-10);k.style.left=Math.max(10,I)+"px",k.style.top=Math.max(10,T)+"px";let M={end_start:"finish_to_start",end_end:"finish_to_finish",start_start:"start_to_start",start_end:"start_to_finish"}[`${r}_${D}`]||"finish_to_start",H=[{value:"blocks",label:"\u{1F6AB} Blocks",cssClass:"rel-line-blocks",tooltip:"Target cannot be closed until this issue is closed"},{value:"precedes",label:"\u27A1\uFE0F Precedes",cssClass:"rel-line-scheduling",tooltip:"This issue must complete before target can start"},{value:"relates",label:"\u{1F517} Relates to",cssClass:"rel-line-informational",tooltip:"Simple link between issues (no constraints)"},{value:"duplicates",label:"\u{1F4CB} Duplicates",cssClass:"rel-line-informational",tooltip:"Closing target will automatically close this issue"},{value:"copied_to",label:"\u{1F4C4} Copied to",cssClass:"rel-line-informational",tooltip:"This issue was copied to create the target issue"}],Q=[{value:"finish_to_start",label:"\u23E9 Finish\u2192Start",cssClass:"rel-line-scheduling",tooltip:"Target starts after this issue finishes (FS)"},{value:"start_to_start",label:"\u25B6\uFE0F Start\u2192Start",cssClass:"rel-line-scheduling",tooltip:"Target starts when this issue starts (SS)"},{value:"finish_to_finish",label:"\u23F9\uFE0F Finish\u2192Finish",cssClass:"rel-line-scheduling",tooltip:"Target finishes when this issue finishes (FF)"},{value:"start_to_finish",label:"\u23EA Start\u2192Finish",cssClass:"rel-line-scheduling",tooltip:"Target finishes when this issue starts (SF)"}],re=L?[...H,...Q]:H,he=-1,$=document.createElement("div");$.className="delay-row";let ke=document.createElement("label");ke.textContent="Delay:",$.appendChild(ke);let ie=document.createElement("button");ie.className="delay-preset active",ie.dataset.delay="-1",ie.title="Start same day predecessor ends",ie.textContent="Same day",$.appendChild(ie);let Se=document.createElement("button");Se.className="delay-preset",Se.dataset.delay="0",Se.title="Start day after predecessor ends",Se.textContent="+1 day",$.appendChild(Se);let R=document.createElement("input");R.type="number",R.className="delay-input",R.value=he,R.min="-30",R.max="30",R.title="Custom delay in days (-1=same day, 0=next day, 3=+4 days)",$.appendChild(R),$.style.display="none",$.querySelectorAll(".delay-preset").forEach(x=>{x.addEventListener("click",j=>{j.stopPropagation(),he=parseInt(x.dataset.delay),R.value=he,$.querySelectorAll(".delay-preset").forEach(Oe=>Oe.classList.remove("active")),x.classList.add("active")})}),R.addEventListener("input",()=>{he=parseInt(R.value)||0,$.querySelectorAll(".delay-preset").forEach(x=>{x.classList.toggle("active",parseInt(x.dataset.delay)===he)})}),R.addEventListener("click",x=>x.stopPropagation()),re.forEach(x=>{let j=document.createElement("button");x.value===M&&j.classList.add("suggested");let Oe=document.createElement("span");Oe.className="color-swatch "+x.cssClass,j.appendChild(Oe),j.appendChild(document.createTextNode(x.label)),j.title=x.tooltip+(x.value===M?" (suggested based on anchors)":""),x.value==="precedes"&&(j.addEventListener("mouseenter",()=>{$.style.display="flex"}),j.addEventListener("focus",()=>{$.style.display="flex"})),j.addEventListener("click",()=>{_();let We={command:"createRelation",issueId:n,targetIssueId:i,relationType:x.value};x.value==="precedes"&&(We.delay=he),v.postMessage(We),k.remove()}),k.appendChild(j)}),k.appendChild($),document.body.appendChild(k),Z(k)}let Re=".drag-handle, .link-handle, .bar-outline, .blocks-badge-group, .blocker-badge, .progress-badge-group, .flex-badge-group";document.querySelectorAll(".issue-bar").forEach(t=>{t.addEventListener("click",o=>{o.target.closest(Re)||c||z||se||(S()&&d(),b(t.dataset.issueId))}),t.addEventListener("dblclick",o=>{c||z||se||(o.preventDefault(),pe(t.dataset.issueId))})});function st(t,o){if(document.querySelectorAll(".dependency-arrow.selected").forEach(i=>i.classList.remove("selected")),document.querySelectorAll(".arrow-connected").forEach(i=>i.classList.remove("arrow-connected")),t.length===0)return;document.body.classList.add("arrow-selection-mode");let n=new Set;t.forEach(i=>{i.classList.add("selected"),n.add(i.dataset.from),n.add(i.dataset.to)}),n.forEach(i=>{document.querySelectorAll(`.issue-bar[data-issue-id="${i}"], .issue-label[data-issue-id="${i}"]`).forEach(r=>r.classList.add("arrow-connected"))}),ne(`Highlighted ${t.length} dependency arrow(s) for #${o}`)}document.querySelectorAll(".blocks-badge-group").forEach(t=>{t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation()}),t.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();let n=t.closest(".issue-bar");if(!n)return;let i=n.dataset.issueId,r=Array.from(document.querySelectorAll(`.dependency-arrow[data-from="${i}"]`));st(r,i)})}),document.querySelectorAll(".blocker-badge").forEach(t=>{t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation()}),t.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();let n=t.closest(".issue-bar");if(!n)return;let i=n.dataset.issueId,r=Array.from(document.querySelectorAll(`.dependency-arrow[data-to="${i}"]`));st(r,i)})});let be=Array.from(document.querySelectorAll(".issue-bar")),nt=10;be.forEach((t,o)=>{t.addEventListener("keydown",n=>{if(n.key==="Enter"||n.key===" ")n.preventDefault(),b(t.dataset.issueId);else if(n.key==="ArrowDown"&&o<be.length-1)n.preventDefault(),be[o+1].focus(),ne(`Issue ${be[o+1].getAttribute("aria-label")}`);else if(n.key==="ArrowUp"&&o>0)n.preventDefault(),be[o-1].focus(),ne(`Issue ${be[o-1].getAttribute("aria-label")}`);else if(n.key==="Home")n.preventDefault(),be[0].focus(),ne(`First issue: ${be[0].getAttribute("aria-label")}`);else if(n.key==="End")n.preventDefault(),be[be.length-1].focus(),ne(`Last issue: ${be[be.length-1].getAttribute("aria-label")}`);else if(n.key==="PageDown"){n.preventDefault();let i=Math.min(o+nt,be.length-1);be[i].focus(),ne(`Issue ${be[i].getAttribute("aria-label")}`)}else if(n.key==="PageUp"){n.preventDefault();let i=Math.max(o-nt,0);be[i].focus(),ne(`Issue ${be[i].getAttribute("aria-label")}`)}else if(n.key==="Tab"&&n.shiftKey){let i=t.dataset.issueId,r=document.querySelector(`.issue-label[data-issue-id="${i}"]`);r&&(n.preventDefault(),r.focus(),ne(`Label for issue #${i}`))}})}),document.querySelectorAll(".link-handle").forEach(t=>{t.addEventListener("mousedown",o=>{o.stopPropagation(),o.preventDefault();let n=t.closest(".issue-bar"),i=parseInt(n.dataset.issueId),r=parseFloat(t.dataset.cx),D=parseFloat(t.dataset.cy);n.classList.add("linking-source"),document.body.classList.add("cursor-crosshair");let k=document.querySelector("#ganttTimeline svg");if(!document.getElementById("temp-arrow-head")){let F=document.createElementNS("http://www.w3.org/2000/svg","defs");F.innerHTML=`
            <marker id="temp-arrow-head" markerWidth="10" markerHeight="7"
                    refX="9" refY="3.5" orient="auto" markerUnits="strokeWidth">
              <polygon points="0 0, 10 3.5, 0 7" fill="var(--vscode-focusBorder)"/>
            </marker>`,k.insertBefore(F,k.firstChild)}de=document.createElementNS("http://www.w3.org/2000/svg","path"),de.classList.add("temp-link-arrow"),de.setAttribute("stroke","var(--vscode-focusBorder)"),de.setAttribute("stroke-width","2"),de.setAttribute("fill","none"),de.setAttribute("marker-end","url(#temp-arrow-head)"),k.appendChild(de);let w=t.dataset.anchor||"end";z={fromId:i,fromBar:n,startX:r,startY:D,fromAnchor:w}})}),ue("keydown",t=>{if(t.key==="Escape"){let o=document.querySelector(".relation-picker");if(o){t.stopImmediatePropagation(),o.remove();return}if(z){t.stopImmediatePropagation(),Me();return}S()&&(t.stopImmediatePropagation(),d(),ne("Focus cleared"))}});let Ze=!1,et=null;ue("mousemove",t=>{!c&&!z||(et=t,!Ze&&(Ze=!0,requestAnimationFrame(()=>{Ze=!1;let o=et;if(o){if(c){let n=o.clientX-c.initialMouseX;if(c.isMove&&c.isBulkDrag&&c.bulkBars){let i=ge(n)-ge(0);c.bulkBars.forEach(r=>{let D=r.endX-r.startX,k=Math.max(0,Math.min(r.startX+i,me-D)),w=k+D,F=w-k;r.barOutline.setAttribute("x",k),r.barOutline.setAttribute("width",F),r.barMain&&(r.barMain.setAttribute("x",k),r.barMain.setAttribute("width",F));let I=r.leftHandle.querySelector("rect"),T=r.rightHandle.querySelector("rect");if(I&&I.setAttribute("x",k),T&&T.setAttribute("x",w-14),r.leftHandle.querySelectorAll(".drag-grip circle").forEach((g,M)=>g.setAttribute("cx",k+9)),r.rightHandle.querySelectorAll(".drag-grip circle").forEach((g,M)=>g.setAttribute("cx",w-9)),r.newStartX=k,r.newEndX=w,r.barLabels){let g=r.labelsOnLeft?k-r.startX:w-r.endX;r.barLabels.setAttribute("transform","translate("+g+", 0)")}r.connectedArrows&&He(r.connectedArrows,r.issueId,k,w),r.linkHandle&&r.linkHandle.querySelectorAll("circle").forEach(g=>g.setAttribute("cx",String(w+8)))}),c.snappedDelta=i}else{let i=c.startX,r=c.endX,D=c.endX-c.startX;c.isMove?(i=ge(Math.max(0,Math.min(c.startX+n,me-D))),r=i+D):c.isLeft?i=ge(Math.max(0,Math.min(c.startX+n,c.endX-G))):r=ge(Math.max(c.startX+G,Math.min(c.endX+n,me)));let k=r-i;c.barOutline.setAttribute("x",i),c.barOutline.setAttribute("width",k),c.barMain&&(c.barMain.setAttribute("x",i),c.barMain.setAttribute("width",k));let w=c.leftHandle.querySelector("rect"),F=c.rightHandle.querySelector("rect");if(w&&w.setAttribute("x",i),F&&F.setAttribute("x",r-14),c.leftHandle.querySelectorAll(".drag-grip circle").forEach(I=>I.setAttribute("cx",i+9)),c.rightHandle.querySelectorAll(".drag-grip circle").forEach(I=>I.setAttribute("cx",r-9)),c.newStartX=i,c.newEndX=r,c.barLabels){let I=c.labelsOnLeft?i-c.startX:r-c.endX;c.barLabels.setAttribute("transform","translate("+I+", 0)")}if(c.connectedArrows&&He(c.connectedArrows,c.issueId,i,r),c.linkHandle&&c.linkHandle.querySelectorAll("circle").forEach(I=>I.setAttribute("cx",String(r+8))),c.isMove&&!c.isBulkDrag){let I=B(i),T=N(r),M=I!==c.oldStartDate?W(c.oldStartDate,c.oldDueDate)+" \u2192 "+W(I,T):W(I,T);Ie(M),Pe(o.clientX,o.clientY)}else if(!c.isMove){let I=c.isLeft?i:r,T=c.isLeft?B(I):N(I);Ie((c.isLeft?"Start: ":"Due: ")+oe(T)),Pe(o.clientX,o.clientY)}}}if(z&&de){let i=document.querySelector("#ganttTimeline svg").getBoundingClientRect(),r=o.clientX-i.left,D=o.clientY-i.top,k=`M ${z.startX} ${z.startY} L ${r} ${D}`;de.setAttribute("d",k);let w=document.elementFromPoint(o.clientX,o.clientY)?.closest(".issue-bar");we&&we!==w&&we.classList.remove("link-target"),w&&w!==z.fromBar?(w.classList.add("link-target"),we=w):we=null}}})))});function Ve(t){if(!t)return;let{bar:o,barOutline:n,barMain:i,leftHandle:r,rightHandle:D,barLabels:k,startX:w,endX:F,connectedArrows:I,issueId:T,linkHandle:g}=t,M=F-w;if(n&&(n.setAttribute("x",String(w)),n.setAttribute("width",String(M))),i&&(i.setAttribute("x",String(w)),i.setAttribute("width",String(M))),r){let H=r.querySelector("rect");H&&H.setAttribute("x",String(w)),r.querySelectorAll(".drag-grip circle").forEach(Q=>Q.setAttribute("cx",w+9))}if(D){let H=D.querySelector("rect");H&&H.setAttribute("x",String(F-14)),D.querySelectorAll(".drag-grip circle").forEach(Q=>Q.setAttribute("cx",F-9))}k&&k.removeAttribute("transform"),I&&I.length>0&&He(I,T,w,F),g&&g.querySelectorAll("circle").forEach(H=>H.setAttribute("cx",String(F+8))),o&&o.classList.remove("dragging")}ue("mouseup",t=>{if(c){let{issueId:o,isLeft:n,isMove:i,isBulkDrag:r,bulkBars:D,newStartX:k,newEndX:w,bar:F,startX:I,endX:T,oldStartDate:g,oldDueDate:M,barOutline:H,barMain:Q,leftHandle:re,rightHandle:he,barLabels:$,connectedArrows:ke}=c,ie={...c};if(r&&D&&i){D.forEach(R=>R.bar.classList.remove("dragging"));let Se=[];if(D.forEach(R=>{if(R.newStartX!==void 0&&R.newStartX!==R.startX){let x=B(R.newStartX),j=N(R.newEndX);(x!==R.oldStartDate||j!==R.oldDueDate)&&Se.push({issueId:parseInt(R.issueId),oldStartDate:R.oldStartDate,oldDueDate:R.oldDueDate,newStartDate:x,newDueDate:j,barData:R})}}),Se.length>0){xe();let R=()=>{De.push({type:"bulk",changes:Se.map(x=>({issueId:x.issueId,oldStartDate:x.oldStartDate,oldDueDate:x.oldDueDate,newStartDate:x.newStartDate,newDueDate:x.newDueDate}))}),Ae.length=0,fe(),_(),Se.forEach(x=>{v.postMessage({command:"updateDates",issueId:x.issueId,startDate:x.newStartDate,dueDate:x.newDueDate})})};if(A&&A())R();else{let x="Move "+Se.length+" issue(s) to new dates?";$e(x,R,()=>{D.forEach(j=>Ve(j))})}}else xe(),D.forEach(R=>Ve(R));c=null,se=!0,requestAnimationFrame(()=>se=!1);return}if(F.classList.remove("dragging"),xe(),k!==void 0||w!==void 0){let Se=null,R=null;i?k!==I&&(Se=B(k),R=N(w)):n?Se=k!==I?B(k):null:R=w!==T?N(w):null;let x=Se&&Se!==g?Se:null,j=R&&R!==M?R:null;if(x||j){let Oe=()=>{De.push({issueId:o,oldStartDate:x?g:null,oldDueDate:j?M:null,newStartDate:x,newDueDate:j}),Ae.length=0,fe(),_(),v.postMessage({command:"updateDates",issueId:o,startDate:x,dueDate:j})};if(A&&A())Oe();else{let We="Issue #"+o+": ";x&&j?We+=W(g,M)+" \u2192 "+W(x,j):x?We+="Start: "+oe(g)+" \u2192 "+oe(x):We+="Due: "+oe(M)+" \u2192 "+oe(j),$e(We,Oe,()=>{Ve(ie)})}}else Ve(ie)}else Ve(ie);c=null,se=!0,requestAnimationFrame(()=>se=!1)}if(z){let o=z.fromId,n=z.fromAnchor;if(we){let i=parseInt(we.dataset.issueId);if(o!==i){let D=document.querySelector("#ganttTimeline svg").getBoundingClientRect(),k=t.clientX-D.left,w=we.querySelector(".bar-outline"),F=parseFloat(w.getAttribute("x")),I=F+parseFloat(w.getAttribute("width")),T=(F+I)/2,g=k<T?"start":"end";je(t.clientX,t.clientY,o,i,n,g)}}Me()}ve||y()}),J?.addEventListener("click",()=>{if(J.hasAttribute("disabled")||De.length===0)return;let t=De.pop();if(Ae.push(t),fe(),_(),t.type==="relation")t.operation==="create"?v.postMessage({command:"undoRelation",operation:"delete",relationId:t.relationId,datesBefore:t.datesBefore}):v.postMessage({command:"undoRelation",operation:"create",issueId:t.issueId,targetIssueId:t.targetIssueId,relationType:t.relationType});else if(t.type==="bulk"){let o=A&&A();t.changes.forEach(n=>{o?v.postMessage({command:"removeDraft",issueId:n.issueId,startDate:n.oldStartDate,dueDate:n.oldDueDate}):v.postMessage({command:"updateDates",issueId:n.issueId,startDate:n.oldStartDate,dueDate:n.oldDueDate})})}else A&&A()?v.postMessage({command:"removeDraft",issueId:t.issueId,startDate:t.oldStartDate,dueDate:t.oldDueDate}):v.postMessage({command:"updateDates",issueId:t.issueId,startDate:t.oldStartDate,dueDate:t.oldDueDate})}),K?.addEventListener("click",()=>{if(K.hasAttribute("disabled")||Ae.length===0)return;let t=Ae.pop();De.push(t),fe(),_(),t.type==="relation"?t.operation==="create"?v.postMessage({command:"redoRelation",operation:"create",issueId:t.issueId,targetIssueId:t.targetIssueId,relationType:t.relationType}):v.postMessage({command:"redoRelation",operation:"delete",relationId:t.relationId}):t.type==="bulk"?t.changes.forEach(o=>{v.postMessage({command:"updateDates",issueId:o.issueId,startDate:o.newStartDate,dueDate:o.newDueDate})}):v.postMessage({command:"updateDates",issueId:t.issueId,startDate:t.newStartDate,dueDate:t.newDueDate})})}function bt(E){let{vscode:v,addDocListener:J,addWinListener:K,announce:ue,barHeight:Z,selectedCollapseKey:ne}=E;document.querySelectorAll(".collapse-toggle").forEach(d=>{d.addEventListener("click",S=>{S.stopPropagation();let C=d.closest("[data-collapse-key]")?.dataset.collapseKey;C&&pe(C)})}),document.getElementById("menuExpand")?.addEventListener("click",()=>{let S=document.getElementById("ganttScroll")?.dataset.allExpandableKeys,b=S?JSON.parse(S):[];v.postMessage({command:"expandAll",keys:b})}),document.getElementById("menuCollapse")?.addEventListener("click",()=>{v.postMessage({command:"collapseAll"})});let _=Array.from(document.querySelectorAll(".project-label, .issue-label, .time-group-label")),fe=null,De=ne??null;function Ae(d){return!d.classList.contains("gantt-row-hidden")&&d.getAttribute("visibility")!=="hidden"}function ce(d,S){let b=d+S;for(;b>=0&&b<_.length;){if(Ae(_[b]))return{label:_[b],index:b};b+=S}return null}function O(d){let S=document.getElementById("ganttScroll"),b=document.querySelector(".gantt-header-row");if(!S||!d)return;let C=b?.getBoundingClientRect().height||60,A=d.closest(".gantt-row");if(!A)return;let l=A.getBoundingClientRect().top,h=A.getBoundingClientRect().height,B=S.getBoundingClientRect(),N=B.top+C,te=B.bottom;l<N?S.scrollBy({top:l-N-4,behavior:"smooth"}):l+h>te&&S.scrollBy({top:l+h-te+4,behavior:"smooth"})}function U(d,S=!1,b=!1,C=!1){fe&&fe.classList.remove("active"),fe=d,d&&(d.classList.add("active"),C||d.focus(),b&&O(d),S||v.postMessage({command:"setSelectedKey",collapseKey:d.dataset.collapseKey}))}K("focus",()=>{fe&&Ae(fe)&&fe.focus()}),J("keydown",d=>{d.key==="Escape"&&fe&&(fe.classList.remove("active"),fe.blur(),fe=null,v.postMessage({command:"setSelectedKey",collapseKey:null}))});let X=new Map,L=new Map,ee=new Map;function f(d){let S=d.dataset.originalY;if(ee.has(S))return ee.get(S);let b=JSON.parse(d.dataset.rowContributions||"{}");return ee.set(S,b),b}function me(){X.clear(),document.querySelectorAll("[data-collapse-key][data-original-y]").forEach(S=>{let b=S.dataset.collapseKey,C=parseFloat(S.dataset.originalY);X.has(b)||X.set(b,{originalY:C,elements:[]}),X.get(b).elements.push(S)})}function G(){L.clear(),document.querySelectorAll("[data-collapse-key][data-parent-key]").forEach(S=>{let b=S.dataset.collapseKey;if(L.has(b))return;let C=[],A=S.dataset.parentKey;for(;A;)C.push(A),A=document.querySelector('[data-collapse-key="'+A+'"]')?.dataset.parentKey||null;L.set(b,C)})}me(),G();function P(d,S){S?(d.setAttribute("visibility","hidden"),d.classList.add("gantt-row-hidden")):(d.removeAttribute("visibility"),d.classList.remove("gantt-row-hidden"))}function ae(d){let S=[];return L.forEach((b,C)=>{b.includes(d)&&S.push(C)}),S}function ge(d){let S=[];return L.forEach((b,C)=>{let A=b.indexOf(d);if(A===-1)return;let l=!0;for(let h=0;h<A;h++){let B=b[h],N=document.querySelector('[data-collapse-key="'+B+'"].project-label, [data-collapse-key="'+B+'"].issue-label, [data-collapse-key="'+B+'"].time-group-label');if(!N||N.dataset.expanded!=="true"){l=!1;break}}l&&S.push(C)}),S}function pe(d,S){let b=document.querySelector('[data-collapse-key="'+d+'"].project-label, [data-collapse-key="'+d+'"].time-group-label, [data-collapse-key="'+d+'"].issue-label');if(!b||b.dataset.hasChildren!=="true")return;let C=b.dataset.expanded==="true",A=S==="expand"?!0:S==="collapse"?!1:!C;if(A===C)return;b.dataset.expanded=A?"true":"false";let l=b.querySelector(".collapse-toggle");l&&l.classList.toggle("expanded",A);let h=ae(d),B=A?ge(d):[];if(h.length===0){v.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:A});return}let N=new Set(h),te=new Set(B),ye=X.get(d),oe=ye?.originalY??0,W=new Set,Ce=0,Ie=0,xe=A?B:ge(d),V=new Set(xe);if(document.querySelectorAll(".zebra-stripe").forEach(y=>{let c=f(y);d in c&&Ie===0&&(Ie=parseFloat(y.dataset.originalY||"0"));for(let[q,se]of Object.entries(c))V.has(q)&&!W.has(q)&&(Ce+=parseFloat(se),W.add(q))}),Ce===0&&xe.length>0){v.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:A}),v.postMessage({command:"requestRerender"});return}let m=A?Ce:-Ce,Te=oe;if(ye&&ye.elements.length>0){let c=(ye.elements[0].getAttribute("transform")||"").match(/translate\([^,]+,\s*([-\d.]+)/);c&&(Te=parseFloat(c[1]))}let Ye=Te+Z;A?B.forEach(y=>{let c=X.get(y);c&&(c.elements.forEach(q=>{let z=(q.getAttribute("transform")||"").match(/translate\(([-\d.]+)/),de=z?z[1]:"0";q.setAttribute("transform","translate("+de+", "+Ye+")"),P(q,!1)}),Ye+=Z)}):h.forEach(y=>{let c=X.get(y);c&&c.elements.forEach(q=>{P(q,!0)})}),X.forEach(({originalY:y,elements:c},q)=>{y>oe&&!N.has(q)&&c.forEach(se=>{let z=se.getAttribute("transform")||"",de=z.match(/translate\(([-\d.]+)/),we=de?de[1]:"0",Me=z.match(/translate\([^,]+,\s*([-\d.]+)/),Re=(Me?parseFloat(Me[1]):y)+m;se.setAttribute("transform","translate("+we+", "+Re+")")})});let Ke=document.querySelector(".gantt-labels svg");if(Ke){let c=parseFloat(Ke.getAttribute("height")||"0")+m;Ke.setAttribute("height",String(c))}[".gantt-col-status svg",".gantt-col-id svg",".gantt-col-start svg",".gantt-col-due svg",".gantt-col-assignee svg"].forEach(y=>{let c=document.querySelector(y);if(!c)return;let se=parseFloat(c.getAttribute("height")||"0")+m;c.setAttribute("height",String(se))});let Be=document.querySelector(".gantt-timeline svg");if(Be){let c=parseFloat(Be.getAttribute("height")||"0")+m;Be.setAttribute("height",c)}let Fe=new Set;document.querySelectorAll('.project-label[data-has-children="true"], .time-group-label[data-has-children="true"], .issue-label[data-has-children="true"]').forEach(y=>{y.dataset.expanded==="false"&&Fe.add(y.dataset.collapseKey)});let Xe=new Map,_e=document.querySelectorAll(".zebra-stripe");_e.forEach(y=>{let c=parseFloat(y.dataset.originalY||"0");if(Xe.has(c))return;let q=f(y),se=Object.keys(q),z=se.length>0&&se.every(Me=>N.has(Me)),de=se.some(Me=>N.has(Me)),we=c>Ie;if(z)Xe.set(c,{action:"toggle-visibility",hide:!A});else if(de)if(A){let Me=0;for(let[je,Re]of Object.entries(q))(!N.has(je)||te.has(je))&&(Me+=parseFloat(Re));Xe.set(c,{action:"expand",newHeight:Me})}else{let Me=0;for(let[je,Re]of Object.entries(q))N.has(je)||(Me+=parseFloat(Re));Xe.set(c,{action:"shrink",newHeight:Me})}else if(we){let Me=parseFloat(y.getAttribute("y")||String(c));Xe.set(c,{action:"shift",newY:Me+m})}}),_e.forEach(y=>{let c=parseFloat(y.dataset.originalY||"0"),q=Xe.get(c);if(q)switch(q.action){case"toggle-visibility":P(y,q.hide);break;case"shrink":y.setAttribute("height",String(q.newHeight));break;case"expand":y.setAttribute("height",String(q.newHeight));break;case"shift":y.setAttribute("y",String(q.newY));break}});let ve=Array.from(document.querySelectorAll(".zebra-stripe")).filter(y=>y.getAttribute("visibility")!=="hidden"),$e=new Map;ve.forEach(y=>{let c=parseFloat(y.getAttribute("y")||"0");$e.has(c)||$e.set(c,[]),$e.get(c).push(y)}),Array.from($e.keys()).sort((y,c)=>y-c).forEach((y,c)=>{let q=c%2===0?"0.03":"0.06";$e.get(y).forEach(se=>se.setAttribute("opacity",q))}),document.querySelectorAll(".indent-guide-line").forEach(y=>{let c=y.dataset.forParent,q=L.get(c)||[],se=Fe.has(c)||q.some(z=>Fe.has(z));if(P(y,se),!se){let z=X.get(c);if(z&&z.originalY>oe){let de=parseFloat(y.getAttribute("y1")||"0"),we=parseFloat(y.getAttribute("y2")||"0");y.setAttribute("y1",de+m),y.setAttribute("y2",we+m)}}}),document.querySelectorAll(".dependency-arrow").forEach(y=>{let c=y.dataset.from,q=y.dataset.to,se=document.querySelector('.issue-bar[data-issue-id="'+c+'"]'),z=document.querySelector('.issue-bar[data-issue-id="'+q+'"]'),de=se?.classList.contains("gantt-row-hidden"),we=z?.classList.contains("gantt-row-hidden");P(y,de||we)}),v.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:A})}if(De){let d=_.find(S=>S.dataset.collapseKey===De);d&&U(d,!0)}_.forEach((d,S)=>{d.addEventListener("click",b=>{if(b.target.closest?.(".collapse-toggle")||b.target.closest?.(".chevron-hit-area"))return;let C=d.dataset.issueId,A=d.classList.contains("project-label"),l=d.classList.contains("time-group-label"),h=d.dataset.collapseKey;if((A||l)&&h){U(d),d.dataset.hasChildren==="true"&&pe(h);return}let B=b.target.classList?.contains("issue-text")||b.target.closest(".issue-text");C&&B?(U(d,!1,!1,!0),v.postMessage({command:"openIssue",issueId:parseInt(C,10)})):d.dataset.hasChildren==="true"&&h?(U(d),pe(h)):U(d)}),d.addEventListener("keydown",b=>{let C=d.dataset.collapseKey,A=d.dataset.issueId?parseInt(d.dataset.issueId,10):NaN;switch(b.key){case"Enter":case" ":b.preventDefault(),isNaN(A)||v.postMessage({command:"openIssue",issueId:A});break;case"ArrowUp":{b.preventDefault();let l=ce(S,-1);l&&U(l.label,!1,!0);break}case"ArrowDown":{b.preventDefault();let l=ce(S,1);l&&U(l.label,!1,!0);break}case"ArrowLeft":if(b.preventDefault(),d.dataset.hasChildren==="true"&&d.dataset.expanded==="true")pe(C,"collapse");else if(d.dataset.parentKey){let l=_.find(h=>h.dataset.collapseKey===d.dataset.parentKey);l&&U(l,!1,!0)}break;case"ArrowRight":if(b.preventDefault(),d.dataset.hasChildren==="true"&&d.dataset.expanded==="false")pe(C,"expand");else if(d.dataset.hasChildren==="true"&&d.dataset.expanded==="true"){let l=_.find(h=>h.dataset.parentKey===C&&Ae(h));l&&U(l,!1,!0)}break;case"Home":{b.preventDefault();let l=ce(-1,1);l&&U(l.label,!1,!0);break}case"End":{b.preventDefault();let l=ce(_.length,-1);l&&U(l.label,!1,!0);break}case"PageDown":{b.preventDefault();let l=S,h=0;for(;h<10&&l<_.length-1;){let B=ce(l,1);if(!B)break;l=B.index,h++}h>0&&U(_[l],!1,!0);break}case"PageUp":{b.preventDefault();let l=S,h=0;for(;h<10&&l>0;){let B=ce(l,-1);if(!B)break;l=B.index,h++}h>0&&U(_[l],!1,!0);break}case"Tab":if(!b.shiftKey&&!isNaN(A)){let l=document.querySelector(`.issue-bar[data-issue-id="${A}"]`);l&&(b.preventDefault(),l.focus(),ue(`Timeline bar for issue #${A}`))}break}})})}function vt(E){let{vscode:v,addDocListener:J,menuUndo:K,menuRedo:ue,undoStack:Z,redoStack:ne,saveState:_,updateUndoRedoButtons:fe,announce:De,scrollToAndHighlight:Ae,scrollToToday:ce}=E;J("keydown",f=>{let G=navigator.platform.toUpperCase().indexOf("MAC")>=0?f.metaKey:f.ctrlKey;if(!(f.target.tagName==="INPUT"||f.target.tagName==="SELECT"||f.target.tagName==="TEXTAREA"))if(G&&f.key==="z"&&!f.shiftKey)f.preventDefault(),K?.click();else if(G&&f.key==="z"&&f.shiftKey)f.preventDefault(),ue?.click();else if(G&&f.key==="y")f.preventDefault(),ue?.click();else if(f.key>="1"&&f.key<="5"){let P=document.getElementById("zoomSelect"),ae=["day","week","month","quarter","year"];P.value=ae[parseInt(f.key)-1],P.dispatchEvent(new Event("change"))}else if(f.key.toLowerCase()==="h")document.getElementById("menuHeatmap")?.click();else if(f.key.toLowerCase()==="y")document.getElementById("menuCapacity")?.click();else if(f.key.toLowerCase()==="i")document.getElementById("menuIntensity")?.click();else if(f.key.toLowerCase()==="d")document.getElementById("menuDeps")?.click();else if(f.key.toLowerCase()==="v"){let P=document.getElementById("viewFocusSelect");P.value=P.value==="project"?"person":"project",P.dispatchEvent(new Event("change"))}else if(f.key.toLowerCase()==="r")document.getElementById("refreshBtn")?.click();else if(f.key.toLowerCase()==="t")ce();else if(f.key.toLowerCase()==="e")document.getElementById("menuExpand")?.click();else if(f.key.toLowerCase()==="c"&&!G)document.getElementById("menuCollapse")?.click();else if(f.key.toLowerCase()==="f"&&!G)f.preventDefault(),document.getElementById("menuFilterHealth")?.click();else if(f.key.toLowerCase()==="b"){f.preventDefault();let P=Array.from(document.querySelectorAll(".issue-bar[data-issue-id]")).filter(S=>S.querySelector(".blocker-badge"));if(P.length===0){De("No blocked issues");return}let ae=document.activeElement?.closest(".issue-bar"),pe=((ae?P.indexOf(ae):-1)+1)%P.length,d=P[pe];Ae(d.dataset.issueId),d.focus(),De("Blocked issue "+(pe+1)+" of "+P.length)}else if(f.key==="ArrowLeft"||f.key==="ArrowRight"){let P=document.activeElement?.closest(".issue-bar:not(.parent-bar)");if(!P)return;f.preventDefault();let ae=parseInt(P.dataset.issueId),ge=P.dataset.startDate,pe=P.dataset.dueDate;if(!ge&&!pe)return;let d=f.key==="ArrowRight"?1:-1,S=(A,l)=>{let h=new Date(A+"T00:00:00");return h.setDate(h.getDate()+l),h.toISOString().slice(0,10)},b=null,C=null;f.shiftKey&&pe?C=S(pe,d):f.altKey&&ge?b=S(ge,d):(ge&&(b=S(ge,d)),pe&&(C=S(pe,d))),(b||C)&&(_(),Z.push({issueId:ae,oldStartDate:b?ge:null,oldDueDate:C?pe:null,newStartDate:b,newDueDate:C}),ne.length=0,fe(),v.postMessage({command:"updateDates",issueId:ae,startDate:b,dueDate:C}))}else f.key==="/"&&!G?(f.preventDefault(),U()):(f.key==="?"||f.shiftKey&&f.key==="/")&&(f.preventDefault(),ee())});let O=null;function U(){O&&O.remove(),O=document.createElement("div"),O.className="quick-search",O.innerHTML=`
      <input type="text" placeholder="Search issues..." autofocus />
    `,document.body.appendChild(O);let f=O.querySelector("input");f.focus();let me=Array.from(document.querySelectorAll(".issue-label"));f.addEventListener("input",()=>{let G=f.value.toLowerCase();me.forEach(P=>{let ae=P.getAttribute("aria-label")?.toLowerCase()||"",ge=G&&ae.includes(G);P.classList.toggle("search-match",ge)})}),f.addEventListener("keydown",G=>{if(G.key==="Escape")X();else if(G.key==="Enter"){let P=document.querySelector(".issue-label.search-match");P&&(X(),P.focus(),Ae(P.dataset.issueId))}}),f.addEventListener("blur",()=>setTimeout(X,150))}function X(){O&&(O.remove(),O=null,document.querySelectorAll(".search-match").forEach(f=>f.classList.remove("search-match")))}let L=null;function ee(){if(L){L.remove(),L=null;return}L=document.createElement("div"),L.className="keyboard-help",L.innerHTML=`
      <div class="keyboard-help-content">
        <h3>Keyboard Shortcuts</h3>
        <div class="shortcut-grid">
          <div class="shortcut-section">
            <h4>Navigation</h4>
            <div><kbd>\u2191</kbd><kbd>\u2193</kbd> Move between issues</div>
            <div><kbd>Home</kbd><kbd>End</kbd> First/last issue</div>
            <div><kbd>PgUp</kbd><kbd>PgDn</kbd> Jump 10 rows</div>
            <div><kbd>Tab</kbd> Label \u2192 Bar</div>
            <div><kbd>Shift+Tab</kbd> Bar \u2192 Label</div>
          </div>
          <div class="shortcut-section">
            <h4>Date Editing</h4>
            <div><kbd>\u2190</kbd><kbd>\u2192</kbd> Move bar \xB11 day</div>
            <div><kbd>Shift+\u2190/\u2192</kbd> Resize end</div>
            <div><kbd>Alt+\u2190/\u2192</kbd> Resize start</div>
            <div><kbd>Ctrl+Z</kbd> Undo</div>
            <div><kbd>Ctrl+Y</kbd> Redo</div>
          </div>
          <div class="shortcut-section">
            <h4>View</h4>
            <div><kbd>1-5</kbd> Zoom levels</div>
            <div><kbd>H</kbd> Heatmap</div>
            <div><kbd>D</kbd> Dependencies</div>
            <div><kbd>C</kbd> Critical path</div>
            <div><kbd>T</kbd> Today</div>
          </div>
          <div class="shortcut-section">
            <h4>Health & Other</h4>
            <div><kbd>F</kbd> Cycle health filter</div>
            <div><kbd>B</kbd> Next blocked issue</div>
            <div><kbd>/</kbd> Quick search</div>
            <div><kbd>S</kbd> Cycle sort</div>
            <div><kbd>R</kbd> Refresh</div>
            <div><kbd>Esc</kbd> Clear/cancel</div>
          </div>
        </div>
        <p class="keyboard-help-close">Press <kbd>?</kbd> or <kbd>Esc</kbd> to close</p>
      </div>
    `,document.body.appendChild(L),L.addEventListener("click",f=>{f.target===L&&ee()})}J("keydown",f=>{f.key==="Escape"&&L&&(f.stopImmediatePropagation(),ee())})}var le=acquireVsCodeApi(),tt=!1;function Je(E){tt&&typeof performance<"u"&&performance.mark(E)}function lt(E,v,J){if(tt&&typeof performance<"u")try{performance.measure(E,v,J);let K=performance.getEntriesByName(E,"measure");K.length>0&&console.log(`[Gantt Perf] ${E}: ${K[K.length-1].duration.toFixed(2)}ms`),performance.clearMarks(v),performance.clearMarks(J),performance.clearMeasures(E)}catch{}}function Et(){if(tt){let E=document.getElementById("ganttRoot"),v=E?E.querySelectorAll("*").length:0,J=E?E.querySelectorAll("svg *").length:0;console.log(`[Gantt Perf] DOM nodes: ${v}, SVG elements: ${J}`)}}function Lt(E){if(!E)return;let v=document.documentElement;v.style.setProperty("--gantt-header-height",`${E.headerHeight}px`),v.style.setProperty("--gantt-label-width",`${E.labelWidth}px`),v.style.setProperty("--gantt-id-column-width",`${E.idColumnWidth}px`),v.style.setProperty("--gantt-start-date-column-width",`${E.startDateColumnWidth}px`),v.style.setProperty("--gantt-status-column-width",`${E.statusColumnWidth}px`),v.style.setProperty("--gantt-due-date-column-width",`${E.dueDateColumnWidth}px`),v.style.setProperty("--gantt-assignee-column-width",`${E.assigneeColumnWidth}px`),v.style.setProperty("--gantt-sticky-left-width",`${E.stickyLeftWidth}px`)}function Dt({addDocListener:E,addWinListener:v}){let J=document.getElementById("ganttRoot"),K=document.getElementById("ganttTooltip"),ue=K?.querySelector(".gantt-tooltip-content");if(!J||!K||!ue)return;let Z=l=>l?String(l).replace(/\r\n/g,`
`).trimEnd():"";function ne(){J.querySelectorAll("svg title").forEach(l=>{let h=l.parentElement,B=Z(l.textContent);h&&B&&(h.dataset.tooltip=B),l.remove()})}function _(){J.querySelectorAll("[title]").forEach(l=>{if(l.tagName.toLowerCase()==="title")return;let h=Z(l.getAttribute("title"));l.removeAttribute("title"),h&&(l.dataset.tooltip=h)})}function fe(){J.querySelectorAll("[data-toolbar-tooltip]").forEach(l=>{let h=Z(l.dataset.toolbarTooltip);delete l.dataset.toolbarTooltip,h&&(l.dataset.tooltip=h)})}function De(){ne(),_(),fe()}function Ae(l){let h=l.findIndex(N=>N.trim().startsWith("#"));return h>=0?h:l.filter(N=>N.trim()).length>1?l.findIndex(N=>N.trim()):-1}function ce(l){ue.textContent="";let h=Z(l);if(!h)return;let B=h.split(`
`),N=Ae(B),te=!1;B.forEach((oe,W)=>{let Ce=oe.trim();if(!Ce){if(!te){let V=document.createElement("div");V.className="gantt-tooltip-spacer",ue.appendChild(V),te=!0}return}if(Ce==="---"){let V=document.createElement("div");V.className="gantt-tooltip-divider",ue.appendChild(V),te=!1;return}let Ie=Ce.match(/^cf:([^:]+):(.*)$/);if(Ie){let V=Ie[1].trim(),m=Ie[2].trim(),Te=document.createElement("div");Te.className="gantt-tooltip-line";let Ye=document.createElement("span");Ye.className="gantt-tooltip-key",Ye.textContent=`${V}: `,Te.appendChild(Ye),m&&Te.appendChild(document.createTextNode(m)),ue.appendChild(Te),te=!1;return}let Pe=document.createElement("div");Pe.className="gantt-tooltip-line",W===N&&Pe.classList.add("gantt-tooltip-title");let xe=Ce.match(/^Open in Browser:\s*(\S+)/);if(xe&&/^https?:\/\//i.test(xe[1])){Pe.appendChild(document.createTextNode("Open in Browser: "));let V=document.createElement("a");V.href=xe[1],V.textContent=xe[1],V.target="_blank",V.rel="noopener noreferrer",Pe.appendChild(V)}else Pe.textContent=oe;ue.appendChild(Pe),te=!1});let ye=ue.lastElementChild;ye&&ye.classList.contains("gantt-tooltip-spacer")&&ye.remove()}let O=null,U=null,X=null,L={x:0,y:0};function ee(l){L={x:l.clientX,y:l.clientY}}function f(){U&&(clearTimeout(U),U=null)}function me(){X&&(clearTimeout(X),X=null)}function G(l){return l&&(l===K||K.contains(l))}function P(l){return l&&O&&(l===O||O.contains(l))}function ae(){if(!L)return!1;let l=document.elementFromPoint(L.x,L.y);return G(l)||P(l)}let ge=300;function pe(l){me(),X=setTimeout(()=>{X=null,!(!O||O!==l)&&ae()&&b(l,L.x,L.y)},ge)}function d(){f(),U=setTimeout(()=>{O&&(ae()||C())},300)}function S(l,h){let te=K.getBoundingClientRect(),ye=l+8,oe=h+8;ye+te.width>window.innerWidth-8&&(ye=l-te.width-8),oe+te.height>window.innerHeight-8&&(oe=h-te.height-8),ye=Math.max(8,Math.min(ye,window.innerWidth-te.width-8)),oe=Math.max(8,Math.min(oe,window.innerHeight-te.height-8)),K.style.left=`${Math.round(ye)}px`,K.style.top=`${Math.round(oe)}px`}function b(l,h,B){let N=l.dataset.tooltip;N&&(ce(N),K.classList.add("visible"),K.setAttribute("aria-hidden","false"),S(h,B))}function C(l=!1){me(),f(),K.classList.remove("visible"),K.setAttribute("aria-hidden","true"),l||(O=null)}function A(l){if(!l||l===K||K.contains(l))return null;let h=l.closest?.("[data-tooltip], [title]");if(!h||!J.contains(h))return null;if(h.hasAttribute("title")){let B=Z(h.getAttribute("title"));h.removeAttribute("title"),B&&(h.dataset.tooltip=B)}return h.dataset.tooltip?h:null}De(),E("pointerover",l=>{if(ee(l),G(l.target)){f(),me();return}let h=A(l.target);if(!h){me();return}f(),O!==h?(O=h,K.classList.contains("visible")&&C(!0),pe(h)):K.classList.contains("visible")||pe(h)},!0),E("pointermove",l=>{O&&(ee(l),U&&ae()&&f())},!0),E("pointerout",l=>{if(!O||(ee(l),me(),!P(l.target)&&!G(l.target)))return;let h=l.relatedTarget;G(h)||P(h)||d()},!0),E("scroll",()=>{O&&C()},!0),E("keydown",()=>{O&&C()},!0),v("blur",()=>{O&&C()})}function St(E){if(!E)return;E.state&&(tt=E.state.perfDebug??!1),Je("render-start");let v=document.getElementById("ganttRoot");v&&(Lt(E.state),Je("innerHTML-start"),v.innerHTML=E.html||"",Je("innerHTML-end"),lt("innerHTML","innerHTML-start","innerHTML-end"),At(E.state),Je("render-end"),lt("render","render-start","render-end"),Et())}window.addEventListener("message",E=>{let v=E.data;if(v){if(v.command==="render"){St(v.payload);return}window.__ganttHandleExtensionMessage&&window.__ganttHandleExtensionMessage(v)}});var wt=window.__GANTT_INITIAL_PAYLOAD__;wt&&St(wt);le.postMessage({command:"webviewReady"});function At(E){if(Je("initializeGantt-start"),!E)return;let{timelineWidth:v,minDateMs:J,maxDateMs:K,totalDays:ue,extendedRelationTypes:Z,redmineBaseUrl:ne,minimapBarsData:_,minimapHeight:fe,minimapBarHeight:De,minimapTodayX:Ae,extScrollLeft:ce,extScrollTop:O,labelWidth:U,leftExtrasWidth:X,healthFilter:L,sortBy:ee,sortOrder:f,selectedCollapseKey:me,barHeight:G,todayX:P,todayInRange:ae,isDraftMode:ge,draftQueueCount:pe}=E,d=v/ue,S=ge,b=document.getElementById("dragConfirmOk");b&&(b.textContent=ge?"Queue to Draft":"Save to Redmine");let C=document.getElementById("draftBadge");if(C){if(ge){C.classList.remove("hidden");let e=pe??0;C.textContent=e,C.dataset.tooltip=e===1?"1 change queued - click to review":e+" changes queued - click to review"}else C.classList.add("hidden");C.addEventListener("click",()=>{le.postMessage({command:"openDraftReview"})})}let A=document.getElementById("draftModeToggle");A&&A.addEventListener("click",()=>{le.postMessage({command:"toggleDraftMode"})}),window._ganttCleanup&&window._ganttCleanup();let l=[],h=[];function B(e,s,a){document.addEventListener(e,s,a),l.push({type:e,handler:s,options:a})}function N(e,s,a){window.addEventListener(e,s,a),h.push({type:e,handler:s,options:a})}window._ganttCleanup=()=>{l.forEach(e=>document.removeEventListener(e.type,e.handler,e.options)),h.forEach(e=>window.removeEventListener(e.type,e.handler,e.options)),window.__ganttHandleExtensionMessage=null};function te(e){setTimeout(()=>{document.addEventListener("click",function s(a){e.contains(a.target)||(e.remove(),document.removeEventListener("click",s))})},0)}function ye(e){return Math.round(e/d)*d}function oe(e){let s=document.getElementById("liveRegion");s&&(s.textContent=e)}let W=document.getElementById("ganttScroll"),Ce=document.getElementById("ganttLeftHeader"),Ie=document.getElementById("ganttLabels"),Pe=document.getElementById("ganttTimeline"),xe=document.getElementById("menuUndo"),V=document.getElementById("menuRedo"),m=document.getElementById("minimapSvg"),Te=document.getElementById("minimapViewport"),{updateMinimapPosition:Ye,updateMinimapViewport:Ke}=pt({timelineWidth:v,minimapBarsData:_,minimapHeight:fe,minimapBarHeight:De,minimapTodayX:Ae,ganttScroll:W,minimapSvg:m,minimapViewport:Te,addDocListener:B}),He=le.getState()||{undoStack:[],redoStack:[],labelWidth:U,scrollLeft:null,scrollTop:null,centerDateMs:null},Be=He.undoStack||[],Fe=He.redoStack||[],Xe=He.scrollLeft??(ce>0?ce:null),_e=He.scrollTop??(O>0?O:null),ve=He.centerDateMs;function $e(){if(!W)return null;let s=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,a=W.clientWidth-s,p=(W.scrollLeft+a/2)/v;return J+p*(K-J)}function ze(e){if(!W)return;let a=(e-J)/(K-J)*v,p=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,Y=W.clientWidth-p;W.scrollLeft=Math.max(0,a-Y/2)}function y(){le.setState({undoStack:Be,redoStack:Fe,labelWidth:Ie?.offsetWidth||U,scrollLeft:null,scrollTop:W?.scrollTop??null,centerDateMs:$e()})}let c=y;function q(){xe&&xe.toggleAttribute("disabled",Be.length===0),V&&V.toggleAttribute("disabled",Fe.length===0),y()}if(He.labelWidth&&Ce&&Ie){Ce.style.width=He.labelWidth+"px",Ie.style.width=He.labelWidth+"px";let e=document.querySelector(".capacity-ribbon-label");e&&(e.style.width=He.labelWidth+X+"px")}let se=!0,z=!1,de=e=>{z=e},we=null;W&&W.addEventListener("scroll",()=>{cancelAnimationFrame(we),we=requestAnimationFrame(()=>{Ke(),se||y()})},{passive:!0}),requestAnimationFrame(()=>q()),window.__ganttHandleExtensionMessage=e=>{if(e.command==="setHeatmapState"){let s=document.querySelector(".heatmap-layer"),a=document.querySelector(".weekend-layer"),u=document.getElementById("menuHeatmap");e.enabled?(s&&s.classList.remove("hidden"),a&&a.classList.add("hidden"),u&&u.classList.add("active")):(s&&s.classList.add("hidden"),a&&a.classList.remove("hidden"),u&&u.classList.remove("active"))}else if(e.command==="setDependenciesState"){let s=document.querySelector(".dependency-layer"),a=document.getElementById("menuDeps");e.enabled?(s&&s.classList.remove("hidden"),a&&a.classList.add("active")):(s&&s.classList.add("hidden"),a&&a.classList.remove("active"))}else if(e.command==="setCapacityRibbonState"){let s=document.querySelector(".capacity-ribbon"),a=document.getElementById("menuCapacity");e.enabled?(s&&s.classList.remove("hidden"),a&&a.classList.add("active")):(s&&s.classList.add("hidden"),a&&a.classList.remove("active"))}else if(e.command==="setIntensityState"){let s=document.querySelector(".gantt-container"),a=document.getElementById("menuIntensity");e.enabled?(s?.classList.add("intensity-enabled"),a&&a.classList.add("active")):(s?.classList.remove("intensity-enabled"),a&&a.classList.remove("active"))}else if(e.command==="setDraftModeState"){S=e.enabled;let s=document.getElementById("dragConfirmOk");s&&(s.textContent=e.enabled?"Queue to Draft":"Save to Redmine");let a=document.getElementById("draftModeToggle");a&&(a.classList.toggle("active",e.enabled),a.textContent=e.enabled?"Disable Draft Mode":"Enable Draft Mode");let u=document.getElementById("draftBadge");if(u)if(e.enabled){u.classList.remove("hidden");let p=e.queueCount??0;u.textContent=p,u.dataset.tooltip=p===1?"1 change queued - click to review":p+" changes queued - click to review"}else u.classList.add("hidden")}else if(e.command==="setDraftQueueCount"){let s=document.getElementById("draftBadge");if(s){let a=e.count;s.textContent=a,s.dataset.tooltip=a===1?"1 change queued - click to review":a+" changes queued - click to review"}}else if(e.command==="pushUndoAction")Be.push(e.action),Fe.length=0,q(),y();else if(e.command==="updateRelationId"){let s=e.stack==="undo"?Be:Fe;if(s.length>0){let a=s[s.length-1];a.type==="relation"&&(a.relationId=e.newRelationId,y())}}else if(e.command==="scrollToIssue"){let s=e.issueId,a=document.querySelector('.issue-label[data-issue-id="'+s+'"]'),u=document.querySelector('.issue-bar[data-issue-id="'+s+'"]'),p=document.getElementById("ganttScroll"),Ee=document.querySelector(".gantt-header-row")?.getBoundingClientRect().height||60;if(!p)return;let qe=p.scrollTop,Le=p.scrollLeft;if(a){let Ne=a.closest(".gantt-row");if(Ne){let Ue=Ne.offsetTop,Ge=Ne.getBoundingClientRect().height,Qe=p.clientHeight-Ee;qe=Math.max(0,Ue-Ee-(Qe-Ge)/2)}a.focus(),a.classList.add("highlighted"),setTimeout(()=>a.classList.remove("highlighted"),2e3)}if(u){let Ne=parseFloat(u.getAttribute("data-start-x")||"0"),Ge=parseFloat(u.getAttribute("data-end-x")||"0")-Ne,Qe=p.clientWidth,kt=document.querySelector(".gantt-sticky-left")?.getBoundingClientRect().width||0,ht=Qe-kt;Ge<=ht-100?Le=Ne-(ht-Ge)/2:Le=Ne-50,Le=Math.max(0,Le),u.classList.add("highlighted"),setTimeout(()=>u.classList.remove("highlighted"),2e3)}p.scrollTo({left:Le,top:qe,behavior:"smooth"})}},document.getElementById("lookbackSelect")?.addEventListener("change",e=>{le.postMessage({command:"setLookback",years:e.target.value})}),document.getElementById("zoomSelect")?.addEventListener("change",e=>{c(),le.postMessage({command:"setZoom",zoomLevel:e.target.value})}),document.getElementById("viewFocusSelect")?.addEventListener("change",e=>{le.postMessage({command:"setViewFocus",focus:e.target.value})}),document.getElementById("projectSelector")?.addEventListener("change",e=>{let s=e.target.value,a=s?parseInt(s,10):null;le.postMessage({command:"setSelectedProject",projectId:a})}),document.getElementById("focusSelector")?.addEventListener("change",e=>{let s=e.target.value;le.postMessage({command:"setSelectedAssignee",assignee:s||null})}),document.getElementById("filterAssignee")?.addEventListener("change",e=>{let s=e.target.value;le.postMessage({command:"setFilter",filter:{assignee:s}})}),document.getElementById("filterStatus")?.addEventListener("change",e=>{let s=e.target.value;le.postMessage({command:"setFilter",filter:{status:s}})}),document.getElementById("menuFilterHealth")?.addEventListener("click",()=>{let e=["all","critical","warning","healthy"],s=L,u=(e.indexOf(s)+1)%e.length;le.postMessage({command:"setHealthFilter",health:e[u]})}),document.querySelectorAll(".gantt-col-header.sortable").forEach(e=>{e.addEventListener("click",()=>{let s=e.dataset.sort;s===ee?f==="asc"?le.postMessage({command:"setSort",sortOrder:"desc"}):le.postMessage({command:"setSort",sortBy:null}):le.postMessage({command:"setSort",sortBy:s,sortOrder:"asc"})})}),document.getElementById("menuHeatmap")?.addEventListener("click",()=>{document.getElementById("menuHeatmap")?.hasAttribute("disabled")||(y(),le.postMessage({command:"toggleWorkloadHeatmap"}))}),document.getElementById("menuCapacity")?.addEventListener("click",()=>{document.getElementById("menuCapacity")?.hasAttribute("disabled")||(y(),le.postMessage({command:"toggleCapacityRibbon"}))}),document.getElementById("menuIntensity")?.addEventListener("click",()=>{document.getElementById("menuIntensity")?.hasAttribute("disabled")||(y(),le.postMessage({command:"toggleIntensity"}))}),document.getElementById("overloadBadge")?.addEventListener("click",e=>{e.stopPropagation();let s=e.currentTarget,a=parseInt(s.dataset.firstOverloadMs||"0",10);a>0&&(ze(a),y())}),document.querySelectorAll(".capacity-day-bar-group").forEach(e=>{e.addEventListener("click",s=>{let a=parseInt(s.currentTarget.dataset.dateMs||"0",10);a>0&&(ze(a),y())})}),document.getElementById("menuDeps")?.addEventListener("click",()=>{y(),le.postMessage({command:"toggleDependencies"})});let Re=document.querySelector(".gantt-container");function st(){let e=new Map,s=new Map;return document.querySelectorAll(".dependency-arrow").forEach(a=>{if(!(a.classList.contains("rel-blocks")||a.classList.contains("rel-precedes")))return;let p=a.dataset.from,Y=a.dataset.to;e.has(p)||e.set(p,[]),e.get(p).push(Y),s.has(Y)||s.set(Y,[]),s.get(Y).push(p)}),{graph:e,reverseGraph:s}}let be=null;function nt(e,s,a){let u=new Set([e]),p=[e];for(;p.length>0;){let Ee=p.shift(),qe=s.get(Ee)||[];for(let Le of qe)u.has(Le)||(u.add(Le),p.push(Le))}let Y=[e];for(;Y.length>0;){let Ee=Y.shift(),qe=a.get(Ee)||[];for(let Le of qe)u.has(Le)||(u.add(Le),Y.push(Le))}return u}function Ze(e){if(et(),!e)return;be=e;let{graph:s,reverseGraph:a}=st(),u=nt(e,s,a);Re.classList.add("focus-mode"),document.querySelectorAll(".issue-bar").forEach(p=>{u.has(p.dataset.issueId)&&p.classList.add("focus-highlighted")}),document.querySelectorAll(".issue-label").forEach(p=>{u.has(p.dataset.issueId)&&p.classList.add("focus-highlighted")}),document.querySelectorAll(".dependency-arrow").forEach(p=>{u.has(p.dataset.from)&&u.has(p.dataset.to)&&p.classList.add("focus-highlighted")}),oe(`Focus: ${u.size} issue${u.size!==1?"s":""} in dependency chain`)}function et(){be=null,Re.classList.remove("focus-mode"),document.querySelectorAll(".focus-highlighted").forEach(e=>e.classList.remove("focus-highlighted"))}let Ve=()=>be,t=new Set,o=null,n=document.getElementById("selectionCount"),i=Array.from(document.querySelectorAll(".issue-bar")),r=new Map;i.forEach(e=>{let s=e.dataset.issueId;s&&(r.has(s)||r.set(s,[]),r.get(s).push(e))});function D(e){e.forEach(s=>{let a=r.get(s);a&&a.forEach(u=>u.classList.toggle("selected",t.has(s)))}),t.size>0?(n.textContent=`${t.size} selected`,n.classList.remove("hidden"),Re.classList.add("multi-select-mode")):(n.classList.add("hidden"),Re.classList.remove("multi-select-mode"))}function k(){i.forEach(e=>{e.classList.toggle("selected",t.has(e.dataset.issueId))}),t.size>0?(n.textContent=`${t.size} selected`,n.classList.remove("hidden"),Re.classList.add("multi-select-mode")):(n.classList.add("hidden"),Re.classList.remove("multi-select-mode"))}function w(){let e=[...t];t.clear(),o=null,D(e)}function F(e){t.has(e)?t.delete(e):t.add(e),o=e,D([e])}function I(e,s){let a=i.findIndex(qe=>qe.dataset.issueId===e),u=i.findIndex(qe=>qe.dataset.issueId===s);if(a===-1||u===-1)return;let p=Math.min(a,u),Y=Math.max(a,u),Ee=[];for(let qe=p;qe<=Y;qe++){let Le=i[qe].dataset.issueId;t.has(Le)||(t.add(Le),Ee.push(Le))}D(Ee)}function T(){i.forEach(e=>t.add(e.dataset.issueId)),k(),oe(`Selected all ${t.size} issues`)}i.forEach(e=>{e.addEventListener("mousedown",s=>{if(!s.ctrlKey&&!s.metaKey&&!s.shiftKey||s.target.classList.contains("drag-handle")||s.target.classList.contains("link-handle"))return;s.preventDefault(),s.stopPropagation();let a=e.dataset.issueId;s.shiftKey&&o?I(o,a):F(a)})}),B("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="a"&&(e.preventDefault(),T()),e.key==="Escape"&&t.size>0&&(e.stopImmediatePropagation(),w(),oe("Selection cleared"))}),document.getElementById("refreshBtn")?.addEventListener("click",()=>{document.getElementById("loadingOverlay")?.classList.add("visible"),le.postMessage({command:"refresh"})}),document.getElementById("draftBadge")?.addEventListener("click",()=>{le.postMessage({command:"openDraftReview"})});function g(e,s,a,u,p){document.querySelector(".relation-picker")?.remove();let Y=document.createElement("div");Y.className="relation-picker";let Ee=150,qe=100,Le=Math.min(e,window.innerWidth-Ee-10),Ne=Math.min(s,window.innerHeight-qe-10);Y.style.left=Math.max(10,Le)+"px",Y.style.top=Math.max(10,Ne)+"px";let Ue=document.createElement("div");Ue.style.padding="6px 12px",Ue.style.fontSize="11px",Ue.style.opacity="0.7",Ue.textContent=`#${u} \u2192 #${p}`,Y.appendChild(Ue);let Ge=document.createElement("button");Ge.textContent="\u{1F5D1}\uFE0F Delete relation",Ge.addEventListener("click",()=>{y(),le.postMessage({command:"deleteRelation",relationId:a}),Y.remove()}),Y.appendChild(Ge);let Qe=document.createElement("button");Qe.textContent="Cancel",Qe.addEventListener("click",()=>Y.remove()),Y.appendChild(Qe),document.body.appendChild(Y),te(Y)}let M=new Map,H=new Map,Q=new Map,re=new Map,he=new Map,$=!1;function ke(){document.querySelectorAll(".issue-bar").forEach(e=>{let s=e.dataset.issueId;s&&(M.has(s)||M.set(s,[]),M.get(s).push(e))}),document.querySelectorAll(".issue-label").forEach(e=>{let s=e.dataset.issueId;s&&(H.has(s)||H.set(s,[]),H.get(s).push(e))}),document.querySelectorAll(".dependency-arrow").forEach(e=>{let s=e.dataset.from,a=e.dataset.to;s&&(Q.has(s)||Q.set(s,[]),Q.get(s).push(e)),a&&(Q.has(a)||Q.set(a,[]),Q.get(a).push(e))}),document.querySelectorAll(".project-label").forEach(e=>{let s=e.dataset.collapseKey;s&&(re.has(s)||re.set(s,[]),re.get(s).push(e))}),document.querySelectorAll(".aggregate-bars").forEach(e=>{let s=e.dataset.collapseKey;s&&(he.has(s)||he.set(s,[]),he.get(s).push(e))}),$=!0}typeof requestIdleCallback<"u"?requestIdleCallback(()=>ke(),{timeout:100}):setTimeout(ke,0);let ie=[];function Se(){document.body.classList.remove("hover-focus","dependency-hover"),ie.forEach(e=>e.classList.remove("hover-highlighted","hover-source")),ie=[]}function R(e){document.body.classList.add("hover-focus");let s=$?M.get(e)||[]:document.querySelectorAll('.issue-bar[data-issue-id="'+e+'"]'),a=$?H.get(e)||[]:document.querySelectorAll('.issue-label[data-issue-id="'+e+'"]'),u=$?Q.get(e)||[]:document.querySelectorAll('.dependency-arrow[data-from="'+e+'"], .dependency-arrow[data-to="'+e+'"]');s.forEach(p=>{p.classList.add("hover-highlighted"),ie.push(p)}),a.forEach(p=>{p.classList.add("hover-highlighted"),ie.push(p)}),u.forEach(p=>{p.classList.add("hover-highlighted"),ie.push(p)})}function x(e){document.body.classList.add("hover-focus");let s=$?re.get(e)||[]:document.querySelectorAll('.project-label[data-collapse-key="'+e+'"]'),a=$?he.get(e)||[]:document.querySelectorAll('.aggregate-bars[data-collapse-key="'+e+'"]');s.forEach(u=>{u.classList.add("hover-highlighted"),ie.push(u)}),a.forEach(u=>{u.classList.add("hover-highlighted"),ie.push(u)})}let j=document.querySelector(".gantt-timeline svg"),Oe=document.querySelector(".gantt-labels svg");if(j&&(j.addEventListener("mouseenter",e=>{let s=e.target.closest(".issue-bar"),a=e.target.closest(".aggregate-bars"),u=e.target.closest(".dependency-arrow");if(s){let p=s.dataset.issueId;p&&R(p)}else if(a){let p=a.dataset.collapseKey;p&&x(p)}else if(u){let p=u.dataset.from,Y=u.dataset.to;document.body.classList.add("dependency-hover"),u.classList.add("hover-source"),ie.push(u),p&&R(p),Y&&R(Y)}},!0),j.addEventListener("mouseleave",e=>{let s=e.target.closest(".issue-bar"),a=e.target.closest(".aggregate-bars"),u=e.target.closest(".dependency-arrow");(s||a||u)&&Se()},!0)),Oe&&(Oe.addEventListener("mouseenter",e=>{let s=e.target.closest(".issue-label"),a=e.target.closest(".project-label");if(s){let u=s.dataset.issueId;u&&R(u)}else if(a){let u=a.dataset.collapseKey;u&&x(u)}},!0),Oe.addEventListener("mouseleave",e=>{let s=e.target.closest(".issue-label"),a=e.target.closest(".project-label");(s||a)&&Se()},!0)),j){let s=function(){document.querySelectorAll(".dependency-arrow.selected").forEach(a=>a.classList.remove("selected")),document.body.classList.remove("arrow-selection-mode"),document.querySelectorAll(".arrow-connected").forEach(a=>a.classList.remove("arrow-connected")),e=null};var It=s;j.addEventListener("mousedown",a=>{if(a.button!==2)return;let u=a.target.closest(".dependency-arrow");if(!u)return;let p=u.querySelector("title");p&&p.remove()}),j.addEventListener("contextmenu",a=>{let u=a.target.closest(".dependency-arrow");if(!u)return;a.preventDefault();let p=parseInt(u.dataset.relationId),Y=u.dataset.from,Ee=u.dataset.to;g(a.clientX,a.clientY,p,Y,Ee)});let e=null;j.addEventListener("click",a=>{let u=a.target.closest(".dependency-arrow");if(e&&(e.classList.remove("selected"),document.body.classList.remove("arrow-selection-mode"),document.querySelectorAll(".arrow-connected").forEach(Ee=>Ee.classList.remove("arrow-connected")),e=null),!u)return;a.stopPropagation(),e=u,u.classList.add("selected"),document.body.classList.add("arrow-selection-mode");let p=u.dataset.from,Y=u.dataset.to;document.querySelectorAll(`.issue-bar[data-issue-id="${p}"], .issue-bar[data-issue-id="${Y}"]`).forEach(Ee=>Ee.classList.add("arrow-connected")),document.querySelectorAll(`.issue-label[data-issue-id="${p}"], .issue-label[data-issue-id="${Y}"]`).forEach(Ee=>Ee.classList.add("arrow-connected")),oe(`Selected relation from #${p} to #${Y}`)}),window._ganttArrowClickHandler&&document.removeEventListener("click",window._ganttArrowClickHandler),window._ganttArrowClickHandler=a=>{(e||document.querySelector(".dependency-arrow.selected"))&&!a.target.closest(".dependency-arrow")&&!a.target.closest(".blocks-badge-group")&&!a.target.closest(".blocker-badge")&&s()},document.addEventListener("click",window._ganttArrowClickHandler),window._ganttArrowKeyHandler&&document.removeEventListener("keydown",window._ganttArrowKeyHandler),window._ganttArrowKeyHandler=a=>{let u=e||document.querySelector(".dependency-arrow.selected");a.key==="Escape"&&u&&(a.stopImmediatePropagation(),s())},document.addEventListener("keydown",window._ganttArrowKeyHandler)}yt({vscode:le,menuUndo:xe,menuRedo:V,addDocListener:B,closeOnOutsideClick:te,announce:oe,saveState:y,updateUndoRedoButtons:q,undoStack:Be,redoStack:Fe,selectedIssues:t,clearSelection:w,allIssueBars:i,redmineBaseUrl:ne,extendedRelationTypes:Z,minDateMs:J,maxDateMs:K,timelineWidth:v,dayWidth:d,barHeight:G,ganttScroll:W,snapToDay:ye,focusOnDependencyChain:Ze,clearFocus:et,getFocusedIssueId:Ve,scrollToAndHighlight:ct,setAllowScrollChange:de,isDraftModeEnabled:()=>S,isPerfDebugEnabled:()=>tt}),bt({vscode:le,addDocListener:B,addWinListener:N,announce:oe,barHeight:G,selectedCollapseKey:me});function We(){if(!ae){le.postMessage({command:"todayOutOfRange"});return}if(W){let s=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,a=W.clientWidth-s;W.scrollLeft=Math.max(0,P-a/2)}}function ct(e){if(!e)return;z=!0;let s=document.querySelector('.issue-label[data-issue-id="'+e+'"]'),a=document.querySelector('.issue-bar[data-issue-id="'+e+'"]');if(s&&(s.scrollIntoView({behavior:"smooth",block:"center"}),s.classList.add("highlighted"),setTimeout(()=>s.classList.remove("highlighted"),1500)),a&&W){let u=a.getBoundingClientRect(),p=W.getBoundingClientRect(),Y=W.scrollLeft+u.left-p.left-100;W.scrollTo({left:Math.max(0,Y),behavior:"smooth"}),a.classList.add("highlighted"),setTimeout(()=>a.classList.remove("highlighted"),1500)}}vt({vscode:le,addDocListener:B,menuUndo:xe,menuRedo:V,undoStack:Be,redoStack:Fe,saveState:y,updateUndoRedoButtons:q,announce:oe,scrollToAndHighlight:ct,scrollToToday:We}),Dt({addDocListener:B,addWinListener:N,ganttScroll:W}),requestAnimationFrame(()=>{if(ve!==null&&W){let e=Math.max(J,Math.min(K,ve));ze(e),_e!==null&&(W.scrollTop=_e),ve=null,_e=null}else Xe!==null&&W?(W.scrollLeft=Xe,_e!==null&&(W.scrollTop=_e),Xe=null,_e=null):We();Ke(),se=!1}),document.getElementById("todayBtn")?.addEventListener("click",We);let dt=document.getElementById("resizeHandle"),ut=document.getElementById("resizeHandleHeader"),at=!1,ft=0,mt=0,ot=null;function gt(e,s){at=!0,ot=s,ft=e.clientX,mt=Ie.offsetWidth,s.classList.add("dragging"),document.body.classList.add("cursor-col-resize","user-select-none"),e.preventDefault()}dt?.addEventListener("mousedown",e=>gt(e,dt)),ut?.addEventListener("mousedown",e=>gt(e,ut));let rt=!1,it=null;B("mousemove",e=>{at&&(it=e,!rt&&(rt=!0,requestAnimationFrame(()=>{if(rt=!1,!it)return;let s=it.clientX-ft,a=Math.min(600,Math.max(120,mt+s));if(Ce&&(Ce.style.width=a+"px"),Ie){Ie.style.width=a+"px";let p=Ie.querySelector("svg");p&&p.setAttribute("width",String(a))}let u=document.querySelector(".capacity-ribbon-label");u&&(u.style.width=a+X+"px"),Ye()})))}),B("mouseup",()=>{at&&(at=!1,ot?.classList.remove("dragging"),ot=null,document.body.classList.remove("cursor-col-resize","user-select-none"),y())}),requestAnimationFrame(()=>{document.getElementById("loadingOverlay")?.classList.remove("visible")}),Je("initializeGantt-end"),lt("initializeGantt","initializeGantt-start","initializeGantt-end")}})();
