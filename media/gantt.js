"use strict";(()=>{function dt({timelineWidth:S,minimapBarsData:b,minimapHeight:j,minimapBarHeight:F,minimapTodayX:se,ganttScroll:J,minimapSvg:G,minimapViewport:X,addDocListener:ne}){function ge(){let M=document.querySelector(".gantt-body .gantt-sticky-left"),L=document.querySelector(".gantt-container");M&&L&&L.style.setProperty("--sticky-left-width",M.offsetWidth+"px")}requestAnimationFrame(ge),G&&requestAnimationFrame(()=>{let M=j/(b.length+1);if(b.forEach((L,K)=>{let u=document.createElementNS("http://www.w3.org/2000/svg","rect");u.setAttribute("class",L.classes),u.setAttribute("x",(L.startPct*S).toString()),u.setAttribute("y",(M*(K+.5)).toString()),u.setAttribute("width",Math.max(2,(L.endPct-L.startPct)*S).toString()),u.setAttribute("height",F.toString()),u.setAttribute("rx","1"),u.setAttribute("fill",L.color),G.insertBefore(u,X)}),se>0&&se<S){let L=document.createElementNS("http://www.w3.org/2000/svg","line");L.setAttribute("class","minimap-today"),L.setAttribute("x1",se.toString()),L.setAttribute("y1","0"),L.setAttribute("x2",se.toString()),L.setAttribute("y2",j.toString()),G.insertBefore(L,X)}});function pe(){if(!J||!X)return;let M=Math.max(1,J.scrollWidth-J.clientWidth),L=Math.min(1,J.scrollLeft/M),K=Math.min(1,J.clientWidth/J.scrollWidth),u=Math.max(20,K*S),ie=L*(S-u);X.setAttribute("x",ie.toString()),X.setAttribute("width",u.toString())}let T=!1,V=0;function z(M,L=!1){if(!J||!G||!X)return;let K=G.getBoundingClientRect(),ie=parseFloat(X.getAttribute("width")||"0")/S*K.width,_=M.clientX-K.left;L?_-=V:_-=ie/2;let x=Math.max(0,Math.min(1,_/(K.width-ie))),Q=Math.max(0,J.scrollWidth-J.clientWidth);J.scrollLeft=x*Q}return G&&X&&(X.addEventListener("mousedown",M=>{M.stopPropagation(),T=!0;let L=G.getBoundingClientRect(),u=parseFloat(X.getAttribute("x")||"0")/S*L.width;V=M.clientX-L.left-u}),G.addEventListener("mousedown",M=>{if(M.target===X)return;T=!0;let L=G.getBoundingClientRect();V=parseFloat(X.getAttribute("width")||"0")/100*L.width/2,z(M,!0)}),ne("mousemove",M=>{T&&z(M,!0)}),ne("mouseup",()=>{T=!1})),{updateMinimapPosition:ge,updateMinimapViewport:pe}}function ut(S){let{vscode:b,menuUndo:j,menuRedo:F,addDocListener:se,closeOnOutsideClick:J,announce:G,saveState:X,updateUndoRedoButtons:ne,undoStack:ge,redoStack:pe,selectedIssues:T,clearSelection:V,allIssueBars:z,redmineBaseUrl:M,extendedRelationTypes:L,minDateMs:K,maxDateMs:u,timelineWidth:ie,dayWidth:_,barHeight:x,ganttScroll:Q,snapToDay:ee,focusOnDependencyChain:le,clearFocus:d,getFocusedIssueId:p,scrollToAndHighlight:h,setAllowScrollChange:B}=S;function l(n,a,s){document.querySelector(".relation-picker")?.remove();let r=T.size>1&&T.has(s),i=r?Array.from(T).map(C=>parseInt(C)):[parseInt(s)],E=document.createElement("div");E.className="relation-picker";let A=160,k=180,W=Math.min(n,window.innerWidth-A-10),O=Math.min(a,window.innerHeight-k-10);E.style.left=Math.max(10,W)+"px",E.style.top=Math.max(10,O)+"px";let $=document.createElement("div");$.style.padding="6px 12px",$.style.fontSize="11px",$.style.opacity="0.7",$.textContent=r?i.length+" issues selected":"#"+s,E.appendChild($),(r?[{label:"Set % Done...",command:"bulkSetDoneRatio",bulk:!0},{label:"Clear Selection",command:"clearSelection",local:!0}]:[{label:"Update Issue...",command:"openIssue"},{label:"Open in Browser",command:"openInBrowser"},{label:"Show in Issues",command:"showInIssues"},{label:"Log Time",command:"logTime"},{label:"Set % Done",command:"setDoneRatio"},{label:"Toggle Auto-update %",command:"toggleAutoUpdate"},{label:"Toggle Ad-hoc Budget",command:"toggleAdHoc"},{label:"Toggle Precedence",command:"togglePrecedence"},{label:"Set Internal Estimate",command:"setInternalEstimate"},{label:"Copy Link",command:"copyLink",local:!0},{label:"Copy URL",command:"copyUrl"}]).forEach(C=>{let ae=document.createElement("button");ae.textContent=C.label,ae.addEventListener("click",async()=>{if(C.command==="copyLink"){let Me=document.querySelector('.issue-bar[data-issue-id="'+s+'"]')?.dataset?.subject||"Issue #"+s,Ke=M+"/issues/"+s,Re='<a href="'+Ke+'">#'+s+" "+Me+"</a>",Ye=Ke;try{await navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([Ye],{type:"text/plain"}),"text/html":new Blob([Re],{type:"text/html"})})]),b.postMessage({command:"showStatus",message:"Copied #"+s+" link"})}catch{await navigator.clipboard.writeText(Ye),b.postMessage({command:"showStatus",message:"Copied #"+s+" URL"})}}else C.local?V():C.bulk?b.postMessage({command:C.command,issueIds:i}):b.postMessage({command:C.command,issueId:parseInt(s)});E.remove()}),E.appendChild(ae)}),document.body.appendChild(E),J(E)}function c(n){let a=K+n/ie*(u-K);return new Date(a).toISOString().slice(0,10)}function m(n){let a=K+n/ie*(u-K)-864e5;return new Date(a).toISOString().slice(0,10)}let I=document.getElementById("dragDateTooltip"),H=null;function ce(n){let a=new Date(n+"T00:00:00"),s=a.toLocaleDateString("en-US",{month:"short"}),r=a.getDate(),i=a.toLocaleDateString("en-US",{weekday:"short"});return s+" "+r+" ("+i+")"}function te(n,a){let s=new Date(n+"T00:00:00"),r=new Date(a+"T00:00:00"),i=s.toLocaleDateString("en-US",{month:"short"}),E=r.toLocaleDateString("en-US",{month:"short"});return i===E?i+" "+s.getDate()+"-"+r.getDate():i+" "+s.getDate()+"-"+E+" "+r.getDate()}function Be(n){I.textContent=n,I.style.display="block",H=n}function qe(n){n!==H&&(I.textContent=n,H=n)}function Ee(n,a){let s=a-28,r=!1;s<40&&(s=a+20,r=!0),I.style.left=n+"px",I.style.top=s+"px",I.classList.toggle("flipped",r)}function ke(){I.style.display="none",H=null}let be=6;function N(n,a,s,r,i){let E=s>n,k=Math.abs(s-n)<30,W=Math.abs(a-r)<5,O;if(W&&E)O="M "+n+" "+a+" H "+(s-be);else if(!W&&k){let C=(a+r)/2;O="M "+n+" "+a+" H "+(n+20)+" V "+C+" H "+(s-20)+" V "+r+" H "+(s-be)}else if(E){let D=(n+s)/2;O="M "+n+" "+a+" H "+D+" V "+r+" H "+(s-be)}else if(W){let C=a-x;O="M "+n+" "+a+" V "+C+" H "+(s-12)+" V "+r+" H "+(s-be)}else{let C=(a+r)/2;O="M "+n+" "+a+" V "+C+" H "+(s-12)+" V "+r+" H "+(s-be)}let $="M "+s+" "+r+" l -"+be+" -"+be*.6+" l 0 "+be*1.2+" Z";return{path:O,arrowHead:$}}function De(n){let a=[],s='.dependency-arrow[data-from="'+n+'"], .dependency-arrow[data-to="'+n+'"]';return document.querySelectorAll(s).forEach(r=>{let i=r.getAttribute("data-from"),E=r.getAttribute("data-to"),k=(r.getAttribute("class")||"").match(/rel-(\w+)/),W=k?k[1]:"relates",O=["blocks","precedes","finish_to_start","start_to_start","finish_to_finish","start_to_finish"].includes(W),$=document.querySelector('.issue-bar[data-issue-id="'+i+'"]'),D=document.querySelector('.issue-bar[data-issue-id="'+E+'"]');!$||!D||a.push({element:r,fromId:i,toId:E,isScheduling:O,fromBar:$,toBar:D,linePath:r.querySelector(".arrow-line"),hitPath:r.querySelector(".arrow-hit-area"),headPath:r.querySelector(".arrow-head")})}),a}function re(n,a,s,r){n.forEach(i=>{let E=i.fromId==a?s:parseFloat(i.fromBar.dataset.startX),A=i.fromId==a?r:parseFloat(i.fromBar.dataset.endX),k=parseFloat(i.fromBar.dataset.centerY),W=i.toId==a?s:parseFloat(i.toBar.dataset.startX),O=i.toId==a?r:parseFloat(i.toBar.dataset.endX),$=parseFloat(i.toBar.dataset.centerY),D,C,ae,Ie;i.isScheduling?(D=A+2,C=k,ae=W-2,Ie=$):(D=(E+A)/2,C=k,ae=(W+O)/2,Ie=$);let{path:Me,arrowHead:Ke}=N(D,C,ae,Ie,i.isScheduling);i.linePath&&i.linePath.setAttribute("d",Me),i.hitPath&&i.hitPath.setAttribute("d",Me),i.headPath&&i.headPath.setAttribute("d",Ke)})}let ve=document.getElementById("dragConfirmOverlay"),Te=document.getElementById("dragConfirmMessage"),Fe=document.getElementById("dragConfirmOk"),Ze=document.getElementById("dragConfirmCancel"),de=null;function ue(n,a,s){!ve||!Te||(Te.textContent=n,de={onConfirm:a,onCancel:s},B(!0),ve.style.display="flex",Fe&&Fe.focus())}function Ae(){ve&&(ve.style.display="none"),de=null}function He(){Q&&we&&(Q.scrollLeft=we.left,Q.scrollTop=we.top),we=null}Fe?.addEventListener("click",()=>{de?.onConfirm&&de.onConfirm(),we=null,Ae()}),Ze?.addEventListener("click",()=>{de?.onCancel&&de.onCancel(),He(),Ae()}),ve?.addEventListener("click",n=>{n.target===ve&&(de?.onCancel&&de.onCancel(),He(),Ae())}),se("keydown",n=>{de&&(n.key==="Escape"?(n.preventDefault(),de.onCancel&&de.onCancel(),He(),Ae()):n.key==="Enter"&&(n.preventDefault(),de.onConfirm&&de.onConfirm(),we=null,Ae()))});let v=null,we=null,$e=!1;document.querySelectorAll(".drag-handle").forEach(n=>{n.addEventListener("mousedown",a=>{a.preventDefault(),a.stopPropagation(),we={left:Q?.scrollLeft,top:Q?.scrollTop};let s=n.closest(".issue-bar"),r=n.classList.contains("drag-left"),i=parseInt(s.dataset.issueId),E=parseFloat(s.dataset.startX),A=parseFloat(s.dataset.endX),k=s.dataset.startDate||null,W=s.dataset.dueDate||null,O=s.querySelector(".bar-outline"),$=s.querySelector(".bar-main"),D=s.querySelector(".drag-left"),C=s.querySelector(".drag-right");s.classList.add("dragging");let ae=s.querySelector(".bar-labels"),Ie=ae?.classList.contains("labels-left"),Me=De(i),Ke=s.querySelector(".link-handle");v={issueId:i,isLeft:r,isMove:!1,initialMouseX:a.clientX,startX:E,endX:A,oldStartDate:k,oldDueDate:W,barOutline:O,barMain:$,leftHandle:D,rightHandle:C,bar:s,barLabels:ae,labelsOnLeft:Ie,connectedArrows:Me,linkHandle:Ke};let Re=r?E:A,Ye=r?k:W;Ye&&(Be((r?"Start: ":"Due: ")+ce(Ye)),Ee(a.clientX,a.clientY))})}),document.querySelectorAll(".bar-outline").forEach(n=>{n.addEventListener("mousedown",a=>{if(a.target.classList.contains("drag-handle")||a.ctrlKey||a.metaKey||a.shiftKey)return;a.preventDefault(),a.stopPropagation(),we={left:Q?.scrollLeft,top:Q?.scrollTop};let s=n.closest(".issue-bar");if(!s)return;let r=s.dataset.issueId,i=T.size>1&&T.has(r),A=(i?z.filter(D=>T.has(D.dataset.issueId)):[s]).map(D=>({issueId:D.dataset.issueId,startX:parseFloat(D.dataset.startX),endX:parseFloat(D.dataset.endX),oldStartDate:D.dataset.startDate||null,oldDueDate:D.dataset.dueDate||null,barOutline:D.querySelector(".bar-outline"),barMain:D.querySelector(".bar-main"),leftHandle:D.querySelector(".drag-left"),rightHandle:D.querySelector(".drag-right"),bar:D,barLabels:D.querySelector(".bar-labels"),labelsOnLeft:D.querySelector(".bar-labels")?.classList.contains("labels-left"),connectedArrows:De(D.dataset.issueId),linkHandle:D.querySelector(".link-handle")}));A.forEach(D=>D.bar.classList.add("dragging"));let k=s.querySelector(".bar-labels"),W=k?.classList.contains("labels-left"),O=De(r),$=s.querySelector(".link-handle");v={issueId:parseInt(r),isLeft:!1,isMove:!0,isBulkDrag:i,bulkBars:A,initialMouseX:a.clientX,startX:parseFloat(s.dataset.startX),endX:parseFloat(s.dataset.endX),oldStartDate:s.dataset.startDate||null,oldDueDate:s.dataset.dueDate||null,barOutline:n,barMain:s.querySelector(".bar-main"),leftHandle:s.querySelector(".drag-left"),rightHandle:s.querySelector(".drag-right"),bar:s,barLabels:k,labelsOnLeft:W,connectedArrows:O,linkHandle:$},!i&&s.dataset.startDate&&s.dataset.dueDate&&(Be(te(s.dataset.startDate,s.dataset.dueDate)),Ee(a.clientX,a.clientY))})});let g=null,w=null,q=null;function U(){g&&(g.fromBar.classList.remove("linking-source"),document.querySelectorAll(".link-target").forEach(n=>n.classList.remove("link-target")),w&&(w.remove(),w=null),g=null,q=null,document.body.classList.remove("cursor-crosshair"))}function ye(n,a,s,r){document.querySelector(".relation-picker")?.remove();let i=document.createElement("div");i.className="relation-picker";let E=180,A=200,k=Math.min(n,window.innerWidth-E-10),W=Math.min(a,window.innerHeight-A-10);i.style.left=Math.max(10,k)+"px",i.style.top=Math.max(10,W)+"px";let O=[{value:"blocks",label:"\u{1F6AB} Blocks",cssClass:"rel-line-blocks",tooltip:"Target cannot be closed until this issue is closed"},{value:"precedes",label:"\u27A1\uFE0F Precedes",cssClass:"rel-line-scheduling",tooltip:"This issue must complete before target can start"},{value:"relates",label:"\u{1F517} Relates to",cssClass:"rel-line-informational",tooltip:"Simple link between issues (no constraints)"},{value:"duplicates",label:"\u{1F4CB} Duplicates",cssClass:"rel-line-informational",tooltip:"Closing target will automatically close this issue"},{value:"copied_to",label:"\u{1F4C4} Copied to",cssClass:"rel-line-informational",tooltip:"This issue was copied to create the target issue"}],$=[{value:"finish_to_start",label:"\u23E9 Finish\u2192Start",cssClass:"rel-line-scheduling",tooltip:"Target starts after this issue finishes (FS)"},{value:"start_to_start",label:"\u25B6\uFE0F Start\u2192Start",cssClass:"rel-line-scheduling",tooltip:"Target starts when this issue starts (SS)"},{value:"finish_to_finish",label:"\u23F9\uFE0F Finish\u2192Finish",cssClass:"rel-line-scheduling",tooltip:"Target finishes when this issue finishes (FF)"},{value:"start_to_finish",label:"\u23EA Start\u2192Finish",cssClass:"rel-line-scheduling",tooltip:"Target finishes when this issue starts (SF)"}];(L?[...O,...$]:O).forEach(C=>{let ae=document.createElement("button"),Ie=document.createElement("span");Ie.className="color-swatch "+C.cssClass,ae.appendChild(Ie),ae.appendChild(document.createTextNode(C.label)),ae.title=C.tooltip,ae.addEventListener("click",()=>{X(),b.postMessage({command:"createRelation",issueId:s,targetIssueId:r,relationType:C.value}),i.remove()}),i.appendChild(ae)}),document.body.appendChild(i),J(i)}let Se=".drag-handle, .link-handle, .bar-outline, .blocks-badge-group, .blocker-badge, .progress-badge-group, .flex-badge-group";document.querySelectorAll(".issue-bar").forEach(n=>{n.addEventListener("click",a=>{a.target.closest(Se)||v||g||$e||(p()&&d(),h(n.dataset.issueId))}),n.addEventListener("dblclick",a=>{v||g||$e||(a.preventDefault(),le(n.dataset.issueId))})});function Xe(n,a){if(document.querySelectorAll(".dependency-arrow.selected").forEach(r=>r.classList.remove("selected")),document.querySelectorAll(".arrow-connected").forEach(r=>r.classList.remove("arrow-connected")),n.length===0)return;document.body.classList.add("arrow-selection-mode");let s=new Set;n.forEach(r=>{r.classList.add("selected"),s.add(r.dataset.from),s.add(r.dataset.to)}),s.forEach(r=>{document.querySelectorAll(`.issue-bar[data-issue-id="${r}"], .issue-label[data-issue-id="${r}"]`).forEach(i=>i.classList.add("arrow-connected"))}),G(`Highlighted ${n.length} dependency arrow(s) for #${a}`)}document.querySelectorAll(".blocks-badge-group").forEach(n=>{n.addEventListener("mousedown",a=>{a.preventDefault(),a.stopPropagation()}),n.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation();let s=n.closest(".issue-bar");if(!s)return;let r=s.dataset.issueId,i=Array.from(document.querySelectorAll(`.dependency-arrow[data-from="${r}"]`));Xe(i,r)})}),document.querySelectorAll(".blocker-badge").forEach(n=>{n.addEventListener("mousedown",a=>{a.preventDefault(),a.stopPropagation()}),n.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation();let s=n.closest(".issue-bar");if(!s)return;let r=s.dataset.issueId,i=Array.from(document.querySelectorAll(`.dependency-arrow[data-to="${r}"]`));Xe(i,r)})});let P=Array.from(document.querySelectorAll(".issue-bar")),Pe=10;P.forEach((n,a)=>{n.addEventListener("keydown",s=>{if(s.key==="Enter"||s.key===" ")s.preventDefault(),h(n.dataset.issueId);else if(s.key==="ArrowDown"&&a<P.length-1)s.preventDefault(),P[a+1].focus(),G(`Issue ${P[a+1].getAttribute("aria-label")}`);else if(s.key==="ArrowUp"&&a>0)s.preventDefault(),P[a-1].focus(),G(`Issue ${P[a-1].getAttribute("aria-label")}`);else if(s.key==="Home")s.preventDefault(),P[0].focus(),G(`First issue: ${P[0].getAttribute("aria-label")}`);else if(s.key==="End")s.preventDefault(),P[P.length-1].focus(),G(`Last issue: ${P[P.length-1].getAttribute("aria-label")}`);else if(s.key==="PageDown"){s.preventDefault();let r=Math.min(a+Pe,P.length-1);P[r].focus(),G(`Issue ${P[r].getAttribute("aria-label")}`)}else if(s.key==="PageUp"){s.preventDefault();let r=Math.max(a-Pe,0);P[r].focus(),G(`Issue ${P[r].getAttribute("aria-label")}`)}else if(s.key==="Tab"&&s.shiftKey){let r=n.dataset.issueId,i=document.querySelector(`.issue-label[data-issue-id="${r}"]`);i&&(s.preventDefault(),i.focus(),G(`Label for issue #${r}`))}})}),document.querySelectorAll(".link-handle").forEach(n=>{n.addEventListener("mousedown",a=>{a.stopPropagation(),a.preventDefault();let s=n.closest(".issue-bar"),r=parseInt(s.dataset.issueId),i=parseFloat(n.dataset.cx),E=parseFloat(n.dataset.cy);s.classList.add("linking-source"),document.body.classList.add("cursor-crosshair");let A=document.querySelector("#ganttTimeline svg");if(!document.getElementById("temp-arrow-head")){let k=document.createElementNS("http://www.w3.org/2000/svg","defs");k.innerHTML=`
            <marker id="temp-arrow-head" markerWidth="10" markerHeight="7"
                    refX="9" refY="3.5" orient="auto" markerUnits="strokeWidth">
              <polygon points="0 0, 10 3.5, 0 7" fill="var(--vscode-focusBorder)"/>
            </marker>`,A.insertBefore(k,A.firstChild)}w=document.createElementNS("http://www.w3.org/2000/svg","path"),w.classList.add("temp-link-arrow"),w.setAttribute("stroke","var(--vscode-focusBorder)"),w.setAttribute("stroke-width","2"),w.setAttribute("fill","none"),w.setAttribute("marker-end","url(#temp-arrow-head)"),A.appendChild(w),g={fromId:r,fromBar:s,startX:i,startY:E}})}),se("keydown",n=>{if(n.key==="Escape"){let a=document.querySelector(".relation-picker");if(a){n.stopImmediatePropagation(),a.remove();return}if(g){n.stopImmediatePropagation(),U();return}p()&&(n.stopImmediatePropagation(),d(),G("Focus cleared"))}});let We=!1,fe=null;se("mousemove",n=>{!v&&!g||(fe=n,!We&&(We=!0,requestAnimationFrame(()=>{We=!1;let a=fe;if(a){if(v){let s=a.clientX-v.initialMouseX;if(v.isMove&&v.isBulkDrag&&v.bulkBars){let r=ee(s)-ee(0);v.bulkBars.forEach(i=>{let E=i.endX-i.startX,A=Math.max(0,Math.min(i.startX+r,ie-E)),k=A+E,W=k-A;if(i.barOutline.setAttribute("x",A),i.barOutline.setAttribute("width",W),i.barMain&&(i.barMain.setAttribute("x",A),i.barMain.setAttribute("width",W)),i.leftHandle.setAttribute("x",A),i.rightHandle.setAttribute("x",k-8),i.newStartX=A,i.newEndX=k,i.barLabels){let O=i.labelsOnLeft?A-i.startX:k-i.endX;i.barLabels.setAttribute("transform","translate("+O+", 0)")}i.connectedArrows&&re(i.connectedArrows,i.issueId,A,k),i.linkHandle&&i.linkHandle.querySelectorAll("circle").forEach(O=>O.setAttribute("cx",String(k+8)))}),v.snappedDelta=r}else{let r=v.startX,i=v.endX,E=v.endX-v.startX;v.isMove?(r=ee(Math.max(0,Math.min(v.startX+s,ie-E))),i=r+E):v.isLeft?r=ee(Math.max(0,Math.min(v.startX+s,v.endX-_))):i=ee(Math.max(v.startX+_,Math.min(v.endX+s,ie)));let A=i-r;if(v.barOutline.setAttribute("x",r),v.barOutline.setAttribute("width",A),v.barMain&&(v.barMain.setAttribute("x",r),v.barMain.setAttribute("width",A)),v.leftHandle.setAttribute("x",r),v.rightHandle.setAttribute("x",i-8),v.newStartX=r,v.newEndX=i,v.barLabels){let k=v.labelsOnLeft?r-v.startX:i-v.endX;v.barLabels.setAttribute("transform","translate("+k+", 0)")}if(v.connectedArrows&&re(v.connectedArrows,v.issueId,r,i),v.linkHandle&&v.linkHandle.querySelectorAll("circle").forEach(k=>k.setAttribute("cx",String(i+8))),v.isMove&&!v.isBulkDrag){let k=c(r),W=m(i),$=k!==v.oldStartDate?te(v.oldStartDate,v.oldDueDate)+" \u2192 "+te(k,W):te(k,W);qe($),Ee(a.clientX,a.clientY)}else if(!v.isMove){let k=v.isLeft?r:i,W=v.isLeft?c(k):m(k);qe((v.isLeft?"Start: ":"Due: ")+ce(W)),Ee(a.clientX,a.clientY)}}}if(g&&w){let r=document.querySelector("#ganttTimeline svg").getBoundingClientRect(),i=a.clientX-r.left,E=a.clientY-r.top,A=`M ${g.startX} ${g.startY} L ${i} ${E}`;w.setAttribute("d",A);let k=document.elementFromPoint(a.clientX,a.clientY)?.closest(".issue-bar");q&&q!==k&&q.classList.remove("link-target"),k&&k!==g.fromBar?(k.classList.add("link-target"),q=k):q=null}}})))});function Oe(n){if(!n)return;let{bar:a,barOutline:s,barMain:r,leftHandle:i,rightHandle:E,barLabels:A,startX:k,endX:W,connectedArrows:O,issueId:$,linkHandle:D}=n,C=W-k;s&&(s.setAttribute("x",String(k)),s.setAttribute("width",String(C))),r&&(r.setAttribute("x",String(k)),r.setAttribute("width",String(C))),i&&i.setAttribute("x",String(k)),E&&E.setAttribute("x",String(W-8)),A&&A.removeAttribute("transform"),O&&O.length>0&&re(O,$,k,W),D&&D.querySelectorAll("circle").forEach(ae=>ae.setAttribute("cx",String(W+8))),a&&a.classList.remove("dragging")}se("mouseup",n=>{if(v){let{issueId:a,isLeft:s,isMove:r,isBulkDrag:i,bulkBars:E,newStartX:A,newEndX:k,bar:W,startX:O,endX:$,oldStartDate:D,oldDueDate:C,barOutline:ae,barMain:Ie,leftHandle:Me,rightHandle:Ke,barLabels:Re,connectedArrows:Ye}=v,ze={...v};if(i&&E&&r){E.forEach(Y=>Y.bar.classList.remove("dragging"));let Ce=[];if(E.forEach(Y=>{if(Y.newStartX!==void 0&&Y.newStartX!==Y.startX){let Z=c(Y.newStartX),xe=m(Y.newEndX);(Z!==Y.oldStartDate||xe!==Y.oldDueDate)&&Ce.push({issueId:parseInt(Y.issueId),oldStartDate:Y.oldStartDate,oldDueDate:Y.oldDueDate,newStartDate:Z,newDueDate:xe,barData:Y})}}),Ce.length>0){ke();let Y="Move "+Ce.length+" issue(s) to new dates?";ue(Y,()=>{ge.push({type:"bulk",changes:Ce.map(Z=>({issueId:Z.issueId,oldStartDate:Z.oldStartDate,oldDueDate:Z.oldDueDate,newStartDate:Z.newStartDate,newDueDate:Z.newDueDate}))}),pe.length=0,ne(),X(),Ce.forEach(Z=>{b.postMessage({command:"updateDates",issueId:Z.issueId,startDate:Z.newStartDate,dueDate:Z.newDueDate})})},()=>{E.forEach(Z=>Oe(Z))})}else ke(),E.forEach(Y=>Oe(Y));v=null,$e=!0,requestAnimationFrame(()=>$e=!1);return}if(W.classList.remove("dragging"),ke(),A!==void 0||k!==void 0){let Ce=null,Y=null;r?A!==O&&(Ce=c(A),Y=m(k)):s?Ce=A!==O?c(A):null:Y=k!==$?m(k):null;let Z=Ce&&Ce!==D?Ce:null,xe=Y&&Y!==C?Y:null;if(Z||xe){let je="Issue #"+a+": ";Z&&xe?je+=te(D,C)+" \u2192 "+te(Z,xe):Z?je+="Start: "+ce(D)+" \u2192 "+ce(Z):je+="Due: "+ce(C)+" \u2192 "+ce(xe),ue(je,()=>{ge.push({issueId:a,oldStartDate:Z?D:null,oldDueDate:xe?C:null,newStartDate:Z,newDueDate:xe}),pe.length=0,ne(),X(),b.postMessage({command:"updateDates",issueId:a,startDate:Z,dueDate:xe})},()=>{Oe(ze)})}else Oe(ze)}else Oe(ze);v=null,$e=!0,requestAnimationFrame(()=>$e=!1)}if(g){let a=g.fromId;if(q){let s=parseInt(q.dataset.issueId);a!==s&&ye(n.clientX,n.clientY,a,s)}U()}de||He()}),j?.addEventListener("click",()=>{if(j.hasAttribute("disabled")||ge.length===0)return;let n=ge.pop();pe.push(n),ne(),X(),n.type==="relation"?n.operation==="create"?b.postMessage({command:"undoRelation",operation:"delete",relationId:n.relationId,datesBefore:n.datesBefore}):b.postMessage({command:"undoRelation",operation:"create",issueId:n.issueId,targetIssueId:n.targetIssueId,relationType:n.relationType}):n.type==="bulk"?n.changes.forEach(a=>{b.postMessage({command:"updateDates",issueId:a.issueId,startDate:a.oldStartDate,dueDate:a.oldDueDate})}):b.postMessage({command:"updateDates",issueId:n.issueId,startDate:n.oldStartDate,dueDate:n.oldDueDate})}),F?.addEventListener("click",()=>{if(F.hasAttribute("disabled")||pe.length===0)return;let n=pe.pop();ge.push(n),ne(),X(),n.type==="relation"?n.operation==="create"?b.postMessage({command:"redoRelation",operation:"create",issueId:n.issueId,targetIssueId:n.targetIssueId,relationType:n.relationType}):b.postMessage({command:"redoRelation",operation:"delete",relationId:n.relationId}):n.type==="bulk"?n.changes.forEach(a=>{b.postMessage({command:"updateDates",issueId:a.issueId,startDate:a.newStartDate,dueDate:a.newDueDate})}):b.postMessage({command:"updateDates",issueId:n.issueId,startDate:n.newStartDate,dueDate:n.newDueDate})})}function ft(S){let{vscode:b,addDocListener:j,addWinListener:F,announce:se,barHeight:J,selectedCollapseKey:G}=S;document.querySelectorAll(".collapse-toggle").forEach(d=>{d.addEventListener("click",p=>{p.stopPropagation();let B=d.closest("[data-collapse-key]")?.dataset.collapseKey;B&&le(B)})}),document.getElementById("menuExpand")?.addEventListener("click",()=>{let p=document.getElementById("ganttScroll")?.dataset.allExpandableKeys,h=p?JSON.parse(p):[];b.postMessage({command:"expandAll",keys:h})}),document.getElementById("menuCollapse")?.addEventListener("click",()=>{b.postMessage({command:"collapseAll"})});let X=Array.from(document.querySelectorAll(".project-label, .issue-label, .time-group-label")),ne=null,ge=G??null;function pe(d){return!d.classList.contains("gantt-row-hidden")&&d.getAttribute("visibility")!=="hidden"}function T(d,p){let h=d+p;for(;h>=0&&h<X.length;){if(pe(X[h]))return{label:X[h],index:h};h+=p}return null}function V(d){let p=document.getElementById("ganttScroll"),h=document.querySelector(".gantt-header-row");if(!p||!d)return;let B=h?.getBoundingClientRect().height||60,l=d.closest(".gantt-row");if(!l)return;let c=l.getBoundingClientRect().top,m=l.getBoundingClientRect().height,I=p.getBoundingClientRect(),H=I.top+B,ce=I.bottom;c<H?p.scrollBy({top:c-H-4,behavior:"smooth"}):c+m>ce&&p.scrollBy({top:c+m-ce+4,behavior:"smooth"})}function z(d,p=!1,h=!1,B=!1){ne&&ne.classList.remove("active"),ne=d,d&&(d.classList.add("active"),B||d.focus(),h&&V(d),p||b.postMessage({command:"setSelectedKey",collapseKey:d.dataset.collapseKey}))}F("focus",()=>{ne&&pe(ne)&&ne.focus()}),j("keydown",d=>{d.key==="Escape"&&ne&&(ne.classList.remove("active"),ne.blur(),ne=null,b.postMessage({command:"setSelectedKey",collapseKey:null}))});let M=new Map,L=new Map,K=new Map;function u(d){let p=d.dataset.originalY;if(K.has(p))return K.get(p);let h=JSON.parse(d.dataset.rowContributions||"{}");return K.set(p,h),h}function ie(){M.clear(),document.querySelectorAll("[data-collapse-key][data-original-y]").forEach(p=>{let h=p.dataset.collapseKey,B=parseFloat(p.dataset.originalY);M.has(h)||M.set(h,{originalY:B,elements:[]}),M.get(h).elements.push(p)})}function _(){L.clear(),document.querySelectorAll("[data-collapse-key][data-parent-key]").forEach(p=>{let h=p.dataset.collapseKey;if(L.has(h))return;let B=[],l=p.dataset.parentKey;for(;l;)B.push(l),l=document.querySelector('[data-collapse-key="'+l+'"]')?.dataset.parentKey||null;L.set(h,B)})}ie(),_();function x(d,p){p?(d.setAttribute("visibility","hidden"),d.classList.add("gantt-row-hidden")):(d.removeAttribute("visibility"),d.classList.remove("gantt-row-hidden"))}function Q(d){let p=[];return L.forEach((h,B)=>{h.includes(d)&&p.push(B)}),p}function ee(d){let p=[];return L.forEach((h,B)=>{let l=h.indexOf(d);if(l===-1)return;let c=!0;for(let m=0;m<l;m++){let I=h[m],H=document.querySelector('[data-collapse-key="'+I+'"].project-label, [data-collapse-key="'+I+'"].issue-label, [data-collapse-key="'+I+'"].time-group-label');if(!H||H.dataset.expanded!=="true"){c=!1;break}}c&&p.push(B)}),p}function le(d,p){let h=document.querySelector('[data-collapse-key="'+d+'"].project-label, [data-collapse-key="'+d+'"].time-group-label, [data-collapse-key="'+d+'"].issue-label');if(!h||h.dataset.hasChildren!=="true")return;let B=h.dataset.expanded==="true",l=p==="expand"?!0:p==="collapse"?!1:!B;if(l===B)return;h.dataset.expanded=l?"true":"false";let c=h.querySelector(".collapse-toggle");c&&c.classList.toggle("expanded",l);let m=Q(d),I=l?ee(d):[];if(m.length===0){b.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:l});return}let H=new Set(m),ce=new Set(I),te=M.get(d),Be=te?.originalY??0,qe=new Set,Ee=0,ke=0,N=l?I:ee(d),De=new Set(N);if(document.querySelectorAll(".zebra-stripe").forEach(g=>{let w=u(g);d in w&&ke===0&&(ke=parseFloat(g.dataset.originalY||"0"));for(let[q,U]of Object.entries(w))De.has(q)&&!qe.has(q)&&(Ee+=parseFloat(U),qe.add(q))}),Ee===0&&N.length>0){b.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:l}),b.postMessage({command:"requestRerender"});return}let re=l?Ee:-Ee,ve=Be;if(te&&te.elements.length>0){let w=(te.elements[0].getAttribute("transform")||"").match(/translate\([^,]+,\s*([-\d.]+)/);w&&(ve=parseFloat(w[1]))}let Te=ve+J;l?I.forEach(g=>{let w=M.get(g);w&&(w.elements.forEach(q=>{let ye=(q.getAttribute("transform")||"").match(/translate\(([-\d.]+)/),Se=ye?ye[1]:"0";q.setAttribute("transform","translate("+Se+", "+Te+")"),x(q,!1)}),Te+=J)}):m.forEach(g=>{let w=M.get(g);w&&w.elements.forEach(q=>{x(q,!0)})}),M.forEach(({originalY:g,elements:w},q)=>{g>Be&&!H.has(q)&&w.forEach(U=>{let ye=U.getAttribute("transform")||"",Se=ye.match(/translate\(([-\d.]+)/),Xe=Se?Se[1]:"0",P=ye.match(/translate\([^,]+,\s*([-\d.]+)/),We=(P?parseFloat(P[1]):g)+re;U.setAttribute("transform","translate("+Xe+", "+We+")")})});let Fe=document.querySelector(".gantt-labels svg");if(Fe){let w=parseFloat(Fe.getAttribute("height")||"0")+re;Fe.setAttribute("height",String(w))}[".gantt-col-status svg",".gantt-col-id svg",".gantt-col-start svg",".gantt-col-due svg",".gantt-col-assignee svg"].forEach(g=>{let w=document.querySelector(g);if(!w)return;let U=parseFloat(w.getAttribute("height")||"0")+re;w.setAttribute("height",String(U))});let de=document.querySelector(".gantt-timeline svg");if(de){let w=parseFloat(de.getAttribute("height")||"0")+re;de.setAttribute("height",w)}let ue=new Set;document.querySelectorAll('.project-label[data-has-children="true"], .time-group-label[data-has-children="true"], .issue-label[data-has-children="true"]').forEach(g=>{g.dataset.expanded==="false"&&ue.add(g.dataset.collapseKey)});let Ae=new Map,He=document.querySelectorAll(".zebra-stripe");He.forEach(g=>{let w=parseFloat(g.dataset.originalY||"0");if(Ae.has(w))return;let q=u(g),U=Object.keys(q),ye=U.length>0&&U.every(P=>H.has(P)),Se=U.some(P=>H.has(P)),Xe=w>ke;if(ye)Ae.set(w,{action:"toggle-visibility",hide:!l});else if(Se)if(l){let P=0;for(let[Pe,We]of Object.entries(q))(!H.has(Pe)||ce.has(Pe))&&(P+=parseFloat(We));Ae.set(w,{action:"expand",newHeight:P})}else{let P=0;for(let[Pe,We]of Object.entries(q))H.has(Pe)||(P+=parseFloat(We));Ae.set(w,{action:"shrink",newHeight:P})}else if(Xe){let P=parseFloat(g.getAttribute("y")||String(w));Ae.set(w,{action:"shift",newY:P+re})}}),He.forEach(g=>{let w=parseFloat(g.dataset.originalY||"0"),q=Ae.get(w);if(q)switch(q.action){case"toggle-visibility":x(g,q.hide);break;case"shrink":g.setAttribute("height",String(q.newHeight));break;case"expand":g.setAttribute("height",String(q.newHeight));break;case"shift":g.setAttribute("y",String(q.newY));break}});let v=Array.from(document.querySelectorAll(".zebra-stripe")).filter(g=>g.getAttribute("visibility")!=="hidden"),we=new Map;v.forEach(g=>{let w=parseFloat(g.getAttribute("y")||"0");we.has(w)||we.set(w,[]),we.get(w).push(g)}),Array.from(we.keys()).sort((g,w)=>g-w).forEach((g,w)=>{let q=w%2===0?"0.03":"0.06";we.get(g).forEach(U=>U.setAttribute("opacity",q))}),document.querySelectorAll(".indent-guide-line").forEach(g=>{let w=g.dataset.forParent,q=L.get(w)||[],U=ue.has(w)||q.some(ye=>ue.has(ye));if(x(g,U),!U){let ye=M.get(w);if(ye&&ye.originalY>Be){let Se=parseFloat(g.getAttribute("y1")||"0"),Xe=parseFloat(g.getAttribute("y2")||"0");g.setAttribute("y1",Se+re),g.setAttribute("y2",Xe+re)}}}),document.querySelectorAll(".dependency-arrow").forEach(g=>{let w=g.dataset.from,q=g.dataset.to,U=document.querySelector('.issue-bar[data-issue-id="'+w+'"]'),ye=document.querySelector('.issue-bar[data-issue-id="'+q+'"]'),Se=U?.classList.contains("gantt-row-hidden"),Xe=ye?.classList.contains("gantt-row-hidden");x(g,Se||Xe)}),b.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:l})}if(ge){let d=X.find(p=>p.dataset.collapseKey===ge);d&&z(d,!0)}X.forEach((d,p)=>{d.addEventListener("click",h=>{if(h.target.closest?.(".collapse-toggle")||h.target.closest?.(".chevron-hit-area"))return;let B=d.dataset.issueId,l=d.classList.contains("project-label"),c=d.classList.contains("time-group-label"),m=d.dataset.collapseKey;if((l||c)&&m){z(d),d.dataset.hasChildren==="true"&&le(m);return}let I=h.target.classList?.contains("issue-text")||h.target.closest(".issue-text");B&&I?(z(d,!1,!1,!0),b.postMessage({command:"openIssue",issueId:parseInt(B,10)})):d.dataset.hasChildren==="true"&&m?(z(d),le(m)):z(d)}),d.addEventListener("keydown",h=>{let B=d.dataset.collapseKey,l=d.dataset.issueId?parseInt(d.dataset.issueId,10):NaN;switch(h.key){case"Enter":case" ":h.preventDefault(),isNaN(l)||b.postMessage({command:"openIssue",issueId:l});break;case"ArrowUp":{h.preventDefault();let c=T(p,-1);c&&z(c.label,!1,!0);break}case"ArrowDown":{h.preventDefault();let c=T(p,1);c&&z(c.label,!1,!0);break}case"ArrowLeft":if(h.preventDefault(),d.dataset.hasChildren==="true"&&d.dataset.expanded==="true")le(B,"collapse");else if(d.dataset.parentKey){let c=X.find(m=>m.dataset.collapseKey===d.dataset.parentKey);c&&z(c,!1,!0)}break;case"ArrowRight":if(h.preventDefault(),d.dataset.hasChildren==="true"&&d.dataset.expanded==="false")le(B,"expand");else if(d.dataset.hasChildren==="true"&&d.dataset.expanded==="true"){let c=X.find(m=>m.dataset.parentKey===B&&pe(m));c&&z(c,!1,!0)}break;case"Home":{h.preventDefault();let c=T(-1,1);c&&z(c.label,!1,!0);break}case"End":{h.preventDefault();let c=T(X.length,-1);c&&z(c.label,!1,!0);break}case"PageDown":{h.preventDefault();let c=p,m=0;for(;m<10&&c<X.length-1;){let I=T(c,1);if(!I)break;c=I.index,m++}m>0&&z(X[c],!1,!0);break}case"PageUp":{h.preventDefault();let c=p,m=0;for(;m<10&&c>0;){let I=T(c,-1);if(!I)break;c=I.index,m++}m>0&&z(X[c],!1,!0);break}case"Tab":if(!h.shiftKey&&!isNaN(l)){let c=document.querySelector(`.issue-bar[data-issue-id="${l}"]`);c&&(h.preventDefault(),c.focus(),se(`Timeline bar for issue #${l}`))}break}})})}function mt(S){let{vscode:b,addDocListener:j,menuUndo:F,menuRedo:se,undoStack:J,redoStack:G,saveState:X,updateUndoRedoButtons:ne,announce:ge,scrollToAndHighlight:pe,scrollToToday:T}=S;j("keydown",u=>{let _=navigator.platform.toUpperCase().indexOf("MAC")>=0?u.metaKey:u.ctrlKey;if(!(u.target.tagName==="INPUT"||u.target.tagName==="SELECT"||u.target.tagName==="TEXTAREA"))if(_&&u.key==="z"&&!u.shiftKey)u.preventDefault(),F?.click();else if(_&&u.key==="z"&&u.shiftKey)u.preventDefault(),se?.click();else if(_&&u.key==="y")u.preventDefault(),se?.click();else if(u.key>="1"&&u.key<="5"){let x=document.getElementById("zoomSelect"),Q=["day","week","month","quarter","year"];x.value=Q[parseInt(u.key)-1],x.dispatchEvent(new Event("change"))}else if(u.key.toLowerCase()==="h")document.getElementById("menuHeatmap")?.click();else if(u.key.toLowerCase()==="y")document.getElementById("menuCapacity")?.click();else if(u.key.toLowerCase()==="i")document.getElementById("menuIntensity")?.click();else if(u.key.toLowerCase()==="d")document.getElementById("menuDeps")?.click();else if(u.key.toLowerCase()==="v"){let x=document.getElementById("viewFocusSelect");x.value=x.value==="project"?"person":"project",x.dispatchEvent(new Event("change"))}else if(u.key.toLowerCase()==="r")document.getElementById("refreshBtn")?.click();else if(u.key.toLowerCase()==="t")T();else if(u.key.toLowerCase()==="e")document.getElementById("menuExpand")?.click();else if(u.key.toLowerCase()==="c"&&!_)document.getElementById("menuCollapse")?.click();else if(u.key.toLowerCase()==="f"&&!_)u.preventDefault(),document.getElementById("menuFilterHealth")?.click();else if(u.key.toLowerCase()==="b"){u.preventDefault();let x=Array.from(document.querySelectorAll(".issue-bar[data-issue-id]")).filter(p=>p.querySelector(".blocker-badge"));if(x.length===0){ge("No blocked issues");return}let Q=document.activeElement?.closest(".issue-bar"),le=((Q?x.indexOf(Q):-1)+1)%x.length,d=x[le];pe(d.dataset.issueId),d.focus(),ge("Blocked issue "+(le+1)+" of "+x.length)}else if(u.key==="ArrowLeft"||u.key==="ArrowRight"){let x=document.activeElement?.closest(".issue-bar:not(.parent-bar)");if(!x)return;u.preventDefault();let Q=parseInt(x.dataset.issueId),ee=x.dataset.startDate,le=x.dataset.dueDate;if(!ee&&!le)return;let d=u.key==="ArrowRight"?1:-1,p=(l,c)=>{let m=new Date(l+"T00:00:00");return m.setDate(m.getDate()+c),m.toISOString().slice(0,10)},h=null,B=null;u.shiftKey&&le?B=p(le,d):u.altKey&&ee?h=p(ee,d):(ee&&(h=p(ee,d)),le&&(B=p(le,d))),(h||B)&&(X(),J.push({issueId:Q,oldStartDate:h?ee:null,oldDueDate:B?le:null,newStartDate:h,newDueDate:B}),G.length=0,ne(),b.postMessage({command:"updateDates",issueId:Q,startDate:h,dueDate:B}))}else u.key==="/"&&!_?(u.preventDefault(),z()):(u.key==="?"||u.shiftKey&&u.key==="/")&&(u.preventDefault(),K())});let V=null;function z(){V&&V.remove(),V=document.createElement("div"),V.className="quick-search",V.innerHTML=`
      <input type="text" placeholder="Search issues..." autofocus />
    `,document.body.appendChild(V);let u=V.querySelector("input");u.focus();let ie=Array.from(document.querySelectorAll(".issue-label"));u.addEventListener("input",()=>{let _=u.value.toLowerCase();ie.forEach(x=>{let Q=x.getAttribute("aria-label")?.toLowerCase()||"",ee=_&&Q.includes(_);x.classList.toggle("search-match",ee)})}),u.addEventListener("keydown",_=>{if(_.key==="Escape")M();else if(_.key==="Enter"){let x=document.querySelector(".issue-label.search-match");x&&(M(),x.focus(),pe(x.dataset.issueId))}}),u.addEventListener("blur",()=>setTimeout(M,150))}function M(){V&&(V.remove(),V=null,document.querySelectorAll(".search-match").forEach(u=>u.classList.remove("search-match")))}let L=null;function K(){if(L){L.remove(),L=null;return}L=document.createElement("div"),L.className="keyboard-help",L.innerHTML=`
      <div class="keyboard-help-content">
        <h3>Keyboard Shortcuts</h3>
        <div class="shortcut-grid">
          <div class="shortcut-section">
            <h4>Navigation</h4>
            <div><kbd>\u2191</kbd><kbd>\u2193</kbd> Move between issues</div>
            <div><kbd>Home</kbd><kbd>End</kbd> First/last issue</div>
            <div><kbd>PgUp</kbd><kbd>PgDn</kbd> Jump 10 rows</div>
            <div><kbd>Tab</kbd> Label \u2192 Bar</div>
            <div><kbd>Shift+Tab</kbd> Bar \u2192 Label</div>
          </div>
          <div class="shortcut-section">
            <h4>Date Editing</h4>
            <div><kbd>\u2190</kbd><kbd>\u2192</kbd> Move bar \xB11 day</div>
            <div><kbd>Shift+\u2190/\u2192</kbd> Resize end</div>
            <div><kbd>Alt+\u2190/\u2192</kbd> Resize start</div>
            <div><kbd>Ctrl+Z</kbd> Undo</div>
            <div><kbd>Ctrl+Y</kbd> Redo</div>
          </div>
          <div class="shortcut-section">
            <h4>View</h4>
            <div><kbd>1-5</kbd> Zoom levels</div>
            <div><kbd>H</kbd> Heatmap</div>
            <div><kbd>D</kbd> Dependencies</div>
            <div><kbd>C</kbd> Critical path</div>
            <div><kbd>T</kbd> Today</div>
          </div>
          <div class="shortcut-section">
            <h4>Health & Other</h4>
            <div><kbd>F</kbd> Cycle health filter</div>
            <div><kbd>B</kbd> Next blocked issue</div>
            <div><kbd>/</kbd> Quick search</div>
            <div><kbd>S</kbd> Cycle sort</div>
            <div><kbd>R</kbd> Refresh</div>
            <div><kbd>Esc</kbd> Clear/cancel</div>
          </div>
        </div>
        <p class="keyboard-help-close">Press <kbd>?</kbd> or <kbd>Esc</kbd> to close</p>
      </div>
    `,document.body.appendChild(L),L.addEventListener("click",u=>{u.target===L&&K()})}j("keydown",u=>{u.key==="Escape"&&L&&(u.stopImmediatePropagation(),K())})}var oe=acquireVsCodeApi(),Qe=!1;function Ve(S){Qe&&typeof performance<"u"&&performance.mark(S)}function nt(S,b,j){if(Qe&&typeof performance<"u")try{performance.measure(S,b,j);let F=performance.getEntriesByName(S,"measure");F.length>0&&console.log(`[Gantt Perf] ${S}: ${F[F.length-1].duration.toFixed(2)}ms`),performance.clearMarks(b),performance.clearMarks(j),performance.clearMeasures(S)}catch{}}function yt(){if(Qe){let S=document.getElementById("ganttRoot"),b=S?S.querySelectorAll("*").length:0,j=S?S.querySelectorAll("svg *").length:0;console.log(`[Gantt Perf] DOM nodes: ${b}, SVG elements: ${j}`)}}function bt(S){if(!S)return;let b=document.documentElement;b.style.setProperty("--gantt-header-height",`${S.headerHeight}px`),b.style.setProperty("--gantt-label-width",`${S.labelWidth}px`),b.style.setProperty("--gantt-id-column-width",`${S.idColumnWidth}px`),b.style.setProperty("--gantt-start-date-column-width",`${S.startDateColumnWidth}px`),b.style.setProperty("--gantt-status-column-width",`${S.statusColumnWidth}px`),b.style.setProperty("--gantt-due-date-column-width",`${S.dueDateColumnWidth}px`),b.style.setProperty("--gantt-assignee-column-width",`${S.assigneeColumnWidth}px`),b.style.setProperty("--gantt-sticky-left-width",`${S.stickyLeftWidth}px`)}function vt({addDocListener:S,addWinListener:b}){let j=document.getElementById("ganttRoot"),F=document.getElementById("ganttTooltip"),se=F?.querySelector(".gantt-tooltip-content");if(!j||!F||!se)return;let J=l=>l?String(l).replace(/\r\n/g,`
`).trimEnd():"";function G(){j.querySelectorAll("svg title").forEach(l=>{let c=l.parentElement,m=J(l.textContent);c&&m&&(c.dataset.tooltip=m),l.remove()})}function X(){j.querySelectorAll("[title]").forEach(l=>{if(l.tagName.toLowerCase()==="title")return;let c=J(l.getAttribute("title"));l.removeAttribute("title"),c&&(l.dataset.tooltip=c)})}function ne(){G(),X()}function ge(l){let c=l.findIndex(I=>I.trim().startsWith("#"));return c>=0?c:l.filter(I=>I.trim()).length>1?l.findIndex(I=>I.trim()):-1}function pe(l){se.textContent="";let c=J(l);if(!c)return;let m=c.split(`
`),I=ge(m),H=!1;m.forEach((te,Be)=>{let qe=te.trim();if(!qe){if(!H){let N=document.createElement("div");N.className="gantt-tooltip-spacer",se.appendChild(N),H=!0}return}if(qe==="---"){let N=document.createElement("div");N.className="gantt-tooltip-divider",se.appendChild(N),H=!1;return}let Ee=qe.match(/^cf:([^:]+):(.*)$/);if(Ee){let N=Ee[1].trim(),De=Ee[2].trim(),re=document.createElement("div");re.className="gantt-tooltip-line";let ve=document.createElement("span");ve.className="gantt-tooltip-key",ve.textContent=`${N}: `,re.appendChild(ve),De&&re.appendChild(document.createTextNode(De)),se.appendChild(re),H=!1;return}let ke=document.createElement("div");ke.className="gantt-tooltip-line",Be===I&&ke.classList.add("gantt-tooltip-title");let be=qe.match(/^Open in Browser:\s*(\S+)/);if(be&&/^https?:\/\//i.test(be[1])){ke.appendChild(document.createTextNode("Open in Browser: "));let N=document.createElement("a");N.href=be[1],N.textContent=be[1],N.target="_blank",N.rel="noopener noreferrer",ke.appendChild(N)}else ke.textContent=te;se.appendChild(ke),H=!1});let ce=se.lastElementChild;ce&&ce.classList.contains("gantt-tooltip-spacer")&&ce.remove()}let T=null,V=null,z=null,M={x:0,y:0};function L(l){M={x:l.clientX,y:l.clientY}}function K(){V&&(clearTimeout(V),V=null)}function u(){z&&(clearTimeout(z),z=null)}function ie(l){return l&&(l===F||F.contains(l))}function _(l){return l&&T&&(l===T||T.contains(l))}function x(){if(!M)return!1;let l=document.elementFromPoint(M.x,M.y);return ie(l)||_(l)}let Q=300;function ee(l){u(),z=setTimeout(()=>{z=null,!(!T||T!==l)&&x()&&p(l,M.x,M.y)},Q)}function le(){K(),V=setTimeout(()=>{T&&(x()||h())},300)}function d(l,c){let H=F.getBoundingClientRect(),ce=l+8,te=c+8;ce+H.width>window.innerWidth-8&&(ce=l-H.width-8),te+H.height>window.innerHeight-8&&(te=c-H.height-8),ce=Math.max(8,Math.min(ce,window.innerWidth-H.width-8)),te=Math.max(8,Math.min(te,window.innerHeight-H.height-8)),F.style.left=`${Math.round(ce)}px`,F.style.top=`${Math.round(te)}px`}function p(l,c,m){let I=l.dataset.tooltip;I&&(pe(I),F.classList.add("visible"),F.setAttribute("aria-hidden","false"),d(c,m))}function h(l=!1){u(),K(),F.classList.remove("visible"),F.setAttribute("aria-hidden","true"),l||(T=null)}function B(l){if(!l||l===F||F.contains(l))return null;let c=l.closest?.("[data-tooltip], [title]");if(!c||!j.contains(c))return null;if(c.hasAttribute("title")){let m=J(c.getAttribute("title"));c.removeAttribute("title"),m&&(c.dataset.tooltip=m)}return c.dataset.tooltip?c:null}ne(),S("pointerover",l=>{if(L(l),ie(l.target)){K(),u();return}let c=B(l.target);if(!c){u();return}K(),T!==c?(T=c,F.classList.contains("visible")&&h(!0),ee(c)):F.classList.contains("visible")||ee(c)},!0),S("pointermove",l=>{T&&(L(l),V&&x()&&K())},!0),S("pointerout",l=>{if(!T||(L(l),u(),!_(l.target)&&!ie(l.target)))return;let c=l.relatedTarget;ie(c)||_(c)||le()},!0),S("scroll",()=>{T&&h()},!0),S("keydown",()=>{T&&h()},!0),b("blur",()=>{T&&h()})}function gt(S){if(!S)return;S.state&&(Qe=S.state.perfDebug??!1),Ve("render-start");let b=document.getElementById("ganttRoot");b&&(bt(S.state),Ve("innerHTML-start"),b.innerHTML=S.html||"",Ve("innerHTML-end"),nt("innerHTML","innerHTML-start","innerHTML-end"),wt(S.state),Ve("render-end"),nt("render","render-start","render-end"),yt())}window.addEventListener("message",S=>{let b=S.data;if(b){if(b.command==="render"){gt(b.payload);return}window.__ganttHandleExtensionMessage&&window.__ganttHandleExtensionMessage(b)}});var ht=window.__GANTT_INITIAL_PAYLOAD__;ht&&gt(ht);oe.postMessage({command:"webviewReady"});function wt(S){if(Ve("initializeGantt-start"),!S)return;let{timelineWidth:b,minDateMs:j,maxDateMs:F,totalDays:se,extendedRelationTypes:J,redmineBaseUrl:G,minimapBarsData:X,minimapHeight:ne,minimapBarHeight:ge,minimapTodayX:pe,extScrollLeft:T,extScrollTop:V,labelWidth:z,leftExtrasWidth:M,healthFilter:L,sortBy:K,sortOrder:u,selectedCollapseKey:ie,barHeight:_,todayX:x,todayInRange:Q}=S,ee=b/se;window._ganttCleanup&&window._ganttCleanup();let le=[],d=[];function p(e,t,o){document.addEventListener(e,t,o),le.push({type:e,handler:t,options:o})}function h(e,t,o){window.addEventListener(e,t,o),d.push({type:e,handler:t,options:o})}window._ganttCleanup=()=>{le.forEach(e=>document.removeEventListener(e.type,e.handler,e.options)),d.forEach(e=>window.removeEventListener(e.type,e.handler,e.options)),window.__ganttHandleExtensionMessage=null};function B(e){setTimeout(()=>{document.addEventListener("click",function t(o){e.contains(o.target)||(e.remove(),document.removeEventListener("click",t))})},0)}function l(e){return Math.round(e/ee)*ee}function c(e){let t=document.getElementById("liveRegion");t&&(t.textContent=e)}let m=document.getElementById("ganttScroll"),I=document.getElementById("ganttLeftHeader"),H=document.getElementById("ganttLabels"),ce=document.getElementById("ganttTimeline"),te=document.getElementById("menuUndo"),Be=document.getElementById("menuRedo"),qe=document.getElementById("minimapSvg"),Ee=document.getElementById("minimapViewport"),{updateMinimapPosition:ke,updateMinimapViewport:be}=dt({timelineWidth:b,minimapBarsData:X,minimapHeight:ne,minimapBarHeight:ge,minimapTodayX:pe,ganttScroll:m,minimapSvg:qe,minimapViewport:Ee,addDocListener:p}),N=oe.getState()||{undoStack:[],redoStack:[],labelWidth:z,scrollLeft:null,scrollTop:null,centerDateMs:null},De=N.undoStack||[],re=N.redoStack||[],ve=N.scrollLeft??(T>0?T:null),Te=N.scrollTop??(V>0?V:null),Fe=N.centerDateMs;function Ze(){if(!m)return null;let t=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,o=m.clientWidth-t,y=(m.scrollLeft+o/2)/b;return j+y*(F-j)}function de(e){if(!m)return;let o=(e-j)/(F-j)*b,y=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,R=m.clientWidth-y;m.scrollLeft=Math.max(0,o-R/2)}function ue(){oe.setState({undoStack:De,redoStack:re,labelWidth:H?.offsetWidth||z,scrollLeft:null,scrollTop:m?.scrollTop??null,centerDateMs:Ze()})}let Ae=ue;function He(){te&&te.toggleAttribute("disabled",De.length===0),Be&&Be.toggleAttribute("disabled",re.length===0),ue()}if(N.labelWidth&&I&&H){I.style.width=N.labelWidth+"px",H.style.width=N.labelWidth+"px";let e=document.querySelector(".capacity-ribbon-label");e&&(e.style.width=N.labelWidth+M+"px")}let v=!0,we=!1,$e=e=>{we=e},g=null;m&&m.addEventListener("scroll",()=>{cancelAnimationFrame(g),g=requestAnimationFrame(()=>{be(),v||ue()})},{passive:!0}),requestAnimationFrame(()=>He()),window.__ganttHandleExtensionMessage=e=>{if(e.command==="setHeatmapState"){let t=document.querySelector(".heatmap-layer"),o=document.querySelector(".weekend-layer"),f=document.getElementById("menuHeatmap");e.enabled?(t&&t.classList.remove("hidden"),o&&o.classList.add("hidden"),f&&f.classList.add("active")):(t&&t.classList.add("hidden"),o&&o.classList.remove("hidden"),f&&f.classList.remove("active"))}else if(e.command==="setDependenciesState"){let t=document.querySelector(".dependency-layer"),o=document.getElementById("menuDeps");e.enabled?(t&&t.classList.remove("hidden"),o&&o.classList.add("active")):(t&&t.classList.add("hidden"),o&&o.classList.remove("active"))}else if(e.command==="setCapacityRibbonState"){let t=document.querySelector(".capacity-ribbon"),o=document.getElementById("menuCapacity");e.enabled?(t&&t.classList.remove("hidden"),o&&o.classList.add("active")):(t&&t.classList.add("hidden"),o&&o.classList.remove("active"))}else if(e.command==="setIntensityState"){let t=document.querySelector(".gantt-container"),o=document.getElementById("menuIntensity");e.enabled?(t?.classList.add("intensity-enabled"),o&&o.classList.add("active")):(t?.classList.remove("intensity-enabled"),o&&o.classList.remove("active"))}else if(e.command==="pushUndoAction")De.push(e.action),re.length=0,He(),ue();else if(e.command==="updateRelationId"){let t=e.stack==="undo"?De:re;if(t.length>0){let o=t[t.length-1];o.type==="relation"&&(o.relationId=e.newRelationId,ue())}}else if(e.command==="scrollToIssue"){let t=e.issueId,o=document.querySelector('.issue-label[data-issue-id="'+t+'"]'),f=document.querySelector('.issue-bar[data-issue-id="'+t+'"]'),y=document.getElementById("ganttScroll"),me=document.querySelector(".gantt-header-row")?.getBoundingClientRect().height||60;if(!y)return;let Le=y.scrollTop,he=y.scrollLeft;if(o){let _e=o.closest(".gantt-row");if(_e){let Ne=_e.offsetTop,Ue=_e.getBoundingClientRect().height,Ge=y.clientHeight-me;Le=Math.max(0,Ne-me-(Ge-Ue)/2)}o.focus(),o.classList.add("highlighted"),setTimeout(()=>o.classList.remove("highlighted"),2e3)}if(f){let _e=parseFloat(f.getAttribute("data-start-x")||"0"),Ue=parseFloat(f.getAttribute("data-end-x")||"0")-_e,Ge=y.clientWidth,pt=document.querySelector(".gantt-sticky-left")?.getBoundingClientRect().width||0,ct=Ge-pt;Ue<=ct-100?he=_e-(ct-Ue)/2:he=_e-50,he=Math.max(0,he),f.classList.add("highlighted"),setTimeout(()=>f.classList.remove("highlighted"),2e3)}y.scrollTo({left:he,top:Le,behavior:"smooth"})}},document.getElementById("lookbackSelect")?.addEventListener("change",e=>{oe.postMessage({command:"setLookback",years:e.target.value})}),document.getElementById("zoomSelect")?.addEventListener("change",e=>{Ae(),oe.postMessage({command:"setZoom",zoomLevel:e.target.value})}),document.getElementById("viewFocusSelect")?.addEventListener("change",e=>{oe.postMessage({command:"setViewFocus",focus:e.target.value})}),document.getElementById("projectSelector")?.addEventListener("change",e=>{let t=e.target.value,o=t?parseInt(t,10):null;oe.postMessage({command:"setSelectedProject",projectId:o})}),document.getElementById("focusSelector")?.addEventListener("change",e=>{let t=e.target.value;oe.postMessage({command:"setSelectedAssignee",assignee:t||null})}),document.getElementById("filterAssignee")?.addEventListener("change",e=>{let t=e.target.value;oe.postMessage({command:"setFilter",filter:{assignee:t}})}),document.getElementById("filterStatus")?.addEventListener("change",e=>{let t=e.target.value;oe.postMessage({command:"setFilter",filter:{status:t}})}),document.getElementById("menuFilterHealth")?.addEventListener("click",()=>{let e=["all","critical","warning","healthy"],t=L,f=(e.indexOf(t)+1)%e.length;oe.postMessage({command:"setHealthFilter",health:e[f]})}),document.querySelectorAll(".gantt-col-header.sortable").forEach(e=>{e.addEventListener("click",()=>{let t=e.dataset.sort;t===K?u==="asc"?oe.postMessage({command:"setSort",sortOrder:"desc"}):oe.postMessage({command:"setSort",sortBy:null}):oe.postMessage({command:"setSort",sortBy:t,sortOrder:"asc"})})}),document.getElementById("menuHeatmap")?.addEventListener("click",()=>{document.getElementById("menuHeatmap")?.hasAttribute("disabled")||(ue(),oe.postMessage({command:"toggleWorkloadHeatmap"}))}),document.getElementById("menuCapacity")?.addEventListener("click",()=>{document.getElementById("menuCapacity")?.hasAttribute("disabled")||(ue(),oe.postMessage({command:"toggleCapacityRibbon"}))}),document.getElementById("menuIntensity")?.addEventListener("click",()=>{document.getElementById("menuIntensity")?.hasAttribute("disabled")||(ue(),oe.postMessage({command:"toggleIntensity"}))}),document.getElementById("overloadBadge")?.addEventListener("click",e=>{e.stopPropagation();let t=e.currentTarget,o=parseInt(t.dataset.firstOverloadMs||"0",10);o>0&&(de(o),ue())}),document.querySelectorAll(".capacity-day-bar-group").forEach(e=>{e.addEventListener("click",t=>{let o=parseInt(t.currentTarget.dataset.dateMs||"0",10);o>0&&(de(o),ue())})}),document.getElementById("menuDeps")?.addEventListener("click",()=>{ue(),oe.postMessage({command:"toggleDependencies"})});let U=document.querySelector(".gantt-container");function ye(){let e=new Map,t=new Map;return document.querySelectorAll(".dependency-arrow").forEach(o=>{if(!(o.classList.contains("rel-blocks")||o.classList.contains("rel-precedes")))return;let y=o.dataset.from,R=o.dataset.to;e.has(y)||e.set(y,[]),e.get(y).push(R),t.has(R)||t.set(R,[]),t.get(R).push(y)}),{graph:e,reverseGraph:t}}let Se=null;function Xe(e,t,o){let f=new Set([e]),y=[e];for(;y.length>0;){let me=y.shift(),Le=t.get(me)||[];for(let he of Le)f.has(he)||(f.add(he),y.push(he))}let R=[e];for(;R.length>0;){let me=R.shift(),Le=o.get(me)||[];for(let he of Le)f.has(he)||(f.add(he),R.push(he))}return f}function P(e){if(Pe(),!e)return;Se=e;let{graph:t,reverseGraph:o}=ye(),f=Xe(e,t,o);U.classList.add("focus-mode"),document.querySelectorAll(".issue-bar").forEach(y=>{f.has(y.dataset.issueId)&&y.classList.add("focus-highlighted")}),document.querySelectorAll(".issue-label").forEach(y=>{f.has(y.dataset.issueId)&&y.classList.add("focus-highlighted")}),document.querySelectorAll(".dependency-arrow").forEach(y=>{f.has(y.dataset.from)&&f.has(y.dataset.to)&&y.classList.add("focus-highlighted")}),c(`Focus: ${f.size} issue${f.size!==1?"s":""} in dependency chain`)}function Pe(){Se=null,U.classList.remove("focus-mode"),document.querySelectorAll(".focus-highlighted").forEach(e=>e.classList.remove("focus-highlighted"))}let We=()=>Se,fe=new Set,Oe=null,n=document.getElementById("selectionCount"),a=Array.from(document.querySelectorAll(".issue-bar")),s=new Map;a.forEach(e=>{let t=e.dataset.issueId;t&&(s.has(t)||s.set(t,[]),s.get(t).push(e))});function r(e){e.forEach(t=>{let o=s.get(t);o&&o.forEach(f=>f.classList.toggle("selected",fe.has(t)))}),fe.size>0?(n.textContent=`${fe.size} selected`,n.classList.remove("hidden"),U.classList.add("multi-select-mode")):(n.classList.add("hidden"),U.classList.remove("multi-select-mode"))}function i(){a.forEach(e=>{e.classList.toggle("selected",fe.has(e.dataset.issueId))}),fe.size>0?(n.textContent=`${fe.size} selected`,n.classList.remove("hidden"),U.classList.add("multi-select-mode")):(n.classList.add("hidden"),U.classList.remove("multi-select-mode"))}function E(){let e=[...fe];fe.clear(),Oe=null,r(e)}function A(e){fe.has(e)?fe.delete(e):fe.add(e),Oe=e,r([e])}function k(e,t){let o=a.findIndex(Le=>Le.dataset.issueId===e),f=a.findIndex(Le=>Le.dataset.issueId===t);if(o===-1||f===-1)return;let y=Math.min(o,f),R=Math.max(o,f),me=[];for(let Le=y;Le<=R;Le++){let he=a[Le].dataset.issueId;fe.has(he)||(fe.add(he),me.push(he))}r(me)}function W(){a.forEach(e=>fe.add(e.dataset.issueId)),i(),c(`Selected all ${fe.size} issues`)}a.forEach(e=>{e.addEventListener("mousedown",t=>{if(!t.ctrlKey&&!t.metaKey&&!t.shiftKey||t.target.classList.contains("drag-handle")||t.target.classList.contains("link-handle"))return;t.preventDefault(),t.stopPropagation();let o=e.dataset.issueId;t.shiftKey&&Oe?k(Oe,o):A(o)})}),p("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="a"&&(e.preventDefault(),W()),e.key==="Escape"&&fe.size>0&&(e.stopImmediatePropagation(),E(),c("Selection cleared"))}),document.getElementById("refreshBtn")?.addEventListener("click",()=>{document.getElementById("loadingOverlay")?.classList.add("visible"),oe.postMessage({command:"refresh"})});function O(e,t,o,f,y){document.querySelector(".relation-picker")?.remove();let R=document.createElement("div");R.className="relation-picker";let me=150,Le=100,he=Math.min(e,window.innerWidth-me-10),_e=Math.min(t,window.innerHeight-Le-10);R.style.left=Math.max(10,he)+"px",R.style.top=Math.max(10,_e)+"px";let Ne=document.createElement("div");Ne.style.padding="6px 12px",Ne.style.fontSize="11px",Ne.style.opacity="0.7",Ne.textContent=`#${f} \u2192 #${y}`,R.appendChild(Ne);let Ue=document.createElement("button");Ue.textContent="\u{1F5D1}\uFE0F Delete relation",Ue.addEventListener("click",()=>{ue(),oe.postMessage({command:"deleteRelation",relationId:o}),R.remove()}),R.appendChild(Ue);let Ge=document.createElement("button");Ge.textContent="Cancel",Ge.addEventListener("click",()=>R.remove()),R.appendChild(Ge),document.body.appendChild(R),B(R)}let $=new Map,D=new Map,C=new Map,ae=new Map,Ie=new Map,Me=!1;function Ke(){document.querySelectorAll(".issue-bar").forEach(e=>{let t=e.dataset.issueId;t&&($.has(t)||$.set(t,[]),$.get(t).push(e))}),document.querySelectorAll(".issue-label").forEach(e=>{let t=e.dataset.issueId;t&&(D.has(t)||D.set(t,[]),D.get(t).push(e))}),document.querySelectorAll(".dependency-arrow").forEach(e=>{let t=e.dataset.from,o=e.dataset.to;t&&(C.has(t)||C.set(t,[]),C.get(t).push(e)),o&&(C.has(o)||C.set(o,[]),C.get(o).push(e))}),document.querySelectorAll(".project-label").forEach(e=>{let t=e.dataset.collapseKey;t&&(ae.has(t)||ae.set(t,[]),ae.get(t).push(e))}),document.querySelectorAll(".aggregate-bars").forEach(e=>{let t=e.dataset.collapseKey;t&&(Ie.has(t)||Ie.set(t,[]),Ie.get(t).push(e))}),Me=!0}typeof requestIdleCallback<"u"?requestIdleCallback(()=>Ke(),{timeout:100}):setTimeout(Ke,0);let Re=[];function Ye(){document.body.classList.remove("hover-focus","dependency-hover"),Re.forEach(e=>e.classList.remove("hover-highlighted","hover-source")),Re=[]}function ze(e){document.body.classList.add("hover-focus");let t=Me?$.get(e)||[]:document.querySelectorAll('.issue-bar[data-issue-id="'+e+'"]'),o=Me?D.get(e)||[]:document.querySelectorAll('.issue-label[data-issue-id="'+e+'"]'),f=Me?C.get(e)||[]:document.querySelectorAll('.dependency-arrow[data-from="'+e+'"], .dependency-arrow[data-to="'+e+'"]');t.forEach(y=>{y.classList.add("hover-highlighted"),Re.push(y)}),o.forEach(y=>{y.classList.add("hover-highlighted"),Re.push(y)}),f.forEach(y=>{y.classList.add("hover-highlighted"),Re.push(y)})}function Ce(e){document.body.classList.add("hover-focus");let t=Me?ae.get(e)||[]:document.querySelectorAll('.project-label[data-collapse-key="'+e+'"]'),o=Me?Ie.get(e)||[]:document.querySelectorAll('.aggregate-bars[data-collapse-key="'+e+'"]');t.forEach(f=>{f.classList.add("hover-highlighted"),Re.push(f)}),o.forEach(f=>{f.classList.add("hover-highlighted"),Re.push(f)})}let Y=document.querySelector(".gantt-timeline svg"),Z=document.querySelector(".gantt-labels svg");if(Y&&(Y.addEventListener("mouseenter",e=>{let t=e.target.closest(".issue-bar"),o=e.target.closest(".aggregate-bars"),f=e.target.closest(".dependency-arrow");if(t){let y=t.dataset.issueId;y&&ze(y)}else if(o){let y=o.dataset.collapseKey;y&&Ce(y)}else if(f){let y=f.dataset.from,R=f.dataset.to;document.body.classList.add("dependency-hover"),f.classList.add("hover-source"),Re.push(f),y&&ze(y),R&&ze(R)}},!0),Y.addEventListener("mouseleave",e=>{let t=e.target.closest(".issue-bar"),o=e.target.closest(".aggregate-bars"),f=e.target.closest(".dependency-arrow");(t||o||f)&&Ye()},!0)),Z&&(Z.addEventListener("mouseenter",e=>{let t=e.target.closest(".issue-label"),o=e.target.closest(".project-label");if(t){let f=t.dataset.issueId;f&&ze(f)}else if(o){let f=o.dataset.collapseKey;f&&Ce(f)}},!0),Z.addEventListener("mouseleave",e=>{let t=e.target.closest(".issue-label"),o=e.target.closest(".project-label");(t||o)&&Ye()},!0)),Y){let t=function(){document.querySelectorAll(".dependency-arrow.selected").forEach(o=>o.classList.remove("selected")),document.body.classList.remove("arrow-selection-mode"),document.querySelectorAll(".arrow-connected").forEach(o=>o.classList.remove("arrow-connected")),e=null};var kt=t;Y.addEventListener("contextmenu",o=>{let f=o.target.closest(".dependency-arrow");if(!f)return;o.preventDefault();let y=parseInt(f.dataset.relationId),R=f.dataset.from,me=f.dataset.to;O(o.clientX,o.clientY,y,R,me)});let e=null;Y.addEventListener("click",o=>{let f=o.target.closest(".dependency-arrow");if(e&&(e.classList.remove("selected"),document.body.classList.remove("arrow-selection-mode"),document.querySelectorAll(".arrow-connected").forEach(me=>me.classList.remove("arrow-connected")),e=null),!f)return;o.stopPropagation(),e=f,f.classList.add("selected"),document.body.classList.add("arrow-selection-mode");let y=f.dataset.from,R=f.dataset.to;document.querySelectorAll(`.issue-bar[data-issue-id="${y}"], .issue-bar[data-issue-id="${R}"]`).forEach(me=>me.classList.add("arrow-connected")),document.querySelectorAll(`.issue-label[data-issue-id="${y}"], .issue-label[data-issue-id="${R}"]`).forEach(me=>me.classList.add("arrow-connected")),c(`Selected relation from #${y} to #${R}`)}),window._ganttArrowClickHandler&&document.removeEventListener("click",window._ganttArrowClickHandler),window._ganttArrowClickHandler=o=>{(e||document.querySelector(".dependency-arrow.selected"))&&!o.target.closest(".dependency-arrow")&&!o.target.closest(".blocks-badge-group")&&!o.target.closest(".blocker-badge")&&t()},document.addEventListener("click",window._ganttArrowClickHandler),window._ganttArrowKeyHandler&&document.removeEventListener("keydown",window._ganttArrowKeyHandler),window._ganttArrowKeyHandler=o=>{let f=e||document.querySelector(".dependency-arrow.selected");o.key==="Escape"&&f&&(o.stopImmediatePropagation(),t())},document.addEventListener("keydown",window._ganttArrowKeyHandler)}ut({vscode:oe,menuUndo:te,menuRedo:Be,addDocListener:p,closeOnOutsideClick:B,announce:c,saveState:ue,updateUndoRedoButtons:He,undoStack:De,redoStack:re,selectedIssues:fe,clearSelection:E,allIssueBars:a,redmineBaseUrl:G,extendedRelationTypes:J,minDateMs:j,maxDateMs:F,timelineWidth:b,dayWidth:ee,barHeight:_,ganttScroll:m,snapToDay:l,focusOnDependencyChain:P,clearFocus:Pe,getFocusedIssueId:We,scrollToAndHighlight:je,setAllowScrollChange:$e}),ft({vscode:oe,addDocListener:p,addWinListener:h,announce:c,barHeight:_,selectedCollapseKey:ie});function xe(){if(!Q){oe.postMessage({command:"todayOutOfRange"});return}if(m){let t=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,o=m.clientWidth-t;m.scrollLeft=Math.max(0,x-o/2)}}function je(e){if(!e)return;we=!0;let t=document.querySelector('.issue-label[data-issue-id="'+e+'"]'),o=document.querySelector('.issue-bar[data-issue-id="'+e+'"]');if(t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("highlighted"),setTimeout(()=>t.classList.remove("highlighted"),1500)),o&&m){let f=o.getBoundingClientRect(),y=m.getBoundingClientRect(),R=m.scrollLeft+f.left-y.left-100;m.scrollTo({left:Math.max(0,R),behavior:"smooth"}),o.classList.add("highlighted"),setTimeout(()=>o.classList.remove("highlighted"),1500)}}mt({vscode:oe,addDocListener:p,menuUndo:te,menuRedo:Be,undoStack:De,redoStack:re,saveState:ue,updateUndoRedoButtons:He,announce:c,scrollToAndHighlight:je,scrollToToday:xe}),vt({addDocListener:p,addWinListener:h,ganttScroll:m}),requestAnimationFrame(()=>{if(Fe!==null&&m){let e=Math.max(j,Math.min(F,Fe));de(e),Te!==null&&(m.scrollTop=Te),Fe=null,Te=null}else ve!==null&&m?(m.scrollLeft=ve,Te!==null&&(m.scrollTop=Te),ve=null,Te=null):xe();be(),v=!1}),document.getElementById("todayBtn")?.addEventListener("click",xe);let at=document.getElementById("resizeHandle"),ot=document.getElementById("resizeHandleHeader"),Je=!1,rt=0,it=0,et=null;function lt(e,t){Je=!0,et=t,rt=e.clientX,it=H.offsetWidth,t.classList.add("dragging"),document.body.classList.add("cursor-col-resize","user-select-none"),e.preventDefault()}at?.addEventListener("mousedown",e=>lt(e,at)),ot?.addEventListener("mousedown",e=>lt(e,ot));let tt=!1,st=null;p("mousemove",e=>{Je&&(st=e,!tt&&(tt=!0,requestAnimationFrame(()=>{if(tt=!1,!st)return;let t=st.clientX-rt,o=Math.min(600,Math.max(120,it+t));if(I&&(I.style.width=o+"px"),H){H.style.width=o+"px";let y=H.querySelector("svg");y&&y.setAttribute("width",String(o))}let f=document.querySelector(".capacity-ribbon-label");f&&(f.style.width=o+M+"px"),ke()})))}),p("mouseup",()=>{Je&&(Je=!1,et?.classList.remove("dragging"),et=null,document.body.classList.remove("cursor-col-resize","user-select-none"),ue())}),requestAnimationFrame(()=>{document.getElementById("loadingOverlay")?.classList.remove("visible")}),Ve("initializeGantt-end"),nt("initializeGantt","initializeGantt-start","initializeGantt-end")}})();
