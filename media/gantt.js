"use strict";(()=>{function pt({timelineWidth:E,minimapBarsData:b,minimapHeight:j,minimapBarHeight:Y,minimapTodayX:ie,ganttScroll:G,minimapSvg:Z,minimapViewport:R,addDocListener:le}){function we(){let x=document.querySelector(".gantt-body .gantt-sticky-left"),L=document.querySelector(".gantt-container");x&&L&&L.style.setProperty("--sticky-left-width",x.offsetWidth+"px")}requestAnimationFrame(we),Z&&requestAnimationFrame(()=>{let x=j/(b.length+1);if(b.forEach((L,V)=>{let u=document.createElementNS("http://www.w3.org/2000/svg","rect");u.setAttribute("class",L.classes),u.setAttribute("x",(L.startPct*E).toString()),u.setAttribute("y",(x*(V+.5)).toString()),u.setAttribute("width",Math.max(2,(L.endPct-L.startPct)*E).toString()),u.setAttribute("height",Y.toString()),u.setAttribute("rx","1"),u.setAttribute("fill",L.color),Z.insertBefore(u,R)}),ie>0&&ie<E){let L=document.createElementNS("http://www.w3.org/2000/svg","line");L.setAttribute("class","minimap-today"),L.setAttribute("x1",ie.toString()),L.setAttribute("y1","0"),L.setAttribute("x2",ie.toString()),L.setAttribute("y2",j.toString()),Z.insertBefore(L,R)}});function Se(){if(!G||!R||!E||!G.scrollWidth||!G.clientWidth)return;let x=Math.max(1,G.scrollWidth-G.clientWidth),L=Math.min(1,G.scrollLeft/x),V=Math.min(1,G.clientWidth/G.scrollWidth),u=Math.max(20,V*E),ce=L*(E-u);isNaN(ce)||isNaN(u)||(R.setAttribute("x",ce.toString()),R.setAttribute("width",u.toString()))}let ae=!1,P=0;function z(x,L=!1){if(!G||!Z||!R)return;let V=Z.getBoundingClientRect(),ce=parseFloat(R.getAttribute("width")||"0")/E*V.width,_=x.clientX-V.left;L?_-=P:_-=ce/2;let q=Math.max(0,Math.min(1,_/(V.width-ce))),ee=Math.max(0,G.scrollWidth-G.clientWidth);G.scrollLeft=q*ee}return Z&&R&&(R.addEventListener("mousedown",x=>{x.stopPropagation(),ae=!0;let L=Z.getBoundingClientRect(),u=parseFloat(R.getAttribute("x")||"0")/E*L.width;P=x.clientX-L.left-u}),Z.addEventListener("mousedown",x=>{if(x.target===R)return;ae=!0;let L=Z.getBoundingClientRect();P=parseFloat(R.getAttribute("width")||"0")/100*L.width/2,z(x,!0)}),le("mousemove",x=>{ae&&z(x,!0)}),le("mouseup",()=>{ae=!1})),{updateMinimapPosition:we,updateMinimapViewport:Se}}function yt(E){let{vscode:b,menuUndo:j,menuRedo:Y,addDocListener:ie,closeOnOutsideClick:G,announce:Z,saveState:R,updateUndoRedoButtons:le,undoStack:we,redoStack:Se,selectedIssues:ae,clearSelection:P,allIssueBars:z,redmineBaseUrl:x,extendedRelationTypes:L,minDateMs:V,maxDateMs:u,timelineWidth:ce,dayWidth:_,barHeight:q,ganttScroll:ee,snapToDay:de,focusOnDependencyChain:ue,clearFocus:d,getFocusedIssueId:S,scrollToAndHighlight:p,setAllowScrollChange:A,isDraftModeEnabled:I,isPerfDebugEnabled:i}=E;function m(s,o,n){document.querySelector(".relation-picker")?.remove();let l=ae.size>1&&ae.has(n),r=l?Array.from(ae).map(T=>parseInt(T)):[parseInt(n)],D=document.createElement("div");D.className="relation-picker";let C=160,k=180,H=Math.min(s,window.innerWidth-C-10),w=Math.min(o,window.innerHeight-k-10);D.style.left=Math.max(10,H)+"px",D.style.top=Math.max(10,w)+"px";let X=document.createElement("div");X.style.padding="6px 12px",X.style.fontSize="11px",X.style.opacity="0.7",X.textContent=l?r.length+" issues selected":"#"+n,D.appendChild(X),(l?[{label:"Set % Done...",command:"bulkSetDoneRatio",bulk:!0},{label:"Clear Selection",command:"clearSelection",local:!0}]:[{label:"Update Issue...",command:"openIssue"},{label:"Open in Browser",command:"openInBrowser"},{label:"Show in Issues",command:"showInIssues"},{label:"Log Time",command:"logTime"},{label:"Set % Done",command:"setDoneRatio"},{label:"Toggle Auto-update %",command:"toggleAutoUpdate"},{label:"Toggle Ad-hoc Budget",command:"toggleAdHoc"},{label:"Toggle Precedence",command:"togglePrecedence"},{label:"Set Internal Estimate",command:"setInternalEstimate"},{label:"Copy Link",command:"copyLink",local:!0},{label:"Copy URL",command:"copyUrl"}]).forEach(T=>{let W=document.createElement("button");W.textContent=T.label,W.addEventListener("click",async()=>{if(T.command==="copyLink"){let Ae=document.querySelector('.issue-bar[data-issue-id="'+n+'"]')?.dataset?.subject||"Issue #"+n,Re=x+"/issues/"+n,Pe='<a href="'+Re+'">#'+n+" "+Ae+"</a>",$e=Re;try{await navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([$e],{type:"text/plain"}),"text/html":new Blob([Pe],{type:"text/html"})})]),b.postMessage({command:"showStatus",message:"Copied #"+n+" link"})}catch{await navigator.clipboard.writeText($e),b.postMessage({command:"showStatus",message:"Copied #"+n+" URL"})}}else T.local?P():T.bulk?b.postMessage({command:T.command,issueIds:r}):b.postMessage({command:T.command,issueId:parseInt(n)});D.remove()}),D.appendChild(W)}),document.body.appendChild(D),G(D)}function M(s){let o=V+s/ce*(u-V);return new Date(o).toISOString().slice(0,10)}function K(s){let o=V+s/ce*(u-V)-864e5;return new Date(o).toISOString().slice(0,10)}let Q=document.getElementById("dragDateTooltip"),fe=null;function te(s){let o=new Date(s+"T00:00:00"),n=o.toLocaleDateString("en-US",{month:"short"}),l=o.getDate(),r=o.toLocaleDateString("en-US",{weekday:"short"});return n+" "+l+" ("+r+")"}function F(s,o){let n=new Date(s+"T00:00:00"),l=new Date(o+"T00:00:00"),r=n.toLocaleDateString("en-US",{month:"short"}),D=l.toLocaleDateString("en-US",{month:"short"});return r===D?r+" "+n.getDate()+"-"+l.getDate():r+" "+n.getDate()+"-"+D+" "+l.getDate()}function Le(s){Q.textContent=s,Q.style.display="block",fe=s}function ke(s){s!==fe&&(Q.textContent=s,fe=s)}function He(s,o){let n=o-28,l=!1;n<40&&(n=o+20,l=!0),Q.style.left=s+"px",Q.style.top=n+"px",Q.classList.toggle("flipped",l)}function Ie(){Q.style.display="none",fe=null}let oe=4,g=4;function Ce(s,o){i&&i()&&console.log("[Arrow Debug]",s,o)}function We(s,o,n,l,r){let D=n>s,C=Math.abs(n-s),k=C<30,H=Math.abs(o-l)<5,w=l>o,X;H&&D?X="sameRow-right":!H&&k?X="nearlyVertical":D?X="diffRow-right":H?X="sameRow-left":X="diffRow-left";let v;if(H&&D)v="M "+s+" "+o+" H "+n;else if(!H&&k){let N=(o+l)/2;v="M "+s+" "+o+" H "+(s+8-g)+" q "+g+" 0 "+g+" "+(w?g:-g)+" V "+(N+(w?-g:g))+" q 0 "+(w?g:-g)+" "+-g+" "+(w?g:-g)+" H "+(n-8+g)+" q "+-g+" 0 "+-g+" "+(w?g:-g)+" V "+(l+(w?-g:g))+" q 0 "+(w?g:-g)+" "+g+" "+(w?g:-g)+" H "+n}else if(D){let W=Math.min(s+8,(s+n)/2);v="M "+s+" "+o+" H "+(W-g)+" q "+g+" 0 "+g+" "+(w?g:-g)+" V "+(l+(w?-g:g))+" q 0 "+(w?g:-g)+" "+g+" "+(w?g:-g)+" H "+n}else if(H){let N=o-q;v="M "+s+" "+o+" V "+(N+g)+" q 0 "+-g+" "+-g+" "+-g+" H "+(n-12+g)+" q "+-g+" 0 "+-g+" "+g+" V "+l+" H "+n}else{let N=(o+l)/2;v="M "+s+" "+o+" V "+(N+(w?-g:g))+" q 0 "+(w?g:-g)+" "+-g+" "+(w?g:-g)+" H "+(n-12+g)+" q "+-g+" 0 "+-g+" "+(w?g:-g)+" V "+l+" H "+n}let T="M "+(n-oe)+" "+(l-oe*.6)+" L "+n+" "+l+" L "+(n-oe)+" "+(l+oe*.6);return Ce("calcArrowPath",{inputs:{x1:s,y1:o,x2:n,y2:l,isScheduling:r},conditions:{goingRight:D,horizontalDist:C,nearlyVertical:k,sameRow:H,goingDown:w},pathCase:X,path:v.substring(0,80)+(v.length>80?"...":"")}),{path:v,arrowHead:T}}function Oe(s){let o=[],n='.dependency-arrow[data-from="'+s+'"], .dependency-arrow[data-to="'+s+'"]';return document.querySelectorAll(n).forEach(l=>{let r=l.getAttribute("data-from"),D=l.getAttribute("data-to"),k=(l.getAttribute("class")||"").match(/rel-(\w+)/),H=k?k[1]:"relates",w=["blocks","precedes","finish_to_start","start_to_start","finish_to_finish","start_to_finish"].includes(H),X=document.querySelector('.issue-bar[data-issue-id="'+r+'"]'),v=document.querySelector('.issue-bar[data-issue-id="'+D+'"]');!X||!v||o.push({element:l,fromId:r,toId:D,isScheduling:w,fromBar:X,toBar:v,linePath:l.querySelector(".arrow-line"),hitPath:l.querySelector(".arrow-hit-area"),headPath:l.querySelector(".arrow-head")})}),o}function Be(s,o,n,l){s.forEach(r=>{let D=r.linePath?r.linePath.getAttribute("d"):null,C=r.fromId==o?n:parseFloat(r.fromBar.dataset.startX),k=r.fromId==o?l:parseFloat(r.fromBar.dataset.endX),H=parseFloat(r.fromBar.dataset.centerY),w=r.toId==o?n:parseFloat(r.toBar.dataset.startX),X=r.toId==o?l:parseFloat(r.toBar.dataset.endX),v=parseFloat(r.toBar.dataset.centerY),T,W,N,Ae;r.isScheduling?(T=k+2,W=H,N=w-2,Ae=v):(T=(C+k)/2,W=H,N=(w+X)/2,Ae=v),Ce("updateArrowPositions",{arrow:r.fromId+" -> "+r.toId,isScheduling:r.isScheduling,draggedId:o,barData:{fromStartX:r.fromBar.dataset.startX,fromEndX:r.fromBar.dataset.endX,fromY:r.fromBar.dataset.centerY,toStartX:r.toBar.dataset.startX,toEndX:r.toBar.dataset.endX,toY:r.toBar.dataset.centerY},computed:{fromStartX:C,fromEndX:k,fromY:H,toStartX:w,toEndX:X,toY:v},coords:{x1:T,y1:W,x2:N,y2:Ae},originalPath:D?D.substring(0,60)+"...":null});let{path:Re,arrowHead:Pe}=We(T,W,N,Ae,r.isScheduling);r.linePath&&r.linePath.setAttribute("d",Re),r.hitPath&&r.hitPath.setAttribute("d",Re),r.headPath&&r.headPath.setAttribute("d",Pe)})}let De=document.getElementById("dragConfirmOverlay"),Xe=document.getElementById("dragConfirmMessage"),xe=document.getElementById("dragConfirmOk"),Fe=document.getElementById("dragConfirmCancel"),ge=null;function Ye(s,o,n){!De||!Xe||(Xe.textContent=s,ge={onConfirm:o,onCancel:n},A(!0),De.style.display="flex",xe&&xe.focus())}function Ke(){De&&(De.style.display="none"),ge=null}function h(){ee&&B&&(ee.scrollLeft=B.left,ee.scrollTop=B.top),B=null}xe?.addEventListener("click",()=>{ge?.onConfirm&&ge.onConfirm(),B=null,Ke()}),Fe?.addEventListener("click",()=>{ge?.onCancel&&ge.onCancel(),h(),Ke()}),De?.addEventListener("click",s=>{s.target===De&&(ge?.onCancel&&ge.onCancel(),h(),Ke())}),ie("keydown",s=>{ge&&(s.key==="Escape"?(s.preventDefault(),ge.onCancel&&ge.onCancel(),h(),Ke()):s.key==="Enter"&&(s.preventDefault(),ge.onConfirm&&ge.onConfirm(),B=null,Ke()))});let c=null,B=null,J=!1;document.querySelectorAll(".drag-handle").forEach(s=>{s.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation(),B={left:ee?.scrollLeft,top:ee?.scrollTop};let n=s.closest(".issue-bar"),l=s.classList.contains("drag-left"),r=parseInt(n.dataset.issueId),D=parseFloat(n.dataset.startX),C=parseFloat(n.dataset.endX),k=n.dataset.startDate||null,H=n.dataset.dueDate||null,w=n.querySelector(".bar-outline"),X=n.querySelector(".bar-main"),v=n.querySelector(".drag-left"),T=n.querySelector(".drag-right");n.classList.add("dragging");let W=n.querySelector(".bar-labels"),N=W?.classList.contains("labels-left"),Ae=Oe(r),Re=n.querySelector(".link-handle");Ce("dragStart (resize)",{issueId:r,isLeft:l,connectedArrowCount:Ae.length,arrows:Ae.map(pe=>({from:pe.fromId,to:pe.toId,isScheduling:pe.isScheduling,currentPath:pe.linePath?pe.linePath.getAttribute("d")?.substring(0,60)+"...":null}))}),c={issueId:r,isLeft:l,isMove:!1,initialMouseX:o.clientX,startX:D,endX:C,oldStartDate:k,oldDueDate:H,barOutline:w,barMain:X,leftHandle:v,rightHandle:T,bar:n,barLabels:W,labelsOnLeft:N,connectedArrows:Ae,linkHandle:Re};let Pe=l?D:C,$e=l?k:H;$e&&(Le((l?"Start: ":"Due: ")+te($e)),He(o.clientX,o.clientY))})}),document.querySelectorAll(".bar-outline").forEach(s=>{s.addEventListener("mousedown",o=>{if(o.target.classList.contains("drag-handle")||o.ctrlKey||o.metaKey||o.shiftKey)return;o.preventDefault(),o.stopPropagation(),B={left:ee?.scrollLeft,top:ee?.scrollTop};let n=s.closest(".issue-bar");if(!n)return;let l=n.dataset.issueId,r=ae.size>1&&ae.has(l),C=(r?z.filter(v=>ae.has(v.dataset.issueId)):[n]).map(v=>({issueId:v.dataset.issueId,startX:parseFloat(v.dataset.startX),endX:parseFloat(v.dataset.endX),oldStartDate:v.dataset.startDate||null,oldDueDate:v.dataset.dueDate||null,barOutline:v.querySelector(".bar-outline"),barMain:v.querySelector(".bar-main"),leftHandle:v.querySelector(".drag-left"),rightHandle:v.querySelector(".drag-right"),bar:v,barLabels:v.querySelector(".bar-labels"),labelsOnLeft:v.querySelector(".bar-labels")?.classList.contains("labels-left"),connectedArrows:Oe(v.dataset.issueId),linkHandle:v.querySelector(".link-handle")}));C.forEach(v=>v.bar.classList.add("dragging"));let k=n.querySelector(".bar-labels"),H=k?.classList.contains("labels-left"),w=Oe(l),X=n.querySelector(".link-handle");Ce("dragStart (move)",{issueId:l,isBulkDrag:r,connectedArrowCount:w.length,arrows:w.map(v=>({from:v.fromId,to:v.toId,isScheduling:v.isScheduling,currentPath:v.linePath?v.linePath.getAttribute("d")?.substring(0,60)+"...":null}))}),c={issueId:parseInt(l),isLeft:!1,isMove:!0,isBulkDrag:r,bulkBars:C,initialMouseX:o.clientX,startX:parseFloat(n.dataset.startX),endX:parseFloat(n.dataset.endX),oldStartDate:n.dataset.startDate||null,oldDueDate:n.dataset.dueDate||null,barOutline:s,barMain:n.querySelector(".bar-main"),leftHandle:n.querySelector(".drag-left"),rightHandle:n.querySelector(".drag-right"),bar:n,barLabels:k,labelsOnLeft:H,connectedArrows:w,linkHandle:X},!r&&n.dataset.startDate&&n.dataset.dueDate&&(Le(F(n.dataset.startDate,n.dataset.dueDate)),He(o.clientX,o.clientY))})});let $=null,re=null,he=null;function Ee(){$&&($.fromBar.classList.remove("linking-source"),document.querySelectorAll(".link-target").forEach(s=>s.classList.remove("link-target")),re&&(re.remove(),re=null),$=null,he=null,document.body.classList.remove("cursor-crosshair"))}function _e(s,o,n,l){document.querySelector(".relation-picker")?.remove();let r=document.createElement("div");r.className="relation-picker";let D=180,C=200,k=Math.min(s,window.innerWidth-D-10),H=Math.min(o,window.innerHeight-C-10);r.style.left=Math.max(10,k)+"px",r.style.top=Math.max(10,H)+"px";let w=[{value:"blocks",label:"\u{1F6AB} Blocks",cssClass:"rel-line-blocks",tooltip:"Target cannot be closed until this issue is closed"},{value:"precedes",label:"\u27A1\uFE0F Precedes",cssClass:"rel-line-scheduling",tooltip:"This issue must complete before target can start"},{value:"relates",label:"\u{1F517} Relates to",cssClass:"rel-line-informational",tooltip:"Simple link between issues (no constraints)"},{value:"duplicates",label:"\u{1F4CB} Duplicates",cssClass:"rel-line-informational",tooltip:"Closing target will automatically close this issue"},{value:"copied_to",label:"\u{1F4C4} Copied to",cssClass:"rel-line-informational",tooltip:"This issue was copied to create the target issue"}],X=[{value:"finish_to_start",label:"\u23E9 Finish\u2192Start",cssClass:"rel-line-scheduling",tooltip:"Target starts after this issue finishes (FS)"},{value:"start_to_start",label:"\u25B6\uFE0F Start\u2192Start",cssClass:"rel-line-scheduling",tooltip:"Target starts when this issue starts (SS)"},{value:"finish_to_finish",label:"\u23F9\uFE0F Finish\u2192Finish",cssClass:"rel-line-scheduling",tooltip:"Target finishes when this issue finishes (FF)"},{value:"start_to_finish",label:"\u23EA Start\u2192Finish",cssClass:"rel-line-scheduling",tooltip:"Target finishes when this issue starts (SF)"}];(L?[...w,...X]:w).forEach(T=>{let W=document.createElement("button"),N=document.createElement("span");N.className="color-swatch "+T.cssClass,W.appendChild(N),W.appendChild(document.createTextNode(T.label)),W.title=T.tooltip,W.addEventListener("click",()=>{R(),b.postMessage({command:"createRelation",issueId:n,targetIssueId:l,relationType:T.value}),r.remove()}),r.appendChild(W)}),document.body.appendChild(r),G(r)}let qe=".drag-handle, .link-handle, .bar-outline, .blocks-badge-group, .blocker-badge, .progress-badge-group, .flex-badge-group";document.querySelectorAll(".issue-bar").forEach(s=>{s.addEventListener("click",o=>{o.target.closest(qe)||c||$||J||(S()&&d(),p(s.dataset.issueId))}),s.addEventListener("dblclick",o=>{c||$||J||(o.preventDefault(),ue(s.dataset.issueId))})});function st(s,o){if(document.querySelectorAll(".dependency-arrow.selected").forEach(l=>l.classList.remove("selected")),document.querySelectorAll(".arrow-connected").forEach(l=>l.classList.remove("arrow-connected")),s.length===0)return;document.body.classList.add("arrow-selection-mode");let n=new Set;s.forEach(l=>{l.classList.add("selected"),n.add(l.dataset.from),n.add(l.dataset.to)}),n.forEach(l=>{document.querySelectorAll(`.issue-bar[data-issue-id="${l}"], .issue-label[data-issue-id="${l}"]`).forEach(r=>r.classList.add("arrow-connected"))}),Z(`Highlighted ${s.length} dependency arrow(s) for #${o}`)}document.querySelectorAll(".blocks-badge-group").forEach(s=>{s.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation()}),s.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();let n=s.closest(".issue-bar");if(!n)return;let l=n.dataset.issueId,r=Array.from(document.querySelectorAll(`.dependency-arrow[data-from="${l}"]`));st(r,l)})}),document.querySelectorAll(".blocker-badge").forEach(s=>{s.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation()}),s.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();let n=s.closest(".issue-bar");if(!n)return;let l=n.dataset.issueId,r=Array.from(document.querySelectorAll(`.dependency-arrow[data-to="${l}"]`));st(r,l)})});let me=Array.from(document.querySelectorAll(".issue-bar")),nt=10;me.forEach((s,o)=>{s.addEventListener("keydown",n=>{if(n.key==="Enter"||n.key===" ")n.preventDefault(),p(s.dataset.issueId);else if(n.key==="ArrowDown"&&o<me.length-1)n.preventDefault(),me[o+1].focus(),Z(`Issue ${me[o+1].getAttribute("aria-label")}`);else if(n.key==="ArrowUp"&&o>0)n.preventDefault(),me[o-1].focus(),Z(`Issue ${me[o-1].getAttribute("aria-label")}`);else if(n.key==="Home")n.preventDefault(),me[0].focus(),Z(`First issue: ${me[0].getAttribute("aria-label")}`);else if(n.key==="End")n.preventDefault(),me[me.length-1].focus(),Z(`Last issue: ${me[me.length-1].getAttribute("aria-label")}`);else if(n.key==="PageDown"){n.preventDefault();let l=Math.min(o+nt,me.length-1);me[l].focus(),Z(`Issue ${me[l].getAttribute("aria-label")}`)}else if(n.key==="PageUp"){n.preventDefault();let l=Math.max(o-nt,0);me[l].focus(),Z(`Issue ${me[l].getAttribute("aria-label")}`)}else if(n.key==="Tab"&&n.shiftKey){let l=s.dataset.issueId,r=document.querySelector(`.issue-label[data-issue-id="${l}"]`);r&&(n.preventDefault(),r.focus(),Z(`Label for issue #${l}`))}})}),document.querySelectorAll(".link-handle").forEach(s=>{s.addEventListener("mousedown",o=>{o.stopPropagation(),o.preventDefault();let n=s.closest(".issue-bar"),l=parseInt(n.dataset.issueId),r=parseFloat(s.dataset.cx),D=parseFloat(s.dataset.cy);n.classList.add("linking-source"),document.body.classList.add("cursor-crosshair");let C=document.querySelector("#ganttTimeline svg");if(!document.getElementById("temp-arrow-head")){let k=document.createElementNS("http://www.w3.org/2000/svg","defs");k.innerHTML=`
            <marker id="temp-arrow-head" markerWidth="10" markerHeight="7"
                    refX="9" refY="3.5" orient="auto" markerUnits="strokeWidth">
              <polygon points="0 0, 10 3.5, 0 7" fill="var(--vscode-focusBorder)"/>
            </marker>`,C.insertBefore(k,C.firstChild)}re=document.createElementNS("http://www.w3.org/2000/svg","path"),re.classList.add("temp-link-arrow"),re.setAttribute("stroke","var(--vscode-focusBorder)"),re.setAttribute("stroke-width","2"),re.setAttribute("fill","none"),re.setAttribute("marker-end","url(#temp-arrow-head)"),C.appendChild(re),$={fromId:l,fromBar:n,startX:r,startY:D}})}),ie("keydown",s=>{if(s.key==="Escape"){let o=document.querySelector(".relation-picker");if(o){s.stopImmediatePropagation(),o.remove();return}if($){s.stopImmediatePropagation(),Ee();return}S()&&(s.stopImmediatePropagation(),d(),Z("Focus cleared"))}});let Ze=!1,et=null;ie("mousemove",s=>{!c&&!$||(et=s,!Ze&&(Ze=!0,requestAnimationFrame(()=>{Ze=!1;let o=et;if(o){if(c){let n=o.clientX-c.initialMouseX;if(c.isMove&&c.isBulkDrag&&c.bulkBars){let l=de(n)-de(0);c.bulkBars.forEach(r=>{let D=r.endX-r.startX,C=Math.max(0,Math.min(r.startX+l,ce-D)),k=C+D,H=k-C;r.barOutline.setAttribute("x",C),r.barOutline.setAttribute("width",H),r.barMain&&(r.barMain.setAttribute("x",C),r.barMain.setAttribute("width",H));let w=r.leftHandle.querySelector("rect"),X=r.rightHandle.querySelector("rect");if(w&&w.setAttribute("x",C),X&&X.setAttribute("x",k-14),r.leftHandle.querySelectorAll(".drag-grip circle").forEach((v,T)=>v.setAttribute("cx",C+9)),r.rightHandle.querySelectorAll(".drag-grip circle").forEach((v,T)=>v.setAttribute("cx",k-9)),r.newStartX=C,r.newEndX=k,r.barLabels){let v=r.labelsOnLeft?C-r.startX:k-r.endX;r.barLabels.setAttribute("transform","translate("+v+", 0)")}r.connectedArrows&&Be(r.connectedArrows,r.issueId,C,k),r.linkHandle&&r.linkHandle.querySelectorAll("circle").forEach(v=>v.setAttribute("cx",String(k+8)))}),c.snappedDelta=l}else{let l=c.startX,r=c.endX,D=c.endX-c.startX;c.isMove?(l=de(Math.max(0,Math.min(c.startX+n,ce-D))),r=l+D):c.isLeft?l=de(Math.max(0,Math.min(c.startX+n,c.endX-_))):r=de(Math.max(c.startX+_,Math.min(c.endX+n,ce)));let C=r-l;c.barOutline.setAttribute("x",l),c.barOutline.setAttribute("width",C),c.barMain&&(c.barMain.setAttribute("x",l),c.barMain.setAttribute("width",C));let k=c.leftHandle.querySelector("rect"),H=c.rightHandle.querySelector("rect");if(k&&k.setAttribute("x",l),H&&H.setAttribute("x",r-14),c.leftHandle.querySelectorAll(".drag-grip circle").forEach(w=>w.setAttribute("cx",l+9)),c.rightHandle.querySelectorAll(".drag-grip circle").forEach(w=>w.setAttribute("cx",r-9)),c.newStartX=l,c.newEndX=r,c.barLabels){let w=c.labelsOnLeft?l-c.startX:r-c.endX;c.barLabels.setAttribute("transform","translate("+w+", 0)")}if(c.connectedArrows&&Be(c.connectedArrows,c.issueId,l,r),c.linkHandle&&c.linkHandle.querySelectorAll("circle").forEach(w=>w.setAttribute("cx",String(r+8))),c.isMove&&!c.isBulkDrag){let w=M(l),X=K(r),T=w!==c.oldStartDate?F(c.oldStartDate,c.oldDueDate)+" \u2192 "+F(w,X):F(w,X);ke(T),He(o.clientX,o.clientY)}else if(!c.isMove){let w=c.isLeft?l:r,X=c.isLeft?M(w):K(w);ke((c.isLeft?"Start: ":"Due: ")+te(X)),He(o.clientX,o.clientY)}}}if($&&re){let l=document.querySelector("#ganttTimeline svg").getBoundingClientRect(),r=o.clientX-l.left,D=o.clientY-l.top,C=`M ${$.startX} ${$.startY} L ${r} ${D}`;re.setAttribute("d",C);let k=document.elementFromPoint(o.clientX,o.clientY)?.closest(".issue-bar");he&&he!==k&&he.classList.remove("link-target"),k&&k!==$.fromBar?(k.classList.add("link-target"),he=k):he=null}}})))});function Ge(s){if(!s)return;let{bar:o,barOutline:n,barMain:l,leftHandle:r,rightHandle:D,barLabels:C,startX:k,endX:H,connectedArrows:w,issueId:X,linkHandle:v}=s,T=H-k;if(n&&(n.setAttribute("x",String(k)),n.setAttribute("width",String(T))),l&&(l.setAttribute("x",String(k)),l.setAttribute("width",String(T))),r){let W=r.querySelector("rect");W&&W.setAttribute("x",String(k)),r.querySelectorAll(".drag-grip circle").forEach(N=>N.setAttribute("cx",k+9))}if(D){let W=D.querySelector("rect");W&&W.setAttribute("x",String(H-14)),D.querySelectorAll(".drag-grip circle").forEach(N=>N.setAttribute("cx",H-9))}C&&C.removeAttribute("transform"),w&&w.length>0&&Be(w,X,k,H),v&&v.querySelectorAll("circle").forEach(W=>W.setAttribute("cx",String(H+8))),o&&o.classList.remove("dragging")}ie("mouseup",s=>{if(c){let{issueId:o,isLeft:n,isMove:l,isBulkDrag:r,bulkBars:D,newStartX:C,newEndX:k,bar:H,startX:w,endX:X,oldStartDate:v,oldDueDate:T,barOutline:W,barMain:N,leftHandle:Ae,rightHandle:Re,barLabels:Pe,connectedArrows:$e}=c,pe={...c};if(r&&D&&l){D.forEach(U=>U.bar.classList.remove("dragging"));let Te=[];if(D.forEach(U=>{if(U.newStartX!==void 0&&U.newStartX!==U.startX){let ne=M(U.newStartX),ye=K(U.newEndX);(ne!==U.oldStartDate||ye!==U.oldDueDate)&&Te.push({issueId:parseInt(U.issueId),oldStartDate:U.oldStartDate,oldDueDate:U.oldDueDate,newStartDate:ne,newDueDate:ye,barData:U})}}),Te.length>0){Ie();let U=()=>{we.push({type:"bulk",changes:Te.map(ne=>({issueId:ne.issueId,oldStartDate:ne.oldStartDate,oldDueDate:ne.oldDueDate,newStartDate:ne.newStartDate,newDueDate:ne.newDueDate}))}),Se.length=0,le(),R(),Te.forEach(ne=>{b.postMessage({command:"updateDates",issueId:ne.issueId,startDate:ne.newStartDate,dueDate:ne.newDueDate})})};if(I&&I())U();else{let ne="Move "+Te.length+" issue(s) to new dates?";Ye(ne,U,()=>{D.forEach(ye=>Ge(ye))})}}else Ie(),D.forEach(U=>Ge(U));c=null,J=!0,requestAnimationFrame(()=>J=!1);return}if(H.classList.remove("dragging"),Ie(),C!==void 0||k!==void 0){let Te=null,U=null;l?C!==w&&(Te=M(C),U=K(k)):n?Te=C!==w?M(C):null:U=k!==X?K(k):null;let ne=Te&&Te!==v?Te:null,ye=U&&U!==T?U:null;if(ne||ye){let Qe=()=>{we.push({issueId:o,oldStartDate:ne?v:null,oldDueDate:ye?T:null,newStartDate:ne,newDueDate:ye}),Se.length=0,le(),R(),b.postMessage({command:"updateDates",issueId:o,startDate:ne,dueDate:ye})};if(I&&I())Qe();else{let Ne="Issue #"+o+": ";ne&&ye?Ne+=F(v,T)+" \u2192 "+F(ne,ye):ne?Ne+="Start: "+te(v)+" \u2192 "+te(ne):Ne+="Due: "+te(T)+" \u2192 "+te(ye),Ye(Ne,Qe,()=>{Ge(pe)})}}else Ge(pe)}else Ge(pe);c=null,J=!0,requestAnimationFrame(()=>J=!1)}if($){let o=$.fromId;if(he){let n=parseInt(he.dataset.issueId);o!==n&&_e(s.clientX,s.clientY,o,n)}Ee()}ge||h()}),j?.addEventListener("click",()=>{if(j.hasAttribute("disabled")||we.length===0)return;let s=we.pop();if(Se.push(s),le(),R(),s.type==="relation")s.operation==="create"?b.postMessage({command:"undoRelation",operation:"delete",relationId:s.relationId,datesBefore:s.datesBefore}):b.postMessage({command:"undoRelation",operation:"create",issueId:s.issueId,targetIssueId:s.targetIssueId,relationType:s.relationType});else if(s.type==="bulk"){let o=I&&I();s.changes.forEach(n=>{o?b.postMessage({command:"removeDraft",issueId:n.issueId,startDate:n.oldStartDate,dueDate:n.oldDueDate}):b.postMessage({command:"updateDates",issueId:n.issueId,startDate:n.oldStartDate,dueDate:n.oldDueDate})})}else I&&I()?b.postMessage({command:"removeDraft",issueId:s.issueId,startDate:s.oldStartDate,dueDate:s.oldDueDate}):b.postMessage({command:"updateDates",issueId:s.issueId,startDate:s.oldStartDate,dueDate:s.oldDueDate})}),Y?.addEventListener("click",()=>{if(Y.hasAttribute("disabled")||Se.length===0)return;let s=Se.pop();we.push(s),le(),R(),s.type==="relation"?s.operation==="create"?b.postMessage({command:"redoRelation",operation:"create",issueId:s.issueId,targetIssueId:s.targetIssueId,relationType:s.relationType}):b.postMessage({command:"redoRelation",operation:"delete",relationId:s.relationId}):s.type==="bulk"?s.changes.forEach(o=>{b.postMessage({command:"updateDates",issueId:o.issueId,startDate:o.newStartDate,dueDate:o.newDueDate})}):b.postMessage({command:"updateDates",issueId:s.issueId,startDate:s.newStartDate,dueDate:s.newDueDate})})}function bt(E){let{vscode:b,addDocListener:j,addWinListener:Y,announce:ie,barHeight:G,selectedCollapseKey:Z}=E;document.querySelectorAll(".collapse-toggle").forEach(d=>{d.addEventListener("click",S=>{S.stopPropagation();let A=d.closest("[data-collapse-key]")?.dataset.collapseKey;A&&ue(A)})}),document.getElementById("menuExpand")?.addEventListener("click",()=>{let S=document.getElementById("ganttScroll")?.dataset.allExpandableKeys,p=S?JSON.parse(S):[];b.postMessage({command:"expandAll",keys:p})}),document.getElementById("menuCollapse")?.addEventListener("click",()=>{b.postMessage({command:"collapseAll"})});let R=Array.from(document.querySelectorAll(".project-label, .issue-label, .time-group-label")),le=null,we=Z??null;function Se(d){return!d.classList.contains("gantt-row-hidden")&&d.getAttribute("visibility")!=="hidden"}function ae(d,S){let p=d+S;for(;p>=0&&p<R.length;){if(Se(R[p]))return{label:R[p],index:p};p+=S}return null}function P(d){let S=document.getElementById("ganttScroll"),p=document.querySelector(".gantt-header-row");if(!S||!d)return;let A=p?.getBoundingClientRect().height||60,I=d.closest(".gantt-row");if(!I)return;let i=I.getBoundingClientRect().top,m=I.getBoundingClientRect().height,M=S.getBoundingClientRect(),K=M.top+A,Q=M.bottom;i<K?S.scrollBy({top:i-K-4,behavior:"smooth"}):i+m>Q&&S.scrollBy({top:i+m-Q+4,behavior:"smooth"})}function z(d,S=!1,p=!1,A=!1){le&&le.classList.remove("active"),le=d,d&&(d.classList.add("active"),A||d.focus(),p&&P(d),S||b.postMessage({command:"setSelectedKey",collapseKey:d.dataset.collapseKey}))}Y("focus",()=>{le&&Se(le)&&le.focus()}),j("keydown",d=>{d.key==="Escape"&&le&&(le.classList.remove("active"),le.blur(),le=null,b.postMessage({command:"setSelectedKey",collapseKey:null}))});let x=new Map,L=new Map,V=new Map;function u(d){let S=d.dataset.originalY;if(V.has(S))return V.get(S);let p=JSON.parse(d.dataset.rowContributions||"{}");return V.set(S,p),p}function ce(){x.clear(),document.querySelectorAll("[data-collapse-key][data-original-y]").forEach(S=>{let p=S.dataset.collapseKey,A=parseFloat(S.dataset.originalY);x.has(p)||x.set(p,{originalY:A,elements:[]}),x.get(p).elements.push(S)})}function _(){L.clear(),document.querySelectorAll("[data-collapse-key][data-parent-key]").forEach(S=>{let p=S.dataset.collapseKey;if(L.has(p))return;let A=[],I=S.dataset.parentKey;for(;I;)A.push(I),I=document.querySelector('[data-collapse-key="'+I+'"]')?.dataset.parentKey||null;L.set(p,A)})}ce(),_();function q(d,S){S?(d.setAttribute("visibility","hidden"),d.classList.add("gantt-row-hidden")):(d.removeAttribute("visibility"),d.classList.remove("gantt-row-hidden"))}function ee(d){let S=[];return L.forEach((p,A)=>{p.includes(d)&&S.push(A)}),S}function de(d){let S=[];return L.forEach((p,A)=>{let I=p.indexOf(d);if(I===-1)return;let i=!0;for(let m=0;m<I;m++){let M=p[m],K=document.querySelector('[data-collapse-key="'+M+'"].project-label, [data-collapse-key="'+M+'"].issue-label, [data-collapse-key="'+M+'"].time-group-label');if(!K||K.dataset.expanded!=="true"){i=!1;break}}i&&S.push(A)}),S}function ue(d,S){let p=document.querySelector('[data-collapse-key="'+d+'"].project-label, [data-collapse-key="'+d+'"].time-group-label, [data-collapse-key="'+d+'"].issue-label');if(!p||p.dataset.hasChildren!=="true")return;let A=p.dataset.expanded==="true",I=S==="expand"?!0:S==="collapse"?!1:!A;if(I===A)return;p.dataset.expanded=I?"true":"false";let i=p.querySelector(".collapse-toggle");i&&i.classList.toggle("expanded",I);let m=ee(d),M=I?de(d):[];if(m.length===0){b.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:I});return}let K=new Set(m),Q=new Set(M),fe=x.get(d),te=fe?.originalY??0,F=new Set,Le=0,ke=0,Ie=I?M:de(d),oe=new Set(Ie);if(document.querySelectorAll(".zebra-stripe").forEach(h=>{let c=u(h);d in c&&ke===0&&(ke=parseFloat(h.dataset.originalY||"0"));for(let[B,J]of Object.entries(c))oe.has(B)&&!F.has(B)&&(Le+=parseFloat(J),F.add(B))}),Le===0&&Ie.length>0){b.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:I}),b.postMessage({command:"requestRerender"});return}let g=I?Le:-Le,Ce=te;if(fe&&fe.elements.length>0){let c=(fe.elements[0].getAttribute("transform")||"").match(/translate\([^,]+,\s*([-\d.]+)/);c&&(Ce=parseFloat(c[1]))}let We=Ce+G;I?M.forEach(h=>{let c=x.get(h);c&&(c.elements.forEach(B=>{let $=(B.getAttribute("transform")||"").match(/translate\(([-\d.]+)/),re=$?$[1]:"0";B.setAttribute("transform","translate("+re+", "+We+")"),q(B,!1)}),We+=G)}):m.forEach(h=>{let c=x.get(h);c&&c.elements.forEach(B=>{q(B,!0)})}),x.forEach(({originalY:h,elements:c},B)=>{h>te&&!K.has(B)&&c.forEach(J=>{let $=J.getAttribute("transform")||"",re=$.match(/translate\(([-\d.]+)/),he=re?re[1]:"0",Ee=$.match(/translate\([^,]+,\s*([-\d.]+)/),qe=(Ee?parseFloat(Ee[1]):h)+g;J.setAttribute("transform","translate("+he+", "+qe+")")})});let Oe=document.querySelector(".gantt-labels svg");if(Oe){let c=parseFloat(Oe.getAttribute("height")||"0")+g;Oe.setAttribute("height",String(c))}[".gantt-col-status svg",".gantt-col-id svg",".gantt-col-start svg",".gantt-col-due svg",".gantt-col-assignee svg"].forEach(h=>{let c=document.querySelector(h);if(!c)return;let J=parseFloat(c.getAttribute("height")||"0")+g;c.setAttribute("height",String(J))});let De=document.querySelector(".gantt-timeline svg");if(De){let c=parseFloat(De.getAttribute("height")||"0")+g;De.setAttribute("height",c)}let Xe=new Set;document.querySelectorAll('.project-label[data-has-children="true"], .time-group-label[data-has-children="true"], .issue-label[data-has-children="true"]').forEach(h=>{h.dataset.expanded==="false"&&Xe.add(h.dataset.collapseKey)});let xe=new Map,Fe=document.querySelectorAll(".zebra-stripe");Fe.forEach(h=>{let c=parseFloat(h.dataset.originalY||"0");if(xe.has(c))return;let B=u(h),J=Object.keys(B),$=J.length>0&&J.every(Ee=>K.has(Ee)),re=J.some(Ee=>K.has(Ee)),he=c>ke;if($)xe.set(c,{action:"toggle-visibility",hide:!I});else if(re)if(I){let Ee=0;for(let[_e,qe]of Object.entries(B))(!K.has(_e)||Q.has(_e))&&(Ee+=parseFloat(qe));xe.set(c,{action:"expand",newHeight:Ee})}else{let Ee=0;for(let[_e,qe]of Object.entries(B))K.has(_e)||(Ee+=parseFloat(qe));xe.set(c,{action:"shrink",newHeight:Ee})}else if(he){let Ee=parseFloat(h.getAttribute("y")||String(c));xe.set(c,{action:"shift",newY:Ee+g})}}),Fe.forEach(h=>{let c=parseFloat(h.dataset.originalY||"0"),B=xe.get(c);if(B)switch(B.action){case"toggle-visibility":q(h,B.hide);break;case"shrink":h.setAttribute("height",String(B.newHeight));break;case"expand":h.setAttribute("height",String(B.newHeight));break;case"shift":h.setAttribute("y",String(B.newY));break}});let ge=Array.from(document.querySelectorAll(".zebra-stripe")).filter(h=>h.getAttribute("visibility")!=="hidden"),Ye=new Map;ge.forEach(h=>{let c=parseFloat(h.getAttribute("y")||"0");Ye.has(c)||Ye.set(c,[]),Ye.get(c).push(h)}),Array.from(Ye.keys()).sort((h,c)=>h-c).forEach((h,c)=>{let B=c%2===0?"0.03":"0.06";Ye.get(h).forEach(J=>J.setAttribute("opacity",B))}),document.querySelectorAll(".indent-guide-line").forEach(h=>{let c=h.dataset.forParent,B=L.get(c)||[],J=Xe.has(c)||B.some($=>Xe.has($));if(q(h,J),!J){let $=x.get(c);if($&&$.originalY>te){let re=parseFloat(h.getAttribute("y1")||"0"),he=parseFloat(h.getAttribute("y2")||"0");h.setAttribute("y1",re+g),h.setAttribute("y2",he+g)}}}),document.querySelectorAll(".dependency-arrow").forEach(h=>{let c=h.dataset.from,B=h.dataset.to,J=document.querySelector('.issue-bar[data-issue-id="'+c+'"]'),$=document.querySelector('.issue-bar[data-issue-id="'+B+'"]'),re=J?.classList.contains("gantt-row-hidden"),he=$?.classList.contains("gantt-row-hidden");q(h,re||he)}),b.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:I})}if(we){let d=R.find(S=>S.dataset.collapseKey===we);d&&z(d,!0)}R.forEach((d,S)=>{d.addEventListener("click",p=>{if(p.target.closest?.(".collapse-toggle")||p.target.closest?.(".chevron-hit-area"))return;let A=d.dataset.issueId,I=d.classList.contains("project-label"),i=d.classList.contains("time-group-label"),m=d.dataset.collapseKey;if((I||i)&&m){z(d),d.dataset.hasChildren==="true"&&ue(m);return}let M=p.target.classList?.contains("issue-text")||p.target.closest(".issue-text");A&&M?(z(d,!1,!1,!0),b.postMessage({command:"openIssue",issueId:parseInt(A,10)})):d.dataset.hasChildren==="true"&&m?(z(d),ue(m)):z(d)}),d.addEventListener("keydown",p=>{let A=d.dataset.collapseKey,I=d.dataset.issueId?parseInt(d.dataset.issueId,10):NaN;switch(p.key){case"Enter":case" ":p.preventDefault(),isNaN(I)||b.postMessage({command:"openIssue",issueId:I});break;case"ArrowUp":{p.preventDefault();let i=ae(S,-1);i&&z(i.label,!1,!0);break}case"ArrowDown":{p.preventDefault();let i=ae(S,1);i&&z(i.label,!1,!0);break}case"ArrowLeft":if(p.preventDefault(),d.dataset.hasChildren==="true"&&d.dataset.expanded==="true")ue(A,"collapse");else if(d.dataset.parentKey){let i=R.find(m=>m.dataset.collapseKey===d.dataset.parentKey);i&&z(i,!1,!0)}break;case"ArrowRight":if(p.preventDefault(),d.dataset.hasChildren==="true"&&d.dataset.expanded==="false")ue(A,"expand");else if(d.dataset.hasChildren==="true"&&d.dataset.expanded==="true"){let i=R.find(m=>m.dataset.parentKey===A&&Se(m));i&&z(i,!1,!0)}break;case"Home":{p.preventDefault();let i=ae(-1,1);i&&z(i.label,!1,!0);break}case"End":{p.preventDefault();let i=ae(R.length,-1);i&&z(i.label,!1,!0);break}case"PageDown":{p.preventDefault();let i=S,m=0;for(;m<10&&i<R.length-1;){let M=ae(i,1);if(!M)break;i=M.index,m++}m>0&&z(R[i],!1,!0);break}case"PageUp":{p.preventDefault();let i=S,m=0;for(;m<10&&i>0;){let M=ae(i,-1);if(!M)break;i=M.index,m++}m>0&&z(R[i],!1,!0);break}case"Tab":if(!p.shiftKey&&!isNaN(I)){let i=document.querySelector(`.issue-bar[data-issue-id="${I}"]`);i&&(p.preventDefault(),i.focus(),ie(`Timeline bar for issue #${I}`))}break}})})}function vt(E){let{vscode:b,addDocListener:j,menuUndo:Y,menuRedo:ie,undoStack:G,redoStack:Z,saveState:R,updateUndoRedoButtons:le,announce:we,scrollToAndHighlight:Se,scrollToToday:ae}=E;j("keydown",u=>{let _=navigator.platform.toUpperCase().indexOf("MAC")>=0?u.metaKey:u.ctrlKey;if(!(u.target.tagName==="INPUT"||u.target.tagName==="SELECT"||u.target.tagName==="TEXTAREA"))if(_&&u.key==="z"&&!u.shiftKey)u.preventDefault(),Y?.click();else if(_&&u.key==="z"&&u.shiftKey)u.preventDefault(),ie?.click();else if(_&&u.key==="y")u.preventDefault(),ie?.click();else if(u.key>="1"&&u.key<="5"){let q=document.getElementById("zoomSelect"),ee=["day","week","month","quarter","year"];q.value=ee[parseInt(u.key)-1],q.dispatchEvent(new Event("change"))}else if(u.key.toLowerCase()==="h")document.getElementById("menuHeatmap")?.click();else if(u.key.toLowerCase()==="y")document.getElementById("menuCapacity")?.click();else if(u.key.toLowerCase()==="i")document.getElementById("menuIntensity")?.click();else if(u.key.toLowerCase()==="d")document.getElementById("menuDeps")?.click();else if(u.key.toLowerCase()==="v"){let q=document.getElementById("viewFocusSelect");q.value=q.value==="project"?"person":"project",q.dispatchEvent(new Event("change"))}else if(u.key.toLowerCase()==="r")document.getElementById("refreshBtn")?.click();else if(u.key.toLowerCase()==="t")ae();else if(u.key.toLowerCase()==="e")document.getElementById("menuExpand")?.click();else if(u.key.toLowerCase()==="c"&&!_)document.getElementById("menuCollapse")?.click();else if(u.key.toLowerCase()==="f"&&!_)u.preventDefault(),document.getElementById("menuFilterHealth")?.click();else if(u.key.toLowerCase()==="b"){u.preventDefault();let q=Array.from(document.querySelectorAll(".issue-bar[data-issue-id]")).filter(S=>S.querySelector(".blocker-badge"));if(q.length===0){we("No blocked issues");return}let ee=document.activeElement?.closest(".issue-bar"),ue=((ee?q.indexOf(ee):-1)+1)%q.length,d=q[ue];Se(d.dataset.issueId),d.focus(),we("Blocked issue "+(ue+1)+" of "+q.length)}else if(u.key==="ArrowLeft"||u.key==="ArrowRight"){let q=document.activeElement?.closest(".issue-bar:not(.parent-bar)");if(!q)return;u.preventDefault();let ee=parseInt(q.dataset.issueId),de=q.dataset.startDate,ue=q.dataset.dueDate;if(!de&&!ue)return;let d=u.key==="ArrowRight"?1:-1,S=(I,i)=>{let m=new Date(I+"T00:00:00");return m.setDate(m.getDate()+i),m.toISOString().slice(0,10)},p=null,A=null;u.shiftKey&&ue?A=S(ue,d):u.altKey&&de?p=S(de,d):(de&&(p=S(de,d)),ue&&(A=S(ue,d))),(p||A)&&(R(),G.push({issueId:ee,oldStartDate:p?de:null,oldDueDate:A?ue:null,newStartDate:p,newDueDate:A}),Z.length=0,le(),b.postMessage({command:"updateDates",issueId:ee,startDate:p,dueDate:A}))}else u.key==="/"&&!_?(u.preventDefault(),z()):(u.key==="?"||u.shiftKey&&u.key==="/")&&(u.preventDefault(),V())});let P=null;function z(){P&&P.remove(),P=document.createElement("div"),P.className="quick-search",P.innerHTML=`
      <input type="text" placeholder="Search issues..." autofocus />
    `,document.body.appendChild(P);let u=P.querySelector("input");u.focus();let ce=Array.from(document.querySelectorAll(".issue-label"));u.addEventListener("input",()=>{let _=u.value.toLowerCase();ce.forEach(q=>{let ee=q.getAttribute("aria-label")?.toLowerCase()||"",de=_&&ee.includes(_);q.classList.toggle("search-match",de)})}),u.addEventListener("keydown",_=>{if(_.key==="Escape")x();else if(_.key==="Enter"){let q=document.querySelector(".issue-label.search-match");q&&(x(),q.focus(),Se(q.dataset.issueId))}}),u.addEventListener("blur",()=>setTimeout(x,150))}function x(){P&&(P.remove(),P=null,document.querySelectorAll(".search-match").forEach(u=>u.classList.remove("search-match")))}let L=null;function V(){if(L){L.remove(),L=null;return}L=document.createElement("div"),L.className="keyboard-help",L.innerHTML=`
      <div class="keyboard-help-content">
        <h3>Keyboard Shortcuts</h3>
        <div class="shortcut-grid">
          <div class="shortcut-section">
            <h4>Navigation</h4>
            <div><kbd>\u2191</kbd><kbd>\u2193</kbd> Move between issues</div>
            <div><kbd>Home</kbd><kbd>End</kbd> First/last issue</div>
            <div><kbd>PgUp</kbd><kbd>PgDn</kbd> Jump 10 rows</div>
            <div><kbd>Tab</kbd> Label \u2192 Bar</div>
            <div><kbd>Shift+Tab</kbd> Bar \u2192 Label</div>
          </div>
          <div class="shortcut-section">
            <h4>Date Editing</h4>
            <div><kbd>\u2190</kbd><kbd>\u2192</kbd> Move bar \xB11 day</div>
            <div><kbd>Shift+\u2190/\u2192</kbd> Resize end</div>
            <div><kbd>Alt+\u2190/\u2192</kbd> Resize start</div>
            <div><kbd>Ctrl+Z</kbd> Undo</div>
            <div><kbd>Ctrl+Y</kbd> Redo</div>
          </div>
          <div class="shortcut-section">
            <h4>View</h4>
            <div><kbd>1-5</kbd> Zoom levels</div>
            <div><kbd>H</kbd> Heatmap</div>
            <div><kbd>D</kbd> Dependencies</div>
            <div><kbd>C</kbd> Critical path</div>
            <div><kbd>T</kbd> Today</div>
          </div>
          <div class="shortcut-section">
            <h4>Health & Other</h4>
            <div><kbd>F</kbd> Cycle health filter</div>
            <div><kbd>B</kbd> Next blocked issue</div>
            <div><kbd>/</kbd> Quick search</div>
            <div><kbd>S</kbd> Cycle sort</div>
            <div><kbd>R</kbd> Refresh</div>
            <div><kbd>Esc</kbd> Clear/cancel</div>
          </div>
        </div>
        <p class="keyboard-help-close">Press <kbd>?</kbd> or <kbd>Esc</kbd> to close</p>
      </div>
    `,document.body.appendChild(L),L.addEventListener("click",u=>{u.target===L&&V()})}j("keydown",u=>{u.key==="Escape"&&L&&(u.stopImmediatePropagation(),V())})}var se=acquireVsCodeApi(),tt=!1;function Je(E){tt&&typeof performance<"u"&&performance.mark(E)}function lt(E,b,j){if(tt&&typeof performance<"u")try{performance.measure(E,b,j);let Y=performance.getEntriesByName(E,"measure");Y.length>0&&console.log(`[Gantt Perf] ${E}: ${Y[Y.length-1].duration.toFixed(2)}ms`),performance.clearMarks(b),performance.clearMarks(j),performance.clearMeasures(E)}catch{}}function Et(){if(tt){let E=document.getElementById("ganttRoot"),b=E?E.querySelectorAll("*").length:0,j=E?E.querySelectorAll("svg *").length:0;console.log(`[Gantt Perf] DOM nodes: ${b}, SVG elements: ${j}`)}}function Lt(E){if(!E)return;let b=document.documentElement;b.style.setProperty("--gantt-header-height",`${E.headerHeight}px`),b.style.setProperty("--gantt-label-width",`${E.labelWidth}px`),b.style.setProperty("--gantt-id-column-width",`${E.idColumnWidth}px`),b.style.setProperty("--gantt-start-date-column-width",`${E.startDateColumnWidth}px`),b.style.setProperty("--gantt-status-column-width",`${E.statusColumnWidth}px`),b.style.setProperty("--gantt-due-date-column-width",`${E.dueDateColumnWidth}px`),b.style.setProperty("--gantt-assignee-column-width",`${E.assigneeColumnWidth}px`),b.style.setProperty("--gantt-sticky-left-width",`${E.stickyLeftWidth}px`)}function Dt({addDocListener:E,addWinListener:b}){let j=document.getElementById("ganttRoot"),Y=document.getElementById("ganttTooltip"),ie=Y?.querySelector(".gantt-tooltip-content");if(!j||!Y||!ie)return;let G=i=>i?String(i).replace(/\r\n/g,`
`).trimEnd():"";function Z(){j.querySelectorAll("svg title").forEach(i=>{let m=i.parentElement,M=G(i.textContent);m&&M&&(m.dataset.tooltip=M),i.remove()})}function R(){j.querySelectorAll("[title]").forEach(i=>{if(i.tagName.toLowerCase()==="title")return;let m=G(i.getAttribute("title"));i.removeAttribute("title"),m&&(i.dataset.tooltip=m)})}function le(){j.querySelectorAll("[data-toolbar-tooltip]").forEach(i=>{let m=G(i.dataset.toolbarTooltip);delete i.dataset.toolbarTooltip,m&&(i.dataset.tooltip=m)})}function we(){Z(),R(),le()}function Se(i){let m=i.findIndex(K=>K.trim().startsWith("#"));return m>=0?m:i.filter(K=>K.trim()).length>1?i.findIndex(K=>K.trim()):-1}function ae(i){ie.textContent="";let m=G(i);if(!m)return;let M=m.split(`
`),K=Se(M),Q=!1;M.forEach((te,F)=>{let Le=te.trim();if(!Le){if(!Q){let oe=document.createElement("div");oe.className="gantt-tooltip-spacer",ie.appendChild(oe),Q=!0}return}if(Le==="---"){let oe=document.createElement("div");oe.className="gantt-tooltip-divider",ie.appendChild(oe),Q=!1;return}let ke=Le.match(/^cf:([^:]+):(.*)$/);if(ke){let oe=ke[1].trim(),g=ke[2].trim(),Ce=document.createElement("div");Ce.className="gantt-tooltip-line";let We=document.createElement("span");We.className="gantt-tooltip-key",We.textContent=`${oe}: `,Ce.appendChild(We),g&&Ce.appendChild(document.createTextNode(g)),ie.appendChild(Ce),Q=!1;return}let He=document.createElement("div");He.className="gantt-tooltip-line",F===K&&He.classList.add("gantt-tooltip-title");let Ie=Le.match(/^Open in Browser:\s*(\S+)/);if(Ie&&/^https?:\/\//i.test(Ie[1])){He.appendChild(document.createTextNode("Open in Browser: "));let oe=document.createElement("a");oe.href=Ie[1],oe.textContent=Ie[1],oe.target="_blank",oe.rel="noopener noreferrer",He.appendChild(oe)}else He.textContent=te;ie.appendChild(He),Q=!1});let fe=ie.lastElementChild;fe&&fe.classList.contains("gantt-tooltip-spacer")&&fe.remove()}let P=null,z=null,x=null,L={x:0,y:0};function V(i){L={x:i.clientX,y:i.clientY}}function u(){z&&(clearTimeout(z),z=null)}function ce(){x&&(clearTimeout(x),x=null)}function _(i){return i&&(i===Y||Y.contains(i))}function q(i){return i&&P&&(i===P||P.contains(i))}function ee(){if(!L)return!1;let i=document.elementFromPoint(L.x,L.y);return _(i)||q(i)}let de=300;function ue(i){ce(),x=setTimeout(()=>{x=null,!(!P||P!==i)&&ee()&&p(i,L.x,L.y)},de)}function d(){u(),z=setTimeout(()=>{P&&(ee()||A())},300)}function S(i,m){let Q=Y.getBoundingClientRect(),fe=i+8,te=m+8;fe+Q.width>window.innerWidth-8&&(fe=i-Q.width-8),te+Q.height>window.innerHeight-8&&(te=m-Q.height-8),fe=Math.max(8,Math.min(fe,window.innerWidth-Q.width-8)),te=Math.max(8,Math.min(te,window.innerHeight-Q.height-8)),Y.style.left=`${Math.round(fe)}px`,Y.style.top=`${Math.round(te)}px`}function p(i,m,M){let K=i.dataset.tooltip;K&&(ae(K),Y.classList.add("visible"),Y.setAttribute("aria-hidden","false"),S(m,M))}function A(i=!1){ce(),u(),Y.classList.remove("visible"),Y.setAttribute("aria-hidden","true"),i||(P=null)}function I(i){if(!i||i===Y||Y.contains(i))return null;let m=i.closest?.("[data-tooltip], [title]");if(!m||!j.contains(m))return null;if(m.hasAttribute("title")){let M=G(m.getAttribute("title"));m.removeAttribute("title"),M&&(m.dataset.tooltip=M)}return m.dataset.tooltip?m:null}we(),E("pointerover",i=>{if(V(i),_(i.target)){u(),ce();return}let m=I(i.target);if(!m){ce();return}u(),P!==m?(P=m,Y.classList.contains("visible")&&A(!0),ue(m)):Y.classList.contains("visible")||ue(m)},!0),E("pointermove",i=>{P&&(V(i),z&&ee()&&u())},!0),E("pointerout",i=>{if(!P||(V(i),ce(),!q(i.target)&&!_(i.target)))return;let m=i.relatedTarget;_(m)||q(m)||d()},!0),E("scroll",()=>{P&&A()},!0),E("keydown",()=>{P&&A()},!0),b("blur",()=>{P&&A()})}function St(E){if(!E)return;E.state&&(tt=E.state.perfDebug??!1),Je("render-start");let b=document.getElementById("ganttRoot");b&&(Lt(E.state),Je("innerHTML-start"),b.innerHTML=E.html||"",Je("innerHTML-end"),lt("innerHTML","innerHTML-start","innerHTML-end"),It(E.state),Je("render-end"),lt("render","render-start","render-end"),Et())}window.addEventListener("message",E=>{let b=E.data;if(b){if(b.command==="render"){St(b.payload);return}window.__ganttHandleExtensionMessage&&window.__ganttHandleExtensionMessage(b)}});var wt=window.__GANTT_INITIAL_PAYLOAD__;wt&&St(wt);se.postMessage({command:"webviewReady"});function It(E){if(Je("initializeGantt-start"),!E)return;let{timelineWidth:b,minDateMs:j,maxDateMs:Y,totalDays:ie,extendedRelationTypes:G,redmineBaseUrl:Z,minimapBarsData:R,minimapHeight:le,minimapBarHeight:we,minimapTodayX:Se,extScrollLeft:ae,extScrollTop:P,labelWidth:z,leftExtrasWidth:x,healthFilter:L,sortBy:V,sortOrder:u,selectedCollapseKey:ce,barHeight:_,todayX:q,todayInRange:ee,isDraftMode:de,draftQueueCount:ue}=E,d=b/ie,S=de,p=document.getElementById("dragConfirmOk");p&&(p.textContent=de?"Queue to Draft":"Save to Redmine");let A=document.getElementById("draftBadge");if(A){if(de){A.classList.remove("hidden");let e=ue??0;A.textContent=e,A.dataset.tooltip=e===1?"1 change queued - click to review":e+" changes queued - click to review"}else A.classList.add("hidden");A.addEventListener("click",()=>{se.postMessage({command:"openDraftReview"})})}let I=document.getElementById("draftModeToggle");I&&I.addEventListener("click",()=>{se.postMessage({command:"toggleDraftMode"})}),window._ganttCleanup&&window._ganttCleanup();let i=[],m=[];function M(e,t,a){document.addEventListener(e,t,a),i.push({type:e,handler:t,options:a})}function K(e,t,a){window.addEventListener(e,t,a),m.push({type:e,handler:t,options:a})}window._ganttCleanup=()=>{i.forEach(e=>document.removeEventListener(e.type,e.handler,e.options)),m.forEach(e=>window.removeEventListener(e.type,e.handler,e.options)),window.__ganttHandleExtensionMessage=null};function Q(e){setTimeout(()=>{document.addEventListener("click",function t(a){e.contains(a.target)||(e.remove(),document.removeEventListener("click",t))})},0)}function fe(e){return Math.round(e/d)*d}function te(e){let t=document.getElementById("liveRegion");t&&(t.textContent=e)}let F=document.getElementById("ganttScroll"),Le=document.getElementById("ganttLeftHeader"),ke=document.getElementById("ganttLabels"),He=document.getElementById("ganttTimeline"),Ie=document.getElementById("menuUndo"),oe=document.getElementById("menuRedo"),g=document.getElementById("minimapSvg"),Ce=document.getElementById("minimapViewport"),{updateMinimapPosition:We,updateMinimapViewport:Oe}=pt({timelineWidth:b,minimapBarsData:R,minimapHeight:le,minimapBarHeight:we,minimapTodayX:Se,ganttScroll:F,minimapSvg:g,minimapViewport:Ce,addDocListener:M}),Be=se.getState()||{undoStack:[],redoStack:[],labelWidth:z,scrollLeft:null,scrollTop:null,centerDateMs:null},De=Be.undoStack||[],Xe=Be.redoStack||[],xe=Be.scrollLeft??(ae>0?ae:null),Fe=Be.scrollTop??(P>0?P:null),ge=Be.centerDateMs;function Ye(){if(!F)return null;let t=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,a=F.clientWidth-t,y=(F.scrollLeft+a/2)/b;return j+y*(Y-j)}function Ke(e){if(!F)return;let a=(e-j)/(Y-j)*b,y=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,O=F.clientWidth-y;F.scrollLeft=Math.max(0,a-O/2)}function h(){se.setState({undoStack:De,redoStack:Xe,labelWidth:ke?.offsetWidth||z,scrollLeft:null,scrollTop:F?.scrollTop??null,centerDateMs:Ye()})}let c=h;function B(){Ie&&Ie.toggleAttribute("disabled",De.length===0),oe&&oe.toggleAttribute("disabled",Xe.length===0),h()}if(Be.labelWidth&&Le&&ke){Le.style.width=Be.labelWidth+"px",ke.style.width=Be.labelWidth+"px";let e=document.querySelector(".capacity-ribbon-label");e&&(e.style.width=Be.labelWidth+x+"px")}let J=!0,$=!1,re=e=>{$=e},he=null;F&&F.addEventListener("scroll",()=>{cancelAnimationFrame(he),he=requestAnimationFrame(()=>{Oe(),J||h()})},{passive:!0}),requestAnimationFrame(()=>B()),window.__ganttHandleExtensionMessage=e=>{if(e.command==="setHeatmapState"){let t=document.querySelector(".heatmap-layer"),a=document.querySelector(".weekend-layer"),f=document.getElementById("menuHeatmap");e.enabled?(t&&t.classList.remove("hidden"),a&&a.classList.add("hidden"),f&&f.classList.add("active")):(t&&t.classList.add("hidden"),a&&a.classList.remove("hidden"),f&&f.classList.remove("active"))}else if(e.command==="setDependenciesState"){let t=document.querySelector(".dependency-layer"),a=document.getElementById("menuDeps");e.enabled?(t&&t.classList.remove("hidden"),a&&a.classList.add("active")):(t&&t.classList.add("hidden"),a&&a.classList.remove("active"))}else if(e.command==="setCapacityRibbonState"){let t=document.querySelector(".capacity-ribbon"),a=document.getElementById("menuCapacity");e.enabled?(t&&t.classList.remove("hidden"),a&&a.classList.add("active")):(t&&t.classList.add("hidden"),a&&a.classList.remove("active"))}else if(e.command==="setIntensityState"){let t=document.querySelector(".gantt-container"),a=document.getElementById("menuIntensity");e.enabled?(t?.classList.add("intensity-enabled"),a&&a.classList.add("active")):(t?.classList.remove("intensity-enabled"),a&&a.classList.remove("active"))}else if(e.command==="setDraftModeState"){S=e.enabled;let t=document.getElementById("dragConfirmOk");t&&(t.textContent=e.enabled?"Queue to Draft":"Save to Redmine");let a=document.getElementById("draftModeToggle");a&&(a.classList.toggle("active",e.enabled),a.textContent=e.enabled?"Disable Draft Mode":"Enable Draft Mode");let f=document.getElementById("draftBadge");if(f)if(e.enabled){f.classList.remove("hidden");let y=e.queueCount??0;f.textContent=y,f.dataset.tooltip=y===1?"1 change queued - click to review":y+" changes queued - click to review"}else f.classList.add("hidden")}else if(e.command==="setDraftQueueCount"){let t=document.getElementById("draftBadge");if(t){let a=e.count;t.textContent=a,t.dataset.tooltip=a===1?"1 change queued - click to review":a+" changes queued - click to review"}}else if(e.command==="pushUndoAction")De.push(e.action),Xe.length=0,B(),h();else if(e.command==="updateRelationId"){let t=e.stack==="undo"?De:Xe;if(t.length>0){let a=t[t.length-1];a.type==="relation"&&(a.relationId=e.newRelationId,h())}}else if(e.command==="scrollToIssue"){let t=e.issueId,a=document.querySelector('.issue-label[data-issue-id="'+t+'"]'),f=document.querySelector('.issue-bar[data-issue-id="'+t+'"]'),y=document.getElementById("ganttScroll"),be=document.querySelector(".gantt-header-row")?.getBoundingClientRect().height||60;if(!y)return;let Me=y.scrollTop,ve=y.scrollLeft;if(a){let ze=a.closest(".gantt-row");if(ze){let Ue=ze.offsetTop,je=ze.getBoundingClientRect().height,Ve=y.clientHeight-be;Me=Math.max(0,Ue-be-(Ve-je)/2)}a.focus(),a.classList.add("highlighted"),setTimeout(()=>a.classList.remove("highlighted"),2e3)}if(f){let ze=parseFloat(f.getAttribute("data-start-x")||"0"),je=parseFloat(f.getAttribute("data-end-x")||"0")-ze,Ve=y.clientWidth,kt=document.querySelector(".gantt-sticky-left")?.getBoundingClientRect().width||0,ht=Ve-kt;je<=ht-100?ve=ze-(ht-je)/2:ve=ze-50,ve=Math.max(0,ve),f.classList.add("highlighted"),setTimeout(()=>f.classList.remove("highlighted"),2e3)}y.scrollTo({left:ve,top:Me,behavior:"smooth"})}},document.getElementById("lookbackSelect")?.addEventListener("change",e=>{se.postMessage({command:"setLookback",years:e.target.value})}),document.getElementById("zoomSelect")?.addEventListener("change",e=>{c(),se.postMessage({command:"setZoom",zoomLevel:e.target.value})}),document.getElementById("viewFocusSelect")?.addEventListener("change",e=>{se.postMessage({command:"setViewFocus",focus:e.target.value})}),document.getElementById("projectSelector")?.addEventListener("change",e=>{let t=e.target.value,a=t?parseInt(t,10):null;se.postMessage({command:"setSelectedProject",projectId:a})}),document.getElementById("focusSelector")?.addEventListener("change",e=>{let t=e.target.value;se.postMessage({command:"setSelectedAssignee",assignee:t||null})}),document.getElementById("filterAssignee")?.addEventListener("change",e=>{let t=e.target.value;se.postMessage({command:"setFilter",filter:{assignee:t}})}),document.getElementById("filterStatus")?.addEventListener("change",e=>{let t=e.target.value;se.postMessage({command:"setFilter",filter:{status:t}})}),document.getElementById("menuFilterHealth")?.addEventListener("click",()=>{let e=["all","critical","warning","healthy"],t=L,f=(e.indexOf(t)+1)%e.length;se.postMessage({command:"setHealthFilter",health:e[f]})}),document.querySelectorAll(".gantt-col-header.sortable").forEach(e=>{e.addEventListener("click",()=>{let t=e.dataset.sort;t===V?u==="asc"?se.postMessage({command:"setSort",sortOrder:"desc"}):se.postMessage({command:"setSort",sortBy:null}):se.postMessage({command:"setSort",sortBy:t,sortOrder:"asc"})})}),document.getElementById("menuHeatmap")?.addEventListener("click",()=>{document.getElementById("menuHeatmap")?.hasAttribute("disabled")||(h(),se.postMessage({command:"toggleWorkloadHeatmap"}))}),document.getElementById("menuCapacity")?.addEventListener("click",()=>{document.getElementById("menuCapacity")?.hasAttribute("disabled")||(h(),se.postMessage({command:"toggleCapacityRibbon"}))}),document.getElementById("menuIntensity")?.addEventListener("click",()=>{document.getElementById("menuIntensity")?.hasAttribute("disabled")||(h(),se.postMessage({command:"toggleIntensity"}))}),document.getElementById("overloadBadge")?.addEventListener("click",e=>{e.stopPropagation();let t=e.currentTarget,a=parseInt(t.dataset.firstOverloadMs||"0",10);a>0&&(Ke(a),h())}),document.querySelectorAll(".capacity-day-bar-group").forEach(e=>{e.addEventListener("click",t=>{let a=parseInt(t.currentTarget.dataset.dateMs||"0",10);a>0&&(Ke(a),h())})}),document.getElementById("menuDeps")?.addEventListener("click",()=>{h(),se.postMessage({command:"toggleDependencies"})});let qe=document.querySelector(".gantt-container");function st(){let e=new Map,t=new Map;return document.querySelectorAll(".dependency-arrow").forEach(a=>{if(!(a.classList.contains("rel-blocks")||a.classList.contains("rel-precedes")))return;let y=a.dataset.from,O=a.dataset.to;e.has(y)||e.set(y,[]),e.get(y).push(O),t.has(O)||t.set(O,[]),t.get(O).push(y)}),{graph:e,reverseGraph:t}}let me=null;function nt(e,t,a){let f=new Set([e]),y=[e];for(;y.length>0;){let be=y.shift(),Me=t.get(be)||[];for(let ve of Me)f.has(ve)||(f.add(ve),y.push(ve))}let O=[e];for(;O.length>0;){let be=O.shift(),Me=a.get(be)||[];for(let ve of Me)f.has(ve)||(f.add(ve),O.push(ve))}return f}function Ze(e){if(et(),!e)return;me=e;let{graph:t,reverseGraph:a}=st(),f=nt(e,t,a);qe.classList.add("focus-mode"),document.querySelectorAll(".issue-bar").forEach(y=>{f.has(y.dataset.issueId)&&y.classList.add("focus-highlighted")}),document.querySelectorAll(".issue-label").forEach(y=>{f.has(y.dataset.issueId)&&y.classList.add("focus-highlighted")}),document.querySelectorAll(".dependency-arrow").forEach(y=>{f.has(y.dataset.from)&&f.has(y.dataset.to)&&y.classList.add("focus-highlighted")}),te(`Focus: ${f.size} issue${f.size!==1?"s":""} in dependency chain`)}function et(){me=null,qe.classList.remove("focus-mode"),document.querySelectorAll(".focus-highlighted").forEach(e=>e.classList.remove("focus-highlighted"))}let Ge=()=>me,s=new Set,o=null,n=document.getElementById("selectionCount"),l=Array.from(document.querySelectorAll(".issue-bar")),r=new Map;l.forEach(e=>{let t=e.dataset.issueId;t&&(r.has(t)||r.set(t,[]),r.get(t).push(e))});function D(e){e.forEach(t=>{let a=r.get(t);a&&a.forEach(f=>f.classList.toggle("selected",s.has(t)))}),s.size>0?(n.textContent=`${s.size} selected`,n.classList.remove("hidden"),qe.classList.add("multi-select-mode")):(n.classList.add("hidden"),qe.classList.remove("multi-select-mode"))}function C(){l.forEach(e=>{e.classList.toggle("selected",s.has(e.dataset.issueId))}),s.size>0?(n.textContent=`${s.size} selected`,n.classList.remove("hidden"),qe.classList.add("multi-select-mode")):(n.classList.add("hidden"),qe.classList.remove("multi-select-mode"))}function k(){let e=[...s];s.clear(),o=null,D(e)}function H(e){s.has(e)?s.delete(e):s.add(e),o=e,D([e])}function w(e,t){let a=l.findIndex(Me=>Me.dataset.issueId===e),f=l.findIndex(Me=>Me.dataset.issueId===t);if(a===-1||f===-1)return;let y=Math.min(a,f),O=Math.max(a,f),be=[];for(let Me=y;Me<=O;Me++){let ve=l[Me].dataset.issueId;s.has(ve)||(s.add(ve),be.push(ve))}D(be)}function X(){l.forEach(e=>s.add(e.dataset.issueId)),C(),te(`Selected all ${s.size} issues`)}l.forEach(e=>{e.addEventListener("mousedown",t=>{if(!t.ctrlKey&&!t.metaKey&&!t.shiftKey||t.target.classList.contains("drag-handle")||t.target.classList.contains("link-handle"))return;t.preventDefault(),t.stopPropagation();let a=e.dataset.issueId;t.shiftKey&&o?w(o,a):H(a)})}),M("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="a"&&(e.preventDefault(),X()),e.key==="Escape"&&s.size>0&&(e.stopImmediatePropagation(),k(),te("Selection cleared"))}),document.getElementById("refreshBtn")?.addEventListener("click",()=>{document.getElementById("loadingOverlay")?.classList.add("visible"),se.postMessage({command:"refresh"})}),document.getElementById("draftBadge")?.addEventListener("click",()=>{se.postMessage({command:"openDraftReview"})});function v(e,t,a,f,y){document.querySelector(".relation-picker")?.remove();let O=document.createElement("div");O.className="relation-picker";let be=150,Me=100,ve=Math.min(e,window.innerWidth-be-10),ze=Math.min(t,window.innerHeight-Me-10);O.style.left=Math.max(10,ve)+"px",O.style.top=Math.max(10,ze)+"px";let Ue=document.createElement("div");Ue.style.padding="6px 12px",Ue.style.fontSize="11px",Ue.style.opacity="0.7",Ue.textContent=`#${f} \u2192 #${y}`,O.appendChild(Ue);let je=document.createElement("button");je.textContent="\u{1F5D1}\uFE0F Delete relation",je.addEventListener("click",()=>{h(),se.postMessage({command:"deleteRelation",relationId:a}),O.remove()}),O.appendChild(je);let Ve=document.createElement("button");Ve.textContent="Cancel",Ve.addEventListener("click",()=>O.remove()),O.appendChild(Ve),document.body.appendChild(O),Q(O)}let T=new Map,W=new Map,N=new Map,Ae=new Map,Re=new Map,Pe=!1;function $e(){document.querySelectorAll(".issue-bar").forEach(e=>{let t=e.dataset.issueId;t&&(T.has(t)||T.set(t,[]),T.get(t).push(e))}),document.querySelectorAll(".issue-label").forEach(e=>{let t=e.dataset.issueId;t&&(W.has(t)||W.set(t,[]),W.get(t).push(e))}),document.querySelectorAll(".dependency-arrow").forEach(e=>{let t=e.dataset.from,a=e.dataset.to;t&&(N.has(t)||N.set(t,[]),N.get(t).push(e)),a&&(N.has(a)||N.set(a,[]),N.get(a).push(e))}),document.querySelectorAll(".project-label").forEach(e=>{let t=e.dataset.collapseKey;t&&(Ae.has(t)||Ae.set(t,[]),Ae.get(t).push(e))}),document.querySelectorAll(".aggregate-bars").forEach(e=>{let t=e.dataset.collapseKey;t&&(Re.has(t)||Re.set(t,[]),Re.get(t).push(e))}),Pe=!0}typeof requestIdleCallback<"u"?requestIdleCallback(()=>$e(),{timeout:100}):setTimeout($e,0);let pe=[];function Te(){document.body.classList.remove("hover-focus","dependency-hover"),pe.forEach(e=>e.classList.remove("hover-highlighted","hover-source")),pe=[]}function U(e){document.body.classList.add("hover-focus");let t=Pe?T.get(e)||[]:document.querySelectorAll('.issue-bar[data-issue-id="'+e+'"]'),a=Pe?W.get(e)||[]:document.querySelectorAll('.issue-label[data-issue-id="'+e+'"]'),f=Pe?N.get(e)||[]:document.querySelectorAll('.dependency-arrow[data-from="'+e+'"], .dependency-arrow[data-to="'+e+'"]');t.forEach(y=>{y.classList.add("hover-highlighted"),pe.push(y)}),a.forEach(y=>{y.classList.add("hover-highlighted"),pe.push(y)}),f.forEach(y=>{y.classList.add("hover-highlighted"),pe.push(y)})}function ne(e){document.body.classList.add("hover-focus");let t=Pe?Ae.get(e)||[]:document.querySelectorAll('.project-label[data-collapse-key="'+e+'"]'),a=Pe?Re.get(e)||[]:document.querySelectorAll('.aggregate-bars[data-collapse-key="'+e+'"]');t.forEach(f=>{f.classList.add("hover-highlighted"),pe.push(f)}),a.forEach(f=>{f.classList.add("hover-highlighted"),pe.push(f)})}let ye=document.querySelector(".gantt-timeline svg"),Qe=document.querySelector(".gantt-labels svg");if(ye&&(ye.addEventListener("mouseenter",e=>{let t=e.target.closest(".issue-bar"),a=e.target.closest(".aggregate-bars"),f=e.target.closest(".dependency-arrow");if(t){let y=t.dataset.issueId;y&&U(y)}else if(a){let y=a.dataset.collapseKey;y&&ne(y)}else if(f){let y=f.dataset.from,O=f.dataset.to;document.body.classList.add("dependency-hover"),f.classList.add("hover-source"),pe.push(f),y&&U(y),O&&U(O)}},!0),ye.addEventListener("mouseleave",e=>{let t=e.target.closest(".issue-bar"),a=e.target.closest(".aggregate-bars"),f=e.target.closest(".dependency-arrow");(t||a||f)&&Te()},!0)),Qe&&(Qe.addEventListener("mouseenter",e=>{let t=e.target.closest(".issue-label"),a=e.target.closest(".project-label");if(t){let f=t.dataset.issueId;f&&U(f)}else if(a){let f=a.dataset.collapseKey;f&&ne(f)}},!0),Qe.addEventListener("mouseleave",e=>{let t=e.target.closest(".issue-label"),a=e.target.closest(".project-label");(t||a)&&Te()},!0)),ye){let t=function(){document.querySelectorAll(".dependency-arrow.selected").forEach(a=>a.classList.remove("selected")),document.body.classList.remove("arrow-selection-mode"),document.querySelectorAll(".arrow-connected").forEach(a=>a.classList.remove("arrow-connected")),e=null};var At=t;ye.addEventListener("contextmenu",a=>{let f=a.target.closest(".dependency-arrow");if(!f)return;a.preventDefault();let y=parseInt(f.dataset.relationId),O=f.dataset.from,be=f.dataset.to;v(a.clientX,a.clientY,y,O,be)});let e=null;ye.addEventListener("click",a=>{let f=a.target.closest(".dependency-arrow");if(e&&(e.classList.remove("selected"),document.body.classList.remove("arrow-selection-mode"),document.querySelectorAll(".arrow-connected").forEach(be=>be.classList.remove("arrow-connected")),e=null),!f)return;a.stopPropagation(),e=f,f.classList.add("selected"),document.body.classList.add("arrow-selection-mode");let y=f.dataset.from,O=f.dataset.to;document.querySelectorAll(`.issue-bar[data-issue-id="${y}"], .issue-bar[data-issue-id="${O}"]`).forEach(be=>be.classList.add("arrow-connected")),document.querySelectorAll(`.issue-label[data-issue-id="${y}"], .issue-label[data-issue-id="${O}"]`).forEach(be=>be.classList.add("arrow-connected")),te(`Selected relation from #${y} to #${O}`)}),window._ganttArrowClickHandler&&document.removeEventListener("click",window._ganttArrowClickHandler),window._ganttArrowClickHandler=a=>{(e||document.querySelector(".dependency-arrow.selected"))&&!a.target.closest(".dependency-arrow")&&!a.target.closest(".blocks-badge-group")&&!a.target.closest(".blocker-badge")&&t()},document.addEventListener("click",window._ganttArrowClickHandler),window._ganttArrowKeyHandler&&document.removeEventListener("keydown",window._ganttArrowKeyHandler),window._ganttArrowKeyHandler=a=>{let f=e||document.querySelector(".dependency-arrow.selected");a.key==="Escape"&&f&&(a.stopImmediatePropagation(),t())},document.addEventListener("keydown",window._ganttArrowKeyHandler)}yt({vscode:se,menuUndo:Ie,menuRedo:oe,addDocListener:M,closeOnOutsideClick:Q,announce:te,saveState:h,updateUndoRedoButtons:B,undoStack:De,redoStack:Xe,selectedIssues:s,clearSelection:k,allIssueBars:l,redmineBaseUrl:Z,extendedRelationTypes:G,minDateMs:j,maxDateMs:Y,timelineWidth:b,dayWidth:d,barHeight:_,ganttScroll:F,snapToDay:fe,focusOnDependencyChain:Ze,clearFocus:et,getFocusedIssueId:Ge,scrollToAndHighlight:ct,setAllowScrollChange:re,isDraftModeEnabled:()=>S,isPerfDebugEnabled:()=>tt}),bt({vscode:se,addDocListener:M,addWinListener:K,announce:te,barHeight:_,selectedCollapseKey:ce});function Ne(){if(!ee){se.postMessage({command:"todayOutOfRange"});return}if(F){let t=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,a=F.clientWidth-t;F.scrollLeft=Math.max(0,q-a/2)}}function ct(e){if(!e)return;$=!0;let t=document.querySelector('.issue-label[data-issue-id="'+e+'"]'),a=document.querySelector('.issue-bar[data-issue-id="'+e+'"]');if(t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("highlighted"),setTimeout(()=>t.classList.remove("highlighted"),1500)),a&&F){let f=a.getBoundingClientRect(),y=F.getBoundingClientRect(),O=F.scrollLeft+f.left-y.left-100;F.scrollTo({left:Math.max(0,O),behavior:"smooth"}),a.classList.add("highlighted"),setTimeout(()=>a.classList.remove("highlighted"),1500)}}vt({vscode:se,addDocListener:M,menuUndo:Ie,menuRedo:oe,undoStack:De,redoStack:Xe,saveState:h,updateUndoRedoButtons:B,announce:te,scrollToAndHighlight:ct,scrollToToday:Ne}),Dt({addDocListener:M,addWinListener:K,ganttScroll:F}),requestAnimationFrame(()=>{if(ge!==null&&F){let e=Math.max(j,Math.min(Y,ge));Ke(e),Fe!==null&&(F.scrollTop=Fe),ge=null,Fe=null}else xe!==null&&F?(F.scrollLeft=xe,Fe!==null&&(F.scrollTop=Fe),xe=null,Fe=null):Ne();Oe(),J=!1}),document.getElementById("todayBtn")?.addEventListener("click",Ne);let dt=document.getElementById("resizeHandle"),ut=document.getElementById("resizeHandleHeader"),at=!1,ft=0,mt=0,ot=null;function gt(e,t){at=!0,ot=t,ft=e.clientX,mt=ke.offsetWidth,t.classList.add("dragging"),document.body.classList.add("cursor-col-resize","user-select-none"),e.preventDefault()}dt?.addEventListener("mousedown",e=>gt(e,dt)),ut?.addEventListener("mousedown",e=>gt(e,ut));let rt=!1,it=null;M("mousemove",e=>{at&&(it=e,!rt&&(rt=!0,requestAnimationFrame(()=>{if(rt=!1,!it)return;let t=it.clientX-ft,a=Math.min(600,Math.max(120,mt+t));if(Le&&(Le.style.width=a+"px"),ke){ke.style.width=a+"px";let y=ke.querySelector("svg");y&&y.setAttribute("width",String(a))}let f=document.querySelector(".capacity-ribbon-label");f&&(f.style.width=a+x+"px"),We()})))}),M("mouseup",()=>{at&&(at=!1,ot?.classList.remove("dragging"),ot=null,document.body.classList.remove("cursor-col-resize","user-select-none"),h())}),requestAnimationFrame(()=>{document.getElementById("loadingOverlay")?.classList.remove("visible")}),Je("initializeGantt-end"),lt("initializeGantt","initializeGantt-start","initializeGantt-end")}})();
