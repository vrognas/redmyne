"use strict";(()=>{function pt({timelineWidth:k,minimapBarsData:v,minimapHeight:Q,minimapBarHeight:K,minimapTodayX:he,ganttScroll:J,minimapSvg:se,minimapViewport:O,addDocListener:pe}){function He(){let R=document.querySelector(".gantt-body .gantt-sticky-left"),L=document.querySelector(".gantt-container");R&&L&&L.style.setProperty("--sticky-left-width",R.offsetWidth+"px")}requestAnimationFrame(He),se&&requestAnimationFrame(()=>{let R=Q/(v.length+1);if(v.forEach((L,Z)=>{let g=document.createElementNS("http://www.w3.org/2000/svg","rect");g.setAttribute("class",L.classes),g.setAttribute("x",(L.startPct*k).toString()),g.setAttribute("y",(R*(Z+.5)).toString()),g.setAttribute("width",Math.max(2,(L.endPct-L.startPct)*k).toString()),g.setAttribute("height",K.toString()),g.setAttribute("rx","1"),g.setAttribute("fill",L.color),se.insertBefore(g,O)}),he>0&&he<k){let L=document.createElementNS("http://www.w3.org/2000/svg","line");L.setAttribute("class","minimap-today"),L.setAttribute("x1",he.toString()),L.setAttribute("y1","0"),L.setAttribute("x2",he.toString()),L.setAttribute("y2",Q.toString()),se.insertBefore(L,O)}});function Ce(){if(!J||!O||!k||!J.scrollWidth||!J.clientWidth)return;let R=Math.max(1,J.scrollWidth-J.clientWidth),L=Math.min(1,J.scrollLeft/R),Z=Math.min(1,J.clientWidth/J.scrollWidth),g=Math.max(20,Z*k),me=L*(k-g);isNaN(me)||isNaN(g)||(O.setAttribute("x",me.toString()),O.setAttribute("width",g.toString()))}let fe=!1,Y=0;function V(R,L=!1){if(!J||!se||!O)return;let Z=se.getBoundingClientRect(),me=parseFloat(O.getAttribute("width")||"0")/k*Z.width,ne=R.clientX-Z.left;L?ne-=Y:ne-=me/2;let F=Math.max(0,Math.min(1,ne/(Z.width-me))),de=Math.max(0,J.scrollWidth-J.clientWidth);J.scrollLeft=F*de}return se&&O&&(O.addEventListener("mousedown",R=>{R.stopPropagation(),fe=!0;let L=se.getBoundingClientRect(),g=parseFloat(O.getAttribute("x")||"0")/k*L.width;Y=R.clientX-L.left-g}),se.addEventListener("mousedown",R=>{if(R.target===O)return;fe=!0;let L=se.getBoundingClientRect();Y=parseFloat(O.getAttribute("width")||"0")/100*L.width/2,V(R,!0)}),pe("mousemove",R=>{fe&&V(R,!0)}),pe("mouseup",()=>{fe=!1})),{updateMinimapPosition:He,updateMinimapViewport:Ce}}function yt(k){let{vscode:v,menuUndo:Q,menuRedo:K,addDocListener:he,closeOnOutsideClick:J,announce:se,saveState:O,updateUndoRedoButtons:pe,undoStack:He,redoStack:Ce,selectedIssues:fe,clearSelection:Y,allIssueBars:V,redmineBaseUrl:R,extendedRelationTypes:L,minDateMs:Z,maxDateMs:g,timelineWidth:me,dayWidth:ne,barHeight:F,ganttScroll:de,snapToDay:ve,focusOnDependencyChain:we,clearFocus:f,getFocusedIssueId:S,scrollToAndHighlight:p,setAllowScrollChange:H,isDraftModeEnabled:I,isPerfDebugEnabled:c}=k;function h(n,r,t){document.querySelector(".relation-picker")?.remove();let a=fe.size>1&&fe.has(t),l=a?Array.from(fe).map(C=>parseInt(C)):[parseInt(t)],D=document.createElement("div");D.className="relation-picker";let w=160,b=180,x=Math.min(n,window.innerWidth-w-10),M=Math.min(r,window.innerHeight-b-10);D.style.left=Math.max(10,x)+"px",D.style.top=Math.max(10,M)+"px";let X=document.createElement("div");X.style.padding="6px 12px",X.style.fontSize="11px",X.style.opacity="0.7",X.textContent=a?l.length+" issues selected":"#"+t,D.appendChild(X),(a?[{label:"Set % Done...",command:"bulkSetDoneRatio",bulk:!0},{label:"Clear Selection",command:"clearSelection",local:!0}]:[{label:"Update Issue...",command:"openIssue"},{label:"Open in Browser",command:"openInBrowser"},{label:"Show in Issues",command:"showInIssues"},{label:"Log Time",command:"logTime"},{label:"Set % Done",command:"setDoneRatio"},{label:"Toggle Auto-update %",command:"toggleAutoUpdate"},{label:"Toggle Ad-hoc Budget",command:"toggleAdHoc"},{label:"Toggle Precedence",command:"togglePrecedence"},{label:"Set Internal Estimate",command:"setInternalEstimate"},{label:"Copy Link",command:"copyLink",local:!0},{label:"Copy URL",command:"copyUrl"}]).forEach(C=>{let B=document.createElement("button");B.textContent=C.label,B.addEventListener("click",async()=>{if(C.command==="copyLink"){let z=document.querySelector('.issue-bar[data-issue-id="'+t+'"]')?.dataset?.subject||"Issue #"+t,U=R+"/issues/"+t,$='<a href="'+U+'">#'+t+" "+z+"</a>",G=U;try{await navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([G],{type:"text/plain"}),"text/html":new Blob([$],{type:"text/html"})})]),v.postMessage({command:"showStatus",message:"Copied #"+t+" link"})}catch{await navigator.clipboard.writeText(G),v.postMessage({command:"showStatus",message:"Copied #"+t+" URL"})}}else C.local?Y():C.bulk?v.postMessage({command:C.command,issueIds:l}):v.postMessage({command:C.command,issueId:parseInt(t)});D.remove()}),D.appendChild(B)}),document.body.appendChild(D),J(D)}function _(n){let r=Z+n/me*(g-Z);return new Date(r).toISOString().slice(0,10)}function N(n){let r=Z+n/me*(g-Z)-864e5;return new Date(r).toISOString().slice(0,10)}let ae=document.getElementById("dragDateTooltip"),oe=null;function T(n){let r=new Date(n+"T00:00:00"),t=r.toLocaleDateString("en-US",{month:"short"}),a=r.getDate(),l=r.toLocaleDateString("en-US",{weekday:"short"});return t+" "+a+" ("+l+")"}function Xe(n,r){let t=new Date(n+"T00:00:00"),a=new Date(r+"T00:00:00"),l=t.toLocaleDateString("en-US",{month:"short"}),D=a.toLocaleDateString("en-US",{month:"short"});return l===D?l+" "+t.getDate()+"-"+a.getDate():l+" "+t.getDate()+"-"+D+" "+a.getDate()}function Ee(n){ae.textContent=n,ae.style.display="block",oe=n}function We(n){n!==oe&&(ae.textContent=n,oe=n)}function qe(n,r){let t=r-28,a=!1;t<40&&(t=r+20,a=!0),ae.style.left=n+"px",ae.style.top=t+"px",ae.classList.toggle("flipped",a)}function Re(){ae.style.display="none",oe=null}let q=4,o=4;function Pe(n,r){c&&c()&&console.log("[Arrow Debug]",n,r)}function Oe(n,r,t,a,l,D=!1,w=!1){let b=t>n,x=Math.abs(t-n),M=x<30,X=Math.abs(r-a)<5,u=a>r,C=D?-1:1,B=w?1:-1,re;l?X&&b?re="sameRow-right":!X&&M?re="nearlyVertical":b?re="diffRow-right":X?re="sameRow-left":re="diffRow-left":re="non-scheduling";let z,U;if(l)if(X&&b)z="M "+n+" "+r+" H "+t;else if(X&&!b){let $=r-F;z="M "+n+" "+r+" V "+($+o)+" q 0 "+-o+" "+C*-o+" "+-o+" H "+(t+B*12-B*o)+" q "+B*-o+" 0 "+B*-o+" "+o+" V "+a+" H "+t}else if(!X&&M){let G=(r+a)/2;z="M "+n+" "+r+" H "+(n+C*8-C*o)+" q "+C*o+" 0 "+C*o+" "+(u?o:-o)+" V "+(G+(u?-o:o))+" q 0 "+(u?o:-o)+" "+-C*o+" "+(u?o:-o)+" H "+(t+B*8-B*o)+" q "+B*o+" 0 "+B*o+" "+(u?o:-o)+" V "+(a+(u?-o:o))+" q 0 "+(u?o:-o)+" "+-B*o+" "+(u?o:-o)+" H "+t}else if(b&&!D)z="M "+n+" "+r+" H "+(n+C*8-C*o)+" q "+C*o+" 0 "+C*o+" "+(u?o:-o)+" V "+(a+(u?-o:o))+" q 0 "+(u?o:-o)+" "+o+" "+(u?o:-o)+" H "+t;else if(b)z="M "+n+" "+r+" H "+(t+B*8-B*o)+" q "+B*o+" 0 "+B*o+" "+(u?o:-o)+" V "+(a+(u?-o:o))+" q 0 "+(u?o:-o)+" "+-B*o+" "+(u?o:-o)+" H "+t;else if(D)z="M "+n+" "+r+" H "+(t+B*8+o)+" q "+-o+" 0 "+-o+" "+(u?o:-o)+" V "+(a+(u?-o:o))+" q 0 "+(u?o:-o)+" "+o+" "+(u?o:-o)+" H "+t;else{let G=(r+a)/2;z="M "+n+" "+r+" H "+(n+C*8-C*o)+" q "+C*o+" 0 "+C*o+" "+(u?o:-o)+" V "+(G+(u?-o:o))+" q 0 "+(u?o:-o)+" "+-o+" "+(u?o:-o)+" H "+(t+B*8+o)+" q "+-o+" 0 "+-o+" "+(u?o:-o)+" V "+(a+(u?-o:o))+" q 0 "+(u?o:-o)+" "+o+" "+(u?o:-o)+" H "+t}else{let $=Math.abs(n-t)<5;if(X){let G=r-8;z="M "+n+" "+r+" V "+(G+o)+" q 0 "+-o+" "+(b?o:-o)+" "+-o+" H "+(t+(b?-o:o))+" q "+(b?o:-o)+" 0 "+(b?o:-o)+" "+o+" V "+a,U="M "+(t-q*.6)+" "+(a-q)+" L "+t+" "+a+" L "+(t+q*.6)+" "+(a-q)}else if($)z="M "+n+" "+r+" V "+a,U=u?"M "+(t-q*.6)+" "+(a-q)+" L "+t+" "+a+" L "+(t+q*.6)+" "+(a-q):"M "+(t-q*.6)+" "+(a+q)+" L "+t+" "+a+" L "+(t+q*.6)+" "+(a+q);else{let G=(r+a)/2;z="M "+n+" "+r+" V "+(G+(u?-o:o))+" q 0 "+(u?o:-o)+" "+(b?o:-o)+" "+(u?o:-o)+" H "+(t+(b?-o:o))+" q "+(b?o:-o)+" 0 "+(b?o:-o)+" "+(u?o:-o)+" V "+a,U=u?"M "+(t-q*.6)+" "+(a-q)+" L "+t+" "+a+" L "+(t+q*.6)+" "+(a-q):"M "+(t-q*.6)+" "+(a+q)+" L "+t+" "+a+" L "+(t+q*.6)+" "+(a+q)}}return l&&(U=w?"M "+(t+q)+" "+(a-q*.6)+" L "+t+" "+a+" L "+(t+q)+" "+(a+q*.6):"M "+(t-q)+" "+(a-q*.6)+" L "+t+" "+a+" L "+(t-q)+" "+(a+q*.6)),Pe("calcArrowPath",{inputs:{x1:n,y1:r,x2:t,y2:a,isScheduling:l},conditions:{goingRight:b,horizontalDist:x,nearlyVertical:M,sameRow:X,goingDown:u},pathCase:re,path:z.substring(0,80)+(z.length>80?"...":"")}),{path:z,arrowHead:U}}function Be(n){let r=[],t='.dependency-arrow[data-from="'+n+'"], .dependency-arrow[data-to="'+n+'"]';return document.querySelectorAll(t).forEach(a=>{let l=a.getAttribute("data-from"),D=a.getAttribute("data-to"),b=(a.getAttribute("class")||"").match(/rel-(\w+)/),x=b?b[1]:"relates",M=["blocks","precedes","finish_to_start","start_to_start","finish_to_finish","start_to_finish"].includes(x),X=document.querySelector('.issue-bar[data-issue-id="'+l+'"]'),u=document.querySelector('.issue-bar[data-issue-id="'+D+'"]');!X||!u||r.push({element:a,fromId:l,toId:D,isScheduling:M,relType:x,fromBar:X,toBar:u,linePath:a.querySelector(".arrow-line"),hitPath:a.querySelector(".arrow-hit-area"),headPath:a.querySelector(".arrow-head")})}),r}function Ye(n,r,t,a){n.forEach(l=>{let D=l.linePath?l.linePath.getAttribute("d"):null,w=l.fromId==r?t:parseFloat(l.fromBar.dataset.startX),b=l.fromId==r?a:parseFloat(l.fromBar.dataset.endX),x=parseFloat(l.fromBar.dataset.centerY),M=l.toId==r?t:parseFloat(l.toBar.dataset.startX),X=l.toId==r?a:parseFloat(l.toBar.dataset.endX),u=parseFloat(l.toBar.dataset.centerY),C=l.relType==="start_to_start"||l.relType==="start_to_finish",B=l.relType==="finish_to_finish"||l.relType==="start_to_finish",re,z,U,$;if(l.isScheduling)re=C?w-2:b+2,z=x,U=B?X+2:M-2,$=u;else{re=(w+b)/2,U=(M+X)/2;let ge=u>x;Math.abs(x-u)<5?(z=x-F/2,$=u-F/2):(z=ge?x+F/2:x-F/2,$=ge?u-F/2:u+F/2)}Pe("updateArrowPositions",{arrow:l.fromId+" -> "+l.toId,isScheduling:l.isScheduling,draggedId:r,barData:{fromStartX:l.fromBar.dataset.startX,fromEndX:l.fromBar.dataset.endX,fromY:l.fromBar.dataset.centerY,toStartX:l.toBar.dataset.startX,toEndX:l.toBar.dataset.endX,toY:l.toBar.dataset.centerY},computed:{fromStartX:w,fromEndX:b,fromY:x,toStartX:M,toEndX:X,toY:u},coords:{x1:re,y1:z,x2:U,y2:$},originalPath:D?D.substring(0,60)+"...":null});let{path:G,arrowHead:Se}=Oe(re,z,U,$,l.isScheduling,C,B);l.linePath&&l.linePath.setAttribute("d",G),l.hitPath&&l.hitPath.setAttribute("d",G),l.headPath&&l.headPath.setAttribute("d",Se)})}let Te=document.getElementById("dragConfirmOverlay"),ze=document.getElementById("dragConfirmMessage"),xe=document.getElementById("dragConfirmOk"),Ve=document.getElementById("dragConfirmCancel"),Ae=null;function _e(n,r,t){!Te||!ze||(ze.textContent=n,Ae={onConfirm:r,onCancel:t},H(!0),Te.style.display="flex",xe&&xe.focus())}function be(){Te&&(Te.style.display="none"),Ae=null}function E(){de&&P&&(de.scrollLeft=P.left,de.scrollTop=P.top),P=null}xe?.addEventListener("click",()=>{Ae?.onConfirm&&Ae.onConfirm(),P=null,be()}),Ve?.addEventListener("click",()=>{Ae?.onCancel&&Ae.onCancel(),E(),be()}),Te?.addEventListener("click",n=>{n.target===Te&&(Ae?.onCancel&&Ae.onCancel(),E(),be())}),he("keydown",n=>{Ae&&(n.key==="Escape"?(n.preventDefault(),Ae.onCancel&&Ae.onCancel(),E(),be()):n.key==="Enter"&&(n.preventDefault(),Ae.onConfirm&&Ae.onConfirm(),P=null,be()))});let d=null,P=null,ee=!1;document.querySelectorAll(".drag-handle").forEach(n=>{n.addEventListener("mousedown",r=>{r.preventDefault(),r.stopPropagation(),P={left:de?.scrollLeft,top:de?.scrollTop};let t=n.closest(".issue-bar"),a=n.classList.contains("drag-left"),l=parseInt(t.dataset.issueId),D=parseFloat(t.dataset.startX),w=parseFloat(t.dataset.endX),b=t.dataset.startDate||null,x=t.dataset.dueDate||null,M=t.querySelector(".bar-outline"),X=t.querySelector(".bar-main"),u=t.querySelector(".drag-left"),C=t.querySelector(".drag-right");t.classList.add("dragging");let B=t.querySelector(".bar-labels"),re=B?.classList.contains("labels-left"),z=Be(l),U=t.querySelector(".link-handle");Pe("dragStart (resize)",{issueId:l,isLeft:a,connectedArrowCount:z.length,arrows:z.map(Se=>({from:Se.fromId,to:Se.toId,isScheduling:Se.isScheduling,currentPath:Se.linePath?Se.linePath.getAttribute("d")?.substring(0,60)+"...":null}))}),d={issueId:l,isLeft:a,isMove:!1,initialMouseX:r.clientX,startX:D,endX:w,oldStartDate:b,oldDueDate:x,barOutline:M,barMain:X,leftHandle:u,rightHandle:C,bar:t,barLabels:B,labelsOnLeft:re,connectedArrows:z,linkHandle:U};let $=a?D:w,G=a?b:x;G&&(Ee((a?"Start: ":"Due: ")+T(G)),qe(r.clientX,r.clientY))})}),document.querySelectorAll(".bar-outline").forEach(n=>{n.addEventListener("mousedown",r=>{if(r.target.classList.contains("drag-handle")||r.ctrlKey||r.metaKey||r.shiftKey)return;r.preventDefault(),r.stopPropagation(),P={left:de?.scrollLeft,top:de?.scrollTop};let t=n.closest(".issue-bar");if(!t)return;let a=t.dataset.issueId,l=fe.size>1&&fe.has(a),w=(l?V.filter(u=>fe.has(u.dataset.issueId)):[t]).map(u=>({issueId:u.dataset.issueId,startX:parseFloat(u.dataset.startX),endX:parseFloat(u.dataset.endX),oldStartDate:u.dataset.startDate||null,oldDueDate:u.dataset.dueDate||null,barOutline:u.querySelector(".bar-outline"),barMain:u.querySelector(".bar-main"),leftHandle:u.querySelector(".drag-left"),rightHandle:u.querySelector(".drag-right"),bar:u,barLabels:u.querySelector(".bar-labels"),labelsOnLeft:u.querySelector(".bar-labels")?.classList.contains("labels-left"),connectedArrows:Be(u.dataset.issueId),linkHandle:u.querySelector(".link-handle")}));w.forEach(u=>u.bar.classList.add("dragging"));let b=t.querySelector(".bar-labels"),x=b?.classList.contains("labels-left"),M=Be(a),X=t.querySelector(".link-handle");Pe("dragStart (move)",{issueId:a,isBulkDrag:l,connectedArrowCount:M.length,arrows:M.map(u=>({from:u.fromId,to:u.toId,isScheduling:u.isScheduling,currentPath:u.linePath?u.linePath.getAttribute("d")?.substring(0,60)+"...":null}))}),d={issueId:parseInt(a),isLeft:!1,isMove:!0,isBulkDrag:l,bulkBars:w,initialMouseX:r.clientX,startX:parseFloat(t.dataset.startX),endX:parseFloat(t.dataset.endX),oldStartDate:t.dataset.startDate||null,oldDueDate:t.dataset.dueDate||null,barOutline:n,barMain:t.querySelector(".bar-main"),leftHandle:t.querySelector(".drag-left"),rightHandle:t.querySelector(".drag-right"),bar:t,barLabels:b,labelsOnLeft:x,connectedArrows:M,linkHandle:X},!l&&t.dataset.startDate&&t.dataset.dueDate&&(Ee(Xe(t.dataset.startDate,t.dataset.dueDate)),qe(r.clientX,r.clientY))})});let j=null,ue=null,Ie=null;function Me(){j&&(j.fromBar.classList.remove("linking-source"),document.querySelectorAll(".link-target").forEach(n=>n.classList.remove("link-target")),ue&&(ue.remove(),ue=null),j=null,Ie=null,document.body.classList.remove("cursor-crosshair"))}function Fe(n,r,t,a,l="end",D="start"){document.querySelector(".relation-picker")?.remove();let w=document.createElement("div");w.className="relation-picker";let b=180,x=200,M=Math.min(n,window.innerWidth-b-10),X=Math.min(r,window.innerHeight-x-10);w.style.left=Math.max(10,M)+"px",w.style.top=Math.max(10,X)+"px";let C={end_start:"finish_to_start",end_end:"finish_to_finish",start_start:"start_to_start",start_end:"start_to_finish"}[`${l}_${D}`]||"finish_to_start",B=[{value:"blocks",label:"\u{1F6AB} Blocks",cssClass:"rel-line-blocks",tooltip:"Target cannot be closed until this issue is closed"},{value:"precedes",label:"\u27A1\uFE0F Precedes",cssClass:"rel-line-scheduling",tooltip:"This issue must complete before target can start"},{value:"relates",label:"\u{1F517} Relates to",cssClass:"rel-line-informational",tooltip:"Simple link between issues (no constraints)"},{value:"duplicates",label:"\u{1F4CB} Duplicates",cssClass:"rel-line-informational",tooltip:"Closing target will automatically close this issue"},{value:"copied_to",label:"\u{1F4C4} Copied to",cssClass:"rel-line-informational",tooltip:"This issue was copied to create the target issue"}],re=[{value:"finish_to_start",label:"\u23E9 Finish\u2192Start",cssClass:"rel-line-scheduling",tooltip:"Target starts after this issue finishes (FS)"},{value:"start_to_start",label:"\u25B6\uFE0F Start\u2192Start",cssClass:"rel-line-scheduling",tooltip:"Target starts when this issue starts (SS)"},{value:"finish_to_finish",label:"\u23F9\uFE0F Finish\u2192Finish",cssClass:"rel-line-scheduling",tooltip:"Target finishes when this issue finishes (FF)"},{value:"start_to_finish",label:"\u23EA Start\u2192Finish",cssClass:"rel-line-scheduling",tooltip:"Target finishes when this issue starts (SF)"}],z=L?[...B,...re]:B,U=-1,$=document.createElement("div");$.className="delay-row";let G=document.createElement("label");G.textContent="Delay:",$.appendChild(G);let Se=document.createElement("button");Se.className="delay-preset active",Se.dataset.delay="-1",Se.title="Start same day predecessor ends",Se.textContent="Same day",$.appendChild(Se);let ge=document.createElement("button");ge.className="delay-preset",ge.dataset.delay="0",ge.title="Start day after predecessor ends",ge.textContent="+1 day",$.appendChild(ge);let W=document.createElement("input");W.type="number",W.className="delay-input",W.value=U,W.min="-30",W.max="30",W.title="Custom delay in days (-1=same day, 0=next day, 3=+4 days)",$.appendChild(W),$.style.display="none",$.querySelectorAll(".delay-preset").forEach(A=>{A.addEventListener("click",ie=>{ie.stopPropagation(),U=parseInt(A.dataset.delay),W.value=U,$.querySelectorAll(".delay-preset").forEach(Ke=>Ke.classList.remove("active")),A.classList.add("active")})}),W.addEventListener("input",()=>{U=parseInt(W.value)||0,$.querySelectorAll(".delay-preset").forEach(A=>{A.classList.toggle("active",parseInt(A.dataset.delay)===U)})}),W.addEventListener("click",A=>A.stopPropagation()),z.forEach(A=>{let ie=document.createElement("button");A.value===C&&ie.classList.add("suggested");let Ke=document.createElement("span");Ke.className="color-swatch "+A.cssClass,ie.appendChild(Ke),ie.appendChild(document.createTextNode(A.label)),ie.title=A.tooltip+(A.value===C?" (suggested based on anchors)":""),A.value==="precedes"&&(ie.addEventListener("mouseenter",()=>{$.style.display="flex"}),ie.addEventListener("focus",()=>{$.style.display="flex"})),ie.addEventListener("click",()=>{O();let Ne={command:"createRelation",issueId:t,targetIssueId:a,relationType:A.value};A.value==="precedes"&&(Ne.delay=U),v.postMessage(Ne),w.remove()}),w.appendChild(ie)}),w.appendChild($),document.body.appendChild(w),J(w)}let Ue=".drag-handle, .link-handle, .bar-outline, .blocks-badge-group, .blocker-badge, .progress-badge-group, .flex-badge-group";document.querySelectorAll(".issue-bar").forEach(n=>{n.addEventListener("click",r=>{r.target.closest(Ue)||d||j||ee||(S()&&f(),p(n.dataset.issueId))}),n.addEventListener("dblclick",r=>{d||j||ee||(r.preventDefault(),we(n.dataset.issueId))})});function Qe(n,r){if(document.querySelectorAll(".dependency-arrow.selected").forEach(a=>a.classList.remove("selected")),document.querySelectorAll(".arrow-connected").forEach(a=>a.classList.remove("arrow-connected")),n.length===0)return;document.body.classList.add("arrow-selection-mode");let t=new Set;n.forEach(a=>{a.classList.add("selected"),t.add(a.dataset.from),t.add(a.dataset.to)}),t.forEach(a=>{document.querySelectorAll(`.issue-bar[data-issue-id="${a}"], .issue-label[data-issue-id="${a}"]`).forEach(l=>l.classList.add("arrow-connected"))}),se(`Highlighted ${n.length} dependency arrow(s) for #${r}`)}document.querySelectorAll(".blocks-badge-group").forEach(n=>{n.addEventListener("mousedown",r=>{r.preventDefault(),r.stopPropagation()}),n.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation();let t=n.closest(".issue-bar");if(!t)return;let a=t.dataset.issueId,l=Array.from(document.querySelectorAll(`.dependency-arrow[data-from="${a}"]`));Qe(l,a)})}),document.querySelectorAll(".blocker-badge").forEach(n=>{n.addEventListener("mousedown",r=>{r.preventDefault(),r.stopPropagation()}),n.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation();let t=n.closest(".issue-bar");if(!t)return;let a=t.dataset.issueId,l=Array.from(document.querySelectorAll(`.dependency-arrow[data-to="${a}"]`));Qe(l,a)})});let Le=Array.from(document.querySelectorAll(".issue-bar")),st=10;Le.forEach((n,r)=>{n.addEventListener("keydown",t=>{if(t.key==="Enter"||t.key===" ")t.preventDefault(),p(n.dataset.issueId);else if(t.key==="ArrowDown"&&r<Le.length-1)t.preventDefault(),Le[r+1].focus(),se(`Issue ${Le[r+1].getAttribute("aria-label")}`);else if(t.key==="ArrowUp"&&r>0)t.preventDefault(),Le[r-1].focus(),se(`Issue ${Le[r-1].getAttribute("aria-label")}`);else if(t.key==="Home")t.preventDefault(),Le[0].focus(),se(`First issue: ${Le[0].getAttribute("aria-label")}`);else if(t.key==="End")t.preventDefault(),Le[Le.length-1].focus(),se(`Last issue: ${Le[Le.length-1].getAttribute("aria-label")}`);else if(t.key==="PageDown"){t.preventDefault();let a=Math.min(r+st,Le.length-1);Le[a].focus(),se(`Issue ${Le[a].getAttribute("aria-label")}`)}else if(t.key==="PageUp"){t.preventDefault();let a=Math.max(r-st,0);Le[a].focus(),se(`Issue ${Le[a].getAttribute("aria-label")}`)}else if(t.key==="Tab"&&t.shiftKey){let a=n.dataset.issueId,l=document.querySelector(`.issue-label[data-issue-id="${a}"]`);l&&(t.preventDefault(),l.focus(),se(`Label for issue #${a}`))}})}),document.querySelectorAll(".link-handle").forEach(n=>{n.addEventListener("mousedown",r=>{r.stopPropagation(),r.preventDefault();let t=n.closest(".issue-bar"),a=parseInt(t.dataset.issueId),l=parseFloat(n.dataset.cx),D=parseFloat(n.dataset.cy);t.classList.add("linking-source"),document.body.classList.add("cursor-crosshair");let w=document.querySelector("#ganttTimeline svg");if(!document.getElementById("temp-arrow-head")){let x=document.createElementNS("http://www.w3.org/2000/svg","defs");x.innerHTML=`
            <marker id="temp-arrow-head" markerWidth="10" markerHeight="7"
                    refX="9" refY="3.5" orient="auto" markerUnits="strokeWidth">
              <polygon points="0 0, 10 3.5, 0 7" fill="var(--vscode-focusBorder)"/>
            </marker>`,w.insertBefore(x,w.firstChild)}ue=document.createElementNS("http://www.w3.org/2000/svg","path"),ue.classList.add("temp-link-arrow"),ue.setAttribute("stroke","var(--vscode-focusBorder)"),ue.setAttribute("stroke-width","2"),ue.setAttribute("fill","none"),ue.setAttribute("marker-end","url(#temp-arrow-head)"),w.appendChild(ue);let b=n.dataset.anchor||"end";j={fromId:a,fromBar:t,startX:l,startY:D,fromAnchor:b}})}),he("keydown",n=>{if(n.key==="Escape"){let r=document.querySelector(".relation-picker");if(r){n.stopImmediatePropagation(),r.remove();return}if(j){n.stopImmediatePropagation(),Me();return}S()&&(n.stopImmediatePropagation(),f(),se("Focus cleared"))}});let Je=!1,nt=null;he("mousemove",n=>{!d&&!j||(nt=n,!Je&&(Je=!0,requestAnimationFrame(()=>{Je=!1;let r=nt;if(r){if(d){let t=r.clientX-d.initialMouseX;if(d.isMove&&d.isBulkDrag&&d.bulkBars){let a=ve(t)-ve(0);d.bulkBars.forEach(l=>{let D=l.endX-l.startX,w=Math.max(0,Math.min(l.startX+a,me-D)),b=w+D,x=b-w;l.barOutline.setAttribute("x",w),l.barOutline.setAttribute("width",x),l.barMain&&(l.barMain.setAttribute("x",w),l.barMain.setAttribute("width",x));let M=l.leftHandle.querySelector("rect"),X=l.rightHandle.querySelector("rect");if(M&&M.setAttribute("x",w),X&&X.setAttribute("x",b-14),l.leftHandle.querySelectorAll(".drag-grip circle").forEach((u,C)=>u.setAttribute("cx",w+9)),l.rightHandle.querySelectorAll(".drag-grip circle").forEach((u,C)=>u.setAttribute("cx",b-9)),l.newStartX=w,l.newEndX=b,l.barLabels){let u=l.labelsOnLeft?w-l.startX:b-l.endX;l.barLabels.setAttribute("transform","translate("+u+", 0)")}l.connectedArrows&&Ye(l.connectedArrows,l.issueId,w,b),l.linkHandle&&l.linkHandle.querySelectorAll("circle").forEach(u=>u.setAttribute("cx",String(b+8)))}),d.snappedDelta=a}else{let a=d.startX,l=d.endX,D=d.endX-d.startX;d.isMove?(a=ve(Math.max(0,Math.min(d.startX+t,me-D))),l=a+D):d.isLeft?a=ve(Math.max(0,Math.min(d.startX+t,d.endX-ne))):l=ve(Math.max(d.startX+ne,Math.min(d.endX+t,me)));let w=l-a;d.barOutline.setAttribute("x",a),d.barOutline.setAttribute("width",w),d.barMain&&(d.barMain.setAttribute("x",a),d.barMain.setAttribute("width",w));let b=d.leftHandle.querySelector("rect"),x=d.rightHandle.querySelector("rect");if(b&&b.setAttribute("x",a),x&&x.setAttribute("x",l-14),d.leftHandle.querySelectorAll(".drag-grip circle").forEach(M=>M.setAttribute("cx",a+9)),d.rightHandle.querySelectorAll(".drag-grip circle").forEach(M=>M.setAttribute("cx",l-9)),d.newStartX=a,d.newEndX=l,d.barLabels){let M=d.labelsOnLeft?a-d.startX:l-d.endX;d.barLabels.setAttribute("transform","translate("+M+", 0)")}if(d.connectedArrows&&Ye(d.connectedArrows,d.issueId,a,l),d.linkHandle&&d.linkHandle.querySelectorAll("circle").forEach(M=>M.setAttribute("cx",String(l+8))),d.isMove&&!d.isBulkDrag){let M=_(a),X=N(l),C=M!==d.oldStartDate?Xe(d.oldStartDate,d.oldDueDate)+" \u2192 "+Xe(M,X):Xe(M,X);We(C),qe(r.clientX,r.clientY)}else if(!d.isMove){let M=d.isLeft?a:l,X=d.isLeft?_(M):N(M);We((d.isLeft?"Start: ":"Due: ")+T(X)),qe(r.clientX,r.clientY)}}}if(j&&ue){let a=document.querySelector("#ganttTimeline svg").getBoundingClientRect(),l=r.clientX-a.left,D=r.clientY-a.top,w=`M ${j.startX} ${j.startY} L ${l} ${D}`;ue.setAttribute("d",w);let b=document.elementFromPoint(r.clientX,r.clientY)?.closest(".issue-bar");Ie&&Ie!==b&&Ie.classList.remove("link-target"),b&&b!==j.fromBar?(b.classList.add("link-target"),Ie=b):Ie=null}}})))});function ye(n){if(!n)return;let{bar:r,barOutline:t,barMain:a,leftHandle:l,rightHandle:D,barLabels:w,startX:b,endX:x,connectedArrows:M,issueId:X,linkHandle:u}=n,C=x-b;if(t&&(t.setAttribute("x",String(b)),t.setAttribute("width",String(C))),a&&(a.setAttribute("x",String(b)),a.setAttribute("width",String(C))),l){let B=l.querySelector("rect");B&&B.setAttribute("x",String(b)),l.querySelectorAll(".drag-grip circle").forEach(re=>re.setAttribute("cx",b+9))}if(D){let B=D.querySelector("rect");B&&B.setAttribute("x",String(x-14)),D.querySelectorAll(".drag-grip circle").forEach(re=>re.setAttribute("cx",x-9))}w&&w.removeAttribute("transform"),M&&M.length>0&&Ye(M,X,b,x),u&&u.querySelectorAll("circle").forEach(B=>B.setAttribute("cx",String(x+8))),r&&r.classList.remove("dragging")}he("mouseup",n=>{if(d){let{issueId:r,isLeft:t,isMove:a,isBulkDrag:l,bulkBars:D,newStartX:w,newEndX:b,bar:x,startX:M,endX:X,oldStartDate:u,oldDueDate:C,barOutline:B,barMain:re,leftHandle:z,rightHandle:U,barLabels:$,connectedArrows:G}=d,Se={...d};if(l&&D&&a){D.forEach(W=>W.bar.classList.remove("dragging"));let ge=[];if(D.forEach(W=>{if(W.newStartX!==void 0&&W.newStartX!==W.startX){let A=_(W.newStartX),ie=N(W.newEndX);(A!==W.oldStartDate||ie!==W.oldDueDate)&&ge.push({issueId:parseInt(W.issueId),oldStartDate:W.oldStartDate,oldDueDate:W.oldDueDate,newStartDate:A,newDueDate:ie,barData:W})}}),ge.length>0){Re();let W=()=>{He.push({type:"bulk",changes:ge.map(A=>({issueId:A.issueId,oldStartDate:A.oldStartDate,oldDueDate:A.oldDueDate,newStartDate:A.newStartDate,newDueDate:A.newDueDate}))}),Ce.length=0,pe(),O(),ge.forEach(A=>{v.postMessage({command:"updateDates",issueId:A.issueId,startDate:A.newStartDate,dueDate:A.newDueDate})})};if(I&&I())W();else{let A="Move "+ge.length+" issue(s) to new dates?";_e(A,W,()=>{D.forEach(ie=>ye(ie))})}}else Re(),D.forEach(W=>ye(W));d=null,ee=!0,requestAnimationFrame(()=>ee=!1);return}if(x.classList.remove("dragging"),Re(),w!==void 0||b!==void 0){let ge=null,W=null;a?w!==M&&(ge=_(w),W=N(b)):t?ge=w!==M?_(w):null:W=b!==X?N(b):null;let A=ge&&ge!==u?ge:null,ie=W&&W!==C?W:null;if(A||ie){let Ke=()=>{He.push({issueId:r,oldStartDate:A?u:null,oldDueDate:ie?C:null,newStartDate:A,newDueDate:ie}),Ce.length=0,pe(),O(),v.postMessage({command:"updateDates",issueId:r,startDate:A,dueDate:ie})};if(I&&I())Ke();else{let Ne="Issue #"+r+": ";A&&ie?Ne+=Xe(u,C)+" \u2192 "+Xe(A,ie):A?Ne+="Start: "+T(u)+" \u2192 "+T(A):Ne+="Due: "+T(C)+" \u2192 "+T(ie),_e(Ne,Ke,()=>{ye(Se)})}}else ye(Se)}else ye(Se);d=null,ee=!0,requestAnimationFrame(()=>ee=!1)}if(j){let r=j.fromId,t=j.fromAnchor;if(Ie){let a=parseInt(Ie.dataset.issueId);if(r!==a){let D=document.querySelector("#ganttTimeline svg").getBoundingClientRect(),w=n.clientX-D.left,b=Ie.querySelector(".bar-outline"),x=parseFloat(b.getAttribute("x")),M=x+parseFloat(b.getAttribute("width")),X=(x+M)/2,u=w<X?"start":"end";Fe(n.clientX,n.clientY,r,a,t,u)}}Me()}Ae||E()}),Q?.addEventListener("click",()=>{if(Q.hasAttribute("disabled")||He.length===0)return;let n=He.pop();if(Ce.push(n),pe(),O(),n.type==="relation")n.operation==="create"?v.postMessage({command:"undoRelation",operation:"delete",relationId:n.relationId,datesBefore:n.datesBefore}):v.postMessage({command:"undoRelation",operation:"create",issueId:n.issueId,targetIssueId:n.targetIssueId,relationType:n.relationType});else if(n.type==="bulk"){let r=I&&I();n.changes.forEach(t=>{r?v.postMessage({command:"removeDraft",issueId:t.issueId,startDate:t.oldStartDate,dueDate:t.oldDueDate}):v.postMessage({command:"updateDates",issueId:t.issueId,startDate:t.oldStartDate,dueDate:t.oldDueDate})})}else I&&I()?v.postMessage({command:"removeDraft",issueId:n.issueId,startDate:n.oldStartDate,dueDate:n.oldDueDate}):v.postMessage({command:"updateDates",issueId:n.issueId,startDate:n.oldStartDate,dueDate:n.oldDueDate})}),K?.addEventListener("click",()=>{if(K.hasAttribute("disabled")||Ce.length===0)return;let n=Ce.pop();He.push(n),pe(),O(),n.type==="relation"?n.operation==="create"?v.postMessage({command:"redoRelation",operation:"create",issueId:n.issueId,targetIssueId:n.targetIssueId,relationType:n.relationType}):v.postMessage({command:"redoRelation",operation:"delete",relationId:n.relationId}):n.type==="bulk"?n.changes.forEach(r=>{v.postMessage({command:"updateDates",issueId:r.issueId,startDate:r.newStartDate,dueDate:r.newDueDate})}):v.postMessage({command:"updateDates",issueId:n.issueId,startDate:n.newStartDate,dueDate:n.newDueDate})})}function bt(k){let{vscode:v,addDocListener:Q,addWinListener:K,announce:he,barHeight:J,selectedCollapseKey:se}=k;document.querySelectorAll(".collapse-toggle").forEach(f=>{f.addEventListener("click",S=>{S.stopPropagation();let H=f.closest("[data-collapse-key]")?.dataset.collapseKey;H&&we(H)})}),document.getElementById("menuExpand")?.addEventListener("click",()=>{let S=document.getElementById("ganttScroll")?.dataset.allExpandableKeys,p=S?JSON.parse(S):[];v.postMessage({command:"expandAll",keys:p})}),document.getElementById("menuCollapse")?.addEventListener("click",()=>{v.postMessage({command:"collapseAll"})});let O=Array.from(document.querySelectorAll(".project-label, .issue-label, .time-group-label")),pe=null,He=se??null;function Ce(f){return!f.classList.contains("gantt-row-hidden")&&f.getAttribute("visibility")!=="hidden"}function fe(f,S){let p=f+S;for(;p>=0&&p<O.length;){if(Ce(O[p]))return{label:O[p],index:p};p+=S}return null}function Y(f){let S=document.getElementById("ganttScroll"),p=document.querySelector(".gantt-header-row");if(!S||!f)return;let H=p?.getBoundingClientRect().height||60,I=f.closest(".gantt-row");if(!I)return;let c=I.getBoundingClientRect().top,h=I.getBoundingClientRect().height,_=S.getBoundingClientRect(),N=_.top+H,ae=_.bottom;c<N?S.scrollBy({top:c-N-4,behavior:"smooth"}):c+h>ae&&S.scrollBy({top:c+h-ae+4,behavior:"smooth"})}function V(f,S=!1,p=!1,H=!1){pe&&pe.classList.remove("active"),pe=f,f&&(f.classList.add("active"),H||f.focus(),p&&Y(f),S||v.postMessage({command:"setSelectedKey",collapseKey:f.dataset.collapseKey}))}K("focus",()=>{pe&&Ce(pe)&&pe.focus()}),Q("keydown",f=>{f.key==="Escape"&&pe&&(pe.classList.remove("active"),pe.blur(),pe=null,v.postMessage({command:"setSelectedKey",collapseKey:null}))});let R=new Map,L=new Map,Z=new Map;function g(f){let S=f.dataset.originalY;if(Z.has(S))return Z.get(S);let p=JSON.parse(f.dataset.rowContributions||"{}");return Z.set(S,p),p}function me(){R.clear(),document.querySelectorAll("[data-collapse-key][data-original-y]").forEach(S=>{let p=S.dataset.collapseKey,H=parseFloat(S.dataset.originalY);R.has(p)||R.set(p,{originalY:H,elements:[]}),R.get(p).elements.push(S)})}function ne(){L.clear(),document.querySelectorAll("[data-collapse-key][data-parent-key]").forEach(S=>{let p=S.dataset.collapseKey;if(L.has(p))return;let H=[],I=S.dataset.parentKey;for(;I;)H.push(I),I=document.querySelector('[data-collapse-key="'+I+'"]')?.dataset.parentKey||null;L.set(p,H)})}me(),ne();function F(f,S){S?(f.setAttribute("visibility","hidden"),f.classList.add("gantt-row-hidden")):(f.removeAttribute("visibility"),f.classList.remove("gantt-row-hidden"))}function de(f){let S=[];return L.forEach((p,H)=>{p.includes(f)&&S.push(H)}),S}function ve(f){let S=[];return L.forEach((p,H)=>{let I=p.indexOf(f);if(I===-1)return;let c=!0;for(let h=0;h<I;h++){let _=p[h],N=document.querySelector('[data-collapse-key="'+_+'"].project-label, [data-collapse-key="'+_+'"].issue-label, [data-collapse-key="'+_+'"].time-group-label');if(!N||N.dataset.expanded!=="true"){c=!1;break}}c&&S.push(H)}),S}function we(f,S){let p=document.querySelector('[data-collapse-key="'+f+'"].project-label, [data-collapse-key="'+f+'"].time-group-label, [data-collapse-key="'+f+'"].issue-label');if(!p||p.dataset.hasChildren!=="true")return;let H=p.dataset.expanded==="true",I=S==="expand"?!0:S==="collapse"?!1:!H;if(I===H)return;p.dataset.expanded=I?"true":"false";let c=p.querySelector(".collapse-toggle");c&&c.classList.toggle("expanded",I);let h=de(f),_=I?ve(f):[];if(h.length===0){v.postMessage({command:"collapseStateSync",collapseKey:f,isExpanded:I});return}let N=new Set(h),ae=new Set(_),oe=R.get(f),T=oe?.originalY??0,Xe=new Set,Ee=0,We=0,Re=I?_:ve(f),q=new Set(Re);if(document.querySelectorAll(".zebra-stripe").forEach(E=>{let d=g(E);f in d&&We===0&&(We=parseFloat(E.dataset.originalY||"0"));for(let[P,ee]of Object.entries(d))q.has(P)&&!Xe.has(P)&&(Ee+=parseFloat(ee),Xe.add(P))}),Ee===0&&Re.length>0){v.postMessage({command:"collapseStateSync",collapseKey:f,isExpanded:I}),v.postMessage({command:"requestRerender"});return}let o=I?Ee:-Ee,Pe=T;if(oe&&oe.elements.length>0){let d=(oe.elements[0].getAttribute("transform")||"").match(/translate\([^,]+,\s*([-\d.]+)/);d&&(Pe=parseFloat(d[1]))}let Oe=Pe+J;I?_.forEach(E=>{let d=R.get(E);d&&(d.elements.forEach(P=>{let j=(P.getAttribute("transform")||"").match(/translate\(([-\d.]+)/),ue=j?j[1]:"0";P.setAttribute("transform","translate("+ue+", "+Oe+")"),F(P,!1)}),Oe+=J)}):h.forEach(E=>{let d=R.get(E);d&&d.elements.forEach(P=>{F(P,!0)})}),R.forEach(({originalY:E,elements:d},P)=>{E>T&&!N.has(P)&&d.forEach(ee=>{let j=ee.getAttribute("transform")||"",ue=j.match(/translate\(([-\d.]+)/),Ie=ue?ue[1]:"0",Me=j.match(/translate\([^,]+,\s*([-\d.]+)/),Ue=(Me?parseFloat(Me[1]):E)+o;ee.setAttribute("transform","translate("+Ie+", "+Ue+")")})});let Be=document.querySelector(".gantt-labels svg");if(Be){let d=parseFloat(Be.getAttribute("height")||"0")+o;Be.setAttribute("height",String(d))}[".gantt-col-status svg",".gantt-col-id svg",".gantt-col-start svg",".gantt-col-due svg",".gantt-col-assignee svg"].forEach(E=>{let d=document.querySelector(E);if(!d)return;let ee=parseFloat(d.getAttribute("height")||"0")+o;d.setAttribute("height",String(ee))});let Te=document.querySelector(".gantt-timeline svg");if(Te){let d=parseFloat(Te.getAttribute("height")||"0")+o;Te.setAttribute("height",d)}let ze=new Set;document.querySelectorAll('.project-label[data-has-children="true"], .time-group-label[data-has-children="true"], .issue-label[data-has-children="true"]').forEach(E=>{E.dataset.expanded==="false"&&ze.add(E.dataset.collapseKey)});let xe=new Map,Ve=document.querySelectorAll(".zebra-stripe");Ve.forEach(E=>{let d=parseFloat(E.dataset.originalY||"0");if(xe.has(d))return;let P=g(E),ee=Object.keys(P),j=ee.length>0&&ee.every(Me=>N.has(Me)),ue=ee.some(Me=>N.has(Me)),Ie=d>We;if(j)xe.set(d,{action:"toggle-visibility",hide:!I});else if(ue)if(I){let Me=0;for(let[Fe,Ue]of Object.entries(P))(!N.has(Fe)||ae.has(Fe))&&(Me+=parseFloat(Ue));xe.set(d,{action:"expand",newHeight:Me})}else{let Me=0;for(let[Fe,Ue]of Object.entries(P))N.has(Fe)||(Me+=parseFloat(Ue));xe.set(d,{action:"shrink",newHeight:Me})}else if(Ie){let Me=parseFloat(E.getAttribute("y")||String(d));xe.set(d,{action:"shift",newY:Me+o})}}),Ve.forEach(E=>{let d=parseFloat(E.dataset.originalY||"0"),P=xe.get(d);if(P)switch(P.action){case"toggle-visibility":F(E,P.hide);break;case"shrink":E.setAttribute("height",String(P.newHeight));break;case"expand":E.setAttribute("height",String(P.newHeight));break;case"shift":E.setAttribute("y",String(P.newY));break}});let Ae=Array.from(document.querySelectorAll(".zebra-stripe")).filter(E=>E.getAttribute("visibility")!=="hidden"),_e=new Map;Ae.forEach(E=>{let d=parseFloat(E.getAttribute("y")||"0");_e.has(d)||_e.set(d,[]),_e.get(d).push(E)}),Array.from(_e.keys()).sort((E,d)=>E-d).forEach((E,d)=>{let P=d%2===0?"0.03":"0.06";_e.get(E).forEach(ee=>ee.setAttribute("opacity",P))}),document.querySelectorAll(".indent-guide-line").forEach(E=>{let d=E.dataset.forParent,P=L.get(d)||[],ee=ze.has(d)||P.some(j=>ze.has(j));if(F(E,ee),!ee){let j=R.get(d);if(j&&j.originalY>T){let ue=parseFloat(E.getAttribute("y1")||"0"),Ie=parseFloat(E.getAttribute("y2")||"0");E.setAttribute("y1",ue+o),E.setAttribute("y2",Ie+o)}}}),document.querySelectorAll(".dependency-arrow").forEach(E=>{let d=E.dataset.from,P=E.dataset.to,ee=document.querySelector('.issue-bar[data-issue-id="'+d+'"]'),j=document.querySelector('.issue-bar[data-issue-id="'+P+'"]'),ue=ee?.classList.contains("gantt-row-hidden"),Ie=j?.classList.contains("gantt-row-hidden");F(E,ue||Ie)}),v.postMessage({command:"collapseStateSync",collapseKey:f,isExpanded:I})}if(He){let f=O.find(S=>S.dataset.collapseKey===He);f&&V(f,!0)}O.forEach((f,S)=>{f.addEventListener("click",p=>{if(p.target.closest?.(".collapse-toggle")||p.target.closest?.(".chevron-hit-area"))return;let H=f.dataset.issueId,I=f.classList.contains("project-label"),c=f.classList.contains("time-group-label"),h=f.dataset.collapseKey;if((I||c)&&h){V(f),f.dataset.hasChildren==="true"&&we(h);return}let _=p.target.classList?.contains("issue-text")||p.target.closest(".issue-text");H&&_?(V(f,!1,!1,!0),v.postMessage({command:"openIssue",issueId:parseInt(H,10)})):f.dataset.hasChildren==="true"&&h?(V(f),we(h)):V(f)}),f.addEventListener("keydown",p=>{let H=f.dataset.collapseKey,I=f.dataset.issueId?parseInt(f.dataset.issueId,10):NaN;switch(p.key){case"Enter":case" ":p.preventDefault(),isNaN(I)||v.postMessage({command:"openIssue",issueId:I});break;case"ArrowUp":{p.preventDefault();let c=fe(S,-1);c&&V(c.label,!1,!0);break}case"ArrowDown":{p.preventDefault();let c=fe(S,1);c&&V(c.label,!1,!0);break}case"ArrowLeft":if(p.preventDefault(),f.dataset.hasChildren==="true"&&f.dataset.expanded==="true")we(H,"collapse");else if(f.dataset.parentKey){let c=O.find(h=>h.dataset.collapseKey===f.dataset.parentKey);c&&V(c,!1,!0)}break;case"ArrowRight":if(p.preventDefault(),f.dataset.hasChildren==="true"&&f.dataset.expanded==="false")we(H,"expand");else if(f.dataset.hasChildren==="true"&&f.dataset.expanded==="true"){let c=O.find(h=>h.dataset.parentKey===H&&Ce(h));c&&V(c,!1,!0)}break;case"Home":{p.preventDefault();let c=fe(-1,1);c&&V(c.label,!1,!0);break}case"End":{p.preventDefault();let c=fe(O.length,-1);c&&V(c.label,!1,!0);break}case"PageDown":{p.preventDefault();let c=S,h=0;for(;h<10&&c<O.length-1;){let _=fe(c,1);if(!_)break;c=_.index,h++}h>0&&V(O[c],!1,!0);break}case"PageUp":{p.preventDefault();let c=S,h=0;for(;h<10&&c>0;){let _=fe(c,-1);if(!_)break;c=_.index,h++}h>0&&V(O[c],!1,!0);break}case"Tab":if(!p.shiftKey&&!isNaN(I)){let c=document.querySelector(`.issue-bar[data-issue-id="${I}"]`);c&&(p.preventDefault(),c.focus(),he(`Timeline bar for issue #${I}`))}break}})})}function vt(k){let{vscode:v,addDocListener:Q,menuUndo:K,menuRedo:he,undoStack:J,redoStack:se,saveState:O,updateUndoRedoButtons:pe,announce:He,scrollToAndHighlight:Ce,scrollToToday:fe}=k;Q("keydown",g=>{let ne=navigator.platform.toUpperCase().indexOf("MAC")>=0?g.metaKey:g.ctrlKey;if(!(g.target.tagName==="INPUT"||g.target.tagName==="SELECT"||g.target.tagName==="TEXTAREA"))if(ne&&g.key==="z"&&!g.shiftKey)g.preventDefault(),K?.click();else if(ne&&g.key==="z"&&g.shiftKey)g.preventDefault(),he?.click();else if(ne&&g.key==="y")g.preventDefault(),he?.click();else if(g.key>="1"&&g.key<="5"){let F=document.getElementById("zoomSelect"),de=["day","week","month","quarter","year"];F.value=de[parseInt(g.key)-1],F.dispatchEvent(new Event("change"))}else if(g.key.toLowerCase()==="y")document.getElementById("menuCapacity")?.click();else if(g.key.toLowerCase()==="i")document.getElementById("menuIntensity")?.click();else if(g.key.toLowerCase()==="d")document.getElementById("menuDeps")?.click();else if(g.key.toLowerCase()==="v"){let F=document.getElementById("viewFocusSelect");F.value=F.value==="project"?"person":"project",F.dispatchEvent(new Event("change"))}else if(g.key.toLowerCase()==="r")document.getElementById("refreshBtn")?.click();else if(g.key.toLowerCase()==="t")fe();else if(g.key.toLowerCase()==="e")document.getElementById("menuExpand")?.click();else if(g.key.toLowerCase()==="c"&&!ne)document.getElementById("menuCollapse")?.click();else if(g.key.toLowerCase()==="b")document.getElementById("menuBadges")?.click();else if(g.key==="ArrowLeft"||g.key==="ArrowRight"){let F=document.activeElement?.closest(".issue-bar:not(.parent-bar)");if(!F)return;g.preventDefault();let de=parseInt(F.dataset.issueId),ve=F.dataset.startDate,we=F.dataset.dueDate;if(!ve&&!we)return;let f=g.key==="ArrowRight"?1:-1,S=(I,c)=>{let h=new Date(I+"T00:00:00");return h.setDate(h.getDate()+c),h.toISOString().slice(0,10)},p=null,H=null;g.shiftKey&&we?H=S(we,f):g.altKey&&ve?p=S(ve,f):(ve&&(p=S(ve,f)),we&&(H=S(we,f))),(p||H)&&(O(),J.push({issueId:de,oldStartDate:p?ve:null,oldDueDate:H?we:null,newStartDate:p,newDueDate:H}),se.length=0,pe(),v.postMessage({command:"updateDates",issueId:de,startDate:p,dueDate:H}))}else g.key==="/"&&!ne?(g.preventDefault(),V()):(g.key==="?"||g.shiftKey&&g.key==="/")&&(g.preventDefault(),Z())});let Y=null;function V(){Y&&Y.remove(),Y=document.createElement("div"),Y.className="quick-search",Y.innerHTML=`
      <input type="text" placeholder="Search issues..." autofocus />
    `,document.body.appendChild(Y);let g=Y.querySelector("input");g.focus();let me=Array.from(document.querySelectorAll(".issue-label"));g.addEventListener("input",()=>{let ne=g.value.toLowerCase();me.forEach(F=>{let de=F.getAttribute("aria-label")?.toLowerCase()||"",ve=ne&&de.includes(ne);F.classList.toggle("search-match",ve)})}),g.addEventListener("keydown",ne=>{if(ne.key==="Escape")R();else if(ne.key==="Enter"){let F=document.querySelector(".issue-label.search-match");F&&(R(),F.focus(),Ce(F.dataset.issueId))}}),g.addEventListener("blur",()=>setTimeout(R,150))}function R(){Y&&(Y.remove(),Y=null,document.querySelectorAll(".search-match").forEach(g=>g.classList.remove("search-match")))}let L=null;function Z(){if(L){L.remove(),L=null;return}L=document.createElement("div"),L.className="keyboard-help",L.innerHTML=`
      <div class="keyboard-help-content">
        <h3>Keyboard Shortcuts</h3>
        <div class="shortcut-grid">
          <div class="shortcut-section">
            <h4>Navigation</h4>
            <div><kbd>\u2191</kbd><kbd>\u2193</kbd> Move between issues</div>
            <div><kbd>Home</kbd><kbd>End</kbd> First/last issue</div>
            <div><kbd>PgUp</kbd><kbd>PgDn</kbd> Jump 10 rows</div>
            <div><kbd>Tab</kbd> Label \u2192 Bar</div>
            <div><kbd>Shift+Tab</kbd> Bar \u2192 Label</div>
          </div>
          <div class="shortcut-section">
            <h4>Date Editing</h4>
            <div><kbd>\u2190</kbd><kbd>\u2192</kbd> Move bar \xB11 day</div>
            <div><kbd>Shift+\u2190/\u2192</kbd> Resize end</div>
            <div><kbd>Alt+\u2190/\u2192</kbd> Resize start</div>
            <div><kbd>Ctrl+Z</kbd> Undo</div>
            <div><kbd>Ctrl+Y</kbd> Redo</div>
          </div>
          <div class="shortcut-section">
            <h4>View</h4>
            <div><kbd>1-5</kbd> Zoom levels</div>
            <div><kbd>D</kbd> Dependencies</div>
            <div><kbd>C</kbd> Critical path</div>
            <div><kbd>T</kbd> Today</div>
          </div>
          <div class="shortcut-section">
            <h4>Other</h4>
            <div><kbd>B</kbd> Badges</div>
            <div><kbd>/</kbd> Quick search</div>
            <div><kbd>S</kbd> Cycle sort</div>
            <div><kbd>R</kbd> Refresh</div>
            <div><kbd>Esc</kbd> Clear/cancel</div>
          </div>
        </div>
        <p class="keyboard-help-close">Press <kbd>?</kbd> or <kbd>Esc</kbd> to close</p>
      </div>
    `,document.body.appendChild(L),L.addEventListener("click",g=>{g.target===L&&Z()})}Q("keydown",g=>{g.key==="Escape"&&L&&(g.stopImmediatePropagation(),Z())})}var ce=acquireVsCodeApi(),tt=!1;function Ze(k){tt&&typeof performance<"u"&&performance.mark(k)}function ct(k,v,Q){if(tt&&typeof performance<"u")try{performance.measure(k,v,Q);let K=performance.getEntriesByName(k,"measure");K.length>0&&console.log(`[Gantt Perf] ${k}: ${K[K.length-1].duration.toFixed(2)}ms`),performance.clearMarks(v),performance.clearMarks(Q),performance.clearMeasures(k)}catch{}}function kt(){if(tt){let k=document.getElementById("ganttRoot"),v=k?k.querySelectorAll("*").length:0,Q=k?k.querySelectorAll("svg *").length:0;console.log(`[Gantt Perf] DOM nodes: ${v}, SVG elements: ${Q}`)}}function Et(k){if(!k)return;let v=document.documentElement;v.style.setProperty("--gantt-header-height",`${k.headerHeight}px`),v.style.setProperty("--gantt-label-width",`${k.labelWidth}px`),v.style.setProperty("--gantt-id-column-width",`${k.idColumnWidth}px`),v.style.setProperty("--gantt-start-date-column-width",`${k.startDateColumnWidth}px`),v.style.setProperty("--gantt-status-column-width",`${k.statusColumnWidth}px`),v.style.setProperty("--gantt-due-date-column-width",`${k.dueDateColumnWidth}px`),v.style.setProperty("--gantt-assignee-column-width",`${k.assigneeColumnWidth}px`),v.style.setProperty("--gantt-sticky-left-width",`${k.stickyLeftWidth}px`)}function Lt({addDocListener:k,addWinListener:v}){let Q=document.getElementById("ganttRoot"),K=document.getElementById("ganttTooltip"),he=K?.querySelector(".gantt-tooltip-content");if(!Q||!K||!he)return;let J=c=>c?String(c).replace(/\r\n/g,`
`).trimEnd():"";function se(){Q.querySelectorAll("svg title").forEach(c=>{let h=c.parentElement,_=J(c.textContent);h&&_&&(h.dataset.tooltip=_),c.remove()})}function O(){Q.querySelectorAll("[title]").forEach(c=>{if(c.tagName.toLowerCase()==="title")return;let h=J(c.getAttribute("title"));c.removeAttribute("title"),h&&(c.dataset.tooltip=h)})}function pe(){Q.querySelectorAll("[data-toolbar-tooltip]").forEach(c=>{let h=J(c.dataset.toolbarTooltip);delete c.dataset.toolbarTooltip,h&&(c.dataset.tooltip=h)})}function He(){se(),O(),pe()}function Ce(c){let h=c.findIndex(N=>N.trim().startsWith("#"));return h>=0?h:c.filter(N=>N.trim()).length>1?c.findIndex(N=>N.trim()):-1}function fe(c){he.textContent="";let h=J(c);if(!h)return;let _=h.split(`
`),N=Ce(_),ae=!1;_.forEach((T,Xe)=>{let Ee=T.trim();if(!Ee){if(!ae){let q=document.createElement("div");q.className="gantt-tooltip-spacer",he.appendChild(q),ae=!0}return}if(Ee==="---"){let q=document.createElement("div");q.className="gantt-tooltip-divider",he.appendChild(q),ae=!1;return}let We=Ee.match(/^cf:([^:]+):(.*)$/);if(We){let q=We[1].trim(),o=We[2].trim(),Pe=document.createElement("div");Pe.className="gantt-tooltip-line";let Oe=document.createElement("span");Oe.className="gantt-tooltip-key",Oe.textContent=`${q}: `,Pe.appendChild(Oe),o&&Pe.appendChild(document.createTextNode(o)),he.appendChild(Pe),ae=!1;return}let qe=document.createElement("div");qe.className="gantt-tooltip-line",Xe===N&&qe.classList.add("gantt-tooltip-title");let Re=Ee.match(/^Open in Browser:\s*(\S+)/);if(Re&&/^https?:\/\//i.test(Re[1])){qe.appendChild(document.createTextNode("Open in Browser: "));let q=document.createElement("a");q.href=Re[1],q.textContent=Re[1],q.target="_blank",q.rel="noopener noreferrer",qe.appendChild(q)}else qe.textContent=T;he.appendChild(qe),ae=!1});let oe=he.lastElementChild;oe&&oe.classList.contains("gantt-tooltip-spacer")&&oe.remove()}let Y=null,V=null,R=null,L={x:0,y:0};function Z(c){L={x:c.clientX,y:c.clientY}}function g(){V&&(clearTimeout(V),V=null)}function me(){R&&(clearTimeout(R),R=null)}function ne(c){return c&&(c===K||K.contains(c))}function F(c){return c&&Y&&(c===Y||Y.contains(c))}function de(){if(!L)return!1;let c=document.elementFromPoint(L.x,L.y);return ne(c)||F(c)}let ve=300;function we(c){me(),R=setTimeout(()=>{R=null,!(!Y||Y!==c)&&de()&&p(c,L.x,L.y)},ve)}function f(){g(),V=setTimeout(()=>{Y&&(de()||H())},300)}function S(c,h){let ae=K.getBoundingClientRect(),oe=c+8,T=h+8;oe+ae.width>window.innerWidth-8&&(oe=c-ae.width-8),T+ae.height>window.innerHeight-8&&(T=h-ae.height-8),oe=Math.max(8,Math.min(oe,window.innerWidth-ae.width-8)),T=Math.max(8,Math.min(T,window.innerHeight-ae.height-8)),K.style.left=`${Math.round(oe)}px`,K.style.top=`${Math.round(T)}px`}function p(c,h,_){let N=c.dataset.tooltip;N&&(fe(N),K.classList.add("visible"),K.setAttribute("aria-hidden","false"),S(h,_))}function H(c=!1){me(),g(),K.classList.remove("visible"),K.setAttribute("aria-hidden","true"),c||(Y=null)}function I(c){if(!c||c===K||K.contains(c))return null;let h=c.closest?.("[data-tooltip], [title]");if(!h||!Q.contains(h))return null;if(h.hasAttribute("title")){let _=J(h.getAttribute("title"));h.removeAttribute("title"),_&&(h.dataset.tooltip=_)}return h.dataset.tooltip?h:null}He(),k("pointerover",c=>{if(Z(c),ne(c.target)){g(),me();return}let h=I(c.target);if(!h){me();return}g(),Y!==h?(Y=h,K.classList.contains("visible")&&H(!0),we(h)):K.classList.contains("visible")||we(h)},!0),k("pointermove",c=>{Y&&(Z(c),V&&de()&&g())},!0),k("pointerout",c=>{if(!Y||(Z(c),me(),!F(c.target)&&!ne(c.target)))return;let h=c.relatedTarget;ne(h)||F(h)||f()},!0),k("scroll",()=>{Y&&H()},!0),k("keydown",()=>{Y&&H()},!0),v("blur",()=>{Y&&H()})}function St(k){if(!k)return;k.state&&(tt=k.state.perfDebug??!1),Ze("render-start");let v=document.getElementById("ganttRoot");v&&(Et(k.state),Ze("innerHTML-start"),v.innerHTML=k.html||"",Ze("innerHTML-end"),ct("innerHTML","innerHTML-start","innerHTML-end"),Dt(k.state),Ze("render-end"),ct("render","render-start","render-end"),kt())}window.addEventListener("message",k=>{let v=k.data;if(v){if(v.command==="render"){St(v.payload);return}window.__ganttHandleExtensionMessage&&window.__ganttHandleExtensionMessage(v)}});var wt=window.__GANTT_INITIAL_PAYLOAD__;wt&&St(wt);ce.postMessage({command:"webviewReady"});function Dt(k){if(Ze("initializeGantt-start"),!k)return;let{timelineWidth:v,minDateMs:Q,maxDateMs:K,totalDays:he,extendedRelationTypes:J,redmineBaseUrl:se,minimapBarsData:O,minimapHeight:pe,minimapBarHeight:He,minimapTodayX:Ce,extScrollLeft:fe,extScrollTop:Y,labelWidth:V,leftExtrasWidth:R,sortBy:L,sortOrder:Z,selectedCollapseKey:g,barHeight:me,todayX:ne,todayInRange:F,isDraftMode:de,draftQueueCount:ve}=k,we=v/he,f=de,S=document.getElementById("dragConfirmOk");S&&(S.textContent=de?"Queue to Draft":"Save to Redmine");let p=document.getElementById("draftBadge");if(p){if(de){p.classList.remove("hidden");let e=ve??0;p.textContent=e,p.dataset.tooltip=e===1?"1 change queued - click to review":e+" changes queued - click to review"}else p.classList.add("hidden");p.addEventListener("click",()=>{ce.postMessage({command:"openDraftReview"})})}let H=document.getElementById("draftModeToggle");H&&H.addEventListener("click",()=>{ce.postMessage({command:"toggleDraftMode"})}),window._ganttCleanup&&window._ganttCleanup();let I=[],c=[];function h(e,s,i){document.addEventListener(e,s,i),I.push({type:e,handler:s,options:i})}function _(e,s,i){window.addEventListener(e,s,i),c.push({type:e,handler:s,options:i})}window._ganttCleanup=()=>{I.forEach(e=>document.removeEventListener(e.type,e.handler,e.options)),c.forEach(e=>window.removeEventListener(e.type,e.handler,e.options)),window.__ganttHandleExtensionMessage=null};function N(e){setTimeout(()=>{document.addEventListener("click",function s(i){e.contains(i.target)||(e.remove(),document.removeEventListener("click",s))})},0)}function ae(e){return Math.round(e/we)*we}function oe(e){let s=document.getElementById("liveRegion");s&&(s.textContent=e)}let T=document.getElementById("ganttScroll"),Xe=document.getElementById("ganttLeftHeader"),Ee=document.getElementById("ganttLabels"),We=document.getElementById("ganttTimeline"),qe=document.getElementById("menuUndo"),Re=document.getElementById("menuRedo"),q=document.getElementById("minimapSvg"),o=document.getElementById("minimapViewport"),{updateMinimapPosition:Pe,updateMinimapViewport:Oe}=pt({timelineWidth:v,minimapBarsData:O,minimapHeight:pe,minimapBarHeight:He,minimapTodayX:Ce,ganttScroll:T,minimapSvg:q,minimapViewport:o,addDocListener:h}),Be=ce.getState()||{undoStack:[],redoStack:[],labelWidth:V,scrollLeft:null,scrollTop:null,centerDateMs:null},Ye=Be.undoStack||[],Te=Be.redoStack||[],ze=Be.scrollLeft??(fe>0?fe:null),xe=Be.scrollTop??(Y>0?Y:null),Ve=Be.centerDateMs;function Ae(){if(!T)return null;let s=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,i=T.clientWidth-s,y=(T.scrollLeft+i/2)/v;return Q+y*(K-Q)}function _e(e){if(!T)return;let i=(e-Q)/(K-Q)*v,y=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,le=T.clientWidth-y;T.scrollLeft=Math.max(0,i-le/2)}function be(){ce.setState({undoStack:Ye,redoStack:Te,labelWidth:Ee?.offsetWidth||V,scrollLeft:null,scrollTop:T?.scrollTop??null,centerDateMs:Ae()})}let E=be;function d(){qe&&qe.toggleAttribute("disabled",Ye.length===0),Re&&Re.toggleAttribute("disabled",Te.length===0),be()}if(Be.labelWidth&&Xe&&Ee){Xe.style.width=Be.labelWidth+"px",Ee.style.width=Be.labelWidth+"px";let e=document.querySelector(".capacity-ribbon-label");e&&(e.style.width=Be.labelWidth+R+"px")}let P=!0,ee=!1,j=e=>{ee=e},ue=null;T&&T.addEventListener("scroll",()=>{cancelAnimationFrame(ue),ue=requestAnimationFrame(()=>{Oe(),P||be()})},{passive:!0}),requestAnimationFrame(()=>d()),window.__ganttHandleExtensionMessage=e=>{if(e.command==="setDependenciesState"){let s=document.querySelector(".dependency-layer"),i=document.getElementById("menuDeps");e.enabled?(s&&s.classList.remove("hidden"),i&&i.classList.add("active")):(s&&s.classList.add("hidden"),i&&i.classList.remove("active"))}else if(e.command==="setBadgesState"){let s=document.querySelector(".gantt-container"),i=document.getElementById("menuBadges");e.enabled?(s&&s.classList.remove("hide-badges"),i&&i.classList.add("active")):(s&&s.classList.add("hide-badges"),i&&i.classList.remove("active"))}else if(e.command==="setCapacityRibbonState"){let s=document.querySelector(".capacity-ribbon"),i=document.getElementById("menuCapacity");e.enabled?(s&&s.classList.remove("hidden"),i&&i.classList.add("active")):(s&&s.classList.add("hidden"),i&&i.classList.remove("active"))}else if(e.command==="setIntensityState"){let s=document.querySelector(".gantt-container"),i=document.getElementById("menuIntensity");e.enabled?(s?.classList.add("intensity-enabled"),i&&i.classList.add("active")):(s?.classList.remove("intensity-enabled"),i&&i.classList.remove("active"))}else if(e.command==="setDraftModeState"){f=e.enabled;let s=document.getElementById("dragConfirmOk");s&&(s.textContent=e.enabled?"Queue to Draft":"Save to Redmine");let i=document.getElementById("draftModeToggle");i&&(i.classList.toggle("active",e.enabled),i.textContent=e.enabled?"Disable Draft Mode":"Enable Draft Mode");let m=document.getElementById("draftBadge");if(m)if(e.enabled){m.classList.remove("hidden");let y=e.queueCount??0;m.textContent=y,m.dataset.tooltip=y===1?"1 change queued - click to review":y+" changes queued - click to review"}else m.classList.add("hidden")}else if(e.command==="setDraftQueueCount"){let s=document.getElementById("draftBadge");if(s){let i=e.count;s.textContent=i,s.dataset.tooltip=i===1?"1 change queued - click to review":i+" changes queued - click to review"}}else if(e.command==="pushUndoAction")Ye.push(e.action),Te.length=0,d(),be();else if(e.command==="updateRelationId"){let s=e.stack==="undo"?Ye:Te;if(s.length>0){let i=s[s.length-1];i.type==="relation"&&(i.relationId=e.newRelationId,be())}}else if(e.command==="scrollToIssue"){let s=e.issueId,i=document.querySelector('.issue-label[data-issue-id="'+s+'"]'),m=document.querySelector('.issue-bar[data-issue-id="'+s+'"]'),y=document.getElementById("ganttScroll"),te=document.querySelector(".gantt-header-row")?.getBoundingClientRect().height||60;if(!y)return;let De=y.scrollTop,ke=y.scrollLeft;if(i){let $e=i.closest(".gantt-row");if($e){let ot=$e.offsetTop,je=$e.getBoundingClientRect().height,Ge=y.clientHeight-te;De=Math.max(0,ot-te-(Ge-je)/2)}i.focus(),i.classList.add("highlighted"),setTimeout(()=>i.classList.remove("highlighted"),2e3)}if(m){let $e=parseFloat(m.getAttribute("data-start-x")||"0"),je=parseFloat(m.getAttribute("data-end-x")||"0")-$e,Ge=y.clientWidth,et=document.querySelector(".gantt-sticky-left")?.getBoundingClientRect().width||0,ht=Ge-et;je<=ht-100?ke=$e-(ht-je)/2:ke=$e-50,ke=Math.max(0,ke),m.classList.add("highlighted"),setTimeout(()=>m.classList.remove("highlighted"),2e3)}y.scrollTo({left:ke,top:De,behavior:"smooth"})}},document.getElementById("lookbackSelect")?.addEventListener("change",e=>{ce.postMessage({command:"setLookback",years:e.target.value})}),document.getElementById("zoomSelect")?.addEventListener("change",e=>{E(),ce.postMessage({command:"setZoom",zoomLevel:e.target.value})}),document.getElementById("viewFocusSelect")?.addEventListener("change",e=>{ce.postMessage({command:"setViewFocus",focus:e.target.value})}),document.getElementById("projectSelector")?.addEventListener("change",e=>{let s=e.target.value,i=s?parseInt(s,10):null;ce.postMessage({command:"setSelectedProject",projectId:i})}),document.getElementById("focusSelector")?.addEventListener("change",e=>{let s=e.target.value;ce.postMessage({command:"setSelectedAssignee",assignee:s||null})}),document.getElementById("filterAssignee")?.addEventListener("change",e=>{let s=e.target.value;ce.postMessage({command:"setFilter",filter:{assignee:s}})}),document.getElementById("filterStatus")?.addEventListener("change",e=>{let s=e.target.value;ce.postMessage({command:"setFilter",filter:{status:s}})}),document.querySelectorAll(".gantt-col-header.sortable").forEach(e=>{e.addEventListener("click",()=>{let s=e.dataset.sort;s===L?Z==="asc"?ce.postMessage({command:"setSort",sortOrder:"desc"}):ce.postMessage({command:"setSort",sortBy:null}):ce.postMessage({command:"setSort",sortBy:s,sortOrder:"asc"})})}),document.getElementById("menuCapacity")?.addEventListener("click",()=>{document.getElementById("menuCapacity")?.hasAttribute("disabled")||(be(),ce.postMessage({command:"toggleCapacityRibbon"}))}),document.getElementById("menuIntensity")?.addEventListener("click",()=>{document.getElementById("menuIntensity")?.hasAttribute("disabled")||(be(),ce.postMessage({command:"toggleIntensity"}))}),document.getElementById("overloadBadge")?.addEventListener("click",e=>{e.stopPropagation();let s=e.currentTarget,i=parseInt(s.dataset.firstOverloadMs||"0",10);i>0&&(_e(i),be())}),document.querySelectorAll(".capacity-day-bar-group").forEach(e=>{e.addEventListener("click",s=>{let i=parseInt(s.currentTarget.dataset.dateMs||"0",10);i>0&&(_e(i),be())})}),document.getElementById("menuDeps")?.addEventListener("click",()=>{be(),ce.postMessage({command:"toggleDependencies"})}),document.getElementById("menuBadges")?.addEventListener("click",()=>{be(),ce.postMessage({command:"toggleBadges"})});let Fe=document.querySelector(".gantt-container");function Ue(){let e=new Map,s=new Map;return document.querySelectorAll(".dependency-arrow").forEach(i=>{if(!(i.classList.contains("rel-blocks")||i.classList.contains("rel-precedes")))return;let y=i.dataset.from,le=i.dataset.to;e.has(y)||e.set(y,[]),e.get(y).push(le),s.has(le)||s.set(le,[]),s.get(le).push(y)}),{graph:e,reverseGraph:s}}let Qe=null;function Le(e,s,i){let m=new Set([e]),y=[e];for(;y.length>0;){let te=y.shift(),De=s.get(te)||[];for(let ke of De)m.has(ke)||(m.add(ke),y.push(ke))}let le=[e];for(;le.length>0;){let te=le.shift(),De=i.get(te)||[];for(let ke of De)m.has(ke)||(m.add(ke),le.push(ke))}return m}function st(e){if(Je(),!e)return;Qe=e;let{graph:s,reverseGraph:i}=Ue(),m=Le(e,s,i);Fe.classList.add("focus-mode"),document.querySelectorAll(".issue-bar").forEach(y=>{m.has(y.dataset.issueId)&&y.classList.add("focus-highlighted")}),document.querySelectorAll(".issue-label").forEach(y=>{m.has(y.dataset.issueId)&&y.classList.add("focus-highlighted")}),document.querySelectorAll(".dependency-arrow").forEach(y=>{m.has(y.dataset.from)&&m.has(y.dataset.to)&&y.classList.add("focus-highlighted")}),oe(`Focus: ${m.size} issue${m.size!==1?"s":""} in dependency chain`)}function Je(){Qe=null,Fe.classList.remove("focus-mode"),document.querySelectorAll(".focus-highlighted").forEach(e=>e.classList.remove("focus-highlighted"))}let nt=()=>Qe,ye=new Set,n=null,r=document.getElementById("selectionCount"),t=Array.from(document.querySelectorAll(".issue-bar")),a=new Map;t.forEach(e=>{let s=e.dataset.issueId;s&&(a.has(s)||a.set(s,[]),a.get(s).push(e))});function l(e){e.forEach(s=>{let i=a.get(s);i&&i.forEach(m=>m.classList.toggle("selected",ye.has(s)))}),ye.size>0?(r.textContent=`${ye.size} selected`,r.classList.remove("hidden"),Fe.classList.add("multi-select-mode")):(r.classList.add("hidden"),Fe.classList.remove("multi-select-mode"))}function D(){t.forEach(e=>{e.classList.toggle("selected",ye.has(e.dataset.issueId))}),ye.size>0?(r.textContent=`${ye.size} selected`,r.classList.remove("hidden"),Fe.classList.add("multi-select-mode")):(r.classList.add("hidden"),Fe.classList.remove("multi-select-mode"))}function w(){let e=[...ye];ye.clear(),n=null,l(e)}function b(e){ye.has(e)?ye.delete(e):ye.add(e),n=e,l([e])}function x(e,s){let i=t.findIndex(De=>De.dataset.issueId===e),m=t.findIndex(De=>De.dataset.issueId===s);if(i===-1||m===-1)return;let y=Math.min(i,m),le=Math.max(i,m),te=[];for(let De=y;De<=le;De++){let ke=t[De].dataset.issueId;ye.has(ke)||(ye.add(ke),te.push(ke))}l(te)}function M(){t.forEach(e=>ye.add(e.dataset.issueId)),D(),oe(`Selected all ${ye.size} issues`)}t.forEach(e=>{e.addEventListener("mousedown",s=>{if(!s.ctrlKey&&!s.metaKey&&!s.shiftKey||s.target.classList.contains("drag-handle")||s.target.classList.contains("link-handle"))return;s.preventDefault(),s.stopPropagation();let i=e.dataset.issueId;s.shiftKey&&n?x(n,i):b(i)})}),h("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="a"&&(e.preventDefault(),M()),e.key==="Escape"&&ye.size>0&&(e.stopImmediatePropagation(),w(),oe("Selection cleared"))}),document.getElementById("refreshBtn")?.addEventListener("click",()=>{document.getElementById("loadingOverlay")?.classList.add("visible"),ce.postMessage({command:"refresh"})}),document.getElementById("draftBadge")?.addEventListener("click",()=>{ce.postMessage({command:"openDraftReview"})});function X(e,s,i,m,y,le){document.querySelector(".relation-picker")?.remove();let te=document.createElement("div");te.className="relation-picker";let De=150,ke=120,$e=Math.min(e,window.innerWidth-De-10),ot=Math.min(s,window.innerHeight-ke-10);te.style.left=Math.max(10,$e)+"px",te.style.top=Math.max(10,ot)+"px";let je=document.createElement("div");if(je.style.padding="6px 12px",je.style.fontSize="11px",je.style.opacity="0.7",je.textContent=`#${m} \u2192 #${y}`,te.appendChild(je),le==="precedes"||le==="follows"){let et=document.createElement("button");et.textContent="Update delay...",et.addEventListener("click",()=>{te.remove(),ce.postMessage({command:"updateRelationDelay",relationId:i,fromId:m,toId:y})}),te.appendChild(et)}let Ge=document.createElement("button");Ge.textContent="Delete relation",Ge.addEventListener("click",()=>{be(),ce.postMessage({command:"deleteRelation",relationId:i}),te.remove()}),te.appendChild(Ge),document.body.appendChild(te),N(te)}let u=new Map,C=new Map,B=new Map,re=new Map,z=new Map,U=!1;function $(){document.querySelectorAll(".issue-bar").forEach(e=>{let s=e.dataset.issueId;s&&(u.has(s)||u.set(s,[]),u.get(s).push(e))}),document.querySelectorAll(".issue-label").forEach(e=>{let s=e.dataset.issueId;s&&(C.has(s)||C.set(s,[]),C.get(s).push(e))}),document.querySelectorAll(".dependency-arrow").forEach(e=>{let s=e.dataset.from,i=e.dataset.to;s&&(B.has(s)||B.set(s,[]),B.get(s).push(e)),i&&(B.has(i)||B.set(i,[]),B.get(i).push(e))}),document.querySelectorAll(".project-label").forEach(e=>{let s=e.dataset.collapseKey;s&&(re.has(s)||re.set(s,[]),re.get(s).push(e))}),document.querySelectorAll(".aggregate-bars").forEach(e=>{let s=e.dataset.collapseKey;s&&(z.has(s)||z.set(s,[]),z.get(s).push(e))}),U=!0}typeof requestIdleCallback<"u"?requestIdleCallback(()=>$(),{timeout:100}):setTimeout($,0);let G=[];function Se(){document.body.classList.remove("hover-focus","dependency-hover"),G.forEach(e=>e.classList.remove("hover-highlighted","hover-source")),G=[]}function ge(e){document.body.classList.add("hover-focus");let s=U?u.get(e)||[]:document.querySelectorAll('.issue-bar[data-issue-id="'+e+'"]'),i=U?C.get(e)||[]:document.querySelectorAll('.issue-label[data-issue-id="'+e+'"]'),m=U?B.get(e)||[]:document.querySelectorAll('.dependency-arrow[data-from="'+e+'"], .dependency-arrow[data-to="'+e+'"]');s.forEach(y=>{y.classList.add("hover-highlighted"),G.push(y)}),i.forEach(y=>{y.classList.add("hover-highlighted"),G.push(y)}),m.forEach(y=>{y.classList.add("hover-highlighted"),G.push(y)})}function W(e){document.body.classList.add("hover-focus");let s=U?re.get(e)||[]:document.querySelectorAll('.project-label[data-collapse-key="'+e+'"]'),i=U?z.get(e)||[]:document.querySelectorAll('.aggregate-bars[data-collapse-key="'+e+'"]');s.forEach(m=>{m.classList.add("hover-highlighted"),G.push(m)}),i.forEach(m=>{m.classList.add("hover-highlighted"),G.push(m)})}let A=document.querySelector(".gantt-timeline svg"),ie=document.querySelector(".gantt-labels svg");if(A&&(A.addEventListener("mouseenter",e=>{let s=e.target.closest(".issue-bar"),i=e.target.closest(".aggregate-bars"),m=e.target.closest(".dependency-arrow");if(s){let y=s.dataset.issueId;y&&ge(y)}else if(i){let y=i.dataset.collapseKey;y&&W(y)}else if(m){let y=m.dataset.from,le=m.dataset.to;document.body.classList.add("dependency-hover"),m.classList.add("hover-source"),G.push(m),y&&ge(y),le&&ge(le)}},!0),A.addEventListener("mouseleave",e=>{let s=e.target.closest(".issue-bar"),i=e.target.closest(".aggregate-bars"),m=e.target.closest(".dependency-arrow");(s||i||m)&&Se()},!0)),ie&&(ie.addEventListener("mouseenter",e=>{let s=e.target.closest(".issue-label"),i=e.target.closest(".project-label");if(s){let m=s.dataset.issueId;m&&ge(m)}else if(i){let m=i.dataset.collapseKey;m&&W(m)}},!0),ie.addEventListener("mouseleave",e=>{let s=e.target.closest(".issue-label"),i=e.target.closest(".project-label");(s||i)&&Se()},!0)),A){let s=function(){document.querySelectorAll(".dependency-arrow.selected").forEach(i=>i.classList.remove("selected")),document.body.classList.remove("arrow-selection-mode"),document.querySelectorAll(".arrow-connected").forEach(i=>i.classList.remove("arrow-connected")),e=null};var At=s;A.addEventListener("mousedown",i=>{if(i.button!==2)return;let m=i.target.closest(".dependency-arrow");if(!m)return;let y=m.querySelector("title");y&&y.remove()}),A.addEventListener("contextmenu",i=>{let m=i.target.closest(".dependency-arrow");if(!m)return;i.preventDefault();let y=parseInt(m.dataset.relationId),le=m.dataset.from,te=m.dataset.to,De=[...m.classList].find($e=>$e.startsWith("rel-")),ke=De?De.replace("rel-",""):null;X(i.clientX,i.clientY,y,le,te,ke)});let e=null;A.addEventListener("click",i=>{let m=i.target.closest(".dependency-arrow");if(e&&(e.classList.remove("selected"),document.body.classList.remove("arrow-selection-mode"),document.querySelectorAll(".arrow-connected").forEach(te=>te.classList.remove("arrow-connected")),e=null),!m)return;i.stopPropagation(),e=m,m.classList.add("selected"),document.body.classList.add("arrow-selection-mode");let y=m.dataset.from,le=m.dataset.to;document.querySelectorAll(`.issue-bar[data-issue-id="${y}"], .issue-bar[data-issue-id="${le}"]`).forEach(te=>te.classList.add("arrow-connected")),document.querySelectorAll(`.issue-label[data-issue-id="${y}"], .issue-label[data-issue-id="${le}"]`).forEach(te=>te.classList.add("arrow-connected")),oe(`Selected relation from #${y} to #${le}`)}),window._ganttArrowClickHandler&&document.removeEventListener("click",window._ganttArrowClickHandler),window._ganttArrowClickHandler=i=>{(e||document.querySelector(".dependency-arrow.selected"))&&!i.target.closest(".dependency-arrow")&&!i.target.closest(".blocks-badge-group")&&!i.target.closest(".blocker-badge")&&s()},document.addEventListener("click",window._ganttArrowClickHandler),window._ganttArrowKeyHandler&&document.removeEventListener("keydown",window._ganttArrowKeyHandler),window._ganttArrowKeyHandler=i=>{let m=e||document.querySelector(".dependency-arrow.selected");i.key==="Escape"&&m&&(i.stopImmediatePropagation(),s())},document.addEventListener("keydown",window._ganttArrowKeyHandler)}yt({vscode:ce,menuUndo:qe,menuRedo:Re,addDocListener:h,closeOnOutsideClick:N,announce:oe,saveState:be,updateUndoRedoButtons:d,undoStack:Ye,redoStack:Te,selectedIssues:ye,clearSelection:w,allIssueBars:t,redmineBaseUrl:se,extendedRelationTypes:J,minDateMs:Q,maxDateMs:K,timelineWidth:v,dayWidth:we,barHeight:me,ganttScroll:T,snapToDay:ae,focusOnDependencyChain:st,clearFocus:Je,getFocusedIssueId:nt,scrollToAndHighlight:Ne,setAllowScrollChange:j,isDraftModeEnabled:()=>f,isPerfDebugEnabled:()=>tt}),bt({vscode:ce,addDocListener:h,addWinListener:_,announce:oe,barHeight:me,selectedCollapseKey:g});function Ke(){if(!F){ce.postMessage({command:"todayOutOfRange"});return}if(T){let s=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,i=T.clientWidth-s;T.scrollLeft=Math.max(0,ne-i/2)}}function Ne(e){if(!e)return;ee=!0;let s=document.querySelector('.issue-label[data-issue-id="'+e+'"]'),i=document.querySelector('.issue-bar[data-issue-id="'+e+'"]');if(s&&(s.scrollIntoView({behavior:"smooth",block:"center"}),s.classList.add("highlighted"),setTimeout(()=>s.classList.remove("highlighted"),1500)),i&&T){let m=i.getBoundingClientRect(),y=T.getBoundingClientRect(),le=T.scrollLeft+m.left-y.left-100;T.scrollTo({left:Math.max(0,le),behavior:"smooth"}),i.classList.add("highlighted"),setTimeout(()=>i.classList.remove("highlighted"),1500)}}vt({vscode:ce,addDocListener:h,menuUndo:qe,menuRedo:Re,undoStack:Ye,redoStack:Te,saveState:be,updateUndoRedoButtons:d,announce:oe,scrollToAndHighlight:Ne,scrollToToday:Ke}),Lt({addDocListener:h,addWinListener:_,ganttScroll:T}),requestAnimationFrame(()=>{if(Ve!==null&&T){let e=Math.max(Q,Math.min(K,Ve));_e(e),xe!==null&&(T.scrollTop=xe),Ve=null,xe=null}else ze!==null&&T?(T.scrollLeft=ze,xe!==null&&(T.scrollTop=xe),ze=null,xe=null):Ke();Oe(),P=!1}),document.getElementById("todayBtn")?.addEventListener("click",Ke);let dt=document.getElementById("resizeHandle"),ut=document.getElementById("resizeHandleHeader"),at=!1,ft=0,mt=0,rt=null;function gt(e,s){at=!0,rt=s,ft=e.clientX,mt=Ee.offsetWidth,s.classList.add("dragging"),document.body.classList.add("cursor-col-resize","user-select-none"),e.preventDefault()}dt?.addEventListener("mousedown",e=>gt(e,dt)),ut?.addEventListener("mousedown",e=>gt(e,ut));let it=!1,lt=null;h("mousemove",e=>{at&&(lt=e,!it&&(it=!0,requestAnimationFrame(()=>{if(it=!1,!lt)return;let s=lt.clientX-ft,i=Math.min(600,Math.max(120,mt+s));if(Xe&&(Xe.style.width=i+"px"),Ee){Ee.style.width=i+"px";let y=Ee.querySelector("svg");y&&y.setAttribute("width",String(i))}let m=document.querySelector(".capacity-ribbon-label");m&&(m.style.width=i+R+"px"),Pe()})))}),h("mouseup",()=>{at&&(at=!1,rt?.classList.remove("dragging"),rt=null,document.body.classList.remove("cursor-col-resize","user-select-none"),be())}),requestAnimationFrame(()=>{document.getElementById("loadingOverlay")?.classList.remove("visible")}),Ze("initializeGantt-end"),ct("initializeGantt","initializeGantt-start","initializeGantt-end")}})();
