"use strict";(()=>{function yt({timelineWidth:E,minimapBarsData:v,minimapHeight:Q,minimapBarHeight:Y,minimapTodayX:fe,ganttScroll:J,minimapSvg:ae,minimapViewport:_,addDocListener:me}){function Ae(){let X=document.querySelector(".gantt-body .gantt-sticky-left"),L=document.querySelector(".gantt-container");X&&L&&L.style.setProperty("--sticky-left-width",X.offsetWidth+"px")}requestAnimationFrame(Ae),ae&&requestAnimationFrame(()=>{let X=Q/(v.length+1);if(v.forEach((L,Z)=>{let f=document.createElementNS("http://www.w3.org/2000/svg","rect");f.setAttribute("class",L.classes),f.setAttribute("x",(L.startPct*E).toString()),f.setAttribute("y",(X*(Z+.5)).toString()),f.setAttribute("width",Math.max(2,(L.endPct-L.startPct)*E).toString()),f.setAttribute("height",Y.toString()),f.setAttribute("rx","1"),f.setAttribute("fill",L.color),ae.insertBefore(f,_)}),fe>0&&fe<E){let L=document.createElementNS("http://www.w3.org/2000/svg","line");L.setAttribute("class","minimap-today"),L.setAttribute("x1",fe.toString()),L.setAttribute("y1","0"),L.setAttribute("x2",fe.toString()),L.setAttribute("y2",Q.toString()),ae.insertBefore(L,_)}});function Ie(){if(!J||!_||!E||!J.scrollWidth||!J.clientWidth)return;let X=Math.max(1,J.scrollWidth-J.clientWidth),L=Math.min(1,J.scrollLeft/X),Z=Math.min(1,J.clientWidth/J.scrollWidth),f=Math.max(20,Z*E),ge=L*(E-f);isNaN(ge)||isNaN(f)||(_.setAttribute("x",ge.toString()),_.setAttribute("width",f.toString()))}let de=!1,W=0;function j(X,L=!1){if(!J||!ae||!_)return;let Z=ae.getBoundingClientRect(),ge=parseFloat(_.getAttribute("width")||"0")/E*Z.width,U=X.clientX-Z.left;L?U-=W:U-=ge/2;let P=Math.max(0,Math.min(1,U/(Z.width-ge))),oe=Math.max(0,J.scrollWidth-J.clientWidth);J.scrollLeft=P*oe}return ae&&_&&(_.addEventListener("mousedown",X=>{X.stopPropagation(),de=!0;let L=ae.getBoundingClientRect(),f=parseFloat(_.getAttribute("x")||"0")/E*L.width;W=X.clientX-L.left-f}),ae.addEventListener("mousedown",X=>{if(X.target===_)return;de=!0;let L=ae.getBoundingClientRect();W=parseFloat(_.getAttribute("width")||"0")/100*L.width/2,j(X,!0)}),me("mousemove",X=>{de&&j(X,!0)}),me("mouseup",()=>{de=!1})),{updateMinimapPosition:Ae,updateMinimapViewport:Ie}}function bt(E){let{vscode:v,menuUndo:Q,menuRedo:Y,addDocListener:fe,closeOnOutsideClick:J,announce:ae,saveState:_,updateUndoRedoButtons:me,undoStack:Ae,redoStack:Ie,selectedIssues:de,clearSelection:W,allIssueBars:j,redmineBaseUrl:X,extendedRelationTypes:L,minDateMs:Z,maxDateMs:f,timelineWidth:ge,dayWidth:U,barHeight:P,ganttScroll:oe,snapToDay:he,focusOnDependencyChain:ye,clearFocus:d,getFocusedIssueId:S,scrollToAndHighlight:b,setAllowScrollChange:C,isDraftModeEnabled:A,isPerfDebugEnabled:l}=E;function h(t,o,n){document.querySelector(".relation-picker")?.remove();let i=de.size>1&&de.has(n),r=i?Array.from(de).map(M=>parseInt(M)):[parseInt(n)],D=document.createElement("div");D.className="relation-picker";let k=160,w=180,F=Math.min(t,window.innerWidth-k-10),I=Math.min(o,window.innerHeight-w-10);D.style.left=Math.max(10,F)+"px",D.style.top=Math.max(10,I)+"px";let T=document.createElement("div");T.style.padding="6px 12px",T.style.fontSize="11px",T.style.opacity="0.7",T.textContent=i?r.length+" issues selected":"#"+n,D.appendChild(T),(i?[{label:"Set % Done...",command:"bulkSetDoneRatio",bulk:!0},{label:"Clear Selection",command:"clearSelection",local:!0}]:[{label:"Update Issue...",command:"openIssue"},{label:"Open in Browser",command:"openInBrowser"},{label:"Show in Issues",command:"showInIssues"},{label:"Log Time",command:"logTime"},{label:"Set % Done",command:"setDoneRatio"},{label:"Toggle Auto-update %",command:"toggleAutoUpdate"},{label:"Toggle Ad-hoc Budget",command:"toggleAdHoc"},{label:"Toggle Precedence",command:"togglePrecedence"},{label:"Set Internal Estimate",command:"setInternalEstimate"},{label:"Copy Link",command:"copyLink",local:!0},{label:"Copy URL",command:"copyUrl"}]).forEach(M=>{let H=document.createElement("button");H.textContent=M.label,H.addEventListener("click",async()=>{if(M.command==="copyLink"){let ie=document.querySelector('.issue-bar[data-issue-id="'+n+'"]')?.dataset?.subject||"Issue #"+n,pe=X+"/issues/"+n,K='<a href="'+pe+'">#'+n+" "+ie+"</a>",Le=pe;try{await navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([Le],{type:"text/plain"}),"text/html":new Blob([K],{type:"text/html"})})]),v.postMessage({command:"showStatus",message:"Copied #"+n+" link"})}catch{await navigator.clipboard.writeText(Le),v.postMessage({command:"showStatus",message:"Copied #"+n+" URL"})}}else M.local?W():M.bulk?v.postMessage({command:M.command,issueIds:r}):v.postMessage({command:M.command,issueId:parseInt(n)});D.remove()}),D.appendChild(H)}),document.body.appendChild(D),J(D)}function B(t){let o=Z+t/ge*(f-Z);return new Date(o).toISOString().slice(0,10)}function z(t){let o=Z+t/ge*(f-Z)-864e5;return new Date(o).toISOString().slice(0,10)}let ee=document.getElementById("dragDateTooltip"),be=null;function re(t){let o=new Date(t+"T00:00:00"),n=o.toLocaleDateString("en-US",{month:"short"}),i=o.getDate(),r=o.toLocaleDateString("en-US",{weekday:"short"});return n+" "+i+" ("+r+")"}function O(t,o){let n=new Date(t+"T00:00:00"),i=new Date(o+"T00:00:00"),r=n.toLocaleDateString("en-US",{month:"short"}),D=i.toLocaleDateString("en-US",{month:"short"});return r===D?r+" "+n.getDate()+"-"+i.getDate():r+" "+n.getDate()+"-"+D+" "+i.getDate()}function Be(t){ee.textContent=t,ee.style.display="block",be=t}function Me(t){t!==be&&(ee.textContent=t,be=t)}function Pe(t,o){let n=o-28,i=!1;n<40&&(n=o+20,i=!0),ee.style.left=t+"px",ee.style.top=n+"px",ee.classList.toggle("flipped",i)}function qe(){ee.style.display="none",be=null}let G=4,m=4;function Te(t,o){l&&l()&&console.log("[Arrow Debug]",t,o)}function Ke(t,o,n,i,r,D=!1,k=!1){let w=n>t,F=Math.abs(n-t),I=F<30,T=Math.abs(o-i)<5,g=i>o,M=D?-1:1,H=k?1:-1,V;T&&w?V="sameRow-right":!T&&I?V="nearlyVertical":w?V="diffRow-right":T?V="sameRow-left":V="diffRow-left";let ie;if(T&&w)ie="M "+t+" "+o+" H "+n;else if(T&&!w){let K=o-P;ie="M "+t+" "+o+" V "+(K+m)+" q 0 "+-m+" "+M*-m+" "+-m+" H "+(n+H*12-H*m)+" q "+H*-m+" 0 "+H*-m+" "+m+" V "+i+" H "+n}else if(!T&&I){let Le=(o+i)/2;ie="M "+t+" "+o+" H "+(t+M*8-M*m)+" q "+M*m+" 0 "+M*m+" "+(g?m:-m)+" V "+(Le+(g?-m:m))+" q 0 "+(g?m:-m)+" "+-M*m+" "+(g?m:-m)+" H "+(n+H*8-H*m)+" q "+H*m+" 0 "+H*m+" "+(g?m:-m)+" V "+(i+(g?-m:m))+" q 0 "+(g?m:-m)+" "+-H*m+" "+(g?m:-m)+" H "+n}else if(w){let K=D?Math.max(t-8,(t+n)/2):Math.min(t+8,(t+n)/2);ie="M "+t+" "+o+" H "+(K-M*m)+" q "+M*m+" 0 "+M*m+" "+(g?m:-m)+" V "+(i+(g?-m:m))+" q 0 "+(g?m:-m)+" "+-H*m+" "+(g?m:-m)+" H "+n}else{let Le=(o+i)/2;ie="M "+t+" "+o+" H "+(t+M*8-M*m)+" q "+M*m+" 0 "+M*m+" "+(g?m:-m)+" V "+(Le+(g?-m:m))+" q 0 "+(g?m:-m)+" "+-M*m+" "+(g?m:-m)+" H "+(n+H*8-H*m)+" q "+H*m+" 0 "+H*m+" "+(g?m:-m)+" V "+(i+(g?-m:m))+" q 0 "+(g?m:-m)+" "+-H*m+" "+(g?m:-m)+" H "+n}let pe=k?"M "+(n+G)+" "+(i-G*.6)+" L "+n+" "+i+" L "+(n+G)+" "+(i+G*.6):"M "+(n-G)+" "+(i-G*.6)+" L "+n+" "+i+" L "+(n-G)+" "+(i+G*.6);return Te("calcArrowPath",{inputs:{x1:t,y1:o,x2:n,y2:i,isScheduling:r},conditions:{goingRight:w,horizontalDist:F,nearlyVertical:I,sameRow:T,goingDown:g},pathCase:V,path:ie.substring(0,80)+(ie.length>80?"...":"")}),{path:ie,arrowHead:pe}}function $e(t){let o=[],n='.dependency-arrow[data-from="'+t+'"], .dependency-arrow[data-to="'+t+'"]';return document.querySelectorAll(n).forEach(i=>{let r=i.getAttribute("data-from"),D=i.getAttribute("data-to"),w=(i.getAttribute("class")||"").match(/rel-(\w+)/),F=w?w[1]:"relates",I=["blocks","precedes","finish_to_start","start_to_start","finish_to_finish","start_to_finish"].includes(F),T=document.querySelector('.issue-bar[data-issue-id="'+r+'"]'),g=document.querySelector('.issue-bar[data-issue-id="'+D+'"]');!T||!g||o.push({element:i,fromId:r,toId:D,isScheduling:I,relType:F,fromBar:T,toBar:g,linePath:i.querySelector(".arrow-line"),hitPath:i.querySelector(".arrow-hit-area"),headPath:i.querySelector(".arrow-head")})}),o}function He(t,o,n,i){t.forEach(r=>{let D=r.linePath?r.linePath.getAttribute("d"):null,k=r.fromId==o?n:parseFloat(r.fromBar.dataset.startX),w=r.fromId==o?i:parseFloat(r.fromBar.dataset.endX),F=parseFloat(r.fromBar.dataset.centerY),I=r.toId==o?n:parseFloat(r.toBar.dataset.startX),T=r.toId==o?i:parseFloat(r.toBar.dataset.endX),g=parseFloat(r.toBar.dataset.centerY),M=r.relType==="start_to_start"||r.relType==="start_to_finish",H=r.relType==="finish_to_finish"||r.relType==="start_to_finish",V,ie,pe,K;r.isScheduling?(V=M?k-2:w+2,ie=F,pe=H?T+2:I-2,K=g):(V=(k+w)/2,ie=F,pe=(I+T)/2,K=g),Te("updateArrowPositions",{arrow:r.fromId+" -> "+r.toId,isScheduling:r.isScheduling,draggedId:o,barData:{fromStartX:r.fromBar.dataset.startX,fromEndX:r.fromBar.dataset.endX,fromY:r.fromBar.dataset.centerY,toStartX:r.toBar.dataset.startX,toEndX:r.toBar.dataset.endX,toY:r.toBar.dataset.centerY},computed:{fromStartX:k,fromEndX:w,fromY:F,toStartX:I,toEndX:T,toY:g},coords:{x1:V,y1:ie,x2:pe,y2:K},originalPath:D?D.substring(0,60)+"...":null});let{path:Le,arrowHead:le}=Ke(V,ie,pe,K,r.isScheduling,M,H);r.linePath&&r.linePath.setAttribute("d",Le),r.hitPath&&r.hitPath.setAttribute("d",Le),r.headPath&&r.headPath.setAttribute("d",le)})}let xe=document.getElementById("dragConfirmOverlay"),Fe=document.getElementById("dragConfirmMessage"),Xe=document.getElementById("dragConfirmOk"),_e=document.getElementById("dragConfirmCancel"),Se=null;function ze(t,o,n){!xe||!Fe||(Fe.textContent=t,Se={onConfirm:o,onCancel:n},C(!0),xe.style.display="flex",Xe&&Xe.focus())}function Ne(){xe&&(xe.style.display="none"),Se=null}function y(){oe&&q&&(oe.scrollLeft=q.left,oe.scrollTop=q.top),q=null}Xe?.addEventListener("click",()=>{Se?.onConfirm&&Se.onConfirm(),q=null,Ne()}),_e?.addEventListener("click",()=>{Se?.onCancel&&Se.onCancel(),y(),Ne()}),xe?.addEventListener("click",t=>{t.target===xe&&(Se?.onCancel&&Se.onCancel(),y(),Ne())}),fe("keydown",t=>{Se&&(t.key==="Escape"?(t.preventDefault(),Se.onCancel&&Se.onCancel(),y(),Ne()):t.key==="Enter"&&(t.preventDefault(),Se.onConfirm&&Se.onConfirm(),q=null,Ne()))});let c=null,q=null,te=!1;document.querySelectorAll(".drag-handle").forEach(t=>{t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation(),q={left:oe?.scrollLeft,top:oe?.scrollTop};let n=t.closest(".issue-bar"),i=t.classList.contains("drag-left"),r=parseInt(n.dataset.issueId),D=parseFloat(n.dataset.startX),k=parseFloat(n.dataset.endX),w=n.dataset.startDate||null,F=n.dataset.dueDate||null,I=n.querySelector(".bar-outline"),T=n.querySelector(".bar-main"),g=n.querySelector(".drag-left"),M=n.querySelector(".drag-right");n.classList.add("dragging");let H=n.querySelector(".bar-labels"),V=H?.classList.contains("labels-left"),ie=$e(r),pe=n.querySelector(".link-handle");Te("dragStart (resize)",{issueId:r,isLeft:i,connectedArrowCount:ie.length,arrows:ie.map(le=>({from:le.fromId,to:le.toId,isScheduling:le.isScheduling,currentPath:le.linePath?le.linePath.getAttribute("d")?.substring(0,60)+"...":null}))}),c={issueId:r,isLeft:i,isMove:!1,initialMouseX:o.clientX,startX:D,endX:k,oldStartDate:w,oldDueDate:F,barOutline:I,barMain:T,leftHandle:g,rightHandle:M,bar:n,barLabels:H,labelsOnLeft:V,connectedArrows:ie,linkHandle:pe};let K=i?D:k,Le=i?w:F;Le&&(Be((i?"Start: ":"Due: ")+re(Le)),Pe(o.clientX,o.clientY))})}),document.querySelectorAll(".bar-outline").forEach(t=>{t.addEventListener("mousedown",o=>{if(o.target.classList.contains("drag-handle")||o.ctrlKey||o.metaKey||o.shiftKey)return;o.preventDefault(),o.stopPropagation(),q={left:oe?.scrollLeft,top:oe?.scrollTop};let n=t.closest(".issue-bar");if(!n)return;let i=n.dataset.issueId,r=de.size>1&&de.has(i),k=(r?j.filter(g=>de.has(g.dataset.issueId)):[n]).map(g=>({issueId:g.dataset.issueId,startX:parseFloat(g.dataset.startX),endX:parseFloat(g.dataset.endX),oldStartDate:g.dataset.startDate||null,oldDueDate:g.dataset.dueDate||null,barOutline:g.querySelector(".bar-outline"),barMain:g.querySelector(".bar-main"),leftHandle:g.querySelector(".drag-left"),rightHandle:g.querySelector(".drag-right"),bar:g,barLabels:g.querySelector(".bar-labels"),labelsOnLeft:g.querySelector(".bar-labels")?.classList.contains("labels-left"),connectedArrows:$e(g.dataset.issueId),linkHandle:g.querySelector(".link-handle")}));k.forEach(g=>g.bar.classList.add("dragging"));let w=n.querySelector(".bar-labels"),F=w?.classList.contains("labels-left"),I=$e(i),T=n.querySelector(".link-handle");Te("dragStart (move)",{issueId:i,isBulkDrag:r,connectedArrowCount:I.length,arrows:I.map(g=>({from:g.fromId,to:g.toId,isScheduling:g.isScheduling,currentPath:g.linePath?g.linePath.getAttribute("d")?.substring(0,60)+"...":null}))}),c={issueId:parseInt(i),isLeft:!1,isMove:!0,isBulkDrag:r,bulkBars:k,initialMouseX:o.clientX,startX:parseFloat(n.dataset.startX),endX:parseFloat(n.dataset.endX),oldStartDate:n.dataset.startDate||null,oldDueDate:n.dataset.dueDate||null,barOutline:t,barMain:n.querySelector(".bar-main"),leftHandle:n.querySelector(".drag-left"),rightHandle:n.querySelector(".drag-right"),bar:n,barLabels:w,labelsOnLeft:F,connectedArrows:I,linkHandle:T},!r&&n.dataset.startDate&&n.dataset.dueDate&&(Be(O(n.dataset.startDate,n.dataset.dueDate)),Pe(o.clientX,o.clientY))})});let $=null,ue=null,ke=null;function Ce(){$&&($.fromBar.classList.remove("linking-source"),document.querySelectorAll(".link-target").forEach(t=>t.classList.remove("link-target")),ue&&(ue.remove(),ue=null),$=null,ke=null,document.body.classList.remove("cursor-crosshair"))}function Ue(t,o,n,i,r="end",D="start"){document.querySelector(".relation-picker")?.remove();let k=document.createElement("div");k.className="relation-picker";let w=180,F=200,I=Math.min(t,window.innerWidth-w-10),T=Math.min(o,window.innerHeight-F-10);k.style.left=Math.max(10,I)+"px",k.style.top=Math.max(10,T)+"px";let M={end_start:"finish_to_start",end_end:"finish_to_finish",start_start:"start_to_start",start_end:"start_to_finish"}[`${r}_${D}`]||"finish_to_start",H=[{value:"blocks",label:"\u{1F6AB} Blocks",cssClass:"rel-line-blocks",tooltip:"Target cannot be closed until this issue is closed"},{value:"precedes",label:"\u27A1\uFE0F Precedes",cssClass:"rel-line-scheduling",tooltip:"This issue must complete before target can start"},{value:"relates",label:"\u{1F517} Relates to",cssClass:"rel-line-informational",tooltip:"Simple link between issues (no constraints)"},{value:"duplicates",label:"\u{1F4CB} Duplicates",cssClass:"rel-line-informational",tooltip:"Closing target will automatically close this issue"},{value:"copied_to",label:"\u{1F4C4} Copied to",cssClass:"rel-line-informational",tooltip:"This issue was copied to create the target issue"}],V=[{value:"finish_to_start",label:"\u23E9 Finish\u2192Start",cssClass:"rel-line-scheduling",tooltip:"Target starts after this issue finishes (FS)"},{value:"start_to_start",label:"\u25B6\uFE0F Start\u2192Start",cssClass:"rel-line-scheduling",tooltip:"Target starts when this issue starts (SS)"},{value:"finish_to_finish",label:"\u23F9\uFE0F Finish\u2192Finish",cssClass:"rel-line-scheduling",tooltip:"Target finishes when this issue finishes (FF)"},{value:"start_to_finish",label:"\u23EA Start\u2192Finish",cssClass:"rel-line-scheduling",tooltip:"Target finishes when this issue starts (SF)"}],ie=L?[...H,...V]:H,pe=-1,K=document.createElement("div");K.className="delay-row";let Le=document.createElement("label");Le.textContent="Delay:",K.appendChild(Le);let le=document.createElement("button");le.className="delay-preset active",le.dataset.delay="-1",le.title="Start same day predecessor ends",le.textContent="Same day",K.appendChild(le);let Ee=document.createElement("button");Ee.className="delay-preset",Ee.dataset.delay="0",Ee.title="Start day after predecessor ends",Ee.textContent="+1 day",K.appendChild(Ee);let R=document.createElement("input");R.type="number",R.className="delay-input",R.value=pe,R.min="-30",R.max="30",R.title="Custom delay in days (-1=same day, 0=next day, 3=+4 days)",K.appendChild(R),K.style.display="none",K.querySelectorAll(".delay-preset").forEach(x=>{x.addEventListener("click",N=>{N.stopPropagation(),pe=parseInt(x.dataset.delay),R.value=pe,K.querySelectorAll(".delay-preset").forEach(We=>We.classList.remove("active")),x.classList.add("active")})}),R.addEventListener("input",()=>{pe=parseInt(R.value)||0,K.querySelectorAll(".delay-preset").forEach(x=>{x.classList.toggle("active",parseInt(x.dataset.delay)===pe)})}),R.addEventListener("click",x=>x.stopPropagation()),ie.forEach(x=>{let N=document.createElement("button");x.value===M&&N.classList.add("suggested");let We=document.createElement("span");We.className="color-swatch "+x.cssClass,N.appendChild(We),N.appendChild(document.createTextNode(x.label)),N.title=x.tooltip+(x.value===M?" (suggested based on anchors)":""),x.value==="precedes"&&(N.addEventListener("mouseenter",()=>{K.style.display="flex"}),N.addEventListener("focus",()=>{K.style.display="flex"})),N.addEventListener("click",()=>{_();let Oe={command:"createRelation",issueId:n,targetIssueId:i,relationType:x.value};x.value==="precedes"&&(Oe.delay=pe),v.postMessage(Oe),k.remove()}),k.appendChild(N)}),k.appendChild(K),document.body.appendChild(k),J(k)}let Re=".drag-handle, .link-handle, .bar-outline, .blocks-badge-group, .blocker-badge, .progress-badge-group, .flex-badge-group";document.querySelectorAll(".issue-bar").forEach(t=>{t.addEventListener("click",o=>{o.target.closest(Re)||c||$||te||(S()&&d(),b(t.dataset.issueId))}),t.addEventListener("dblclick",o=>{c||$||te||(o.preventDefault(),ye(t.dataset.issueId))})});function st(t,o){if(document.querySelectorAll(".dependency-arrow.selected").forEach(i=>i.classList.remove("selected")),document.querySelectorAll(".arrow-connected").forEach(i=>i.classList.remove("arrow-connected")),t.length===0)return;document.body.classList.add("arrow-selection-mode");let n=new Set;t.forEach(i=>{i.classList.add("selected"),n.add(i.dataset.from),n.add(i.dataset.to)}),n.forEach(i=>{document.querySelectorAll(`.issue-bar[data-issue-id="${i}"], .issue-label[data-issue-id="${i}"]`).forEach(r=>r.classList.add("arrow-connected"))}),ae(`Highlighted ${t.length} dependency arrow(s) for #${o}`)}document.querySelectorAll(".blocks-badge-group").forEach(t=>{t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation()}),t.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();let n=t.closest(".issue-bar");if(!n)return;let i=n.dataset.issueId,r=Array.from(document.querySelectorAll(`.dependency-arrow[data-from="${i}"]`));st(r,i)})}),document.querySelectorAll(".blocker-badge").forEach(t=>{t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation()}),t.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();let n=t.closest(".issue-bar");if(!n)return;let i=n.dataset.issueId,r=Array.from(document.querySelectorAll(`.dependency-arrow[data-to="${i}"]`));st(r,i)})});let ve=Array.from(document.querySelectorAll(".issue-bar")),nt=10;ve.forEach((t,o)=>{t.addEventListener("keydown",n=>{if(n.key==="Enter"||n.key===" ")n.preventDefault(),b(t.dataset.issueId);else if(n.key==="ArrowDown"&&o<ve.length-1)n.preventDefault(),ve[o+1].focus(),ae(`Issue ${ve[o+1].getAttribute("aria-label")}`);else if(n.key==="ArrowUp"&&o>0)n.preventDefault(),ve[o-1].focus(),ae(`Issue ${ve[o-1].getAttribute("aria-label")}`);else if(n.key==="Home")n.preventDefault(),ve[0].focus(),ae(`First issue: ${ve[0].getAttribute("aria-label")}`);else if(n.key==="End")n.preventDefault(),ve[ve.length-1].focus(),ae(`Last issue: ${ve[ve.length-1].getAttribute("aria-label")}`);else if(n.key==="PageDown"){n.preventDefault();let i=Math.min(o+nt,ve.length-1);ve[i].focus(),ae(`Issue ${ve[i].getAttribute("aria-label")}`)}else if(n.key==="PageUp"){n.preventDefault();let i=Math.max(o-nt,0);ve[i].focus(),ae(`Issue ${ve[i].getAttribute("aria-label")}`)}else if(n.key==="Tab"&&n.shiftKey){let i=t.dataset.issueId,r=document.querySelector(`.issue-label[data-issue-id="${i}"]`);r&&(n.preventDefault(),r.focus(),ae(`Label for issue #${i}`))}})}),document.querySelectorAll(".link-handle").forEach(t=>{t.addEventListener("mousedown",o=>{o.stopPropagation(),o.preventDefault();let n=t.closest(".issue-bar"),i=parseInt(n.dataset.issueId),r=parseFloat(t.dataset.cx),D=parseFloat(t.dataset.cy);n.classList.add("linking-source"),document.body.classList.add("cursor-crosshair");let k=document.querySelector("#ganttTimeline svg");if(!document.getElementById("temp-arrow-head")){let F=document.createElementNS("http://www.w3.org/2000/svg","defs");F.innerHTML=`
            <marker id="temp-arrow-head" markerWidth="10" markerHeight="7"
                    refX="9" refY="3.5" orient="auto" markerUnits="strokeWidth">
              <polygon points="0 0, 10 3.5, 0 7" fill="var(--vscode-focusBorder)"/>
            </marker>`,k.insertBefore(F,k.firstChild)}ue=document.createElementNS("http://www.w3.org/2000/svg","path"),ue.classList.add("temp-link-arrow"),ue.setAttribute("stroke","var(--vscode-focusBorder)"),ue.setAttribute("stroke-width","2"),ue.setAttribute("fill","none"),ue.setAttribute("marker-end","url(#temp-arrow-head)"),k.appendChild(ue);let w=t.dataset.anchor||"end";$={fromId:i,fromBar:n,startX:r,startY:D,fromAnchor:w}})}),fe("keydown",t=>{if(t.key==="Escape"){let o=document.querySelector(".relation-picker");if(o){t.stopImmediatePropagation(),o.remove();return}if($){t.stopImmediatePropagation(),Ce();return}S()&&(t.stopImmediatePropagation(),d(),ae("Focus cleared"))}});let Je=!1,Ze=null;fe("mousemove",t=>{!c&&!$||(Ze=t,!Je&&(Je=!0,requestAnimationFrame(()=>{Je=!1;let o=Ze;if(o){if(c){let n=o.clientX-c.initialMouseX;if(c.isMove&&c.isBulkDrag&&c.bulkBars){let i=he(n)-he(0);c.bulkBars.forEach(r=>{let D=r.endX-r.startX,k=Math.max(0,Math.min(r.startX+i,ge-D)),w=k+D,F=w-k;r.barOutline.setAttribute("x",k),r.barOutline.setAttribute("width",F),r.barMain&&(r.barMain.setAttribute("x",k),r.barMain.setAttribute("width",F));let I=r.leftHandle.querySelector("rect"),T=r.rightHandle.querySelector("rect");if(I&&I.setAttribute("x",k),T&&T.setAttribute("x",w-14),r.leftHandle.querySelectorAll(".drag-grip circle").forEach((g,M)=>g.setAttribute("cx",k+9)),r.rightHandle.querySelectorAll(".drag-grip circle").forEach((g,M)=>g.setAttribute("cx",w-9)),r.newStartX=k,r.newEndX=w,r.barLabels){let g=r.labelsOnLeft?k-r.startX:w-r.endX;r.barLabels.setAttribute("transform","translate("+g+", 0)")}r.connectedArrows&&He(r.connectedArrows,r.issueId,k,w),r.linkHandle&&r.linkHandle.querySelectorAll("circle").forEach(g=>g.setAttribute("cx",String(w+8)))}),c.snappedDelta=i}else{let i=c.startX,r=c.endX,D=c.endX-c.startX;c.isMove?(i=he(Math.max(0,Math.min(c.startX+n,ge-D))),r=i+D):c.isLeft?i=he(Math.max(0,Math.min(c.startX+n,c.endX-U))):r=he(Math.max(c.startX+U,Math.min(c.endX+n,ge)));let k=r-i;c.barOutline.setAttribute("x",i),c.barOutline.setAttribute("width",k),c.barMain&&(c.barMain.setAttribute("x",i),c.barMain.setAttribute("width",k));let w=c.leftHandle.querySelector("rect"),F=c.rightHandle.querySelector("rect");if(w&&w.setAttribute("x",i),F&&F.setAttribute("x",r-14),c.leftHandle.querySelectorAll(".drag-grip circle").forEach(I=>I.setAttribute("cx",i+9)),c.rightHandle.querySelectorAll(".drag-grip circle").forEach(I=>I.setAttribute("cx",r-9)),c.newStartX=i,c.newEndX=r,c.barLabels){let I=c.labelsOnLeft?i-c.startX:r-c.endX;c.barLabels.setAttribute("transform","translate("+I+", 0)")}if(c.connectedArrows&&He(c.connectedArrows,c.issueId,i,r),c.linkHandle&&c.linkHandle.querySelectorAll("circle").forEach(I=>I.setAttribute("cx",String(r+8))),c.isMove&&!c.isBulkDrag){let I=B(i),T=z(r),M=I!==c.oldStartDate?O(c.oldStartDate,c.oldDueDate)+" \u2192 "+O(I,T):O(I,T);Me(M),Pe(o.clientX,o.clientY)}else if(!c.isMove){let I=c.isLeft?i:r,T=c.isLeft?B(I):z(I);Me((c.isLeft?"Start: ":"Due: ")+re(T)),Pe(o.clientX,o.clientY)}}}if($&&ue){let i=document.querySelector("#ganttTimeline svg").getBoundingClientRect(),r=o.clientX-i.left,D=o.clientY-i.top,k=`M ${$.startX} ${$.startY} L ${r} ${D}`;ue.setAttribute("d",k);let w=document.elementFromPoint(o.clientX,o.clientY)?.closest(".issue-bar");ke&&ke!==w&&ke.classList.remove("link-target"),w&&w!==$.fromBar?(w.classList.add("link-target"),ke=w):ke=null}}})))});function Ge(t){if(!t)return;let{bar:o,barOutline:n,barMain:i,leftHandle:r,rightHandle:D,barLabels:k,startX:w,endX:F,connectedArrows:I,issueId:T,linkHandle:g}=t,M=F-w;if(n&&(n.setAttribute("x",String(w)),n.setAttribute("width",String(M))),i&&(i.setAttribute("x",String(w)),i.setAttribute("width",String(M))),r){let H=r.querySelector("rect");H&&H.setAttribute("x",String(w)),r.querySelectorAll(".drag-grip circle").forEach(V=>V.setAttribute("cx",w+9))}if(D){let H=D.querySelector("rect");H&&H.setAttribute("x",String(F-14)),D.querySelectorAll(".drag-grip circle").forEach(V=>V.setAttribute("cx",F-9))}k&&k.removeAttribute("transform"),I&&I.length>0&&He(I,T,w,F),g&&g.querySelectorAll("circle").forEach(H=>H.setAttribute("cx",String(F+8))),o&&o.classList.remove("dragging")}fe("mouseup",t=>{if(c){let{issueId:o,isLeft:n,isMove:i,isBulkDrag:r,bulkBars:D,newStartX:k,newEndX:w,bar:F,startX:I,endX:T,oldStartDate:g,oldDueDate:M,barOutline:H,barMain:V,leftHandle:ie,rightHandle:pe,barLabels:K,connectedArrows:Le}=c,le={...c};if(r&&D&&i){D.forEach(R=>R.bar.classList.remove("dragging"));let Ee=[];if(D.forEach(R=>{if(R.newStartX!==void 0&&R.newStartX!==R.startX){let x=B(R.newStartX),N=z(R.newEndX);(x!==R.oldStartDate||N!==R.oldDueDate)&&Ee.push({issueId:parseInt(R.issueId),oldStartDate:R.oldStartDate,oldDueDate:R.oldDueDate,newStartDate:x,newDueDate:N,barData:R})}}),Ee.length>0){qe();let R=()=>{Ae.push({type:"bulk",changes:Ee.map(x=>({issueId:x.issueId,oldStartDate:x.oldStartDate,oldDueDate:x.oldDueDate,newStartDate:x.newStartDate,newDueDate:x.newDueDate}))}),Ie.length=0,me(),_(),Ee.forEach(x=>{v.postMessage({command:"updateDates",issueId:x.issueId,startDate:x.newStartDate,dueDate:x.newDueDate})})};if(A&&A())R();else{let x="Move "+Ee.length+" issue(s) to new dates?";ze(x,R,()=>{D.forEach(N=>Ge(N))})}}else qe(),D.forEach(R=>Ge(R));c=null,te=!0,requestAnimationFrame(()=>te=!1);return}if(F.classList.remove("dragging"),qe(),k!==void 0||w!==void 0){let Ee=null,R=null;i?k!==I&&(Ee=B(k),R=z(w)):n?Ee=k!==I?B(k):null:R=w!==T?z(w):null;let x=Ee&&Ee!==g?Ee:null,N=R&&R!==M?R:null;if(x||N){let We=()=>{Ae.push({issueId:o,oldStartDate:x?g:null,oldDueDate:N?M:null,newStartDate:x,newDueDate:N}),Ie.length=0,me(),_(),v.postMessage({command:"updateDates",issueId:o,startDate:x,dueDate:N})};if(A&&A())We();else{let Oe="Issue #"+o+": ";x&&N?Oe+=O(g,M)+" \u2192 "+O(x,N):x?Oe+="Start: "+re(g)+" \u2192 "+re(x):Oe+="Due: "+re(M)+" \u2192 "+re(N),ze(Oe,We,()=>{Ge(le)})}}else Ge(le)}else Ge(le);c=null,te=!0,requestAnimationFrame(()=>te=!1)}if($){let o=$.fromId,n=$.fromAnchor;if(ke){let i=parseInt(ke.dataset.issueId);if(o!==i){let D=document.querySelector("#ganttTimeline svg").getBoundingClientRect(),k=t.clientX-D.left,w=ke.querySelector(".bar-outline"),F=parseFloat(w.getAttribute("x")),I=F+parseFloat(w.getAttribute("width")),T=(F+I)/2,g=k<T?"start":"end";Ue(t.clientX,t.clientY,o,i,n,g)}}Ce()}Se||y()}),Q?.addEventListener("click",()=>{if(Q.hasAttribute("disabled")||Ae.length===0)return;let t=Ae.pop();if(Ie.push(t),me(),_(),t.type==="relation")t.operation==="create"?v.postMessage({command:"undoRelation",operation:"delete",relationId:t.relationId,datesBefore:t.datesBefore}):v.postMessage({command:"undoRelation",operation:"create",issueId:t.issueId,targetIssueId:t.targetIssueId,relationType:t.relationType});else if(t.type==="bulk"){let o=A&&A();t.changes.forEach(n=>{o?v.postMessage({command:"removeDraft",issueId:n.issueId,startDate:n.oldStartDate,dueDate:n.oldDueDate}):v.postMessage({command:"updateDates",issueId:n.issueId,startDate:n.oldStartDate,dueDate:n.oldDueDate})})}else A&&A()?v.postMessage({command:"removeDraft",issueId:t.issueId,startDate:t.oldStartDate,dueDate:t.oldDueDate}):v.postMessage({command:"updateDates",issueId:t.issueId,startDate:t.oldStartDate,dueDate:t.oldDueDate})}),Y?.addEventListener("click",()=>{if(Y.hasAttribute("disabled")||Ie.length===0)return;let t=Ie.pop();Ae.push(t),me(),_(),t.type==="relation"?t.operation==="create"?v.postMessage({command:"redoRelation",operation:"create",issueId:t.issueId,targetIssueId:t.targetIssueId,relationType:t.relationType}):v.postMessage({command:"redoRelation",operation:"delete",relationId:t.relationId}):t.type==="bulk"?t.changes.forEach(o=>{v.postMessage({command:"updateDates",issueId:o.issueId,startDate:o.newStartDate,dueDate:o.newDueDate})}):v.postMessage({command:"updateDates",issueId:t.issueId,startDate:t.newStartDate,dueDate:t.newDueDate})})}function vt(E){let{vscode:v,addDocListener:Q,addWinListener:Y,announce:fe,barHeight:J,selectedCollapseKey:ae}=E;document.querySelectorAll(".collapse-toggle").forEach(d=>{d.addEventListener("click",S=>{S.stopPropagation();let C=d.closest("[data-collapse-key]")?.dataset.collapseKey;C&&ye(C)})}),document.getElementById("menuExpand")?.addEventListener("click",()=>{let S=document.getElementById("ganttScroll")?.dataset.allExpandableKeys,b=S?JSON.parse(S):[];v.postMessage({command:"expandAll",keys:b})}),document.getElementById("menuCollapse")?.addEventListener("click",()=>{v.postMessage({command:"collapseAll"})});let _=Array.from(document.querySelectorAll(".project-label, .issue-label, .time-group-label")),me=null,Ae=ae??null;function Ie(d){return!d.classList.contains("gantt-row-hidden")&&d.getAttribute("visibility")!=="hidden"}function de(d,S){let b=d+S;for(;b>=0&&b<_.length;){if(Ie(_[b]))return{label:_[b],index:b};b+=S}return null}function W(d){let S=document.getElementById("ganttScroll"),b=document.querySelector(".gantt-header-row");if(!S||!d)return;let C=b?.getBoundingClientRect().height||60,A=d.closest(".gantt-row");if(!A)return;let l=A.getBoundingClientRect().top,h=A.getBoundingClientRect().height,B=S.getBoundingClientRect(),z=B.top+C,ee=B.bottom;l<z?S.scrollBy({top:l-z-4,behavior:"smooth"}):l+h>ee&&S.scrollBy({top:l+h-ee+4,behavior:"smooth"})}function j(d,S=!1,b=!1,C=!1){me&&me.classList.remove("active"),me=d,d&&(d.classList.add("active"),C||d.focus(),b&&W(d),S||v.postMessage({command:"setSelectedKey",collapseKey:d.dataset.collapseKey}))}Y("focus",()=>{me&&Ie(me)&&me.focus()}),Q("keydown",d=>{d.key==="Escape"&&me&&(me.classList.remove("active"),me.blur(),me=null,v.postMessage({command:"setSelectedKey",collapseKey:null}))});let X=new Map,L=new Map,Z=new Map;function f(d){let S=d.dataset.originalY;if(Z.has(S))return Z.get(S);let b=JSON.parse(d.dataset.rowContributions||"{}");return Z.set(S,b),b}function ge(){X.clear(),document.querySelectorAll("[data-collapse-key][data-original-y]").forEach(S=>{let b=S.dataset.collapseKey,C=parseFloat(S.dataset.originalY);X.has(b)||X.set(b,{originalY:C,elements:[]}),X.get(b).elements.push(S)})}function U(){L.clear(),document.querySelectorAll("[data-collapse-key][data-parent-key]").forEach(S=>{let b=S.dataset.collapseKey;if(L.has(b))return;let C=[],A=S.dataset.parentKey;for(;A;)C.push(A),A=document.querySelector('[data-collapse-key="'+A+'"]')?.dataset.parentKey||null;L.set(b,C)})}ge(),U();function P(d,S){S?(d.setAttribute("visibility","hidden"),d.classList.add("gantt-row-hidden")):(d.removeAttribute("visibility"),d.classList.remove("gantt-row-hidden"))}function oe(d){let S=[];return L.forEach((b,C)=>{b.includes(d)&&S.push(C)}),S}function he(d){let S=[];return L.forEach((b,C)=>{let A=b.indexOf(d);if(A===-1)return;let l=!0;for(let h=0;h<A;h++){let B=b[h],z=document.querySelector('[data-collapse-key="'+B+'"].project-label, [data-collapse-key="'+B+'"].issue-label, [data-collapse-key="'+B+'"].time-group-label');if(!z||z.dataset.expanded!=="true"){l=!1;break}}l&&S.push(C)}),S}function ye(d,S){let b=document.querySelector('[data-collapse-key="'+d+'"].project-label, [data-collapse-key="'+d+'"].time-group-label, [data-collapse-key="'+d+'"].issue-label');if(!b||b.dataset.hasChildren!=="true")return;let C=b.dataset.expanded==="true",A=S==="expand"?!0:S==="collapse"?!1:!C;if(A===C)return;b.dataset.expanded=A?"true":"false";let l=b.querySelector(".collapse-toggle");l&&l.classList.toggle("expanded",A);let h=oe(d),B=A?he(d):[];if(h.length===0){v.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:A});return}let z=new Set(h),ee=new Set(B),be=X.get(d),re=be?.originalY??0,O=new Set,Be=0,Me=0,qe=A?B:he(d),G=new Set(qe);if(document.querySelectorAll(".zebra-stripe").forEach(y=>{let c=f(y);d in c&&Me===0&&(Me=parseFloat(y.dataset.originalY||"0"));for(let[q,te]of Object.entries(c))G.has(q)&&!O.has(q)&&(Be+=parseFloat(te),O.add(q))}),Be===0&&qe.length>0){v.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:A}),v.postMessage({command:"requestRerender"});return}let m=A?Be:-Be,Te=re;if(be&&be.elements.length>0){let c=(be.elements[0].getAttribute("transform")||"").match(/translate\([^,]+,\s*([-\d.]+)/);c&&(Te=parseFloat(c[1]))}let Ke=Te+J;A?B.forEach(y=>{let c=X.get(y);c&&(c.elements.forEach(q=>{let $=(q.getAttribute("transform")||"").match(/translate\(([-\d.]+)/),ue=$?$[1]:"0";q.setAttribute("transform","translate("+ue+", "+Ke+")"),P(q,!1)}),Ke+=J)}):h.forEach(y=>{let c=X.get(y);c&&c.elements.forEach(q=>{P(q,!0)})}),X.forEach(({originalY:y,elements:c},q)=>{y>re&&!z.has(q)&&c.forEach(te=>{let $=te.getAttribute("transform")||"",ue=$.match(/translate\(([-\d.]+)/),ke=ue?ue[1]:"0",Ce=$.match(/translate\([^,]+,\s*([-\d.]+)/),Re=(Ce?parseFloat(Ce[1]):y)+m;te.setAttribute("transform","translate("+ke+", "+Re+")")})});let $e=document.querySelector(".gantt-labels svg");if($e){let c=parseFloat($e.getAttribute("height")||"0")+m;$e.setAttribute("height",String(c))}[".gantt-col-status svg",".gantt-col-id svg",".gantt-col-start svg",".gantt-col-due svg",".gantt-col-assignee svg"].forEach(y=>{let c=document.querySelector(y);if(!c)return;let te=parseFloat(c.getAttribute("height")||"0")+m;c.setAttribute("height",String(te))});let xe=document.querySelector(".gantt-timeline svg");if(xe){let c=parseFloat(xe.getAttribute("height")||"0")+m;xe.setAttribute("height",c)}let Fe=new Set;document.querySelectorAll('.project-label[data-has-children="true"], .time-group-label[data-has-children="true"], .issue-label[data-has-children="true"]').forEach(y=>{y.dataset.expanded==="false"&&Fe.add(y.dataset.collapseKey)});let Xe=new Map,_e=document.querySelectorAll(".zebra-stripe");_e.forEach(y=>{let c=parseFloat(y.dataset.originalY||"0");if(Xe.has(c))return;let q=f(y),te=Object.keys(q),$=te.length>0&&te.every(Ce=>z.has(Ce)),ue=te.some(Ce=>z.has(Ce)),ke=c>Me;if($)Xe.set(c,{action:"toggle-visibility",hide:!A});else if(ue)if(A){let Ce=0;for(let[Ue,Re]of Object.entries(q))(!z.has(Ue)||ee.has(Ue))&&(Ce+=parseFloat(Re));Xe.set(c,{action:"expand",newHeight:Ce})}else{let Ce=0;for(let[Ue,Re]of Object.entries(q))z.has(Ue)||(Ce+=parseFloat(Re));Xe.set(c,{action:"shrink",newHeight:Ce})}else if(ke){let Ce=parseFloat(y.getAttribute("y")||String(c));Xe.set(c,{action:"shift",newY:Ce+m})}}),_e.forEach(y=>{let c=parseFloat(y.dataset.originalY||"0"),q=Xe.get(c);if(q)switch(q.action){case"toggle-visibility":P(y,q.hide);break;case"shrink":y.setAttribute("height",String(q.newHeight));break;case"expand":y.setAttribute("height",String(q.newHeight));break;case"shift":y.setAttribute("y",String(q.newY));break}});let Se=Array.from(document.querySelectorAll(".zebra-stripe")).filter(y=>y.getAttribute("visibility")!=="hidden"),ze=new Map;Se.forEach(y=>{let c=parseFloat(y.getAttribute("y")||"0");ze.has(c)||ze.set(c,[]),ze.get(c).push(y)}),Array.from(ze.keys()).sort((y,c)=>y-c).forEach((y,c)=>{let q=c%2===0?"0.03":"0.06";ze.get(y).forEach(te=>te.setAttribute("opacity",q))}),document.querySelectorAll(".indent-guide-line").forEach(y=>{let c=y.dataset.forParent,q=L.get(c)||[],te=Fe.has(c)||q.some($=>Fe.has($));if(P(y,te),!te){let $=X.get(c);if($&&$.originalY>re){let ue=parseFloat(y.getAttribute("y1")||"0"),ke=parseFloat(y.getAttribute("y2")||"0");y.setAttribute("y1",ue+m),y.setAttribute("y2",ke+m)}}}),document.querySelectorAll(".dependency-arrow").forEach(y=>{let c=y.dataset.from,q=y.dataset.to,te=document.querySelector('.issue-bar[data-issue-id="'+c+'"]'),$=document.querySelector('.issue-bar[data-issue-id="'+q+'"]'),ue=te?.classList.contains("gantt-row-hidden"),ke=$?.classList.contains("gantt-row-hidden");P(y,ue||ke)}),v.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:A})}if(Ae){let d=_.find(S=>S.dataset.collapseKey===Ae);d&&j(d,!0)}_.forEach((d,S)=>{d.addEventListener("click",b=>{if(b.target.closest?.(".collapse-toggle")||b.target.closest?.(".chevron-hit-area"))return;let C=d.dataset.issueId,A=d.classList.contains("project-label"),l=d.classList.contains("time-group-label"),h=d.dataset.collapseKey;if((A||l)&&h){j(d),d.dataset.hasChildren==="true"&&ye(h);return}let B=b.target.classList?.contains("issue-text")||b.target.closest(".issue-text");C&&B?(j(d,!1,!1,!0),v.postMessage({command:"openIssue",issueId:parseInt(C,10)})):d.dataset.hasChildren==="true"&&h?(j(d),ye(h)):j(d)}),d.addEventListener("keydown",b=>{let C=d.dataset.collapseKey,A=d.dataset.issueId?parseInt(d.dataset.issueId,10):NaN;switch(b.key){case"Enter":case" ":b.preventDefault(),isNaN(A)||v.postMessage({command:"openIssue",issueId:A});break;case"ArrowUp":{b.preventDefault();let l=de(S,-1);l&&j(l.label,!1,!0);break}case"ArrowDown":{b.preventDefault();let l=de(S,1);l&&j(l.label,!1,!0);break}case"ArrowLeft":if(b.preventDefault(),d.dataset.hasChildren==="true"&&d.dataset.expanded==="true")ye(C,"collapse");else if(d.dataset.parentKey){let l=_.find(h=>h.dataset.collapseKey===d.dataset.parentKey);l&&j(l,!1,!0)}break;case"ArrowRight":if(b.preventDefault(),d.dataset.hasChildren==="true"&&d.dataset.expanded==="false")ye(C,"expand");else if(d.dataset.hasChildren==="true"&&d.dataset.expanded==="true"){let l=_.find(h=>h.dataset.parentKey===C&&Ie(h));l&&j(l,!1,!0)}break;case"Home":{b.preventDefault();let l=de(-1,1);l&&j(l.label,!1,!0);break}case"End":{b.preventDefault();let l=de(_.length,-1);l&&j(l.label,!1,!0);break}case"PageDown":{b.preventDefault();let l=S,h=0;for(;h<10&&l<_.length-1;){let B=de(l,1);if(!B)break;l=B.index,h++}h>0&&j(_[l],!1,!0);break}case"PageUp":{b.preventDefault();let l=S,h=0;for(;h<10&&l>0;){let B=de(l,-1);if(!B)break;l=B.index,h++}h>0&&j(_[l],!1,!0);break}case"Tab":if(!b.shiftKey&&!isNaN(A)){let l=document.querySelector(`.issue-bar[data-issue-id="${A}"]`);l&&(b.preventDefault(),l.focus(),fe(`Timeline bar for issue #${A}`))}break}})})}function wt(E){let{vscode:v,addDocListener:Q,menuUndo:Y,menuRedo:fe,undoStack:J,redoStack:ae,saveState:_,updateUndoRedoButtons:me,announce:Ae,scrollToAndHighlight:Ie,scrollToToday:de}=E;Q("keydown",f=>{let U=navigator.platform.toUpperCase().indexOf("MAC")>=0?f.metaKey:f.ctrlKey;if(!(f.target.tagName==="INPUT"||f.target.tagName==="SELECT"||f.target.tagName==="TEXTAREA"))if(U&&f.key==="z"&&!f.shiftKey)f.preventDefault(),Y?.click();else if(U&&f.key==="z"&&f.shiftKey)f.preventDefault(),fe?.click();else if(U&&f.key==="y")f.preventDefault(),fe?.click();else if(f.key>="1"&&f.key<="5"){let P=document.getElementById("zoomSelect"),oe=["day","week","month","quarter","year"];P.value=oe[parseInt(f.key)-1],P.dispatchEvent(new Event("change"))}else if(f.key.toLowerCase()==="h")document.getElementById("menuHeatmap")?.click();else if(f.key.toLowerCase()==="y")document.getElementById("menuCapacity")?.click();else if(f.key.toLowerCase()==="i")document.getElementById("menuIntensity")?.click();else if(f.key.toLowerCase()==="d")document.getElementById("menuDeps")?.click();else if(f.key.toLowerCase()==="v"){let P=document.getElementById("viewFocusSelect");P.value=P.value==="project"?"person":"project",P.dispatchEvent(new Event("change"))}else if(f.key.toLowerCase()==="r")document.getElementById("refreshBtn")?.click();else if(f.key.toLowerCase()==="t")de();else if(f.key.toLowerCase()==="e")document.getElementById("menuExpand")?.click();else if(f.key.toLowerCase()==="c"&&!U)document.getElementById("menuCollapse")?.click();else if(f.key.toLowerCase()==="f"&&!U)f.preventDefault(),document.getElementById("menuFilterHealth")?.click();else if(f.key.toLowerCase()==="b"){f.preventDefault();let P=Array.from(document.querySelectorAll(".issue-bar[data-issue-id]")).filter(S=>S.querySelector(".blocker-badge"));if(P.length===0){Ae("No blocked issues");return}let oe=document.activeElement?.closest(".issue-bar"),ye=((oe?P.indexOf(oe):-1)+1)%P.length,d=P[ye];Ie(d.dataset.issueId),d.focus(),Ae("Blocked issue "+(ye+1)+" of "+P.length)}else if(f.key==="ArrowLeft"||f.key==="ArrowRight"){let P=document.activeElement?.closest(".issue-bar:not(.parent-bar)");if(!P)return;f.preventDefault();let oe=parseInt(P.dataset.issueId),he=P.dataset.startDate,ye=P.dataset.dueDate;if(!he&&!ye)return;let d=f.key==="ArrowRight"?1:-1,S=(A,l)=>{let h=new Date(A+"T00:00:00");return h.setDate(h.getDate()+l),h.toISOString().slice(0,10)},b=null,C=null;f.shiftKey&&ye?C=S(ye,d):f.altKey&&he?b=S(he,d):(he&&(b=S(he,d)),ye&&(C=S(ye,d))),(b||C)&&(_(),J.push({issueId:oe,oldStartDate:b?he:null,oldDueDate:C?ye:null,newStartDate:b,newDueDate:C}),ae.length=0,me(),v.postMessage({command:"updateDates",issueId:oe,startDate:b,dueDate:C}))}else f.key==="/"&&!U?(f.preventDefault(),j()):(f.key==="?"||f.shiftKey&&f.key==="/")&&(f.preventDefault(),Z())});let W=null;function j(){W&&W.remove(),W=document.createElement("div"),W.className="quick-search",W.innerHTML=`
      <input type="text" placeholder="Search issues..." autofocus />
    `,document.body.appendChild(W);let f=W.querySelector("input");f.focus();let ge=Array.from(document.querySelectorAll(".issue-label"));f.addEventListener("input",()=>{let U=f.value.toLowerCase();ge.forEach(P=>{let oe=P.getAttribute("aria-label")?.toLowerCase()||"",he=U&&oe.includes(U);P.classList.toggle("search-match",he)})}),f.addEventListener("keydown",U=>{if(U.key==="Escape")X();else if(U.key==="Enter"){let P=document.querySelector(".issue-label.search-match");P&&(X(),P.focus(),Ie(P.dataset.issueId))}}),f.addEventListener("blur",()=>setTimeout(X,150))}function X(){W&&(W.remove(),W=null,document.querySelectorAll(".search-match").forEach(f=>f.classList.remove("search-match")))}let L=null;function Z(){if(L){L.remove(),L=null;return}L=document.createElement("div"),L.className="keyboard-help",L.innerHTML=`
      <div class="keyboard-help-content">
        <h3>Keyboard Shortcuts</h3>
        <div class="shortcut-grid">
          <div class="shortcut-section">
            <h4>Navigation</h4>
            <div><kbd>\u2191</kbd><kbd>\u2193</kbd> Move between issues</div>
            <div><kbd>Home</kbd><kbd>End</kbd> First/last issue</div>
            <div><kbd>PgUp</kbd><kbd>PgDn</kbd> Jump 10 rows</div>
            <div><kbd>Tab</kbd> Label \u2192 Bar</div>
            <div><kbd>Shift+Tab</kbd> Bar \u2192 Label</div>
          </div>
          <div class="shortcut-section">
            <h4>Date Editing</h4>
            <div><kbd>\u2190</kbd><kbd>\u2192</kbd> Move bar \xB11 day</div>
            <div><kbd>Shift+\u2190/\u2192</kbd> Resize end</div>
            <div><kbd>Alt+\u2190/\u2192</kbd> Resize start</div>
            <div><kbd>Ctrl+Z</kbd> Undo</div>
            <div><kbd>Ctrl+Y</kbd> Redo</div>
          </div>
          <div class="shortcut-section">
            <h4>View</h4>
            <div><kbd>1-5</kbd> Zoom levels</div>
            <div><kbd>H</kbd> Heatmap</div>
            <div><kbd>D</kbd> Dependencies</div>
            <div><kbd>C</kbd> Critical path</div>
            <div><kbd>T</kbd> Today</div>
          </div>
          <div class="shortcut-section">
            <h4>Health & Other</h4>
            <div><kbd>F</kbd> Cycle health filter</div>
            <div><kbd>B</kbd> Next blocked issue</div>
            <div><kbd>/</kbd> Quick search</div>
            <div><kbd>S</kbd> Cycle sort</div>
            <div><kbd>R</kbd> Refresh</div>
            <div><kbd>Esc</kbd> Clear/cancel</div>
          </div>
        </div>
        <p class="keyboard-help-close">Press <kbd>?</kbd> or <kbd>Esc</kbd> to close</p>
      </div>
    `,document.body.appendChild(L),L.addEventListener("click",f=>{f.target===L&&Z()})}Q("keydown",f=>{f.key==="Escape"&&L&&(f.stopImmediatePropagation(),Z())})}var ne=acquireVsCodeApi(),tt=!1;function Qe(E){tt&&typeof performance<"u"&&performance.mark(E)}function ct(E,v,Q){if(tt&&typeof performance<"u")try{performance.measure(E,v,Q);let Y=performance.getEntriesByName(E,"measure");Y.length>0&&console.log(`[Gantt Perf] ${E}: ${Y[Y.length-1].duration.toFixed(2)}ms`),performance.clearMarks(v),performance.clearMarks(Q),performance.clearMeasures(E)}catch{}}function Et(){if(tt){let E=document.getElementById("ganttRoot"),v=E?E.querySelectorAll("*").length:0,Q=E?E.querySelectorAll("svg *").length:0;console.log(`[Gantt Perf] DOM nodes: ${v}, SVG elements: ${Q}`)}}function Lt(E){if(!E)return;let v=document.documentElement;v.style.setProperty("--gantt-header-height",`${E.headerHeight}px`),v.style.setProperty("--gantt-label-width",`${E.labelWidth}px`),v.style.setProperty("--gantt-id-column-width",`${E.idColumnWidth}px`),v.style.setProperty("--gantt-start-date-column-width",`${E.startDateColumnWidth}px`),v.style.setProperty("--gantt-status-column-width",`${E.statusColumnWidth}px`),v.style.setProperty("--gantt-due-date-column-width",`${E.dueDateColumnWidth}px`),v.style.setProperty("--gantt-assignee-column-width",`${E.assigneeColumnWidth}px`),v.style.setProperty("--gantt-sticky-left-width",`${E.stickyLeftWidth}px`)}function Dt({addDocListener:E,addWinListener:v}){let Q=document.getElementById("ganttRoot"),Y=document.getElementById("ganttTooltip"),fe=Y?.querySelector(".gantt-tooltip-content");if(!Q||!Y||!fe)return;let J=l=>l?String(l).replace(/\r\n/g,`
`).trimEnd():"";function ae(){Q.querySelectorAll("svg title").forEach(l=>{let h=l.parentElement,B=J(l.textContent);h&&B&&(h.dataset.tooltip=B),l.remove()})}function _(){Q.querySelectorAll("[title]").forEach(l=>{if(l.tagName.toLowerCase()==="title")return;let h=J(l.getAttribute("title"));l.removeAttribute("title"),h&&(l.dataset.tooltip=h)})}function me(){Q.querySelectorAll("[data-toolbar-tooltip]").forEach(l=>{let h=J(l.dataset.toolbarTooltip);delete l.dataset.toolbarTooltip,h&&(l.dataset.tooltip=h)})}function Ae(){ae(),_(),me()}function Ie(l){let h=l.findIndex(z=>z.trim().startsWith("#"));return h>=0?h:l.filter(z=>z.trim()).length>1?l.findIndex(z=>z.trim()):-1}function de(l){fe.textContent="";let h=J(l);if(!h)return;let B=h.split(`
`),z=Ie(B),ee=!1;B.forEach((re,O)=>{let Be=re.trim();if(!Be){if(!ee){let G=document.createElement("div");G.className="gantt-tooltip-spacer",fe.appendChild(G),ee=!0}return}if(Be==="---"){let G=document.createElement("div");G.className="gantt-tooltip-divider",fe.appendChild(G),ee=!1;return}let Me=Be.match(/^cf:([^:]+):(.*)$/);if(Me){let G=Me[1].trim(),m=Me[2].trim(),Te=document.createElement("div");Te.className="gantt-tooltip-line";let Ke=document.createElement("span");Ke.className="gantt-tooltip-key",Ke.textContent=`${G}: `,Te.appendChild(Ke),m&&Te.appendChild(document.createTextNode(m)),fe.appendChild(Te),ee=!1;return}let Pe=document.createElement("div");Pe.className="gantt-tooltip-line",O===z&&Pe.classList.add("gantt-tooltip-title");let qe=Be.match(/^Open in Browser:\s*(\S+)/);if(qe&&/^https?:\/\//i.test(qe[1])){Pe.appendChild(document.createTextNode("Open in Browser: "));let G=document.createElement("a");G.href=qe[1],G.textContent=qe[1],G.target="_blank",G.rel="noopener noreferrer",Pe.appendChild(G)}else Pe.textContent=re;fe.appendChild(Pe),ee=!1});let be=fe.lastElementChild;be&&be.classList.contains("gantt-tooltip-spacer")&&be.remove()}let W=null,j=null,X=null,L={x:0,y:0};function Z(l){L={x:l.clientX,y:l.clientY}}function f(){j&&(clearTimeout(j),j=null)}function ge(){X&&(clearTimeout(X),X=null)}function U(l){return l&&(l===Y||Y.contains(l))}function P(l){return l&&W&&(l===W||W.contains(l))}function oe(){if(!L)return!1;let l=document.elementFromPoint(L.x,L.y);return U(l)||P(l)}let he=300;function ye(l){ge(),X=setTimeout(()=>{X=null,!(!W||W!==l)&&oe()&&b(l,L.x,L.y)},he)}function d(){f(),j=setTimeout(()=>{W&&(oe()||C())},300)}function S(l,h){let ee=Y.getBoundingClientRect(),be=l+8,re=h+8;be+ee.width>window.innerWidth-8&&(be=l-ee.width-8),re+ee.height>window.innerHeight-8&&(re=h-ee.height-8),be=Math.max(8,Math.min(be,window.innerWidth-ee.width-8)),re=Math.max(8,Math.min(re,window.innerHeight-ee.height-8)),Y.style.left=`${Math.round(be)}px`,Y.style.top=`${Math.round(re)}px`}function b(l,h,B){let z=l.dataset.tooltip;z&&(de(z),Y.classList.add("visible"),Y.setAttribute("aria-hidden","false"),S(h,B))}function C(l=!1){ge(),f(),Y.classList.remove("visible"),Y.setAttribute("aria-hidden","true"),l||(W=null)}function A(l){if(!l||l===Y||Y.contains(l))return null;let h=l.closest?.("[data-tooltip], [title]");if(!h||!Q.contains(h))return null;if(h.hasAttribute("title")){let B=J(h.getAttribute("title"));h.removeAttribute("title"),B&&(h.dataset.tooltip=B)}return h.dataset.tooltip?h:null}Ae(),E("pointerover",l=>{if(Z(l),U(l.target)){f(),ge();return}let h=A(l.target);if(!h){ge();return}f(),W!==h?(W=h,Y.classList.contains("visible")&&C(!0),ye(h)):Y.classList.contains("visible")||ye(h)},!0),E("pointermove",l=>{W&&(Z(l),j&&oe()&&f())},!0),E("pointerout",l=>{if(!W||(Z(l),ge(),!P(l.target)&&!U(l.target)))return;let h=l.relatedTarget;U(h)||P(h)||d()},!0),E("scroll",()=>{W&&C()},!0),E("keydown",()=>{W&&C()},!0),v("blur",()=>{W&&C()})}function kt(E){if(!E)return;E.state&&(tt=E.state.perfDebug??!1),Qe("render-start");let v=document.getElementById("ganttRoot");v&&(Lt(E.state),Qe("innerHTML-start"),v.innerHTML=E.html||"",Qe("innerHTML-end"),ct("innerHTML","innerHTML-start","innerHTML-end"),At(E.state),Qe("render-end"),ct("render","render-start","render-end"),Et())}window.addEventListener("message",E=>{let v=E.data;if(v){if(v.command==="render"){kt(v.payload);return}window.__ganttHandleExtensionMessage&&window.__ganttHandleExtensionMessage(v)}});var St=window.__GANTT_INITIAL_PAYLOAD__;St&&kt(St);ne.postMessage({command:"webviewReady"});function At(E){if(Qe("initializeGantt-start"),!E)return;let{timelineWidth:v,minDateMs:Q,maxDateMs:Y,totalDays:fe,extendedRelationTypes:J,redmineBaseUrl:ae,minimapBarsData:_,minimapHeight:me,minimapBarHeight:Ae,minimapTodayX:Ie,extScrollLeft:de,extScrollTop:W,labelWidth:j,leftExtrasWidth:X,healthFilter:L,sortBy:Z,sortOrder:f,selectedCollapseKey:ge,barHeight:U,todayX:P,todayInRange:oe,isDraftMode:he,draftQueueCount:ye}=E,d=v/fe,S=he,b=document.getElementById("dragConfirmOk");b&&(b.textContent=he?"Queue to Draft":"Save to Redmine");let C=document.getElementById("draftBadge");if(C){if(he){C.classList.remove("hidden");let e=ye??0;C.textContent=e,C.dataset.tooltip=e===1?"1 change queued - click to review":e+" changes queued - click to review"}else C.classList.add("hidden");C.addEventListener("click",()=>{ne.postMessage({command:"openDraftReview"})})}let A=document.getElementById("draftModeToggle");A&&A.addEventListener("click",()=>{ne.postMessage({command:"toggleDraftMode"})}),window._ganttCleanup&&window._ganttCleanup();let l=[],h=[];function B(e,s,a){document.addEventListener(e,s,a),l.push({type:e,handler:s,options:a})}function z(e,s,a){window.addEventListener(e,s,a),h.push({type:e,handler:s,options:a})}window._ganttCleanup=()=>{l.forEach(e=>document.removeEventListener(e.type,e.handler,e.options)),h.forEach(e=>window.removeEventListener(e.type,e.handler,e.options)),window.__ganttHandleExtensionMessage=null};function ee(e){setTimeout(()=>{document.addEventListener("click",function s(a){e.contains(a.target)||(e.remove(),document.removeEventListener("click",s))})},0)}function be(e){return Math.round(e/d)*d}function re(e){let s=document.getElementById("liveRegion");s&&(s.textContent=e)}let O=document.getElementById("ganttScroll"),Be=document.getElementById("ganttLeftHeader"),Me=document.getElementById("ganttLabels"),Pe=document.getElementById("ganttTimeline"),qe=document.getElementById("menuUndo"),G=document.getElementById("menuRedo"),m=document.getElementById("minimapSvg"),Te=document.getElementById("minimapViewport"),{updateMinimapPosition:Ke,updateMinimapViewport:$e}=yt({timelineWidth:v,minimapBarsData:_,minimapHeight:me,minimapBarHeight:Ae,minimapTodayX:Ie,ganttScroll:O,minimapSvg:m,minimapViewport:Te,addDocListener:B}),He=ne.getState()||{undoStack:[],redoStack:[],labelWidth:j,scrollLeft:null,scrollTop:null,centerDateMs:null},xe=He.undoStack||[],Fe=He.redoStack||[],Xe=He.scrollLeft??(de>0?de:null),_e=He.scrollTop??(W>0?W:null),Se=He.centerDateMs;function ze(){if(!O)return null;let s=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,a=O.clientWidth-s,p=(O.scrollLeft+a/2)/v;return Q+p*(Y-Q)}function Ne(e){if(!O)return;let a=(e-Q)/(Y-Q)*v,p=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,ce=O.clientWidth-p;O.scrollLeft=Math.max(0,a-ce/2)}function y(){ne.setState({undoStack:xe,redoStack:Fe,labelWidth:Me?.offsetWidth||j,scrollLeft:null,scrollTop:O?.scrollTop??null,centerDateMs:ze()})}let c=y;function q(){qe&&qe.toggleAttribute("disabled",xe.length===0),G&&G.toggleAttribute("disabled",Fe.length===0),y()}if(He.labelWidth&&Be&&Me){Be.style.width=He.labelWidth+"px",Me.style.width=He.labelWidth+"px";let e=document.querySelector(".capacity-ribbon-label");e&&(e.style.width=He.labelWidth+X+"px")}let te=!0,$=!1,ue=e=>{$=e},ke=null;O&&O.addEventListener("scroll",()=>{cancelAnimationFrame(ke),ke=requestAnimationFrame(()=>{$e(),te||y()})},{passive:!0}),requestAnimationFrame(()=>q()),window.__ganttHandleExtensionMessage=e=>{if(e.command==="setHeatmapState"){let s=document.querySelector(".heatmap-layer"),a=document.querySelector(".weekend-layer"),u=document.getElementById("menuHeatmap");e.enabled?(s&&s.classList.remove("hidden"),a&&a.classList.add("hidden"),u&&u.classList.add("active")):(s&&s.classList.add("hidden"),a&&a.classList.remove("hidden"),u&&u.classList.remove("active"))}else if(e.command==="setDependenciesState"){let s=document.querySelector(".dependency-layer"),a=document.getElementById("menuDeps");e.enabled?(s&&s.classList.remove("hidden"),a&&a.classList.add("active")):(s&&s.classList.add("hidden"),a&&a.classList.remove("active"))}else if(e.command==="setCapacityRibbonState"){let s=document.querySelector(".capacity-ribbon"),a=document.getElementById("menuCapacity");e.enabled?(s&&s.classList.remove("hidden"),a&&a.classList.add("active")):(s&&s.classList.add("hidden"),a&&a.classList.remove("active"))}else if(e.command==="setIntensityState"){let s=document.querySelector(".gantt-container"),a=document.getElementById("menuIntensity");e.enabled?(s?.classList.add("intensity-enabled"),a&&a.classList.add("active")):(s?.classList.remove("intensity-enabled"),a&&a.classList.remove("active"))}else if(e.command==="setDraftModeState"){S=e.enabled;let s=document.getElementById("dragConfirmOk");s&&(s.textContent=e.enabled?"Queue to Draft":"Save to Redmine");let a=document.getElementById("draftModeToggle");a&&(a.classList.toggle("active",e.enabled),a.textContent=e.enabled?"Disable Draft Mode":"Enable Draft Mode");let u=document.getElementById("draftBadge");if(u)if(e.enabled){u.classList.remove("hidden");let p=e.queueCount??0;u.textContent=p,u.dataset.tooltip=p===1?"1 change queued - click to review":p+" changes queued - click to review"}else u.classList.add("hidden")}else if(e.command==="setDraftQueueCount"){let s=document.getElementById("draftBadge");if(s){let a=e.count;s.textContent=a,s.dataset.tooltip=a===1?"1 change queued - click to review":a+" changes queued - click to review"}}else if(e.command==="pushUndoAction")xe.push(e.action),Fe.length=0,q(),y();else if(e.command==="updateRelationId"){let s=e.stack==="undo"?xe:Fe;if(s.length>0){let a=s[s.length-1];a.type==="relation"&&(a.relationId=e.newRelationId,y())}}else if(e.command==="scrollToIssue"){let s=e.issueId,a=document.querySelector('.issue-label[data-issue-id="'+s+'"]'),u=document.querySelector('.issue-bar[data-issue-id="'+s+'"]'),p=document.getElementById("ganttScroll"),se=document.querySelector(".gantt-header-row")?.getBoundingClientRect().height||60;if(!p)return;let De=p.scrollTop,we=p.scrollLeft;if(a){let Ye=a.closest(".gantt-row");if(Ye){let ot=Ye.offsetTop,je=Ye.getBoundingClientRect().height,Ve=p.clientHeight-se;De=Math.max(0,ot-se-(Ve-je)/2)}a.focus(),a.classList.add("highlighted"),setTimeout(()=>a.classList.remove("highlighted"),2e3)}if(u){let Ye=parseFloat(u.getAttribute("data-start-x")||"0"),je=parseFloat(u.getAttribute("data-end-x")||"0")-Ye,Ve=p.clientWidth,et=document.querySelector(".gantt-sticky-left")?.getBoundingClientRect().width||0,pt=Ve-et;je<=pt-100?we=Ye-(pt-je)/2:we=Ye-50,we=Math.max(0,we),u.classList.add("highlighted"),setTimeout(()=>u.classList.remove("highlighted"),2e3)}p.scrollTo({left:we,top:De,behavior:"smooth"})}},document.getElementById("lookbackSelect")?.addEventListener("change",e=>{ne.postMessage({command:"setLookback",years:e.target.value})}),document.getElementById("zoomSelect")?.addEventListener("change",e=>{c(),ne.postMessage({command:"setZoom",zoomLevel:e.target.value})}),document.getElementById("viewFocusSelect")?.addEventListener("change",e=>{ne.postMessage({command:"setViewFocus",focus:e.target.value})}),document.getElementById("projectSelector")?.addEventListener("change",e=>{let s=e.target.value,a=s?parseInt(s,10):null;ne.postMessage({command:"setSelectedProject",projectId:a})}),document.getElementById("focusSelector")?.addEventListener("change",e=>{let s=e.target.value;ne.postMessage({command:"setSelectedAssignee",assignee:s||null})}),document.getElementById("filterAssignee")?.addEventListener("change",e=>{let s=e.target.value;ne.postMessage({command:"setFilter",filter:{assignee:s}})}),document.getElementById("filterStatus")?.addEventListener("change",e=>{let s=e.target.value;ne.postMessage({command:"setFilter",filter:{status:s}})}),document.getElementById("menuFilterHealth")?.addEventListener("click",()=>{let e=["all","critical","warning","healthy"],s=L,u=(e.indexOf(s)+1)%e.length;ne.postMessage({command:"setHealthFilter",health:e[u]})}),document.querySelectorAll(".gantt-col-header.sortable").forEach(e=>{e.addEventListener("click",()=>{let s=e.dataset.sort;s===Z?f==="asc"?ne.postMessage({command:"setSort",sortOrder:"desc"}):ne.postMessage({command:"setSort",sortBy:null}):ne.postMessage({command:"setSort",sortBy:s,sortOrder:"asc"})})}),document.getElementById("menuHeatmap")?.addEventListener("click",()=>{document.getElementById("menuHeatmap")?.hasAttribute("disabled")||(y(),ne.postMessage({command:"toggleWorkloadHeatmap"}))}),document.getElementById("menuCapacity")?.addEventListener("click",()=>{document.getElementById("menuCapacity")?.hasAttribute("disabled")||(y(),ne.postMessage({command:"toggleCapacityRibbon"}))}),document.getElementById("menuIntensity")?.addEventListener("click",()=>{document.getElementById("menuIntensity")?.hasAttribute("disabled")||(y(),ne.postMessage({command:"toggleIntensity"}))}),document.getElementById("overloadBadge")?.addEventListener("click",e=>{e.stopPropagation();let s=e.currentTarget,a=parseInt(s.dataset.firstOverloadMs||"0",10);a>0&&(Ne(a),y())}),document.querySelectorAll(".capacity-day-bar-group").forEach(e=>{e.addEventListener("click",s=>{let a=parseInt(s.currentTarget.dataset.dateMs||"0",10);a>0&&(Ne(a),y())})}),document.getElementById("menuDeps")?.addEventListener("click",()=>{y(),ne.postMessage({command:"toggleDependencies"})});let Re=document.querySelector(".gantt-container");function st(){let e=new Map,s=new Map;return document.querySelectorAll(".dependency-arrow").forEach(a=>{if(!(a.classList.contains("rel-blocks")||a.classList.contains("rel-precedes")))return;let p=a.dataset.from,ce=a.dataset.to;e.has(p)||e.set(p,[]),e.get(p).push(ce),s.has(ce)||s.set(ce,[]),s.get(ce).push(p)}),{graph:e,reverseGraph:s}}let ve=null;function nt(e,s,a){let u=new Set([e]),p=[e];for(;p.length>0;){let se=p.shift(),De=s.get(se)||[];for(let we of De)u.has(we)||(u.add(we),p.push(we))}let ce=[e];for(;ce.length>0;){let se=ce.shift(),De=a.get(se)||[];for(let we of De)u.has(we)||(u.add(we),ce.push(we))}return u}function Je(e){if(Ze(),!e)return;ve=e;let{graph:s,reverseGraph:a}=st(),u=nt(e,s,a);Re.classList.add("focus-mode"),document.querySelectorAll(".issue-bar").forEach(p=>{u.has(p.dataset.issueId)&&p.classList.add("focus-highlighted")}),document.querySelectorAll(".issue-label").forEach(p=>{u.has(p.dataset.issueId)&&p.classList.add("focus-highlighted")}),document.querySelectorAll(".dependency-arrow").forEach(p=>{u.has(p.dataset.from)&&u.has(p.dataset.to)&&p.classList.add("focus-highlighted")}),re(`Focus: ${u.size} issue${u.size!==1?"s":""} in dependency chain`)}function Ze(){ve=null,Re.classList.remove("focus-mode"),document.querySelectorAll(".focus-highlighted").forEach(e=>e.classList.remove("focus-highlighted"))}let Ge=()=>ve,t=new Set,o=null,n=document.getElementById("selectionCount"),i=Array.from(document.querySelectorAll(".issue-bar")),r=new Map;i.forEach(e=>{let s=e.dataset.issueId;s&&(r.has(s)||r.set(s,[]),r.get(s).push(e))});function D(e){e.forEach(s=>{let a=r.get(s);a&&a.forEach(u=>u.classList.toggle("selected",t.has(s)))}),t.size>0?(n.textContent=`${t.size} selected`,n.classList.remove("hidden"),Re.classList.add("multi-select-mode")):(n.classList.add("hidden"),Re.classList.remove("multi-select-mode"))}function k(){i.forEach(e=>{e.classList.toggle("selected",t.has(e.dataset.issueId))}),t.size>0?(n.textContent=`${t.size} selected`,n.classList.remove("hidden"),Re.classList.add("multi-select-mode")):(n.classList.add("hidden"),Re.classList.remove("multi-select-mode"))}function w(){let e=[...t];t.clear(),o=null,D(e)}function F(e){t.has(e)?t.delete(e):t.add(e),o=e,D([e])}function I(e,s){let a=i.findIndex(De=>De.dataset.issueId===e),u=i.findIndex(De=>De.dataset.issueId===s);if(a===-1||u===-1)return;let p=Math.min(a,u),ce=Math.max(a,u),se=[];for(let De=p;De<=ce;De++){let we=i[De].dataset.issueId;t.has(we)||(t.add(we),se.push(we))}D(se)}function T(){i.forEach(e=>t.add(e.dataset.issueId)),k(),re(`Selected all ${t.size} issues`)}i.forEach(e=>{e.addEventListener("mousedown",s=>{if(!s.ctrlKey&&!s.metaKey&&!s.shiftKey||s.target.classList.contains("drag-handle")||s.target.classList.contains("link-handle"))return;s.preventDefault(),s.stopPropagation();let a=e.dataset.issueId;s.shiftKey&&o?I(o,a):F(a)})}),B("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="a"&&(e.preventDefault(),T()),e.key==="Escape"&&t.size>0&&(e.stopImmediatePropagation(),w(),re("Selection cleared"))}),document.getElementById("refreshBtn")?.addEventListener("click",()=>{document.getElementById("loadingOverlay")?.classList.add("visible"),ne.postMessage({command:"refresh"})}),document.getElementById("draftBadge")?.addEventListener("click",()=>{ne.postMessage({command:"openDraftReview"})});function g(e,s,a,u,p,ce){document.querySelector(".relation-picker")?.remove();let se=document.createElement("div");se.className="relation-picker";let De=150,we=120,Ye=Math.min(e,window.innerWidth-De-10),ot=Math.min(s,window.innerHeight-we-10);se.style.left=Math.max(10,Ye)+"px",se.style.top=Math.max(10,ot)+"px";let je=document.createElement("div");if(je.style.padding="6px 12px",je.style.fontSize="11px",je.style.opacity="0.7",je.textContent=`#${u} \u2192 #${p}`,se.appendChild(je),ce==="precedes"||ce==="follows"){let et=document.createElement("button");et.textContent="Update delay...",et.addEventListener("click",()=>{se.remove(),ne.postMessage({command:"updateRelationDelay",relationId:a,fromId:u,toId:p})}),se.appendChild(et)}let Ve=document.createElement("button");Ve.textContent="Delete relation",Ve.addEventListener("click",()=>{y(),ne.postMessage({command:"deleteRelation",relationId:a}),se.remove()}),se.appendChild(Ve),document.body.appendChild(se),ee(se)}let M=new Map,H=new Map,V=new Map,ie=new Map,pe=new Map,K=!1;function Le(){document.querySelectorAll(".issue-bar").forEach(e=>{let s=e.dataset.issueId;s&&(M.has(s)||M.set(s,[]),M.get(s).push(e))}),document.querySelectorAll(".issue-label").forEach(e=>{let s=e.dataset.issueId;s&&(H.has(s)||H.set(s,[]),H.get(s).push(e))}),document.querySelectorAll(".dependency-arrow").forEach(e=>{let s=e.dataset.from,a=e.dataset.to;s&&(V.has(s)||V.set(s,[]),V.get(s).push(e)),a&&(V.has(a)||V.set(a,[]),V.get(a).push(e))}),document.querySelectorAll(".project-label").forEach(e=>{let s=e.dataset.collapseKey;s&&(ie.has(s)||ie.set(s,[]),ie.get(s).push(e))}),document.querySelectorAll(".aggregate-bars").forEach(e=>{let s=e.dataset.collapseKey;s&&(pe.has(s)||pe.set(s,[]),pe.get(s).push(e))}),K=!0}typeof requestIdleCallback<"u"?requestIdleCallback(()=>Le(),{timeout:100}):setTimeout(Le,0);let le=[];function Ee(){document.body.classList.remove("hover-focus","dependency-hover"),le.forEach(e=>e.classList.remove("hover-highlighted","hover-source")),le=[]}function R(e){document.body.classList.add("hover-focus");let s=K?M.get(e)||[]:document.querySelectorAll('.issue-bar[data-issue-id="'+e+'"]'),a=K?H.get(e)||[]:document.querySelectorAll('.issue-label[data-issue-id="'+e+'"]'),u=K?V.get(e)||[]:document.querySelectorAll('.dependency-arrow[data-from="'+e+'"], .dependency-arrow[data-to="'+e+'"]');s.forEach(p=>{p.classList.add("hover-highlighted"),le.push(p)}),a.forEach(p=>{p.classList.add("hover-highlighted"),le.push(p)}),u.forEach(p=>{p.classList.add("hover-highlighted"),le.push(p)})}function x(e){document.body.classList.add("hover-focus");let s=K?ie.get(e)||[]:document.querySelectorAll('.project-label[data-collapse-key="'+e+'"]'),a=K?pe.get(e)||[]:document.querySelectorAll('.aggregate-bars[data-collapse-key="'+e+'"]');s.forEach(u=>{u.classList.add("hover-highlighted"),le.push(u)}),a.forEach(u=>{u.classList.add("hover-highlighted"),le.push(u)})}let N=document.querySelector(".gantt-timeline svg"),We=document.querySelector(".gantt-labels svg");if(N&&(N.addEventListener("mouseenter",e=>{let s=e.target.closest(".issue-bar"),a=e.target.closest(".aggregate-bars"),u=e.target.closest(".dependency-arrow");if(s){let p=s.dataset.issueId;p&&R(p)}else if(a){let p=a.dataset.collapseKey;p&&x(p)}else if(u){let p=u.dataset.from,ce=u.dataset.to;document.body.classList.add("dependency-hover"),u.classList.add("hover-source"),le.push(u),p&&R(p),ce&&R(ce)}},!0),N.addEventListener("mouseleave",e=>{let s=e.target.closest(".issue-bar"),a=e.target.closest(".aggregate-bars"),u=e.target.closest(".dependency-arrow");(s||a||u)&&Ee()},!0)),We&&(We.addEventListener("mouseenter",e=>{let s=e.target.closest(".issue-label"),a=e.target.closest(".project-label");if(s){let u=s.dataset.issueId;u&&R(u)}else if(a){let u=a.dataset.collapseKey;u&&x(u)}},!0),We.addEventListener("mouseleave",e=>{let s=e.target.closest(".issue-label"),a=e.target.closest(".project-label");(s||a)&&Ee()},!0)),N){let s=function(){document.querySelectorAll(".dependency-arrow.selected").forEach(a=>a.classList.remove("selected")),document.body.classList.remove("arrow-selection-mode"),document.querySelectorAll(".arrow-connected").forEach(a=>a.classList.remove("arrow-connected")),e=null};var It=s;N.addEventListener("mousedown",a=>{if(a.button!==2)return;let u=a.target.closest(".dependency-arrow");if(!u)return;let p=u.querySelector("title");p&&p.remove()}),N.addEventListener("contextmenu",a=>{let u=a.target.closest(".dependency-arrow");if(!u)return;a.preventDefault();let p=parseInt(u.dataset.relationId),ce=u.dataset.from,se=u.dataset.to,De=[...u.classList].find(Ye=>Ye.startsWith("rel-")),we=De?De.replace("rel-",""):null;g(a.clientX,a.clientY,p,ce,se,we)});let e=null;N.addEventListener("click",a=>{let u=a.target.closest(".dependency-arrow");if(e&&(e.classList.remove("selected"),document.body.classList.remove("arrow-selection-mode"),document.querySelectorAll(".arrow-connected").forEach(se=>se.classList.remove("arrow-connected")),e=null),!u)return;a.stopPropagation(),e=u,u.classList.add("selected"),document.body.classList.add("arrow-selection-mode");let p=u.dataset.from,ce=u.dataset.to;document.querySelectorAll(`.issue-bar[data-issue-id="${p}"], .issue-bar[data-issue-id="${ce}"]`).forEach(se=>se.classList.add("arrow-connected")),document.querySelectorAll(`.issue-label[data-issue-id="${p}"], .issue-label[data-issue-id="${ce}"]`).forEach(se=>se.classList.add("arrow-connected")),re(`Selected relation from #${p} to #${ce}`)}),window._ganttArrowClickHandler&&document.removeEventListener("click",window._ganttArrowClickHandler),window._ganttArrowClickHandler=a=>{(e||document.querySelector(".dependency-arrow.selected"))&&!a.target.closest(".dependency-arrow")&&!a.target.closest(".blocks-badge-group")&&!a.target.closest(".blocker-badge")&&s()},document.addEventListener("click",window._ganttArrowClickHandler),window._ganttArrowKeyHandler&&document.removeEventListener("keydown",window._ganttArrowKeyHandler),window._ganttArrowKeyHandler=a=>{let u=e||document.querySelector(".dependency-arrow.selected");a.key==="Escape"&&u&&(a.stopImmediatePropagation(),s())},document.addEventListener("keydown",window._ganttArrowKeyHandler)}bt({vscode:ne,menuUndo:qe,menuRedo:G,addDocListener:B,closeOnOutsideClick:ee,announce:re,saveState:y,updateUndoRedoButtons:q,undoStack:xe,redoStack:Fe,selectedIssues:t,clearSelection:w,allIssueBars:i,redmineBaseUrl:ae,extendedRelationTypes:J,minDateMs:Q,maxDateMs:Y,timelineWidth:v,dayWidth:d,barHeight:U,ganttScroll:O,snapToDay:be,focusOnDependencyChain:Je,clearFocus:Ze,getFocusedIssueId:Ge,scrollToAndHighlight:dt,setAllowScrollChange:ue,isDraftModeEnabled:()=>S,isPerfDebugEnabled:()=>tt}),vt({vscode:ne,addDocListener:B,addWinListener:z,announce:re,barHeight:U,selectedCollapseKey:ge});function Oe(){if(!oe){ne.postMessage({command:"todayOutOfRange"});return}if(O){let s=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,a=O.clientWidth-s;O.scrollLeft=Math.max(0,P-a/2)}}function dt(e){if(!e)return;$=!0;let s=document.querySelector('.issue-label[data-issue-id="'+e+'"]'),a=document.querySelector('.issue-bar[data-issue-id="'+e+'"]');if(s&&(s.scrollIntoView({behavior:"smooth",block:"center"}),s.classList.add("highlighted"),setTimeout(()=>s.classList.remove("highlighted"),1500)),a&&O){let u=a.getBoundingClientRect(),p=O.getBoundingClientRect(),ce=O.scrollLeft+u.left-p.left-100;O.scrollTo({left:Math.max(0,ce),behavior:"smooth"}),a.classList.add("highlighted"),setTimeout(()=>a.classList.remove("highlighted"),1500)}}wt({vscode:ne,addDocListener:B,menuUndo:qe,menuRedo:G,undoStack:xe,redoStack:Fe,saveState:y,updateUndoRedoButtons:q,announce:re,scrollToAndHighlight:dt,scrollToToday:Oe}),Dt({addDocListener:B,addWinListener:z,ganttScroll:O}),requestAnimationFrame(()=>{if(Se!==null&&O){let e=Math.max(Q,Math.min(Y,Se));Ne(e),_e!==null&&(O.scrollTop=_e),Se=null,_e=null}else Xe!==null&&O?(O.scrollLeft=Xe,_e!==null&&(O.scrollTop=_e),Xe=null,_e=null):Oe();$e(),te=!1}),document.getElementById("todayBtn")?.addEventListener("click",Oe);let ut=document.getElementById("resizeHandle"),ft=document.getElementById("resizeHandleHeader"),at=!1,mt=0,gt=0,rt=null;function ht(e,s){at=!0,rt=s,mt=e.clientX,gt=Me.offsetWidth,s.classList.add("dragging"),document.body.classList.add("cursor-col-resize","user-select-none"),e.preventDefault()}ut?.addEventListener("mousedown",e=>ht(e,ut)),ft?.addEventListener("mousedown",e=>ht(e,ft));let it=!1,lt=null;B("mousemove",e=>{at&&(lt=e,!it&&(it=!0,requestAnimationFrame(()=>{if(it=!1,!lt)return;let s=lt.clientX-mt,a=Math.min(600,Math.max(120,gt+s));if(Be&&(Be.style.width=a+"px"),Me){Me.style.width=a+"px";let p=Me.querySelector("svg");p&&p.setAttribute("width",String(a))}let u=document.querySelector(".capacity-ribbon-label");u&&(u.style.width=a+X+"px"),Ke()})))}),B("mouseup",()=>{at&&(at=!1,rt?.classList.remove("dragging"),rt=null,document.body.classList.remove("cursor-col-resize","user-select-none"),y())}),requestAnimationFrame(()=>{document.getElementById("loadingOverlay")?.classList.remove("visible")}),Qe("initializeGantt-end"),ct("initializeGantt","initializeGantt-start","initializeGantt-end")}})();
