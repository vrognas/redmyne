"use strict";(()=>{function ft({timelineWidth:S,minimapBarsData:y,minimapHeight:j,minimapBarHeight:O,minimapTodayX:se,ganttScroll:ee,minimapSvg:G,minimapViewport:R,addDocListener:ne}){function be(){let B=document.querySelector(".gantt-body .gantt-sticky-left"),D=document.querySelector(".gantt-container");B&&D&&D.style.setProperty("--sticky-left-width",B.offsetWidth+"px")}requestAnimationFrame(be),G&&requestAnimationFrame(()=>{let B=j/(y.length+1);if(y.forEach((D,$)=>{let u=document.createElementNS("http://www.w3.org/2000/svg","rect");u.setAttribute("class",D.classes),u.setAttribute("x",(D.startPct*S).toString()),u.setAttribute("y",(B*($+.5)).toString()),u.setAttribute("width",Math.max(2,(D.endPct-D.startPct)*S).toString()),u.setAttribute("height",O.toString()),u.setAttribute("rx","1"),u.setAttribute("fill",D.color),G.insertBefore(u,R)}),se>0&&se<S){let D=document.createElementNS("http://www.w3.org/2000/svg","line");D.setAttribute("class","minimap-today"),D.setAttribute("x1",se.toString()),D.setAttribute("y1","0"),D.setAttribute("x2",se.toString()),D.setAttribute("y2",j.toString()),G.insertBefore(D,R)}});function ve(){if(!ee||!R)return;let B=Math.max(1,ee.scrollWidth-ee.clientWidth),D=Math.min(1,ee.scrollLeft/B),$=Math.min(1,ee.clientWidth/ee.scrollWidth),u=Math.max(20,$*S),le=D*(S-u);R.setAttribute("x",le.toString()),R.setAttribute("width",u.toString())}let X=!1,V=0;function z(B,D=!1){if(!ee||!G||!R)return;let $=G.getBoundingClientRect(),le=parseFloat(R.getAttribute("width")||"0")/S*$.width,_=B.clientX-$.left;D?_-=V:_-=le/2;let H=Math.max(0,Math.min(1,_/($.width-le))),te=Math.max(0,ee.scrollWidth-ee.clientWidth);ee.scrollLeft=H*te}return G&&R&&(R.addEventListener("mousedown",B=>{B.stopPropagation(),X=!0;let D=G.getBoundingClientRect(),u=parseFloat(R.getAttribute("x")||"0")/S*D.width;V=B.clientX-D.left-u}),G.addEventListener("mousedown",B=>{if(B.target===R)return;X=!0;let D=G.getBoundingClientRect();V=parseFloat(R.getAttribute("width")||"0")/100*D.width/2,z(B,!0)}),ne("mousemove",B=>{X&&z(B,!0)}),ne("mouseup",()=>{X=!1})),{updateMinimapPosition:be,updateMinimapViewport:ve}}function mt(S){let{vscode:y,menuUndo:j,menuRedo:O,addDocListener:se,closeOnOutsideClick:ee,announce:G,saveState:R,updateUndoRedoButtons:ne,undoStack:be,redoStack:ve,selectedIssues:X,clearSelection:V,allIssueBars:z,redmineBaseUrl:B,extendedRelationTypes:D,minDateMs:$,maxDateMs:u,timelineWidth:le,dayWidth:_,barHeight:H,ganttScroll:te,snapToDay:oe,focusOnDependencyChain:re,clearFocus:d,getFocusedIssueId:v,scrollToAndHighlight:m,setAllowScrollChange:C}=S;function l(s,o,n){document.querySelector(".relation-picker")?.remove();let r=X.size>1&&X.has(n),i=r?Array.from(X).map(q=>parseInt(q)):[parseInt(n)],A=document.createElement("div");A.className="relation-picker";let x=160,L=180,W=Math.min(s,window.innerWidth-x-10),M=Math.min(o,window.innerHeight-L-10);A.style.left=Math.max(10,W)+"px",A.style.top=Math.max(10,M)+"px";let K=document.createElement("div");K.style.padding="6px 12px",K.style.fontSize="11px",K.style.opacity="0.7",K.textContent=r?i.length+" issues selected":"#"+n,A.appendChild(K),(r?[{label:"Set % Done...",command:"bulkSetDoneRatio",bulk:!0},{label:"Clear Selection",command:"clearSelection",local:!0}]:[{label:"Update Issue...",command:"openIssue"},{label:"Open in Browser",command:"openInBrowser"},{label:"Show in Issues",command:"showInIssues"},{label:"Log Time",command:"logTime"},{label:"Set % Done",command:"setDoneRatio"},{label:"Toggle Auto-update %",command:"toggleAutoUpdate"},{label:"Toggle Ad-hoc Budget",command:"toggleAdHoc"},{label:"Toggle Precedence",command:"togglePrecedence"},{label:"Set Internal Estimate",command:"setInternalEstimate"},{label:"Copy Link",command:"copyLink",local:!0},{label:"Copy URL",command:"copyUrl"}]).forEach(q=>{let Y=document.createElement("button");Y.textContent=q.label,Y.addEventListener("click",async()=>{if(q.command==="copyLink"){let qe=document.querySelector('.issue-bar[data-issue-id="'+n+'"]')?.dataset?.subject||"Issue #"+n,Te=B+"/issues/"+n,Oe='<a href="'+Te+'">#'+n+" "+qe+"</a>",$e=Te;try{await navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([$e],{type:"text/plain"}),"text/html":new Blob([Oe],{type:"text/html"})})]),y.postMessage({command:"showStatus",message:"Copied #"+n+" link"})}catch{await navigator.clipboard.writeText($e),y.postMessage({command:"showStatus",message:"Copied #"+n+" URL"})}}else q.local?V():q.bulk?y.postMessage({command:q.command,issueIds:i}):y.postMessage({command:q.command,issueId:parseInt(n)});A.remove()}),A.appendChild(Y)}),document.body.appendChild(A),ee(A)}function c(s){let o=$+s/le*(u-$);return new Date(o).toISOString().slice(0,10)}function k(s){let o=$+s/le*(u-$)-864e5;return new Date(o).toISOString().slice(0,10)}let I=document.getElementById("dragDateTooltip"),w=null;function Q(s){let o=new Date(s+"T00:00:00"),n=o.toLocaleDateString("en-US",{month:"short"}),r=o.getDate(),i=o.toLocaleDateString("en-US",{weekday:"short"});return n+" "+r+" ("+i+")"}function N(s,o){let n=new Date(s+"T00:00:00"),r=new Date(o+"T00:00:00"),i=n.toLocaleDateString("en-US",{month:"short"}),A=r.toLocaleDateString("en-US",{month:"short"});return i===A?i+" "+n.getDate()+"-"+r.getDate():i+" "+n.getDate()+"-"+A+" "+r.getDate()}function We(s){I.textContent=s,I.style.display="block",w=s}function Ae(s){s!==w&&(I.textContent=s,w=s)}function we(s,o){let n=o-28,r=!1;n<40&&(n=o+20,r=!0),I.style.left=s+"px",I.style.top=n+"px",I.classList.toggle("flipped",r)}function Ee(){I.style.display="none",w=null}let Ce=4;function fe(s,o,n,r,i){let A=n>s,L=Math.abs(n-s)<30,W=Math.abs(o-r)<5,M;if(W&&A)M="M "+s+" "+o+" H "+n;else if(!W&&L){let q=(o+r)/2;M="M "+s+" "+o+" H "+(s+20)+" V "+q+" H "+(n-20)+" V "+r+" H "+n}else if(A){let E=(s+n)/2;M="M "+s+" "+o+" H "+E+" V "+r+" H "+n}else if(W){let q=o-H;M="M "+s+" "+o+" V "+q+" H "+(n-12)+" V "+r+" H "+n}else{let q=(o+r)/2;M="M "+s+" "+o+" V "+q+" H "+(n-12)+" V "+r+" H "+n}let K="M "+(n-Ce)+" "+(r-Ce*.6)+" L "+n+" "+r+" L "+(n-Ce)+" "+(r+Ce*.6);return{path:M,arrowHead:K}}function He(s){let o=[],n='.dependency-arrow[data-from="'+s+'"], .dependency-arrow[data-to="'+s+'"]';return document.querySelectorAll(n).forEach(r=>{let i=r.getAttribute("data-from"),A=r.getAttribute("data-to"),L=(r.getAttribute("class")||"").match(/rel-(\w+)/),W=L?L[1]:"relates",M=["blocks","precedes","finish_to_start","start_to_start","finish_to_finish","start_to_finish"].includes(W),K=document.querySelector('.issue-bar[data-issue-id="'+i+'"]'),E=document.querySelector('.issue-bar[data-issue-id="'+A+'"]');!K||!E||o.push({element:r,fromId:i,toId:A,isScheduling:M,fromBar:K,toBar:E,linePath:r.querySelector(".arrow-line"),hitPath:r.querySelector(".arrow-hit-area"),headPath:r.querySelector(".arrow-head")})}),o}function J(s,o,n,r){s.forEach(i=>{let A=i.fromId==o?n:parseFloat(i.fromBar.dataset.startX),x=i.fromId==o?r:parseFloat(i.fromBar.dataset.endX),L=parseFloat(i.fromBar.dataset.centerY),W=i.toId==o?n:parseFloat(i.toBar.dataset.startX),M=i.toId==o?r:parseFloat(i.toBar.dataset.endX),K=parseFloat(i.toBar.dataset.centerY),E,q,Y,ue;i.isScheduling?(E=x+2,q=L,Y=W-2,ue=K):(E=(A+x)/2,q=L,Y=(W+M)/2,ue=K);let{path:qe,arrowHead:Te}=fe(E,q,Y,ue,i.isScheduling);i.linePath&&i.linePath.setAttribute("d",qe),i.hitPath&&i.hitPath.setAttribute("d",qe),i.headPath&&i.headPath.setAttribute("d",Te)})}let me=document.getElementById("dragConfirmOverlay"),xe=document.getElementById("dragConfirmMessage"),Xe=document.getElementById("dragConfirmOk"),Ke=document.getElementById("dragConfirmCancel"),ce=null;function ze(s,o,n){!me||!xe||(xe.textContent=s,ce={onConfirm:o,onCancel:n},C(!0),me.style.display="flex",Xe&&Xe.focus())}function Le(){me&&(me.style.display="none"),ce=null}function ie(){te&&he&&(te.scrollLeft=he.left,te.scrollTop=he.top),he=null}Xe?.addEventListener("click",()=>{ce?.onConfirm&&ce.onConfirm(),he=null,Le()}),Ke?.addEventListener("click",()=>{ce?.onCancel&&ce.onCancel(),ie(),Le()}),me?.addEventListener("click",s=>{s.target===me&&(ce?.onCancel&&ce.onCancel(),ie(),Le())}),se("keydown",s=>{ce&&(s.key==="Escape"?(s.preventDefault(),ce.onCancel&&ce.onCancel(),ie(),Le()):s.key==="Enter"&&(s.preventDefault(),ce.onConfirm&&ce.onConfirm(),he=null,Le()))});let g=null,he=null,Fe=!1;document.querySelectorAll(".drag-handle").forEach(s=>{s.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation(),he={left:te?.scrollLeft,top:te?.scrollTop};let n=s.closest(".issue-bar"),r=s.classList.contains("drag-left"),i=parseInt(n.dataset.issueId),A=parseFloat(n.dataset.startX),x=parseFloat(n.dataset.endX),L=n.dataset.startDate||null,W=n.dataset.dueDate||null,M=n.querySelector(".bar-outline"),K=n.querySelector(".bar-main"),E=n.querySelector(".drag-left"),q=n.querySelector(".drag-right");n.classList.add("dragging");let Y=n.querySelector(".bar-labels"),ue=Y?.classList.contains("labels-left"),qe=He(i),Te=n.querySelector(".link-handle");g={issueId:i,isLeft:r,isMove:!1,initialMouseX:o.clientX,startX:A,endX:x,oldStartDate:L,oldDueDate:W,barOutline:M,barMain:K,leftHandle:E,rightHandle:q,bar:n,barLabels:Y,labelsOnLeft:ue,connectedArrows:qe,linkHandle:Te};let Oe=r?A:x,$e=r?L:W;$e&&(We((r?"Start: ":"Due: ")+Q($e)),we(o.clientX,o.clientY))})}),document.querySelectorAll(".bar-outline").forEach(s=>{s.addEventListener("mousedown",o=>{if(o.target.classList.contains("drag-handle")||o.ctrlKey||o.metaKey||o.shiftKey)return;o.preventDefault(),o.stopPropagation(),he={left:te?.scrollLeft,top:te?.scrollTop};let n=s.closest(".issue-bar");if(!n)return;let r=n.dataset.issueId,i=X.size>1&&X.has(r),x=(i?z.filter(E=>X.has(E.dataset.issueId)):[n]).map(E=>({issueId:E.dataset.issueId,startX:parseFloat(E.dataset.startX),endX:parseFloat(E.dataset.endX),oldStartDate:E.dataset.startDate||null,oldDueDate:E.dataset.dueDate||null,barOutline:E.querySelector(".bar-outline"),barMain:E.querySelector(".bar-main"),leftHandle:E.querySelector(".drag-left"),rightHandle:E.querySelector(".drag-right"),bar:E,barLabels:E.querySelector(".bar-labels"),labelsOnLeft:E.querySelector(".bar-labels")?.classList.contains("labels-left"),connectedArrows:He(E.dataset.issueId),linkHandle:E.querySelector(".link-handle")}));x.forEach(E=>E.bar.classList.add("dragging"));let L=n.querySelector(".bar-labels"),W=L?.classList.contains("labels-left"),M=He(r),K=n.querySelector(".link-handle");g={issueId:parseInt(r),isLeft:!1,isMove:!0,isBulkDrag:i,bulkBars:x,initialMouseX:o.clientX,startX:parseFloat(n.dataset.startX),endX:parseFloat(n.dataset.endX),oldStartDate:n.dataset.startDate||null,oldDueDate:n.dataset.dueDate||null,barOutline:s,barMain:n.querySelector(".bar-main"),leftHandle:n.querySelector(".drag-left"),rightHandle:n.querySelector(".drag-right"),bar:n,barLabels:L,labelsOnLeft:W,connectedArrows:M,linkHandle:K},!i&&n.dataset.startDate&&n.dataset.dueDate&&(We(N(n.dataset.startDate,n.dataset.dueDate)),we(o.clientX,o.clientY))})});let h=null,b=null,T=null;function de(){h&&(h.fromBar.classList.remove("linking-source"),document.querySelectorAll(".link-target").forEach(s=>s.classList.remove("link-target")),b&&(b.remove(),b=null),h=null,T=null,document.body.classList.remove("cursor-crosshair"))}function Se(s,o,n,r){document.querySelector(".relation-picker")?.remove();let i=document.createElement("div");i.className="relation-picker";let A=180,x=200,L=Math.min(s,window.innerWidth-A-10),W=Math.min(o,window.innerHeight-x-10);i.style.left=Math.max(10,L)+"px",i.style.top=Math.max(10,W)+"px";let M=[{value:"blocks",label:"\u{1F6AB} Blocks",cssClass:"rel-line-blocks",tooltip:"Target cannot be closed until this issue is closed"},{value:"precedes",label:"\u27A1\uFE0F Precedes",cssClass:"rel-line-scheduling",tooltip:"This issue must complete before target can start"},{value:"relates",label:"\u{1F517} Relates to",cssClass:"rel-line-informational",tooltip:"Simple link between issues (no constraints)"},{value:"duplicates",label:"\u{1F4CB} Duplicates",cssClass:"rel-line-informational",tooltip:"Closing target will automatically close this issue"},{value:"copied_to",label:"\u{1F4C4} Copied to",cssClass:"rel-line-informational",tooltip:"This issue was copied to create the target issue"}],K=[{value:"finish_to_start",label:"\u23E9 Finish\u2192Start",cssClass:"rel-line-scheduling",tooltip:"Target starts after this issue finishes (FS)"},{value:"start_to_start",label:"\u25B6\uFE0F Start\u2192Start",cssClass:"rel-line-scheduling",tooltip:"Target starts when this issue starts (SS)"},{value:"finish_to_finish",label:"\u23F9\uFE0F Finish\u2192Finish",cssClass:"rel-line-scheduling",tooltip:"Target finishes when this issue finishes (FF)"},{value:"start_to_finish",label:"\u23EA Start\u2192Finish",cssClass:"rel-line-scheduling",tooltip:"Target finishes when this issue starts (SF)"}];(D?[...M,...K]:M).forEach(q=>{let Y=document.createElement("button"),ue=document.createElement("span");ue.className="color-swatch "+q.cssClass,Y.appendChild(ue),Y.appendChild(document.createTextNode(q.label)),Y.title=q.tooltip,Y.addEventListener("click",()=>{R(),y.postMessage({command:"createRelation",issueId:n,targetIssueId:r,relationType:q.value}),i.remove()}),i.appendChild(Y)}),document.body.appendChild(i),ee(i)}let ge=".drag-handle, .link-handle, .bar-outline, .blocks-badge-group, .blocker-badge, .progress-badge-group, .flex-badge-group";document.querySelectorAll(".issue-bar").forEach(s=>{s.addEventListener("click",o=>{o.target.closest(ge)||g||h||Fe||(v()&&d(),m(s.dataset.issueId))}),s.addEventListener("dblclick",o=>{g||h||Fe||(o.preventDefault(),re(s.dataset.issueId))})});function Be(s,o){if(document.querySelectorAll(".dependency-arrow.selected").forEach(r=>r.classList.remove("selected")),document.querySelectorAll(".arrow-connected").forEach(r=>r.classList.remove("arrow-connected")),s.length===0)return;document.body.classList.add("arrow-selection-mode");let n=new Set;s.forEach(r=>{r.classList.add("selected"),n.add(r.dataset.from),n.add(r.dataset.to)}),n.forEach(r=>{document.querySelectorAll(`.issue-bar[data-issue-id="${r}"], .issue-label[data-issue-id="${r}"]`).forEach(i=>i.classList.add("arrow-connected"))}),G(`Highlighted ${s.length} dependency arrow(s) for #${o}`)}document.querySelectorAll(".blocks-badge-group").forEach(s=>{s.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation()}),s.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();let n=s.closest(".issue-bar");if(!n)return;let r=n.dataset.issueId,i=Array.from(document.querySelectorAll(`.dependency-arrow[data-from="${r}"]`));Be(i,r)})}),document.querySelectorAll(".blocker-badge").forEach(s=>{s.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation()}),s.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();let n=s.closest(".issue-bar");if(!n)return;let r=n.dataset.issueId,i=Array.from(document.querySelectorAll(`.dependency-arrow[data-to="${r}"]`));Be(i,r)})});let F=Array.from(document.querySelectorAll(".issue-bar")),Pe=10;F.forEach((s,o)=>{s.addEventListener("keydown",n=>{if(n.key==="Enter"||n.key===" ")n.preventDefault(),m(s.dataset.issueId);else if(n.key==="ArrowDown"&&o<F.length-1)n.preventDefault(),F[o+1].focus(),G(`Issue ${F[o+1].getAttribute("aria-label")}`);else if(n.key==="ArrowUp"&&o>0)n.preventDefault(),F[o-1].focus(),G(`Issue ${F[o-1].getAttribute("aria-label")}`);else if(n.key==="Home")n.preventDefault(),F[0].focus(),G(`First issue: ${F[0].getAttribute("aria-label")}`);else if(n.key==="End")n.preventDefault(),F[F.length-1].focus(),G(`Last issue: ${F[F.length-1].getAttribute("aria-label")}`);else if(n.key==="PageDown"){n.preventDefault();let r=Math.min(o+Pe,F.length-1);F[r].focus(),G(`Issue ${F[r].getAttribute("aria-label")}`)}else if(n.key==="PageUp"){n.preventDefault();let r=Math.max(o-Pe,0);F[r].focus(),G(`Issue ${F[r].getAttribute("aria-label")}`)}else if(n.key==="Tab"&&n.shiftKey){let r=s.dataset.issueId,i=document.querySelector(`.issue-label[data-issue-id="${r}"]`);i&&(n.preventDefault(),i.focus(),G(`Label for issue #${r}`))}})}),document.querySelectorAll(".link-handle").forEach(s=>{s.addEventListener("mousedown",o=>{o.stopPropagation(),o.preventDefault();let n=s.closest(".issue-bar"),r=parseInt(n.dataset.issueId),i=parseFloat(s.dataset.cx),A=parseFloat(s.dataset.cy);n.classList.add("linking-source"),document.body.classList.add("cursor-crosshair");let x=document.querySelector("#ganttTimeline svg");if(!document.getElementById("temp-arrow-head")){let L=document.createElementNS("http://www.w3.org/2000/svg","defs");L.innerHTML=`
            <marker id="temp-arrow-head" markerWidth="10" markerHeight="7"
                    refX="9" refY="3.5" orient="auto" markerUnits="strokeWidth">
              <polygon points="0 0, 10 3.5, 0 7" fill="var(--vscode-focusBorder)"/>
            </marker>`,x.insertBefore(L,x.firstChild)}b=document.createElementNS("http://www.w3.org/2000/svg","path"),b.classList.add("temp-link-arrow"),b.setAttribute("stroke","var(--vscode-focusBorder)"),b.setAttribute("stroke-width","2"),b.setAttribute("fill","none"),b.setAttribute("marker-end","url(#temp-arrow-head)"),x.appendChild(b),h={fromId:r,fromBar:n,startX:i,startY:A}})}),se("keydown",s=>{if(s.key==="Escape"){let o=document.querySelector(".relation-picker");if(o){s.stopImmediatePropagation(),o.remove();return}if(h){s.stopImmediatePropagation(),de();return}v()&&(s.stopImmediatePropagation(),d(),G("Focus cleared"))}});let Re=!1,Qe=null;se("mousemove",s=>{!g&&!h||(Qe=s,!Re&&(Re=!0,requestAnimationFrame(()=>{Re=!1;let o=Qe;if(o){if(g){let n=o.clientX-g.initialMouseX;if(g.isMove&&g.isBulkDrag&&g.bulkBars){let r=oe(n)-oe(0);g.bulkBars.forEach(i=>{let A=i.endX-i.startX,x=Math.max(0,Math.min(i.startX+r,le-A)),L=x+A,W=L-x;i.barOutline.setAttribute("x",x),i.barOutline.setAttribute("width",W),i.barMain&&(i.barMain.setAttribute("x",x),i.barMain.setAttribute("width",W));let M=i.leftHandle.querySelector("rect"),K=i.rightHandle.querySelector("rect");if(M&&M.setAttribute("x",x),K&&K.setAttribute("x",L-14),i.leftHandle.querySelectorAll(".drag-grip circle").forEach((E,q)=>E.setAttribute("cx",x+7)),i.rightHandle.querySelectorAll(".drag-grip circle").forEach((E,q)=>E.setAttribute("cx",L-7)),i.newStartX=x,i.newEndX=L,i.barLabels){let E=i.labelsOnLeft?x-i.startX:L-i.endX;i.barLabels.setAttribute("transform","translate("+E+", 0)")}i.connectedArrows&&J(i.connectedArrows,i.issueId,x,L),i.linkHandle&&i.linkHandle.querySelectorAll("circle").forEach(E=>E.setAttribute("cx",String(L+8)))}),g.snappedDelta=r}else{let r=g.startX,i=g.endX,A=g.endX-g.startX;g.isMove?(r=oe(Math.max(0,Math.min(g.startX+n,le-A))),i=r+A):g.isLeft?r=oe(Math.max(0,Math.min(g.startX+n,g.endX-_))):i=oe(Math.max(g.startX+_,Math.min(g.endX+n,le)));let x=i-r;g.barOutline.setAttribute("x",r),g.barOutline.setAttribute("width",x),g.barMain&&(g.barMain.setAttribute("x",r),g.barMain.setAttribute("width",x));let L=g.leftHandle.querySelector("rect"),W=g.rightHandle.querySelector("rect");if(L&&L.setAttribute("x",r),W&&W.setAttribute("x",i-14),g.leftHandle.querySelectorAll(".drag-grip circle").forEach(M=>M.setAttribute("cx",r+7)),g.rightHandle.querySelectorAll(".drag-grip circle").forEach(M=>M.setAttribute("cx",i-7)),g.newStartX=r,g.newEndX=i,g.barLabels){let M=g.labelsOnLeft?r-g.startX:i-g.endX;g.barLabels.setAttribute("transform","translate("+M+", 0)")}if(g.connectedArrows&&J(g.connectedArrows,g.issueId,r,i),g.linkHandle&&g.linkHandle.querySelectorAll("circle").forEach(M=>M.setAttribute("cx",String(i+8))),g.isMove&&!g.isBulkDrag){let M=c(r),K=k(i),q=M!==g.oldStartDate?N(g.oldStartDate,g.oldDueDate)+" \u2192 "+N(M,K):N(M,K);Ae(q),we(o.clientX,o.clientY)}else if(!g.isMove){let M=g.isLeft?r:i,K=g.isLeft?c(M):k(M);Ae((g.isLeft?"Start: ":"Due: ")+Q(K)),we(o.clientX,o.clientY)}}}if(h&&b){let r=document.querySelector("#ganttTimeline svg").getBoundingClientRect(),i=o.clientX-r.left,A=o.clientY-r.top,x=`M ${h.startX} ${h.startY} L ${i} ${A}`;b.setAttribute("d",x);let L=document.elementFromPoint(o.clientX,o.clientY)?.closest(".issue-bar");T&&T!==L&&T.classList.remove("link-target"),L&&L!==h.fromBar?(L.classList.add("link-target"),T=L):T=null}}})))});function je(s){if(!s)return;let{bar:o,barOutline:n,barMain:r,leftHandle:i,rightHandle:A,barLabels:x,startX:L,endX:W,connectedArrows:M,issueId:K,linkHandle:E}=s,q=W-L;if(n&&(n.setAttribute("x",String(L)),n.setAttribute("width",String(q))),r&&(r.setAttribute("x",String(L)),r.setAttribute("width",String(q))),i){let Y=i.querySelector("rect");Y&&Y.setAttribute("x",String(L)),i.querySelectorAll(".drag-grip circle").forEach(ue=>ue.setAttribute("cx",L+7))}if(A){let Y=A.querySelector("rect");Y&&Y.setAttribute("x",String(W-14)),A.querySelectorAll(".drag-grip circle").forEach(ue=>ue.setAttribute("cx",W-7))}x&&x.removeAttribute("transform"),M&&M.length>0&&J(M,K,L,W),E&&E.querySelectorAll("circle").forEach(Y=>Y.setAttribute("cx",String(W+8))),o&&o.classList.remove("dragging")}se("mouseup",s=>{if(g){let{issueId:o,isLeft:n,isMove:r,isBulkDrag:i,bulkBars:A,newStartX:x,newEndX:L,bar:W,startX:M,endX:K,oldStartDate:E,oldDueDate:q,barOutline:Y,barMain:ue,leftHandle:qe,rightHandle:Te,barLabels:Oe,connectedArrows:$e}=g,Me={...g};if(i&&A&&r){A.forEach(U=>U.bar.classList.remove("dragging"));let Ie=[];if(A.forEach(U=>{if(U.newStartX!==void 0&&U.newStartX!==U.startX){let Z=c(U.newStartX),ke=k(U.newEndX);(Z!==U.oldStartDate||ke!==U.oldDueDate)&&Ie.push({issueId:parseInt(U.issueId),oldStartDate:U.oldStartDate,oldDueDate:U.oldDueDate,newStartDate:Z,newDueDate:ke,barData:U})}}),Ie.length>0){Ee();let U="Move "+Ie.length+" issue(s) to new dates?";ze(U,()=>{be.push({type:"bulk",changes:Ie.map(Z=>({issueId:Z.issueId,oldStartDate:Z.oldStartDate,oldDueDate:Z.oldDueDate,newStartDate:Z.newStartDate,newDueDate:Z.newDueDate}))}),ve.length=0,ne(),R(),Ie.forEach(Z=>{y.postMessage({command:"updateDates",issueId:Z.issueId,startDate:Z.newStartDate,dueDate:Z.newDueDate})})},()=>{A.forEach(Z=>je(Z))})}else Ee(),A.forEach(U=>je(U));g=null,Fe=!0,requestAnimationFrame(()=>Fe=!1);return}if(W.classList.remove("dragging"),Ee(),x!==void 0||L!==void 0){let Ie=null,U=null;r?x!==M&&(Ie=c(x),U=k(L)):n?Ie=x!==M?c(x):null:U=L!==K?k(L):null;let Z=Ie&&Ie!==E?Ie:null,ke=U&&U!==q?U:null;if(Z||ke){let _e="Issue #"+o+": ";Z&&ke?_e+=N(E,q)+" \u2192 "+N(Z,ke):Z?_e+="Start: "+Q(E)+" \u2192 "+Q(Z):_e+="Due: "+Q(q)+" \u2192 "+Q(ke),ze(_e,()=>{be.push({issueId:o,oldStartDate:Z?E:null,oldDueDate:ke?q:null,newStartDate:Z,newDueDate:ke}),ve.length=0,ne(),R(),y.postMessage({command:"updateDates",issueId:o,startDate:Z,dueDate:ke})},()=>{je(Me)})}else je(Me)}else je(Me);g=null,Fe=!0,requestAnimationFrame(()=>Fe=!1)}if(h){let o=h.fromId;if(T){let n=parseInt(T.dataset.issueId);o!==n&&Se(s.clientX,s.clientY,o,n)}de()}ce||ie()}),j?.addEventListener("click",()=>{if(j.hasAttribute("disabled")||be.length===0)return;let s=be.pop();ve.push(s),ne(),R(),s.type==="relation"?s.operation==="create"?y.postMessage({command:"undoRelation",operation:"delete",relationId:s.relationId,datesBefore:s.datesBefore}):y.postMessage({command:"undoRelation",operation:"create",issueId:s.issueId,targetIssueId:s.targetIssueId,relationType:s.relationType}):s.type==="bulk"?s.changes.forEach(o=>{y.postMessage({command:"updateDates",issueId:o.issueId,startDate:o.oldStartDate,dueDate:o.oldDueDate})}):y.postMessage({command:"updateDates",issueId:s.issueId,startDate:s.oldStartDate,dueDate:s.oldDueDate})}),O?.addEventListener("click",()=>{if(O.hasAttribute("disabled")||ve.length===0)return;let s=ve.pop();be.push(s),ne(),R(),s.type==="relation"?s.operation==="create"?y.postMessage({command:"redoRelation",operation:"create",issueId:s.issueId,targetIssueId:s.targetIssueId,relationType:s.relationType}):y.postMessage({command:"redoRelation",operation:"delete",relationId:s.relationId}):s.type==="bulk"?s.changes.forEach(o=>{y.postMessage({command:"updateDates",issueId:o.issueId,startDate:o.newStartDate,dueDate:o.newDueDate})}):y.postMessage({command:"updateDates",issueId:s.issueId,startDate:s.newStartDate,dueDate:s.newDueDate})})}function ht(S){let{vscode:y,addDocListener:j,addWinListener:O,announce:se,barHeight:ee,selectedCollapseKey:G}=S;document.querySelectorAll(".collapse-toggle").forEach(d=>{d.addEventListener("click",v=>{v.stopPropagation();let C=d.closest("[data-collapse-key]")?.dataset.collapseKey;C&&re(C)})}),document.getElementById("menuExpand")?.addEventListener("click",()=>{let v=document.getElementById("ganttScroll")?.dataset.allExpandableKeys,m=v?JSON.parse(v):[];y.postMessage({command:"expandAll",keys:m})}),document.getElementById("menuCollapse")?.addEventListener("click",()=>{y.postMessage({command:"collapseAll"})});let R=Array.from(document.querySelectorAll(".project-label, .issue-label, .time-group-label")),ne=null,be=G??null;function ve(d){return!d.classList.contains("gantt-row-hidden")&&d.getAttribute("visibility")!=="hidden"}function X(d,v){let m=d+v;for(;m>=0&&m<R.length;){if(ve(R[m]))return{label:R[m],index:m};m+=v}return null}function V(d){let v=document.getElementById("ganttScroll"),m=document.querySelector(".gantt-header-row");if(!v||!d)return;let C=m?.getBoundingClientRect().height||60,l=d.closest(".gantt-row");if(!l)return;let c=l.getBoundingClientRect().top,k=l.getBoundingClientRect().height,I=v.getBoundingClientRect(),w=I.top+C,Q=I.bottom;c<w?v.scrollBy({top:c-w-4,behavior:"smooth"}):c+k>Q&&v.scrollBy({top:c+k-Q+4,behavior:"smooth"})}function z(d,v=!1,m=!1,C=!1){ne&&ne.classList.remove("active"),ne=d,d&&(d.classList.add("active"),C||d.focus(),m&&V(d),v||y.postMessage({command:"setSelectedKey",collapseKey:d.dataset.collapseKey}))}O("focus",()=>{ne&&ve(ne)&&ne.focus()}),j("keydown",d=>{d.key==="Escape"&&ne&&(ne.classList.remove("active"),ne.blur(),ne=null,y.postMessage({command:"setSelectedKey",collapseKey:null}))});let B=new Map,D=new Map,$=new Map;function u(d){let v=d.dataset.originalY;if($.has(v))return $.get(v);let m=JSON.parse(d.dataset.rowContributions||"{}");return $.set(v,m),m}function le(){B.clear(),document.querySelectorAll("[data-collapse-key][data-original-y]").forEach(v=>{let m=v.dataset.collapseKey,C=parseFloat(v.dataset.originalY);B.has(m)||B.set(m,{originalY:C,elements:[]}),B.get(m).elements.push(v)})}function _(){D.clear(),document.querySelectorAll("[data-collapse-key][data-parent-key]").forEach(v=>{let m=v.dataset.collapseKey;if(D.has(m))return;let C=[],l=v.dataset.parentKey;for(;l;)C.push(l),l=document.querySelector('[data-collapse-key="'+l+'"]')?.dataset.parentKey||null;D.set(m,C)})}le(),_();function H(d,v){v?(d.setAttribute("visibility","hidden"),d.classList.add("gantt-row-hidden")):(d.removeAttribute("visibility"),d.classList.remove("gantt-row-hidden"))}function te(d){let v=[];return D.forEach((m,C)=>{m.includes(d)&&v.push(C)}),v}function oe(d){let v=[];return D.forEach((m,C)=>{let l=m.indexOf(d);if(l===-1)return;let c=!0;for(let k=0;k<l;k++){let I=m[k],w=document.querySelector('[data-collapse-key="'+I+'"].project-label, [data-collapse-key="'+I+'"].issue-label, [data-collapse-key="'+I+'"].time-group-label');if(!w||w.dataset.expanded!=="true"){c=!1;break}}c&&v.push(C)}),v}function re(d,v){let m=document.querySelector('[data-collapse-key="'+d+'"].project-label, [data-collapse-key="'+d+'"].time-group-label, [data-collapse-key="'+d+'"].issue-label');if(!m||m.dataset.hasChildren!=="true")return;let C=m.dataset.expanded==="true",l=v==="expand"?!0:v==="collapse"?!1:!C;if(l===C)return;m.dataset.expanded=l?"true":"false";let c=m.querySelector(".collapse-toggle");c&&c.classList.toggle("expanded",l);let k=te(d),I=l?oe(d):[];if(k.length===0){y.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:l});return}let w=new Set(k),Q=new Set(I),N=B.get(d),We=N?.originalY??0,Ae=new Set,we=0,Ee=0,fe=l?I:oe(d),He=new Set(fe);if(document.querySelectorAll(".zebra-stripe").forEach(h=>{let b=u(h);d in b&&Ee===0&&(Ee=parseFloat(h.dataset.originalY||"0"));for(let[T,de]of Object.entries(b))He.has(T)&&!Ae.has(T)&&(we+=parseFloat(de),Ae.add(T))}),we===0&&fe.length>0){y.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:l}),y.postMessage({command:"requestRerender"});return}let J=l?we:-we,me=We;if(N&&N.elements.length>0){let b=(N.elements[0].getAttribute("transform")||"").match(/translate\([^,]+,\s*([-\d.]+)/);b&&(me=parseFloat(b[1]))}let xe=me+ee;l?I.forEach(h=>{let b=B.get(h);b&&(b.elements.forEach(T=>{let Se=(T.getAttribute("transform")||"").match(/translate\(([-\d.]+)/),ge=Se?Se[1]:"0";T.setAttribute("transform","translate("+ge+", "+xe+")"),H(T,!1)}),xe+=ee)}):k.forEach(h=>{let b=B.get(h);b&&b.elements.forEach(T=>{H(T,!0)})}),B.forEach(({originalY:h,elements:b},T)=>{h>We&&!w.has(T)&&b.forEach(de=>{let Se=de.getAttribute("transform")||"",ge=Se.match(/translate\(([-\d.]+)/),Be=ge?ge[1]:"0",F=Se.match(/translate\([^,]+,\s*([-\d.]+)/),Re=(F?parseFloat(F[1]):h)+J;de.setAttribute("transform","translate("+Be+", "+Re+")")})});let Xe=document.querySelector(".gantt-labels svg");if(Xe){let b=parseFloat(Xe.getAttribute("height")||"0")+J;Xe.setAttribute("height",String(b))}[".gantt-col-status svg",".gantt-col-id svg",".gantt-col-start svg",".gantt-col-due svg",".gantt-col-assignee svg"].forEach(h=>{let b=document.querySelector(h);if(!b)return;let de=parseFloat(b.getAttribute("height")||"0")+J;b.setAttribute("height",String(de))});let ce=document.querySelector(".gantt-timeline svg");if(ce){let b=parseFloat(ce.getAttribute("height")||"0")+J;ce.setAttribute("height",b)}let ze=new Set;document.querySelectorAll('.project-label[data-has-children="true"], .time-group-label[data-has-children="true"], .issue-label[data-has-children="true"]').forEach(h=>{h.dataset.expanded==="false"&&ze.add(h.dataset.collapseKey)});let Le=new Map,ie=document.querySelectorAll(".zebra-stripe");ie.forEach(h=>{let b=parseFloat(h.dataset.originalY||"0");if(Le.has(b))return;let T=u(h),de=Object.keys(T),Se=de.length>0&&de.every(F=>w.has(F)),ge=de.some(F=>w.has(F)),Be=b>Ee;if(Se)Le.set(b,{action:"toggle-visibility",hide:!l});else if(ge)if(l){let F=0;for(let[Pe,Re]of Object.entries(T))(!w.has(Pe)||Q.has(Pe))&&(F+=parseFloat(Re));Le.set(b,{action:"expand",newHeight:F})}else{let F=0;for(let[Pe,Re]of Object.entries(T))w.has(Pe)||(F+=parseFloat(Re));Le.set(b,{action:"shrink",newHeight:F})}else if(Be){let F=parseFloat(h.getAttribute("y")||String(b));Le.set(b,{action:"shift",newY:F+J})}}),ie.forEach(h=>{let b=parseFloat(h.dataset.originalY||"0"),T=Le.get(b);if(T)switch(T.action){case"toggle-visibility":H(h,T.hide);break;case"shrink":h.setAttribute("height",String(T.newHeight));break;case"expand":h.setAttribute("height",String(T.newHeight));break;case"shift":h.setAttribute("y",String(T.newY));break}});let g=Array.from(document.querySelectorAll(".zebra-stripe")).filter(h=>h.getAttribute("visibility")!=="hidden"),he=new Map;g.forEach(h=>{let b=parseFloat(h.getAttribute("y")||"0");he.has(b)||he.set(b,[]),he.get(b).push(h)}),Array.from(he.keys()).sort((h,b)=>h-b).forEach((h,b)=>{let T=b%2===0?"0.03":"0.06";he.get(h).forEach(de=>de.setAttribute("opacity",T))}),document.querySelectorAll(".indent-guide-line").forEach(h=>{let b=h.dataset.forParent,T=D.get(b)||[],de=ze.has(b)||T.some(Se=>ze.has(Se));if(H(h,de),!de){let Se=B.get(b);if(Se&&Se.originalY>We){let ge=parseFloat(h.getAttribute("y1")||"0"),Be=parseFloat(h.getAttribute("y2")||"0");h.setAttribute("y1",ge+J),h.setAttribute("y2",Be+J)}}}),document.querySelectorAll(".dependency-arrow").forEach(h=>{let b=h.dataset.from,T=h.dataset.to,de=document.querySelector('.issue-bar[data-issue-id="'+b+'"]'),Se=document.querySelector('.issue-bar[data-issue-id="'+T+'"]'),ge=de?.classList.contains("gantt-row-hidden"),Be=Se?.classList.contains("gantt-row-hidden");H(h,ge||Be)}),y.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:l})}if(be){let d=R.find(v=>v.dataset.collapseKey===be);d&&z(d,!0)}R.forEach((d,v)=>{d.addEventListener("click",m=>{if(m.target.closest?.(".collapse-toggle")||m.target.closest?.(".chevron-hit-area"))return;let C=d.dataset.issueId,l=d.classList.contains("project-label"),c=d.classList.contains("time-group-label"),k=d.dataset.collapseKey;if((l||c)&&k){z(d),d.dataset.hasChildren==="true"&&re(k);return}let I=m.target.classList?.contains("issue-text")||m.target.closest(".issue-text");C&&I?(z(d,!1,!1,!0),y.postMessage({command:"openIssue",issueId:parseInt(C,10)})):d.dataset.hasChildren==="true"&&k?(z(d),re(k)):z(d)}),d.addEventListener("keydown",m=>{let C=d.dataset.collapseKey,l=d.dataset.issueId?parseInt(d.dataset.issueId,10):NaN;switch(m.key){case"Enter":case" ":m.preventDefault(),isNaN(l)||y.postMessage({command:"openIssue",issueId:l});break;case"ArrowUp":{m.preventDefault();let c=X(v,-1);c&&z(c.label,!1,!0);break}case"ArrowDown":{m.preventDefault();let c=X(v,1);c&&z(c.label,!1,!0);break}case"ArrowLeft":if(m.preventDefault(),d.dataset.hasChildren==="true"&&d.dataset.expanded==="true")re(C,"collapse");else if(d.dataset.parentKey){let c=R.find(k=>k.dataset.collapseKey===d.dataset.parentKey);c&&z(c,!1,!0)}break;case"ArrowRight":if(m.preventDefault(),d.dataset.hasChildren==="true"&&d.dataset.expanded==="false")re(C,"expand");else if(d.dataset.hasChildren==="true"&&d.dataset.expanded==="true"){let c=R.find(k=>k.dataset.parentKey===C&&ve(k));c&&z(c,!1,!0)}break;case"Home":{m.preventDefault();let c=X(-1,1);c&&z(c.label,!1,!0);break}case"End":{m.preventDefault();let c=X(R.length,-1);c&&z(c.label,!1,!0);break}case"PageDown":{m.preventDefault();let c=v,k=0;for(;k<10&&c<R.length-1;){let I=X(c,1);if(!I)break;c=I.index,k++}k>0&&z(R[c],!1,!0);break}case"PageUp":{m.preventDefault();let c=v,k=0;for(;k<10&&c>0;){let I=X(c,-1);if(!I)break;c=I.index,k++}k>0&&z(R[c],!1,!0);break}case"Tab":if(!m.shiftKey&&!isNaN(l)){let c=document.querySelector(`.issue-bar[data-issue-id="${l}"]`);c&&(m.preventDefault(),c.focus(),se(`Timeline bar for issue #${l}`))}break}})})}function gt(S){let{vscode:y,addDocListener:j,menuUndo:O,menuRedo:se,undoStack:ee,redoStack:G,saveState:R,updateUndoRedoButtons:ne,announce:be,scrollToAndHighlight:ve,scrollToToday:X}=S;j("keydown",u=>{let _=navigator.platform.toUpperCase().indexOf("MAC")>=0?u.metaKey:u.ctrlKey;if(!(u.target.tagName==="INPUT"||u.target.tagName==="SELECT"||u.target.tagName==="TEXTAREA"))if(_&&u.key==="z"&&!u.shiftKey)u.preventDefault(),O?.click();else if(_&&u.key==="z"&&u.shiftKey)u.preventDefault(),se?.click();else if(_&&u.key==="y")u.preventDefault(),se?.click();else if(u.key>="1"&&u.key<="5"){let H=document.getElementById("zoomSelect"),te=["day","week","month","quarter","year"];H.value=te[parseInt(u.key)-1],H.dispatchEvent(new Event("change"))}else if(u.key.toLowerCase()==="h")document.getElementById("menuHeatmap")?.click();else if(u.key.toLowerCase()==="y")document.getElementById("menuCapacity")?.click();else if(u.key.toLowerCase()==="i")document.getElementById("menuIntensity")?.click();else if(u.key.toLowerCase()==="d")document.getElementById("menuDeps")?.click();else if(u.key.toLowerCase()==="v"){let H=document.getElementById("viewFocusSelect");H.value=H.value==="project"?"person":"project",H.dispatchEvent(new Event("change"))}else if(u.key.toLowerCase()==="r")document.getElementById("refreshBtn")?.click();else if(u.key.toLowerCase()==="t")X();else if(u.key.toLowerCase()==="e")document.getElementById("menuExpand")?.click();else if(u.key.toLowerCase()==="c"&&!_)document.getElementById("menuCollapse")?.click();else if(u.key.toLowerCase()==="f"&&!_)u.preventDefault(),document.getElementById("menuFilterHealth")?.click();else if(u.key.toLowerCase()==="b"){u.preventDefault();let H=Array.from(document.querySelectorAll(".issue-bar[data-issue-id]")).filter(v=>v.querySelector(".blocker-badge"));if(H.length===0){be("No blocked issues");return}let te=document.activeElement?.closest(".issue-bar"),re=((te?H.indexOf(te):-1)+1)%H.length,d=H[re];ve(d.dataset.issueId),d.focus(),be("Blocked issue "+(re+1)+" of "+H.length)}else if(u.key==="ArrowLeft"||u.key==="ArrowRight"){let H=document.activeElement?.closest(".issue-bar:not(.parent-bar)");if(!H)return;u.preventDefault();let te=parseInt(H.dataset.issueId),oe=H.dataset.startDate,re=H.dataset.dueDate;if(!oe&&!re)return;let d=u.key==="ArrowRight"?1:-1,v=(l,c)=>{let k=new Date(l+"T00:00:00");return k.setDate(k.getDate()+c),k.toISOString().slice(0,10)},m=null,C=null;u.shiftKey&&re?C=v(re,d):u.altKey&&oe?m=v(oe,d):(oe&&(m=v(oe,d)),re&&(C=v(re,d))),(m||C)&&(R(),ee.push({issueId:te,oldStartDate:m?oe:null,oldDueDate:C?re:null,newStartDate:m,newDueDate:C}),G.length=0,ne(),y.postMessage({command:"updateDates",issueId:te,startDate:m,dueDate:C}))}else u.key==="/"&&!_?(u.preventDefault(),z()):(u.key==="?"||u.shiftKey&&u.key==="/")&&(u.preventDefault(),$())});let V=null;function z(){V&&V.remove(),V=document.createElement("div"),V.className="quick-search",V.innerHTML=`
      <input type="text" placeholder="Search issues..." autofocus />
    `,document.body.appendChild(V);let u=V.querySelector("input");u.focus();let le=Array.from(document.querySelectorAll(".issue-label"));u.addEventListener("input",()=>{let _=u.value.toLowerCase();le.forEach(H=>{let te=H.getAttribute("aria-label")?.toLowerCase()||"",oe=_&&te.includes(_);H.classList.toggle("search-match",oe)})}),u.addEventListener("keydown",_=>{if(_.key==="Escape")B();else if(_.key==="Enter"){let H=document.querySelector(".issue-label.search-match");H&&(B(),H.focus(),ve(H.dataset.issueId))}}),u.addEventListener("blur",()=>setTimeout(B,150))}function B(){V&&(V.remove(),V=null,document.querySelectorAll(".search-match").forEach(u=>u.classList.remove("search-match")))}let D=null;function $(){if(D){D.remove(),D=null;return}D=document.createElement("div"),D.className="keyboard-help",D.innerHTML=`
      <div class="keyboard-help-content">
        <h3>Keyboard Shortcuts</h3>
        <div class="shortcut-grid">
          <div class="shortcut-section">
            <h4>Navigation</h4>
            <div><kbd>\u2191</kbd><kbd>\u2193</kbd> Move between issues</div>
            <div><kbd>Home</kbd><kbd>End</kbd> First/last issue</div>
            <div><kbd>PgUp</kbd><kbd>PgDn</kbd> Jump 10 rows</div>
            <div><kbd>Tab</kbd> Label \u2192 Bar</div>
            <div><kbd>Shift+Tab</kbd> Bar \u2192 Label</div>
          </div>
          <div class="shortcut-section">
            <h4>Date Editing</h4>
            <div><kbd>\u2190</kbd><kbd>\u2192</kbd> Move bar \xB11 day</div>
            <div><kbd>Shift+\u2190/\u2192</kbd> Resize end</div>
            <div><kbd>Alt+\u2190/\u2192</kbd> Resize start</div>
            <div><kbd>Ctrl+Z</kbd> Undo</div>
            <div><kbd>Ctrl+Y</kbd> Redo</div>
          </div>
          <div class="shortcut-section">
            <h4>View</h4>
            <div><kbd>1-5</kbd> Zoom levels</div>
            <div><kbd>H</kbd> Heatmap</div>
            <div><kbd>D</kbd> Dependencies</div>
            <div><kbd>C</kbd> Critical path</div>
            <div><kbd>T</kbd> Today</div>
          </div>
          <div class="shortcut-section">
            <h4>Health & Other</h4>
            <div><kbd>F</kbd> Cycle health filter</div>
            <div><kbd>B</kbd> Next blocked issue</div>
            <div><kbd>/</kbd> Quick search</div>
            <div><kbd>S</kbd> Cycle sort</div>
            <div><kbd>R</kbd> Refresh</div>
            <div><kbd>Esc</kbd> Clear/cancel</div>
          </div>
        </div>
        <p class="keyboard-help-close">Press <kbd>?</kbd> or <kbd>Esc</kbd> to close</p>
      </div>
    `,document.body.appendChild(D),D.addEventListener("click",u=>{u.target===D&&$()})}j("keydown",u=>{u.key==="Escape"&&D&&(u.stopImmediatePropagation(),$())})}var ae=acquireVsCodeApi(),Ze=!1;function Ve(S){Ze&&typeof performance<"u"&&performance.mark(S)}function at(S,y,j){if(Ze&&typeof performance<"u")try{performance.measure(S,y,j);let O=performance.getEntriesByName(S,"measure");O.length>0&&console.log(`[Gantt Perf] ${S}: ${O[O.length-1].duration.toFixed(2)}ms`),performance.clearMarks(y),performance.clearMarks(j),performance.clearMeasures(S)}catch{}}function vt(){if(Ze){let S=document.getElementById("ganttRoot"),y=S?S.querySelectorAll("*").length:0,j=S?S.querySelectorAll("svg *").length:0;console.log(`[Gantt Perf] DOM nodes: ${y}, SVG elements: ${j}`)}}function wt(S){if(!S)return;let y=document.documentElement;y.style.setProperty("--gantt-header-height",`${S.headerHeight}px`),y.style.setProperty("--gantt-label-width",`${S.labelWidth}px`),y.style.setProperty("--gantt-id-column-width",`${S.idColumnWidth}px`),y.style.setProperty("--gantt-start-date-column-width",`${S.startDateColumnWidth}px`),y.style.setProperty("--gantt-status-column-width",`${S.statusColumnWidth}px`),y.style.setProperty("--gantt-due-date-column-width",`${S.dueDateColumnWidth}px`),y.style.setProperty("--gantt-assignee-column-width",`${S.assigneeColumnWidth}px`),y.style.setProperty("--gantt-sticky-left-width",`${S.stickyLeftWidth}px`)}function St({addDocListener:S,addWinListener:y}){let j=document.getElementById("ganttRoot"),O=document.getElementById("ganttTooltip"),se=O?.querySelector(".gantt-tooltip-content");if(!j||!O||!se)return;let ee=l=>l?String(l).replace(/\r\n/g,`
`).trimEnd():"";function G(){j.querySelectorAll("svg title").forEach(l=>{let c=l.parentElement,k=ee(l.textContent);c&&k&&(c.dataset.tooltip=k),l.remove()})}function R(){j.querySelectorAll("[title]").forEach(l=>{if(l.tagName.toLowerCase()==="title")return;let c=ee(l.getAttribute("title"));l.removeAttribute("title"),c&&(l.dataset.tooltip=c)})}function ne(){G(),R()}function be(l){let c=l.findIndex(I=>I.trim().startsWith("#"));return c>=0?c:l.filter(I=>I.trim()).length>1?l.findIndex(I=>I.trim()):-1}function ve(l){se.textContent="";let c=ee(l);if(!c)return;let k=c.split(`
`),I=be(k),w=!1;k.forEach((N,We)=>{let Ae=N.trim();if(!Ae){if(!w){let fe=document.createElement("div");fe.className="gantt-tooltip-spacer",se.appendChild(fe),w=!0}return}if(Ae==="---"){let fe=document.createElement("div");fe.className="gantt-tooltip-divider",se.appendChild(fe),w=!1;return}let we=Ae.match(/^cf:([^:]+):(.*)$/);if(we){let fe=we[1].trim(),He=we[2].trim(),J=document.createElement("div");J.className="gantt-tooltip-line";let me=document.createElement("span");me.className="gantt-tooltip-key",me.textContent=`${fe}: `,J.appendChild(me),He&&J.appendChild(document.createTextNode(He)),se.appendChild(J),w=!1;return}let Ee=document.createElement("div");Ee.className="gantt-tooltip-line",We===I&&Ee.classList.add("gantt-tooltip-title");let Ce=Ae.match(/^Open in Browser:\s*(\S+)/);if(Ce&&/^https?:\/\//i.test(Ce[1])){Ee.appendChild(document.createTextNode("Open in Browser: "));let fe=document.createElement("a");fe.href=Ce[1],fe.textContent=Ce[1],fe.target="_blank",fe.rel="noopener noreferrer",Ee.appendChild(fe)}else Ee.textContent=N;se.appendChild(Ee),w=!1});let Q=se.lastElementChild;Q&&Q.classList.contains("gantt-tooltip-spacer")&&Q.remove()}let X=null,V=null,z=null,B={x:0,y:0};function D(l){B={x:l.clientX,y:l.clientY}}function $(){V&&(clearTimeout(V),V=null)}function u(){z&&(clearTimeout(z),z=null)}function le(l){return l&&(l===O||O.contains(l))}function _(l){return l&&X&&(l===X||X.contains(l))}function H(){if(!B)return!1;let l=document.elementFromPoint(B.x,B.y);return le(l)||_(l)}let te=300;function oe(l){u(),z=setTimeout(()=>{z=null,!(!X||X!==l)&&H()&&v(l,B.x,B.y)},te)}function re(){$(),V=setTimeout(()=>{X&&(H()||m())},300)}function d(l,c){let w=O.getBoundingClientRect(),Q=l+8,N=c+8;Q+w.width>window.innerWidth-8&&(Q=l-w.width-8),N+w.height>window.innerHeight-8&&(N=c-w.height-8),Q=Math.max(8,Math.min(Q,window.innerWidth-w.width-8)),N=Math.max(8,Math.min(N,window.innerHeight-w.height-8)),O.style.left=`${Math.round(Q)}px`,O.style.top=`${Math.round(N)}px`}function v(l,c,k){let I=l.dataset.tooltip;I&&(ve(I),O.classList.add("visible"),O.setAttribute("aria-hidden","false"),d(c,k))}function m(l=!1){u(),$(),O.classList.remove("visible"),O.setAttribute("aria-hidden","true"),l||(X=null)}function C(l){if(!l||l===O||O.contains(l))return null;let c=l.closest?.("[data-tooltip], [title]");if(!c||!j.contains(c))return null;if(c.hasAttribute("title")){let k=ee(c.getAttribute("title"));c.removeAttribute("title"),k&&(c.dataset.tooltip=k)}return c.dataset.tooltip?c:null}ne(),S("pointerover",l=>{if(D(l),le(l.target)){$(),u();return}let c=C(l.target);if(!c){u();return}$(),X!==c?(X=c,O.classList.contains("visible")&&m(!0),oe(c)):O.classList.contains("visible")||oe(c)},!0),S("pointermove",l=>{X&&(D(l),V&&H()&&$())},!0),S("pointerout",l=>{if(!X||(D(l),u(),!_(l.target)&&!le(l.target)))return;let c=l.relatedTarget;le(c)||_(c)||re()},!0),S("scroll",()=>{X&&m()},!0),S("keydown",()=>{X&&m()},!0),y("blur",()=>{X&&m()})}function yt(S){if(!S)return;S.state&&(Ze=S.state.perfDebug??!1),Ve("render-start");let y=document.getElementById("ganttRoot");y&&(wt(S.state),Ve("innerHTML-start"),y.innerHTML=S.html||"",Ve("innerHTML-end"),at("innerHTML","innerHTML-start","innerHTML-end"),kt(S.state),Ve("render-end"),at("render","render-start","render-end"),vt())}window.addEventListener("message",S=>{let y=S.data;if(y){if(y.command==="render"){yt(y.payload);return}window.__ganttHandleExtensionMessage&&window.__ganttHandleExtensionMessage(y)}});var pt=window.__GANTT_INITIAL_PAYLOAD__;pt&&yt(pt);ae.postMessage({command:"webviewReady"});function kt(S){if(Ve("initializeGantt-start"),!S)return;let{timelineWidth:y,minDateMs:j,maxDateMs:O,totalDays:se,extendedRelationTypes:ee,redmineBaseUrl:G,minimapBarsData:R,minimapHeight:ne,minimapBarHeight:be,minimapTodayX:ve,extScrollLeft:X,extScrollTop:V,labelWidth:z,leftExtrasWidth:B,healthFilter:D,sortBy:$,sortOrder:u,selectedCollapseKey:le,barHeight:_,todayX:H,todayInRange:te,isDraftMode:oe}=S,re=y/se,d=document.getElementById("dragConfirmOk");d&&(d.textContent=oe?"Queue to Draft":"Save to Redmine"),window._ganttCleanup&&window._ganttCleanup();let v=[],m=[];function C(e,t,a){document.addEventListener(e,t,a),v.push({type:e,handler:t,options:a})}function l(e,t,a){window.addEventListener(e,t,a),m.push({type:e,handler:t,options:a})}window._ganttCleanup=()=>{v.forEach(e=>document.removeEventListener(e.type,e.handler,e.options)),m.forEach(e=>window.removeEventListener(e.type,e.handler,e.options)),window.__ganttHandleExtensionMessage=null};function c(e){setTimeout(()=>{document.addEventListener("click",function t(a){e.contains(a.target)||(e.remove(),document.removeEventListener("click",t))})},0)}function k(e){return Math.round(e/re)*re}function I(e){let t=document.getElementById("liveRegion");t&&(t.textContent=e)}let w=document.getElementById("ganttScroll"),Q=document.getElementById("ganttLeftHeader"),N=document.getElementById("ganttLabels"),We=document.getElementById("ganttTimeline"),Ae=document.getElementById("menuUndo"),we=document.getElementById("menuRedo"),Ee=document.getElementById("minimapSvg"),Ce=document.getElementById("minimapViewport"),{updateMinimapPosition:fe,updateMinimapViewport:He}=ft({timelineWidth:y,minimapBarsData:R,minimapHeight:ne,minimapBarHeight:be,minimapTodayX:ve,ganttScroll:w,minimapSvg:Ee,minimapViewport:Ce,addDocListener:C}),J=ae.getState()||{undoStack:[],redoStack:[],labelWidth:z,scrollLeft:null,scrollTop:null,centerDateMs:null},me=J.undoStack||[],xe=J.redoStack||[],Xe=J.scrollLeft??(X>0?X:null),Ke=J.scrollTop??(V>0?V:null),ce=J.centerDateMs;function ze(){if(!w)return null;let t=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,a=w.clientWidth-t,p=(w.scrollLeft+a/2)/y;return j+p*(O-j)}function Le(e){if(!w)return;let a=(e-j)/(O-j)*y,p=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,P=w.clientWidth-p;w.scrollLeft=Math.max(0,a-P/2)}function ie(){ae.setState({undoStack:me,redoStack:xe,labelWidth:N?.offsetWidth||z,scrollLeft:null,scrollTop:w?.scrollTop??null,centerDateMs:ze()})}let g=ie;function he(){Ae&&Ae.toggleAttribute("disabled",me.length===0),we&&we.toggleAttribute("disabled",xe.length===0),ie()}if(J.labelWidth&&Q&&N){Q.style.width=J.labelWidth+"px",N.style.width=J.labelWidth+"px";let e=document.querySelector(".capacity-ribbon-label");e&&(e.style.width=J.labelWidth+B+"px")}let Fe=!0,h=!1,b=e=>{h=e},T=null;w&&w.addEventListener("scroll",()=>{cancelAnimationFrame(T),T=requestAnimationFrame(()=>{He(),Fe||ie()})},{passive:!0}),requestAnimationFrame(()=>he()),window.__ganttHandleExtensionMessage=e=>{if(e.command==="setHeatmapState"){let t=document.querySelector(".heatmap-layer"),a=document.querySelector(".weekend-layer"),f=document.getElementById("menuHeatmap");e.enabled?(t&&t.classList.remove("hidden"),a&&a.classList.add("hidden"),f&&f.classList.add("active")):(t&&t.classList.add("hidden"),a&&a.classList.remove("hidden"),f&&f.classList.remove("active"))}else if(e.command==="setDependenciesState"){let t=document.querySelector(".dependency-layer"),a=document.getElementById("menuDeps");e.enabled?(t&&t.classList.remove("hidden"),a&&a.classList.add("active")):(t&&t.classList.add("hidden"),a&&a.classList.remove("active"))}else if(e.command==="setCapacityRibbonState"){let t=document.querySelector(".capacity-ribbon"),a=document.getElementById("menuCapacity");e.enabled?(t&&t.classList.remove("hidden"),a&&a.classList.add("active")):(t&&t.classList.add("hidden"),a&&a.classList.remove("active"))}else if(e.command==="setIntensityState"){let t=document.querySelector(".gantt-container"),a=document.getElementById("menuIntensity");e.enabled?(t?.classList.add("intensity-enabled"),a&&a.classList.add("active")):(t?.classList.remove("intensity-enabled"),a&&a.classList.remove("active"))}else if(e.command==="setDraftModeState"){let t=document.getElementById("dragConfirmOk");t&&(t.textContent=e.enabled?"Queue to Draft":"Save to Redmine")}else if(e.command==="pushUndoAction")me.push(e.action),xe.length=0,he(),ie();else if(e.command==="updateRelationId"){let t=e.stack==="undo"?me:xe;if(t.length>0){let a=t[t.length-1];a.type==="relation"&&(a.relationId=e.newRelationId,ie())}}else if(e.command==="scrollToIssue"){let t=e.issueId,a=document.querySelector('.issue-label[data-issue-id="'+t+'"]'),f=document.querySelector('.issue-bar[data-issue-id="'+t+'"]'),p=document.getElementById("ganttScroll"),pe=document.querySelector(".gantt-header-row")?.getBoundingClientRect().height||60;if(!p)return;let De=p.scrollTop,ye=p.scrollLeft;if(a){let Ye=a.closest(".gantt-row");if(Ye){let Ne=Ye.offsetTop,Ue=Ye.getBoundingClientRect().height,Ge=p.clientHeight-pe;De=Math.max(0,Ne-pe-(Ge-Ue)/2)}a.focus(),a.classList.add("highlighted"),setTimeout(()=>a.classList.remove("highlighted"),2e3)}if(f){let Ye=parseFloat(f.getAttribute("data-start-x")||"0"),Ue=parseFloat(f.getAttribute("data-end-x")||"0")-Ye,Ge=p.clientWidth,bt=document.querySelector(".gantt-sticky-left")?.getBoundingClientRect().width||0,ut=Ge-bt;Ue<=ut-100?ye=Ye-(ut-Ue)/2:ye=Ye-50,ye=Math.max(0,ye),f.classList.add("highlighted"),setTimeout(()=>f.classList.remove("highlighted"),2e3)}p.scrollTo({left:ye,top:De,behavior:"smooth"})}},document.getElementById("lookbackSelect")?.addEventListener("change",e=>{ae.postMessage({command:"setLookback",years:e.target.value})}),document.getElementById("zoomSelect")?.addEventListener("change",e=>{g(),ae.postMessage({command:"setZoom",zoomLevel:e.target.value})}),document.getElementById("viewFocusSelect")?.addEventListener("change",e=>{ae.postMessage({command:"setViewFocus",focus:e.target.value})}),document.getElementById("projectSelector")?.addEventListener("change",e=>{let t=e.target.value,a=t?parseInt(t,10):null;ae.postMessage({command:"setSelectedProject",projectId:a})}),document.getElementById("focusSelector")?.addEventListener("change",e=>{let t=e.target.value;ae.postMessage({command:"setSelectedAssignee",assignee:t||null})}),document.getElementById("filterAssignee")?.addEventListener("change",e=>{let t=e.target.value;ae.postMessage({command:"setFilter",filter:{assignee:t}})}),document.getElementById("filterStatus")?.addEventListener("change",e=>{let t=e.target.value;ae.postMessage({command:"setFilter",filter:{status:t}})}),document.getElementById("menuFilterHealth")?.addEventListener("click",()=>{let e=["all","critical","warning","healthy"],t=D,f=(e.indexOf(t)+1)%e.length;ae.postMessage({command:"setHealthFilter",health:e[f]})}),document.querySelectorAll(".gantt-col-header.sortable").forEach(e=>{e.addEventListener("click",()=>{let t=e.dataset.sort;t===$?u==="asc"?ae.postMessage({command:"setSort",sortOrder:"desc"}):ae.postMessage({command:"setSort",sortBy:null}):ae.postMessage({command:"setSort",sortBy:t,sortOrder:"asc"})})}),document.getElementById("menuHeatmap")?.addEventListener("click",()=>{document.getElementById("menuHeatmap")?.hasAttribute("disabled")||(ie(),ae.postMessage({command:"toggleWorkloadHeatmap"}))}),document.getElementById("menuCapacity")?.addEventListener("click",()=>{document.getElementById("menuCapacity")?.hasAttribute("disabled")||(ie(),ae.postMessage({command:"toggleCapacityRibbon"}))}),document.getElementById("menuIntensity")?.addEventListener("click",()=>{document.getElementById("menuIntensity")?.hasAttribute("disabled")||(ie(),ae.postMessage({command:"toggleIntensity"}))}),document.getElementById("overloadBadge")?.addEventListener("click",e=>{e.stopPropagation();let t=e.currentTarget,a=parseInt(t.dataset.firstOverloadMs||"0",10);a>0&&(Le(a),ie())}),document.querySelectorAll(".capacity-day-bar-group").forEach(e=>{e.addEventListener("click",t=>{let a=parseInt(t.currentTarget.dataset.dateMs||"0",10);a>0&&(Le(a),ie())})}),document.getElementById("menuDeps")?.addEventListener("click",()=>{ie(),ae.postMessage({command:"toggleDependencies"})});let ge=document.querySelector(".gantt-container");function Be(){let e=new Map,t=new Map;return document.querySelectorAll(".dependency-arrow").forEach(a=>{if(!(a.classList.contains("rel-blocks")||a.classList.contains("rel-precedes")))return;let p=a.dataset.from,P=a.dataset.to;e.has(p)||e.set(p,[]),e.get(p).push(P),t.has(P)||t.set(P,[]),t.get(P).push(p)}),{graph:e,reverseGraph:t}}let F=null;function Pe(e,t,a){let f=new Set([e]),p=[e];for(;p.length>0;){let pe=p.shift(),De=t.get(pe)||[];for(let ye of De)f.has(ye)||(f.add(ye),p.push(ye))}let P=[e];for(;P.length>0;){let pe=P.shift(),De=a.get(pe)||[];for(let ye of De)f.has(ye)||(f.add(ye),P.push(ye))}return f}function Re(e){if(Qe(),!e)return;F=e;let{graph:t,reverseGraph:a}=Be(),f=Pe(e,t,a);ge.classList.add("focus-mode"),document.querySelectorAll(".issue-bar").forEach(p=>{f.has(p.dataset.issueId)&&p.classList.add("focus-highlighted")}),document.querySelectorAll(".issue-label").forEach(p=>{f.has(p.dataset.issueId)&&p.classList.add("focus-highlighted")}),document.querySelectorAll(".dependency-arrow").forEach(p=>{f.has(p.dataset.from)&&f.has(p.dataset.to)&&p.classList.add("focus-highlighted")}),I(`Focus: ${f.size} issue${f.size!==1?"s":""} in dependency chain`)}function Qe(){F=null,ge.classList.remove("focus-mode"),document.querySelectorAll(".focus-highlighted").forEach(e=>e.classList.remove("focus-highlighted"))}let je=()=>F,s=new Set,o=null,n=document.getElementById("selectionCount"),r=Array.from(document.querySelectorAll(".issue-bar")),i=new Map;r.forEach(e=>{let t=e.dataset.issueId;t&&(i.has(t)||i.set(t,[]),i.get(t).push(e))});function A(e){e.forEach(t=>{let a=i.get(t);a&&a.forEach(f=>f.classList.toggle("selected",s.has(t)))}),s.size>0?(n.textContent=`${s.size} selected`,n.classList.remove("hidden"),ge.classList.add("multi-select-mode")):(n.classList.add("hidden"),ge.classList.remove("multi-select-mode"))}function x(){r.forEach(e=>{e.classList.toggle("selected",s.has(e.dataset.issueId))}),s.size>0?(n.textContent=`${s.size} selected`,n.classList.remove("hidden"),ge.classList.add("multi-select-mode")):(n.classList.add("hidden"),ge.classList.remove("multi-select-mode"))}function L(){let e=[...s];s.clear(),o=null,A(e)}function W(e){s.has(e)?s.delete(e):s.add(e),o=e,A([e])}function M(e,t){let a=r.findIndex(De=>De.dataset.issueId===e),f=r.findIndex(De=>De.dataset.issueId===t);if(a===-1||f===-1)return;let p=Math.min(a,f),P=Math.max(a,f),pe=[];for(let De=p;De<=P;De++){let ye=r[De].dataset.issueId;s.has(ye)||(s.add(ye),pe.push(ye))}A(pe)}function K(){r.forEach(e=>s.add(e.dataset.issueId)),x(),I(`Selected all ${s.size} issues`)}r.forEach(e=>{e.addEventListener("mousedown",t=>{if(!t.ctrlKey&&!t.metaKey&&!t.shiftKey||t.target.classList.contains("drag-handle")||t.target.classList.contains("link-handle"))return;t.preventDefault(),t.stopPropagation();let a=e.dataset.issueId;t.shiftKey&&o?M(o,a):W(a)})}),C("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="a"&&(e.preventDefault(),K()),e.key==="Escape"&&s.size>0&&(e.stopImmediatePropagation(),L(),I("Selection cleared"))}),document.getElementById("refreshBtn")?.addEventListener("click",()=>{document.getElementById("loadingOverlay")?.classList.add("visible"),ae.postMessage({command:"refresh"})});function E(e,t,a,f,p){document.querySelector(".relation-picker")?.remove();let P=document.createElement("div");P.className="relation-picker";let pe=150,De=100,ye=Math.min(e,window.innerWidth-pe-10),Ye=Math.min(t,window.innerHeight-De-10);P.style.left=Math.max(10,ye)+"px",P.style.top=Math.max(10,Ye)+"px";let Ne=document.createElement("div");Ne.style.padding="6px 12px",Ne.style.fontSize="11px",Ne.style.opacity="0.7",Ne.textContent=`#${f} \u2192 #${p}`,P.appendChild(Ne);let Ue=document.createElement("button");Ue.textContent="\u{1F5D1}\uFE0F Delete relation",Ue.addEventListener("click",()=>{ie(),ae.postMessage({command:"deleteRelation",relationId:a}),P.remove()}),P.appendChild(Ue);let Ge=document.createElement("button");Ge.textContent="Cancel",Ge.addEventListener("click",()=>P.remove()),P.appendChild(Ge),document.body.appendChild(P),c(P)}let q=new Map,Y=new Map,ue=new Map,qe=new Map,Te=new Map,Oe=!1;function $e(){document.querySelectorAll(".issue-bar").forEach(e=>{let t=e.dataset.issueId;t&&(q.has(t)||q.set(t,[]),q.get(t).push(e))}),document.querySelectorAll(".issue-label").forEach(e=>{let t=e.dataset.issueId;t&&(Y.has(t)||Y.set(t,[]),Y.get(t).push(e))}),document.querySelectorAll(".dependency-arrow").forEach(e=>{let t=e.dataset.from,a=e.dataset.to;t&&(ue.has(t)||ue.set(t,[]),ue.get(t).push(e)),a&&(ue.has(a)||ue.set(a,[]),ue.get(a).push(e))}),document.querySelectorAll(".project-label").forEach(e=>{let t=e.dataset.collapseKey;t&&(qe.has(t)||qe.set(t,[]),qe.get(t).push(e))}),document.querySelectorAll(".aggregate-bars").forEach(e=>{let t=e.dataset.collapseKey;t&&(Te.has(t)||Te.set(t,[]),Te.get(t).push(e))}),Oe=!0}typeof requestIdleCallback<"u"?requestIdleCallback(()=>$e(),{timeout:100}):setTimeout($e,0);let Me=[];function Ie(){document.body.classList.remove("hover-focus","dependency-hover"),Me.forEach(e=>e.classList.remove("hover-highlighted","hover-source")),Me=[]}function U(e){document.body.classList.add("hover-focus");let t=Oe?q.get(e)||[]:document.querySelectorAll('.issue-bar[data-issue-id="'+e+'"]'),a=Oe?Y.get(e)||[]:document.querySelectorAll('.issue-label[data-issue-id="'+e+'"]'),f=Oe?ue.get(e)||[]:document.querySelectorAll('.dependency-arrow[data-from="'+e+'"], .dependency-arrow[data-to="'+e+'"]');t.forEach(p=>{p.classList.add("hover-highlighted"),Me.push(p)}),a.forEach(p=>{p.classList.add("hover-highlighted"),Me.push(p)}),f.forEach(p=>{p.classList.add("hover-highlighted"),Me.push(p)})}function Z(e){document.body.classList.add("hover-focus");let t=Oe?qe.get(e)||[]:document.querySelectorAll('.project-label[data-collapse-key="'+e+'"]'),a=Oe?Te.get(e)||[]:document.querySelectorAll('.aggregate-bars[data-collapse-key="'+e+'"]');t.forEach(f=>{f.classList.add("hover-highlighted"),Me.push(f)}),a.forEach(f=>{f.classList.add("hover-highlighted"),Me.push(f)})}let ke=document.querySelector(".gantt-timeline svg"),_e=document.querySelector(".gantt-labels svg");if(ke&&(ke.addEventListener("mouseenter",e=>{let t=e.target.closest(".issue-bar"),a=e.target.closest(".aggregate-bars"),f=e.target.closest(".dependency-arrow");if(t){let p=t.dataset.issueId;p&&U(p)}else if(a){let p=a.dataset.collapseKey;p&&Z(p)}else if(f){let p=f.dataset.from,P=f.dataset.to;document.body.classList.add("dependency-hover"),f.classList.add("hover-source"),Me.push(f),p&&U(p),P&&U(P)}},!0),ke.addEventListener("mouseleave",e=>{let t=e.target.closest(".issue-bar"),a=e.target.closest(".aggregate-bars"),f=e.target.closest(".dependency-arrow");(t||a||f)&&Ie()},!0)),_e&&(_e.addEventListener("mouseenter",e=>{let t=e.target.closest(".issue-label"),a=e.target.closest(".project-label");if(t){let f=t.dataset.issueId;f&&U(f)}else if(a){let f=a.dataset.collapseKey;f&&Z(f)}},!0),_e.addEventListener("mouseleave",e=>{let t=e.target.closest(".issue-label"),a=e.target.closest(".project-label");(t||a)&&Ie()},!0)),ke){let t=function(){document.querySelectorAll(".dependency-arrow.selected").forEach(a=>a.classList.remove("selected")),document.body.classList.remove("arrow-selection-mode"),document.querySelectorAll(".arrow-connected").forEach(a=>a.classList.remove("arrow-connected")),e=null};var Et=t;ke.addEventListener("contextmenu",a=>{let f=a.target.closest(".dependency-arrow");if(!f)return;a.preventDefault();let p=parseInt(f.dataset.relationId),P=f.dataset.from,pe=f.dataset.to;E(a.clientX,a.clientY,p,P,pe)});let e=null;ke.addEventListener("click",a=>{let f=a.target.closest(".dependency-arrow");if(e&&(e.classList.remove("selected"),document.body.classList.remove("arrow-selection-mode"),document.querySelectorAll(".arrow-connected").forEach(pe=>pe.classList.remove("arrow-connected")),e=null),!f)return;a.stopPropagation(),e=f,f.classList.add("selected"),document.body.classList.add("arrow-selection-mode");let p=f.dataset.from,P=f.dataset.to;document.querySelectorAll(`.issue-bar[data-issue-id="${p}"], .issue-bar[data-issue-id="${P}"]`).forEach(pe=>pe.classList.add("arrow-connected")),document.querySelectorAll(`.issue-label[data-issue-id="${p}"], .issue-label[data-issue-id="${P}"]`).forEach(pe=>pe.classList.add("arrow-connected")),I(`Selected relation from #${p} to #${P}`)}),window._ganttArrowClickHandler&&document.removeEventListener("click",window._ganttArrowClickHandler),window._ganttArrowClickHandler=a=>{(e||document.querySelector(".dependency-arrow.selected"))&&!a.target.closest(".dependency-arrow")&&!a.target.closest(".blocks-badge-group")&&!a.target.closest(".blocker-badge")&&t()},document.addEventListener("click",window._ganttArrowClickHandler),window._ganttArrowKeyHandler&&document.removeEventListener("keydown",window._ganttArrowKeyHandler),window._ganttArrowKeyHandler=a=>{let f=e||document.querySelector(".dependency-arrow.selected");a.key==="Escape"&&f&&(a.stopImmediatePropagation(),t())},document.addEventListener("keydown",window._ganttArrowKeyHandler)}mt({vscode:ae,menuUndo:Ae,menuRedo:we,addDocListener:C,closeOnOutsideClick:c,announce:I,saveState:ie,updateUndoRedoButtons:he,undoStack:me,redoStack:xe,selectedIssues:s,clearSelection:L,allIssueBars:r,redmineBaseUrl:G,extendedRelationTypes:ee,minDateMs:j,maxDateMs:O,timelineWidth:y,dayWidth:re,barHeight:_,ganttScroll:w,snapToDay:k,focusOnDependencyChain:Re,clearFocus:Qe,getFocusedIssueId:je,scrollToAndHighlight:ot,setAllowScrollChange:b}),ht({vscode:ae,addDocListener:C,addWinListener:l,announce:I,barHeight:_,selectedCollapseKey:le});function et(){if(!te){ae.postMessage({command:"todayOutOfRange"});return}if(w){let t=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,a=w.clientWidth-t;w.scrollLeft=Math.max(0,H-a/2)}}function ot(e){if(!e)return;h=!0;let t=document.querySelector('.issue-label[data-issue-id="'+e+'"]'),a=document.querySelector('.issue-bar[data-issue-id="'+e+'"]');if(t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("highlighted"),setTimeout(()=>t.classList.remove("highlighted"),1500)),a&&w){let f=a.getBoundingClientRect(),p=w.getBoundingClientRect(),P=w.scrollLeft+f.left-p.left-100;w.scrollTo({left:Math.max(0,P),behavior:"smooth"}),a.classList.add("highlighted"),setTimeout(()=>a.classList.remove("highlighted"),1500)}}gt({vscode:ae,addDocListener:C,menuUndo:Ae,menuRedo:we,undoStack:me,redoStack:xe,saveState:ie,updateUndoRedoButtons:he,announce:I,scrollToAndHighlight:ot,scrollToToday:et}),St({addDocListener:C,addWinListener:l,ganttScroll:w}),requestAnimationFrame(()=>{if(ce!==null&&w){let e=Math.max(j,Math.min(O,ce));Le(e),Ke!==null&&(w.scrollTop=Ke),ce=null,Ke=null}else Xe!==null&&w?(w.scrollLeft=Xe,Ke!==null&&(w.scrollTop=Ke),Xe=null,Ke=null):et();He(),Fe=!1}),document.getElementById("todayBtn")?.addEventListener("click",et);let rt=document.getElementById("resizeHandle"),it=document.getElementById("resizeHandleHeader"),Je=!1,lt=0,ct=0,tt=null;function dt(e,t){Je=!0,tt=t,lt=e.clientX,ct=N.offsetWidth,t.classList.add("dragging"),document.body.classList.add("cursor-col-resize","user-select-none"),e.preventDefault()}rt?.addEventListener("mousedown",e=>dt(e,rt)),it?.addEventListener("mousedown",e=>dt(e,it));let st=!1,nt=null;C("mousemove",e=>{Je&&(nt=e,!st&&(st=!0,requestAnimationFrame(()=>{if(st=!1,!nt)return;let t=nt.clientX-lt,a=Math.min(600,Math.max(120,ct+t));if(Q&&(Q.style.width=a+"px"),N){N.style.width=a+"px";let p=N.querySelector("svg");p&&p.setAttribute("width",String(a))}let f=document.querySelector(".capacity-ribbon-label");f&&(f.style.width=a+B+"px"),fe()})))}),C("mouseup",()=>{Je&&(Je=!1,tt?.classList.remove("dragging"),tt=null,document.body.classList.remove("cursor-col-resize","user-select-none"),ie())}),requestAnimationFrame(()=>{document.getElementById("loadingOverlay")?.classList.remove("visible")}),Ve("initializeGantt-end"),at("initializeGantt","initializeGantt-start","initializeGantt-end")}})();
