"use strict";(()=>{function pt({timelineWidth:E,minimapBarsData:v,minimapHeight:G,minimapBarHeight:W,minimapTodayX:ce,ganttScroll:V,minimapSvg:te,minimapViewport:P,addDocListener:de}){function Le(){let H=document.querySelector(".gantt-body .gantt-sticky-left"),L=document.querySelector(".gantt-container");H&&L&&L.style.setProperty("--sticky-left-width",H.offsetWidth+"px")}requestAnimationFrame(Le),te&&requestAnimationFrame(()=>{let H=G/(v.length+1);if(v.forEach((L,Q)=>{let u=document.createElementNS("http://www.w3.org/2000/svg","rect");u.setAttribute("class",L.classes),u.setAttribute("x",(L.startPct*E).toString()),u.setAttribute("y",(H*(Q+.5)).toString()),u.setAttribute("width",Math.max(2,(L.endPct-L.startPct)*E).toString()),u.setAttribute("height",W.toString()),u.setAttribute("rx","1"),u.setAttribute("fill",L.color),te.insertBefore(u,P)}),ce>0&&ce<E){let L=document.createElementNS("http://www.w3.org/2000/svg","line");L.setAttribute("class","minimap-today"),L.setAttribute("x1",ce.toString()),L.setAttribute("y1","0"),L.setAttribute("x2",ce.toString()),L.setAttribute("y2",G.toString()),te.insertBefore(L,P)}});function De(){if(!V||!P||!E||!V.scrollWidth||!V.clientWidth)return;let H=Math.max(1,V.scrollWidth-V.clientWidth),L=Math.min(1,V.scrollLeft/H),Q=Math.min(1,V.clientWidth/V.scrollWidth),u=Math.max(20,Q*E),ue=L*(E-u);isNaN(ue)||isNaN(u)||(P.setAttribute("x",ue.toString()),P.setAttribute("width",u.toString()))}let ie=!1,F=0;function $(H,L=!1){if(!V||!te||!P)return;let Q=te.getBoundingClientRect(),ue=parseFloat(P.getAttribute("width")||"0")/E*Q.width,z=H.clientX-Q.left;L?z-=F:z-=ue/2;let X=Math.max(0,Math.min(1,z/(Q.width-ue))),se=Math.max(0,V.scrollWidth-V.clientWidth);V.scrollLeft=X*se}return te&&P&&(P.addEventListener("mousedown",H=>{H.stopPropagation(),ie=!0;let L=te.getBoundingClientRect(),u=parseFloat(P.getAttribute("x")||"0")/E*L.width;F=H.clientX-L.left-u}),te.addEventListener("mousedown",H=>{if(H.target===P)return;ie=!0;let L=te.getBoundingClientRect();F=parseFloat(P.getAttribute("width")||"0")/100*L.width/2,$(H,!0)}),de("mousemove",H=>{ie&&$(H,!0)}),de("mouseup",()=>{ie=!1})),{updateMinimapPosition:Le,updateMinimapViewport:De}}function yt(E){let{vscode:v,menuUndo:G,menuRedo:W,addDocListener:ce,closeOnOutsideClick:V,announce:te,saveState:P,updateUndoRedoButtons:de,undoStack:Le,redoStack:De,selectedIssues:ie,clearSelection:F,allIssueBars:$,redmineBaseUrl:H,extendedRelationTypes:L,minDateMs:Q,maxDateMs:u,timelineWidth:ue,dayWidth:z,barHeight:X,ganttScroll:se,snapToDay:fe,focusOnDependencyChain:ge,clearFocus:d,getFocusedIssueId:S,scrollToAndHighlight:y,setAllowScrollChange:C,isDraftModeEnabled:A,isPerfDebugEnabled:l}=E;function h(t,o,n){document.querySelector(".relation-picker")?.remove();let i=ie.size>1&&ie.has(n),r=i?Array.from(ie).map(M=>parseInt(M)):[parseInt(n)],D=document.createElement("div");D.className="relation-picker";let k=160,w=180,R=Math.min(t,window.innerWidth-k-10),I=Math.min(o,window.innerHeight-w-10);D.style.left=Math.max(10,R)+"px",D.style.top=Math.max(10,I)+"px";let x=document.createElement("div");x.style.padding="6px 12px",x.style.fontSize="11px",x.style.opacity="0.7",x.textContent=i?r.length+" issues selected":"#"+n,D.appendChild(x),(i?[{label:"Set % Done...",command:"bulkSetDoneRatio",bulk:!0},{label:"Clear Selection",command:"clearSelection",local:!0}]:[{label:"Update Issue...",command:"openIssue"},{label:"Open in Browser",command:"openInBrowser"},{label:"Show in Issues",command:"showInIssues"},{label:"Log Time",command:"logTime"},{label:"Set % Done",command:"setDoneRatio"},{label:"Toggle Auto-update %",command:"toggleAutoUpdate"},{label:"Toggle Ad-hoc Budget",command:"toggleAdHoc"},{label:"Toggle Precedence",command:"togglePrecedence"},{label:"Set Internal Estimate",command:"setInternalEstimate"},{label:"Copy Link",command:"copyLink",local:!0},{label:"Copy URL",command:"copyUrl"}]).forEach(M=>{let T=document.createElement("button");T.textContent=M.label,T.addEventListener("click",async()=>{if(M.command==="copyLink"){let oe=document.querySelector('.issue-bar[data-issue-id="'+n+'"]')?.dataset?.subject||"Issue #"+n,me=H+"/issues/"+n,ee='<a href="'+me+'">#'+n+" "+oe+"</a>",we=me;try{await navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([we],{type:"text/plain"}),"text/html":new Blob([ee],{type:"text/html"})})]),v.postMessage({command:"showStatus",message:"Copied #"+n+" link"})}catch{await navigator.clipboard.writeText(we),v.postMessage({command:"showStatus",message:"Copied #"+n+" URL"})}}else M.local?F():M.bulk?v.postMessage({command:M.command,issueIds:r}):v.postMessage({command:M.command,issueId:parseInt(n)});D.remove()}),D.appendChild(T)}),document.body.appendChild(D),V(D)}function B(t){let o=Q+t/ue*(u-Q);return new Date(o).toISOString().slice(0,10)}function K(t){let o=Q+t/ue*(u-Q)-864e5;return new Date(o).toISOString().slice(0,10)}let J=document.getElementById("dragDateTooltip"),he=null;function ne(t){let o=new Date(t+"T00:00:00"),n=o.toLocaleDateString("en-US",{month:"short"}),i=o.getDate(),r=o.toLocaleDateString("en-US",{weekday:"short"});return n+" "+i+" ("+r+")"}function _(t,o){let n=new Date(t+"T00:00:00"),i=new Date(o+"T00:00:00"),r=n.toLocaleDateString("en-US",{month:"short"}),D=i.toLocaleDateString("en-US",{month:"short"});return r===D?r+" "+n.getDate()+"-"+i.getDate():r+" "+n.getDate()+"-"+D+" "+i.getDate()}function Me(t){J.textContent=t,J.style.display="block",he=t}function Ae(t){t!==he&&(J.textContent=t,he=t)}function Pe(t,o){let n=o-28,i=!1;n<40&&(n=o+20,i=!0),J.style.left=t+"px",J.style.top=n+"px",J.classList.toggle("flipped",i)}function Be(){J.style.display="none",he=null}let N=4,m=4;function xe(t,o){l&&l()&&console.log("[Arrow Debug]",t,o)}function Oe(t,o,n,i,r,D=!1,k=!1){let w=n>t,R=Math.abs(n-t),I=R<30,x=Math.abs(o-i)<5,g=i>o,M=D?-1:1,T=k?-1:1,j;x&&w?j="sameRow-right":!x&&I?j="nearlyVertical":w?j="diffRow-right":x?j="sameRow-left":j="diffRow-left";let oe;if(x&&w)oe="M "+t+" "+o+" H "+n;else if(x&&!w){let ee=o-X;oe="M "+t+" "+o+" V "+(ee+m)+" q 0 "+-m+" "+M*-m+" "+-m+" H "+(n+T*12-T*m)+" q "+T*-m+" 0 "+T*-m+" "+m+" V "+i+" H "+n}else if(!x&&I){let we=(o+i)/2;oe="M "+t+" "+o+" H "+(t+M*8-M*m)+" q "+M*m+" 0 "+M*m+" "+(g?m:-m)+" V "+(we+(g?-m:m))+" q 0 "+(g?m:-m)+" "+M*-m+" "+(g?m:-m)+" H "+(n+T*8-T*m)+" q "+T*-m+" 0 "+T*-m+" "+(g?m:-m)+" V "+(i+(g?-m:m))+" q 0 "+(g?m:-m)+" "+T*m+" "+(g?m:-m)+" H "+n}else if(w){let ee=D?Math.max(t-8,(t+n)/2):Math.min(t+8,(t+n)/2);oe="M "+t+" "+o+" H "+(ee-M*m)+" q "+M*m+" 0 "+M*m+" "+(g?m:-m)+" V "+(i+(g?-m:m))+" q 0 "+(g?m:-m)+" "+T*m+" "+(g?m:-m)+" H "+n}else{let we=(o+i)/2;oe="M "+t+" "+o+" H "+(t+M*8-M*m)+" q "+M*m+" 0 "+M*m+" "+(g?m:-m)+" V "+(we+(g?-m:m))+" q 0 "+(g?m:-m)+" "+M*-m+" "+(g?m:-m)+" H "+(n+T*8-T*m)+" q "+T*-m+" 0 "+T*-m+" "+(g?m:-m)+" V "+(i+(g?-m:m))+" q 0 "+(g?m:-m)+" "+T*m+" "+(g?m:-m)+" H "+n}let me=k?"M "+(n+N)+" "+(i-N*.6)+" L "+n+" "+i+" L "+(n+N)+" "+(i+N*.6):"M "+(n-N)+" "+(i-N*.6)+" L "+n+" "+i+" L "+(n-N)+" "+(i+N*.6);return xe("calcArrowPath",{inputs:{x1:t,y1:o,x2:n,y2:i,isScheduling:r},conditions:{goingRight:w,horizontalDist:R,nearlyVertical:I,sameRow:x,goingDown:g},pathCase:j,path:oe.substring(0,80)+(oe.length>80?"...":"")}),{path:oe,arrowHead:me}}function We(t){let o=[],n='.dependency-arrow[data-from="'+t+'"], .dependency-arrow[data-to="'+t+'"]';return document.querySelectorAll(n).forEach(i=>{let r=i.getAttribute("data-from"),D=i.getAttribute("data-to"),w=(i.getAttribute("class")||"").match(/rel-(\w+)/),R=w?w[1]:"relates",I=["blocks","precedes","finish_to_start","start_to_start","finish_to_finish","start_to_finish"].includes(R),x=document.querySelector('.issue-bar[data-issue-id="'+r+'"]'),g=document.querySelector('.issue-bar[data-issue-id="'+D+'"]');!x||!g||o.push({element:i,fromId:r,toId:D,isScheduling:I,relType:R,fromBar:x,toBar:g,linePath:i.querySelector(".arrow-line"),hitPath:i.querySelector(".arrow-hit-area"),headPath:i.querySelector(".arrow-head")})}),o}function Te(t,o,n,i){t.forEach(r=>{let D=r.linePath?r.linePath.getAttribute("d"):null,k=r.fromId==o?n:parseFloat(r.fromBar.dataset.startX),w=r.fromId==o?i:parseFloat(r.fromBar.dataset.endX),R=parseFloat(r.fromBar.dataset.centerY),I=r.toId==o?n:parseFloat(r.toBar.dataset.startX),x=r.toId==o?i:parseFloat(r.toBar.dataset.endX),g=parseFloat(r.toBar.dataset.centerY),M=r.relType==="start_to_start"||r.relType==="start_to_finish",T=r.relType==="finish_to_finish"||r.relType==="start_to_finish",j,oe,me,ee;r.isScheduling?(j=M?k-2:w+2,oe=R,me=T?x+2:I-2,ee=g):(j=(k+w)/2,oe=R,me=(I+x)/2,ee=g),xe("updateArrowPositions",{arrow:r.fromId+" -> "+r.toId,isScheduling:r.isScheduling,draggedId:o,barData:{fromStartX:r.fromBar.dataset.startX,fromEndX:r.fromBar.dataset.endX,fromY:r.fromBar.dataset.centerY,toStartX:r.toBar.dataset.startX,toEndX:r.toBar.dataset.endX,toY:r.toBar.dataset.centerY},computed:{fromStartX:k,fromEndX:w,fromY:R,toStartX:I,toEndX:x,toY:g},coords:{x1:j,y1:oe,x2:me,y2:ee},originalPath:D?D.substring(0,60)+"...":null});let{path:we,arrowHead:ye}=Oe(j,oe,me,ee,r.isScheduling,M,T);r.linePath&&r.linePath.setAttribute("d",we),r.hitPath&&r.hitPath.setAttribute("d",we),r.headPath&&r.headPath.setAttribute("d",ye)})}let Ce=document.getElementById("dragConfirmOverlay"),Fe=document.getElementById("dragConfirmMessage"),He=document.getElementById("dragConfirmOk"),_e=document.getElementById("dragConfirmCancel"),be=null;function Ye(t,o,n){!Ce||!Fe||(Fe.textContent=t,be={onConfirm:o,onCancel:n},C(!0),Ce.style.display="flex",He&&He.focus())}function Ke(){Ce&&(Ce.style.display="none"),be=null}function p(){se&&q&&(se.scrollLeft=q.left,se.scrollTop=q.top),q=null}He?.addEventListener("click",()=>{be?.onConfirm&&be.onConfirm(),q=null,Ke()}),_e?.addEventListener("click",()=>{be?.onCancel&&be.onCancel(),p(),Ke()}),Ce?.addEventListener("click",t=>{t.target===Ce&&(be?.onCancel&&be.onCancel(),p(),Ke())}),ce("keydown",t=>{be&&(t.key==="Escape"?(t.preventDefault(),be.onCancel&&be.onCancel(),p(),Ke()):t.key==="Enter"&&(t.preventDefault(),be.onConfirm&&be.onConfirm(),q=null,Ke()))});let c=null,q=null,Z=!1;document.querySelectorAll(".drag-handle").forEach(t=>{t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation(),q={left:se?.scrollLeft,top:se?.scrollTop};let n=t.closest(".issue-bar"),i=t.classList.contains("drag-left"),r=parseInt(n.dataset.issueId),D=parseFloat(n.dataset.startX),k=parseFloat(n.dataset.endX),w=n.dataset.startDate||null,R=n.dataset.dueDate||null,I=n.querySelector(".bar-outline"),x=n.querySelector(".bar-main"),g=n.querySelector(".drag-left"),M=n.querySelector(".drag-right");n.classList.add("dragging");let T=n.querySelector(".bar-labels"),j=T?.classList.contains("labels-left"),oe=We(r),me=n.querySelector(".link-handle");xe("dragStart (resize)",{issueId:r,isLeft:i,connectedArrowCount:oe.length,arrows:oe.map(ye=>({from:ye.fromId,to:ye.toId,isScheduling:ye.isScheduling,currentPath:ye.linePath?ye.linePath.getAttribute("d")?.substring(0,60)+"...":null}))}),c={issueId:r,isLeft:i,isMove:!1,initialMouseX:o.clientX,startX:D,endX:k,oldStartDate:w,oldDueDate:R,barOutline:I,barMain:x,leftHandle:g,rightHandle:M,bar:n,barLabels:T,labelsOnLeft:j,connectedArrows:oe,linkHandle:me};let ee=i?D:k,we=i?w:R;we&&(Me((i?"Start: ":"Due: ")+ne(we)),Pe(o.clientX,o.clientY))})}),document.querySelectorAll(".bar-outline").forEach(t=>{t.addEventListener("mousedown",o=>{if(o.target.classList.contains("drag-handle")||o.ctrlKey||o.metaKey||o.shiftKey)return;o.preventDefault(),o.stopPropagation(),q={left:se?.scrollLeft,top:se?.scrollTop};let n=t.closest(".issue-bar");if(!n)return;let i=n.dataset.issueId,r=ie.size>1&&ie.has(i),k=(r?$.filter(g=>ie.has(g.dataset.issueId)):[n]).map(g=>({issueId:g.dataset.issueId,startX:parseFloat(g.dataset.startX),endX:parseFloat(g.dataset.endX),oldStartDate:g.dataset.startDate||null,oldDueDate:g.dataset.dueDate||null,barOutline:g.querySelector(".bar-outline"),barMain:g.querySelector(".bar-main"),leftHandle:g.querySelector(".drag-left"),rightHandle:g.querySelector(".drag-right"),bar:g,barLabels:g.querySelector(".bar-labels"),labelsOnLeft:g.querySelector(".bar-labels")?.classList.contains("labels-left"),connectedArrows:We(g.dataset.issueId),linkHandle:g.querySelector(".link-handle")}));k.forEach(g=>g.bar.classList.add("dragging"));let w=n.querySelector(".bar-labels"),R=w?.classList.contains("labels-left"),I=We(i),x=n.querySelector(".link-handle");xe("dragStart (move)",{issueId:i,isBulkDrag:r,connectedArrowCount:I.length,arrows:I.map(g=>({from:g.fromId,to:g.toId,isScheduling:g.isScheduling,currentPath:g.linePath?g.linePath.getAttribute("d")?.substring(0,60)+"...":null}))}),c={issueId:parseInt(i),isLeft:!1,isMove:!0,isBulkDrag:r,bulkBars:k,initialMouseX:o.clientX,startX:parseFloat(n.dataset.startX),endX:parseFloat(n.dataset.endX),oldStartDate:n.dataset.startDate||null,oldDueDate:n.dataset.dueDate||null,barOutline:t,barMain:n.querySelector(".bar-main"),leftHandle:n.querySelector(".drag-left"),rightHandle:n.querySelector(".drag-right"),bar:n,barLabels:w,labelsOnLeft:R,connectedArrows:I,linkHandle:x},!r&&n.dataset.startDate&&n.dataset.dueDate&&(Me(_(n.dataset.startDate,n.dataset.dueDate)),Pe(o.clientX,o.clientY))})});let Y=null,le=null,ve=null;function Ie(){Y&&(Y.fromBar.classList.remove("linking-source"),document.querySelectorAll(".link-target").forEach(t=>t.classList.remove("link-target")),le&&(le.remove(),le=null),Y=null,ve=null,document.body.classList.remove("cursor-crosshair"))}function ze(t,o,n,i,r="end",D="start"){document.querySelector(".relation-picker")?.remove();let k=document.createElement("div");k.className="relation-picker";let w=180,R=200,I=Math.min(t,window.innerWidth-w-10),x=Math.min(o,window.innerHeight-R-10);k.style.left=Math.max(10,I)+"px",k.style.top=Math.max(10,x)+"px";let M={end_start:"finish_to_start",end_end:"finish_to_finish",start_start:"start_to_start",start_end:"start_to_finish"}[`${r}_${D}`]||"finish_to_start",T=[{value:"blocks",label:"\u{1F6AB} Blocks",cssClass:"rel-line-blocks",tooltip:"Target cannot be closed until this issue is closed"},{value:"precedes",label:"\u27A1\uFE0F Precedes",cssClass:"rel-line-scheduling",tooltip:"This issue must complete before target can start"},{value:"relates",label:"\u{1F517} Relates to",cssClass:"rel-line-informational",tooltip:"Simple link between issues (no constraints)"},{value:"duplicates",label:"\u{1F4CB} Duplicates",cssClass:"rel-line-informational",tooltip:"Closing target will automatically close this issue"},{value:"copied_to",label:"\u{1F4C4} Copied to",cssClass:"rel-line-informational",tooltip:"This issue was copied to create the target issue"}],j=[{value:"finish_to_start",label:"\u23E9 Finish\u2192Start",cssClass:"rel-line-scheduling",tooltip:"Target starts after this issue finishes (FS)"},{value:"start_to_start",label:"\u25B6\uFE0F Start\u2192Start",cssClass:"rel-line-scheduling",tooltip:"Target starts when this issue starts (SS)"},{value:"finish_to_finish",label:"\u23F9\uFE0F Finish\u2192Finish",cssClass:"rel-line-scheduling",tooltip:"Target finishes when this issue finishes (FF)"},{value:"start_to_finish",label:"\u23EA Start\u2192Finish",cssClass:"rel-line-scheduling",tooltip:"Target finishes when this issue starts (SF)"}];(L?[...T,...j]:T).forEach(me=>{let ee=document.createElement("button");me.value===M&&ee.classList.add("suggested");let we=document.createElement("span");we.className="color-swatch "+me.cssClass,ee.appendChild(we),ee.appendChild(document.createTextNode(me.label)),ee.title=me.tooltip+(me.value===M?" (suggested based on anchors)":""),ee.addEventListener("click",()=>{P(),v.postMessage({command:"createRelation",issueId:n,targetIssueId:i,relationType:me.value}),k.remove()}),k.appendChild(ee)}),document.body.appendChild(k),V(k)}let Xe=".drag-handle, .link-handle, .bar-outline, .blocks-badge-group, .blocker-badge, .progress-badge-group, .flex-badge-group";document.querySelectorAll(".issue-bar").forEach(t=>{t.addEventListener("click",o=>{o.target.closest(Xe)||c||Y||Z||(S()&&d(),y(t.dataset.issueId))}),t.addEventListener("dblclick",o=>{c||Y||Z||(o.preventDefault(),ge(t.dataset.issueId))})});function st(t,o){if(document.querySelectorAll(".dependency-arrow.selected").forEach(i=>i.classList.remove("selected")),document.querySelectorAll(".arrow-connected").forEach(i=>i.classList.remove("arrow-connected")),t.length===0)return;document.body.classList.add("arrow-selection-mode");let n=new Set;t.forEach(i=>{i.classList.add("selected"),n.add(i.dataset.from),n.add(i.dataset.to)}),n.forEach(i=>{document.querySelectorAll(`.issue-bar[data-issue-id="${i}"], .issue-label[data-issue-id="${i}"]`).forEach(r=>r.classList.add("arrow-connected"))}),te(`Highlighted ${t.length} dependency arrow(s) for #${o}`)}document.querySelectorAll(".blocks-badge-group").forEach(t=>{t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation()}),t.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();let n=t.closest(".issue-bar");if(!n)return;let i=n.dataset.issueId,r=Array.from(document.querySelectorAll(`.dependency-arrow[data-from="${i}"]`));st(r,i)})}),document.querySelectorAll(".blocker-badge").forEach(t=>{t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation()}),t.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();let n=t.closest(".issue-bar");if(!n)return;let i=n.dataset.issueId,r=Array.from(document.querySelectorAll(`.dependency-arrow[data-to="${i}"]`));st(r,i)})});let pe=Array.from(document.querySelectorAll(".issue-bar")),nt=10;pe.forEach((t,o)=>{t.addEventListener("keydown",n=>{if(n.key==="Enter"||n.key===" ")n.preventDefault(),y(t.dataset.issueId);else if(n.key==="ArrowDown"&&o<pe.length-1)n.preventDefault(),pe[o+1].focus(),te(`Issue ${pe[o+1].getAttribute("aria-label")}`);else if(n.key==="ArrowUp"&&o>0)n.preventDefault(),pe[o-1].focus(),te(`Issue ${pe[o-1].getAttribute("aria-label")}`);else if(n.key==="Home")n.preventDefault(),pe[0].focus(),te(`First issue: ${pe[0].getAttribute("aria-label")}`);else if(n.key==="End")n.preventDefault(),pe[pe.length-1].focus(),te(`Last issue: ${pe[pe.length-1].getAttribute("aria-label")}`);else if(n.key==="PageDown"){n.preventDefault();let i=Math.min(o+nt,pe.length-1);pe[i].focus(),te(`Issue ${pe[i].getAttribute("aria-label")}`)}else if(n.key==="PageUp"){n.preventDefault();let i=Math.max(o-nt,0);pe[i].focus(),te(`Issue ${pe[i].getAttribute("aria-label")}`)}else if(n.key==="Tab"&&n.shiftKey){let i=t.dataset.issueId,r=document.querySelector(`.issue-label[data-issue-id="${i}"]`);r&&(n.preventDefault(),r.focus(),te(`Label for issue #${i}`))}})}),document.querySelectorAll(".link-handle").forEach(t=>{t.addEventListener("mousedown",o=>{o.stopPropagation(),o.preventDefault();let n=t.closest(".issue-bar"),i=parseInt(n.dataset.issueId),r=parseFloat(t.dataset.cx),D=parseFloat(t.dataset.cy);n.classList.add("linking-source"),document.body.classList.add("cursor-crosshair");let k=document.querySelector("#ganttTimeline svg");if(!document.getElementById("temp-arrow-head")){let R=document.createElementNS("http://www.w3.org/2000/svg","defs");R.innerHTML=`
            <marker id="temp-arrow-head" markerWidth="10" markerHeight="7"
                    refX="9" refY="3.5" orient="auto" markerUnits="strokeWidth">
              <polygon points="0 0, 10 3.5, 0 7" fill="var(--vscode-focusBorder)"/>
            </marker>`,k.insertBefore(R,k.firstChild)}le=document.createElementNS("http://www.w3.org/2000/svg","path"),le.classList.add("temp-link-arrow"),le.setAttribute("stroke","var(--vscode-focusBorder)"),le.setAttribute("stroke-width","2"),le.setAttribute("fill","none"),le.setAttribute("marker-end","url(#temp-arrow-head)"),k.appendChild(le);let w=t.dataset.anchor||"end";Y={fromId:i,fromBar:n,startX:r,startY:D,fromAnchor:w}})}),ce("keydown",t=>{if(t.key==="Escape"){let o=document.querySelector(".relation-picker");if(o){t.stopImmediatePropagation(),o.remove();return}if(Y){t.stopImmediatePropagation(),Ie();return}S()&&(t.stopImmediatePropagation(),d(),te("Focus cleared"))}});let Ze=!1,et=null;ce("mousemove",t=>{!c&&!Y||(et=t,!Ze&&(Ze=!0,requestAnimationFrame(()=>{Ze=!1;let o=et;if(o){if(c){let n=o.clientX-c.initialMouseX;if(c.isMove&&c.isBulkDrag&&c.bulkBars){let i=fe(n)-fe(0);c.bulkBars.forEach(r=>{let D=r.endX-r.startX,k=Math.max(0,Math.min(r.startX+i,ue-D)),w=k+D,R=w-k;r.barOutline.setAttribute("x",k),r.barOutline.setAttribute("width",R),r.barMain&&(r.barMain.setAttribute("x",k),r.barMain.setAttribute("width",R));let I=r.leftHandle.querySelector("rect"),x=r.rightHandle.querySelector("rect");if(I&&I.setAttribute("x",k),x&&x.setAttribute("x",w-14),r.leftHandle.querySelectorAll(".drag-grip circle").forEach((g,M)=>g.setAttribute("cx",k+9)),r.rightHandle.querySelectorAll(".drag-grip circle").forEach((g,M)=>g.setAttribute("cx",w-9)),r.newStartX=k,r.newEndX=w,r.barLabels){let g=r.labelsOnLeft?k-r.startX:w-r.endX;r.barLabels.setAttribute("transform","translate("+g+", 0)")}r.connectedArrows&&Te(r.connectedArrows,r.issueId,k,w),r.linkHandle&&r.linkHandle.querySelectorAll("circle").forEach(g=>g.setAttribute("cx",String(w+8)))}),c.snappedDelta=i}else{let i=c.startX,r=c.endX,D=c.endX-c.startX;c.isMove?(i=fe(Math.max(0,Math.min(c.startX+n,ue-D))),r=i+D):c.isLeft?i=fe(Math.max(0,Math.min(c.startX+n,c.endX-z))):r=fe(Math.max(c.startX+z,Math.min(c.endX+n,ue)));let k=r-i;c.barOutline.setAttribute("x",i),c.barOutline.setAttribute("width",k),c.barMain&&(c.barMain.setAttribute("x",i),c.barMain.setAttribute("width",k));let w=c.leftHandle.querySelector("rect"),R=c.rightHandle.querySelector("rect");if(w&&w.setAttribute("x",i),R&&R.setAttribute("x",r-14),c.leftHandle.querySelectorAll(".drag-grip circle").forEach(I=>I.setAttribute("cx",i+9)),c.rightHandle.querySelectorAll(".drag-grip circle").forEach(I=>I.setAttribute("cx",r-9)),c.newStartX=i,c.newEndX=r,c.barLabels){let I=c.labelsOnLeft?i-c.startX:r-c.endX;c.barLabels.setAttribute("transform","translate("+I+", 0)")}if(c.connectedArrows&&Te(c.connectedArrows,c.issueId,i,r),c.linkHandle&&c.linkHandle.querySelectorAll("circle").forEach(I=>I.setAttribute("cx",String(r+8))),c.isMove&&!c.isBulkDrag){let I=B(i),x=K(r),M=I!==c.oldStartDate?_(c.oldStartDate,c.oldDueDate)+" \u2192 "+_(I,x):_(I,x);Ae(M),Pe(o.clientX,o.clientY)}else if(!c.isMove){let I=c.isLeft?i:r,x=c.isLeft?B(I):K(I);Ae((c.isLeft?"Start: ":"Due: ")+ne(x)),Pe(o.clientX,o.clientY)}}}if(Y&&le){let i=document.querySelector("#ganttTimeline svg").getBoundingClientRect(),r=o.clientX-i.left,D=o.clientY-i.top,k=`M ${Y.startX} ${Y.startY} L ${r} ${D}`;le.setAttribute("d",k);let w=document.elementFromPoint(o.clientX,o.clientY)?.closest(".issue-bar");ve&&ve!==w&&ve.classList.remove("link-target"),w&&w!==Y.fromBar?(w.classList.add("link-target"),ve=w):ve=null}}})))});function Ge(t){if(!t)return;let{bar:o,barOutline:n,barMain:i,leftHandle:r,rightHandle:D,barLabels:k,startX:w,endX:R,connectedArrows:I,issueId:x,linkHandle:g}=t,M=R-w;if(n&&(n.setAttribute("x",String(w)),n.setAttribute("width",String(M))),i&&(i.setAttribute("x",String(w)),i.setAttribute("width",String(M))),r){let T=r.querySelector("rect");T&&T.setAttribute("x",String(w)),r.querySelectorAll(".drag-grip circle").forEach(j=>j.setAttribute("cx",w+9))}if(D){let T=D.querySelector("rect");T&&T.setAttribute("x",String(R-14)),D.querySelectorAll(".drag-grip circle").forEach(j=>j.setAttribute("cx",R-9))}k&&k.removeAttribute("transform"),I&&I.length>0&&Te(I,x,w,R),g&&g.querySelectorAll("circle").forEach(T=>T.setAttribute("cx",String(R+8))),o&&o.classList.remove("dragging")}ce("mouseup",t=>{if(c){let{issueId:o,isLeft:n,isMove:i,isBulkDrag:r,bulkBars:D,newStartX:k,newEndX:w,bar:R,startX:I,endX:x,oldStartDate:g,oldDueDate:M,barOutline:T,barMain:j,leftHandle:oe,rightHandle:me,barLabels:ee,connectedArrows:we}=c,ye={...c};if(r&&D&&i){D.forEach(U=>U.bar.classList.remove("dragging"));let Re=[];if(D.forEach(U=>{if(U.newStartX!==void 0&&U.newStartX!==U.startX){let re=B(U.newStartX),Se=K(U.newEndX);(re!==U.oldStartDate||Se!==U.oldDueDate)&&Re.push({issueId:parseInt(U.issueId),oldStartDate:U.oldStartDate,oldDueDate:U.oldDueDate,newStartDate:re,newDueDate:Se,barData:U})}}),Re.length>0){Be();let U=()=>{Le.push({type:"bulk",changes:Re.map(re=>({issueId:re.issueId,oldStartDate:re.oldStartDate,oldDueDate:re.oldDueDate,newStartDate:re.newStartDate,newDueDate:re.newDueDate}))}),De.length=0,de(),P(),Re.forEach(re=>{v.postMessage({command:"updateDates",issueId:re.issueId,startDate:re.newStartDate,dueDate:re.newDueDate})})};if(A&&A())U();else{let re="Move "+Re.length+" issue(s) to new dates?";Ye(re,U,()=>{D.forEach(Se=>Ge(Se))})}}else Be(),D.forEach(U=>Ge(U));c=null,Z=!0,requestAnimationFrame(()=>Z=!1);return}if(R.classList.remove("dragging"),Be(),k!==void 0||w!==void 0){let Re=null,U=null;i?k!==I&&(Re=B(k),U=K(w)):n?Re=k!==I?B(k):null:U=w!==x?K(w):null;let re=Re&&Re!==g?Re:null,Se=U&&U!==M?U:null;if(re||Se){let Qe=()=>{Le.push({issueId:o,oldStartDate:re?g:null,oldDueDate:Se?M:null,newStartDate:re,newDueDate:Se}),De.length=0,de(),P(),v.postMessage({command:"updateDates",issueId:o,startDate:re,dueDate:Se})};if(A&&A())Qe();else{let Ne="Issue #"+o+": ";re&&Se?Ne+=_(g,M)+" \u2192 "+_(re,Se):re?Ne+="Start: "+ne(g)+" \u2192 "+ne(re):Ne+="Due: "+ne(M)+" \u2192 "+ne(Se),Ye(Ne,Qe,()=>{Ge(ye)})}}else Ge(ye)}else Ge(ye);c=null,Z=!0,requestAnimationFrame(()=>Z=!1)}if(Y){let o=Y.fromId,n=Y.fromAnchor;if(ve){let i=parseInt(ve.dataset.issueId);if(o!==i){let D=document.querySelector("#ganttTimeline svg").getBoundingClientRect(),k=t.clientX-D.left,w=ve.querySelector(".bar-outline"),R=parseFloat(w.getAttribute("x")),I=R+parseFloat(w.getAttribute("width")),x=(R+I)/2,g=k<x?"start":"end";ze(t.clientX,t.clientY,o,i,n,g)}}Ie()}be||p()}),G?.addEventListener("click",()=>{if(G.hasAttribute("disabled")||Le.length===0)return;let t=Le.pop();if(De.push(t),de(),P(),t.type==="relation")t.operation==="create"?v.postMessage({command:"undoRelation",operation:"delete",relationId:t.relationId,datesBefore:t.datesBefore}):v.postMessage({command:"undoRelation",operation:"create",issueId:t.issueId,targetIssueId:t.targetIssueId,relationType:t.relationType});else if(t.type==="bulk"){let o=A&&A();t.changes.forEach(n=>{o?v.postMessage({command:"removeDraft",issueId:n.issueId,startDate:n.oldStartDate,dueDate:n.oldDueDate}):v.postMessage({command:"updateDates",issueId:n.issueId,startDate:n.oldStartDate,dueDate:n.oldDueDate})})}else A&&A()?v.postMessage({command:"removeDraft",issueId:t.issueId,startDate:t.oldStartDate,dueDate:t.oldDueDate}):v.postMessage({command:"updateDates",issueId:t.issueId,startDate:t.oldStartDate,dueDate:t.oldDueDate})}),W?.addEventListener("click",()=>{if(W.hasAttribute("disabled")||De.length===0)return;let t=De.pop();Le.push(t),de(),P(),t.type==="relation"?t.operation==="create"?v.postMessage({command:"redoRelation",operation:"create",issueId:t.issueId,targetIssueId:t.targetIssueId,relationType:t.relationType}):v.postMessage({command:"redoRelation",operation:"delete",relationId:t.relationId}):t.type==="bulk"?t.changes.forEach(o=>{v.postMessage({command:"updateDates",issueId:o.issueId,startDate:o.newStartDate,dueDate:o.newDueDate})}):v.postMessage({command:"updateDates",issueId:t.issueId,startDate:t.newStartDate,dueDate:t.newDueDate})})}function bt(E){let{vscode:v,addDocListener:G,addWinListener:W,announce:ce,barHeight:V,selectedCollapseKey:te}=E;document.querySelectorAll(".collapse-toggle").forEach(d=>{d.addEventListener("click",S=>{S.stopPropagation();let C=d.closest("[data-collapse-key]")?.dataset.collapseKey;C&&ge(C)})}),document.getElementById("menuExpand")?.addEventListener("click",()=>{let S=document.getElementById("ganttScroll")?.dataset.allExpandableKeys,y=S?JSON.parse(S):[];v.postMessage({command:"expandAll",keys:y})}),document.getElementById("menuCollapse")?.addEventListener("click",()=>{v.postMessage({command:"collapseAll"})});let P=Array.from(document.querySelectorAll(".project-label, .issue-label, .time-group-label")),de=null,Le=te??null;function De(d){return!d.classList.contains("gantt-row-hidden")&&d.getAttribute("visibility")!=="hidden"}function ie(d,S){let y=d+S;for(;y>=0&&y<P.length;){if(De(P[y]))return{label:P[y],index:y};y+=S}return null}function F(d){let S=document.getElementById("ganttScroll"),y=document.querySelector(".gantt-header-row");if(!S||!d)return;let C=y?.getBoundingClientRect().height||60,A=d.closest(".gantt-row");if(!A)return;let l=A.getBoundingClientRect().top,h=A.getBoundingClientRect().height,B=S.getBoundingClientRect(),K=B.top+C,J=B.bottom;l<K?S.scrollBy({top:l-K-4,behavior:"smooth"}):l+h>J&&S.scrollBy({top:l+h-J+4,behavior:"smooth"})}function $(d,S=!1,y=!1,C=!1){de&&de.classList.remove("active"),de=d,d&&(d.classList.add("active"),C||d.focus(),y&&F(d),S||v.postMessage({command:"setSelectedKey",collapseKey:d.dataset.collapseKey}))}W("focus",()=>{de&&De(de)&&de.focus()}),G("keydown",d=>{d.key==="Escape"&&de&&(de.classList.remove("active"),de.blur(),de=null,v.postMessage({command:"setSelectedKey",collapseKey:null}))});let H=new Map,L=new Map,Q=new Map;function u(d){let S=d.dataset.originalY;if(Q.has(S))return Q.get(S);let y=JSON.parse(d.dataset.rowContributions||"{}");return Q.set(S,y),y}function ue(){H.clear(),document.querySelectorAll("[data-collapse-key][data-original-y]").forEach(S=>{let y=S.dataset.collapseKey,C=parseFloat(S.dataset.originalY);H.has(y)||H.set(y,{originalY:C,elements:[]}),H.get(y).elements.push(S)})}function z(){L.clear(),document.querySelectorAll("[data-collapse-key][data-parent-key]").forEach(S=>{let y=S.dataset.collapseKey;if(L.has(y))return;let C=[],A=S.dataset.parentKey;for(;A;)C.push(A),A=document.querySelector('[data-collapse-key="'+A+'"]')?.dataset.parentKey||null;L.set(y,C)})}ue(),z();function X(d,S){S?(d.setAttribute("visibility","hidden"),d.classList.add("gantt-row-hidden")):(d.removeAttribute("visibility"),d.classList.remove("gantt-row-hidden"))}function se(d){let S=[];return L.forEach((y,C)=>{y.includes(d)&&S.push(C)}),S}function fe(d){let S=[];return L.forEach((y,C)=>{let A=y.indexOf(d);if(A===-1)return;let l=!0;for(let h=0;h<A;h++){let B=y[h],K=document.querySelector('[data-collapse-key="'+B+'"].project-label, [data-collapse-key="'+B+'"].issue-label, [data-collapse-key="'+B+'"].time-group-label');if(!K||K.dataset.expanded!=="true"){l=!1;break}}l&&S.push(C)}),S}function ge(d,S){let y=document.querySelector('[data-collapse-key="'+d+'"].project-label, [data-collapse-key="'+d+'"].time-group-label, [data-collapse-key="'+d+'"].issue-label');if(!y||y.dataset.hasChildren!=="true")return;let C=y.dataset.expanded==="true",A=S==="expand"?!0:S==="collapse"?!1:!C;if(A===C)return;y.dataset.expanded=A?"true":"false";let l=y.querySelector(".collapse-toggle");l&&l.classList.toggle("expanded",A);let h=se(d),B=A?fe(d):[];if(h.length===0){v.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:A});return}let K=new Set(h),J=new Set(B),he=H.get(d),ne=he?.originalY??0,_=new Set,Me=0,Ae=0,Be=A?B:fe(d),N=new Set(Be);if(document.querySelectorAll(".zebra-stripe").forEach(p=>{let c=u(p);d in c&&Ae===0&&(Ae=parseFloat(p.dataset.originalY||"0"));for(let[q,Z]of Object.entries(c))N.has(q)&&!_.has(q)&&(Me+=parseFloat(Z),_.add(q))}),Me===0&&Be.length>0){v.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:A}),v.postMessage({command:"requestRerender"});return}let m=A?Me:-Me,xe=ne;if(he&&he.elements.length>0){let c=(he.elements[0].getAttribute("transform")||"").match(/translate\([^,]+,\s*([-\d.]+)/);c&&(xe=parseFloat(c[1]))}let Oe=xe+V;A?B.forEach(p=>{let c=H.get(p);c&&(c.elements.forEach(q=>{let Y=(q.getAttribute("transform")||"").match(/translate\(([-\d.]+)/),le=Y?Y[1]:"0";q.setAttribute("transform","translate("+le+", "+Oe+")"),X(q,!1)}),Oe+=V)}):h.forEach(p=>{let c=H.get(p);c&&c.elements.forEach(q=>{X(q,!0)})}),H.forEach(({originalY:p,elements:c},q)=>{p>ne&&!K.has(q)&&c.forEach(Z=>{let Y=Z.getAttribute("transform")||"",le=Y.match(/translate\(([-\d.]+)/),ve=le?le[1]:"0",Ie=Y.match(/translate\([^,]+,\s*([-\d.]+)/),Xe=(Ie?parseFloat(Ie[1]):p)+m;Z.setAttribute("transform","translate("+ve+", "+Xe+")")})});let We=document.querySelector(".gantt-labels svg");if(We){let c=parseFloat(We.getAttribute("height")||"0")+m;We.setAttribute("height",String(c))}[".gantt-col-status svg",".gantt-col-id svg",".gantt-col-start svg",".gantt-col-due svg",".gantt-col-assignee svg"].forEach(p=>{let c=document.querySelector(p);if(!c)return;let Z=parseFloat(c.getAttribute("height")||"0")+m;c.setAttribute("height",String(Z))});let Ce=document.querySelector(".gantt-timeline svg");if(Ce){let c=parseFloat(Ce.getAttribute("height")||"0")+m;Ce.setAttribute("height",c)}let Fe=new Set;document.querySelectorAll('.project-label[data-has-children="true"], .time-group-label[data-has-children="true"], .issue-label[data-has-children="true"]').forEach(p=>{p.dataset.expanded==="false"&&Fe.add(p.dataset.collapseKey)});let He=new Map,_e=document.querySelectorAll(".zebra-stripe");_e.forEach(p=>{let c=parseFloat(p.dataset.originalY||"0");if(He.has(c))return;let q=u(p),Z=Object.keys(q),Y=Z.length>0&&Z.every(Ie=>K.has(Ie)),le=Z.some(Ie=>K.has(Ie)),ve=c>Ae;if(Y)He.set(c,{action:"toggle-visibility",hide:!A});else if(le)if(A){let Ie=0;for(let[ze,Xe]of Object.entries(q))(!K.has(ze)||J.has(ze))&&(Ie+=parseFloat(Xe));He.set(c,{action:"expand",newHeight:Ie})}else{let Ie=0;for(let[ze,Xe]of Object.entries(q))K.has(ze)||(Ie+=parseFloat(Xe));He.set(c,{action:"shrink",newHeight:Ie})}else if(ve){let Ie=parseFloat(p.getAttribute("y")||String(c));He.set(c,{action:"shift",newY:Ie+m})}}),_e.forEach(p=>{let c=parseFloat(p.dataset.originalY||"0"),q=He.get(c);if(q)switch(q.action){case"toggle-visibility":X(p,q.hide);break;case"shrink":p.setAttribute("height",String(q.newHeight));break;case"expand":p.setAttribute("height",String(q.newHeight));break;case"shift":p.setAttribute("y",String(q.newY));break}});let be=Array.from(document.querySelectorAll(".zebra-stripe")).filter(p=>p.getAttribute("visibility")!=="hidden"),Ye=new Map;be.forEach(p=>{let c=parseFloat(p.getAttribute("y")||"0");Ye.has(c)||Ye.set(c,[]),Ye.get(c).push(p)}),Array.from(Ye.keys()).sort((p,c)=>p-c).forEach((p,c)=>{let q=c%2===0?"0.03":"0.06";Ye.get(p).forEach(Z=>Z.setAttribute("opacity",q))}),document.querySelectorAll(".indent-guide-line").forEach(p=>{let c=p.dataset.forParent,q=L.get(c)||[],Z=Fe.has(c)||q.some(Y=>Fe.has(Y));if(X(p,Z),!Z){let Y=H.get(c);if(Y&&Y.originalY>ne){let le=parseFloat(p.getAttribute("y1")||"0"),ve=parseFloat(p.getAttribute("y2")||"0");p.setAttribute("y1",le+m),p.setAttribute("y2",ve+m)}}}),document.querySelectorAll(".dependency-arrow").forEach(p=>{let c=p.dataset.from,q=p.dataset.to,Z=document.querySelector('.issue-bar[data-issue-id="'+c+'"]'),Y=document.querySelector('.issue-bar[data-issue-id="'+q+'"]'),le=Z?.classList.contains("gantt-row-hidden"),ve=Y?.classList.contains("gantt-row-hidden");X(p,le||ve)}),v.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:A})}if(Le){let d=P.find(S=>S.dataset.collapseKey===Le);d&&$(d,!0)}P.forEach((d,S)=>{d.addEventListener("click",y=>{if(y.target.closest?.(".collapse-toggle")||y.target.closest?.(".chevron-hit-area"))return;let C=d.dataset.issueId,A=d.classList.contains("project-label"),l=d.classList.contains("time-group-label"),h=d.dataset.collapseKey;if((A||l)&&h){$(d),d.dataset.hasChildren==="true"&&ge(h);return}let B=y.target.classList?.contains("issue-text")||y.target.closest(".issue-text");C&&B?($(d,!1,!1,!0),v.postMessage({command:"openIssue",issueId:parseInt(C,10)})):d.dataset.hasChildren==="true"&&h?($(d),ge(h)):$(d)}),d.addEventListener("keydown",y=>{let C=d.dataset.collapseKey,A=d.dataset.issueId?parseInt(d.dataset.issueId,10):NaN;switch(y.key){case"Enter":case" ":y.preventDefault(),isNaN(A)||v.postMessage({command:"openIssue",issueId:A});break;case"ArrowUp":{y.preventDefault();let l=ie(S,-1);l&&$(l.label,!1,!0);break}case"ArrowDown":{y.preventDefault();let l=ie(S,1);l&&$(l.label,!1,!0);break}case"ArrowLeft":if(y.preventDefault(),d.dataset.hasChildren==="true"&&d.dataset.expanded==="true")ge(C,"collapse");else if(d.dataset.parentKey){let l=P.find(h=>h.dataset.collapseKey===d.dataset.parentKey);l&&$(l,!1,!0)}break;case"ArrowRight":if(y.preventDefault(),d.dataset.hasChildren==="true"&&d.dataset.expanded==="false")ge(C,"expand");else if(d.dataset.hasChildren==="true"&&d.dataset.expanded==="true"){let l=P.find(h=>h.dataset.parentKey===C&&De(h));l&&$(l,!1,!0)}break;case"Home":{y.preventDefault();let l=ie(-1,1);l&&$(l.label,!1,!0);break}case"End":{y.preventDefault();let l=ie(P.length,-1);l&&$(l.label,!1,!0);break}case"PageDown":{y.preventDefault();let l=S,h=0;for(;h<10&&l<P.length-1;){let B=ie(l,1);if(!B)break;l=B.index,h++}h>0&&$(P[l],!1,!0);break}case"PageUp":{y.preventDefault();let l=S,h=0;for(;h<10&&l>0;){let B=ie(l,-1);if(!B)break;l=B.index,h++}h>0&&$(P[l],!1,!0);break}case"Tab":if(!y.shiftKey&&!isNaN(A)){let l=document.querySelector(`.issue-bar[data-issue-id="${A}"]`);l&&(y.preventDefault(),l.focus(),ce(`Timeline bar for issue #${A}`))}break}})})}function vt(E){let{vscode:v,addDocListener:G,menuUndo:W,menuRedo:ce,undoStack:V,redoStack:te,saveState:P,updateUndoRedoButtons:de,announce:Le,scrollToAndHighlight:De,scrollToToday:ie}=E;G("keydown",u=>{let z=navigator.platform.toUpperCase().indexOf("MAC")>=0?u.metaKey:u.ctrlKey;if(!(u.target.tagName==="INPUT"||u.target.tagName==="SELECT"||u.target.tagName==="TEXTAREA"))if(z&&u.key==="z"&&!u.shiftKey)u.preventDefault(),W?.click();else if(z&&u.key==="z"&&u.shiftKey)u.preventDefault(),ce?.click();else if(z&&u.key==="y")u.preventDefault(),ce?.click();else if(u.key>="1"&&u.key<="5"){let X=document.getElementById("zoomSelect"),se=["day","week","month","quarter","year"];X.value=se[parseInt(u.key)-1],X.dispatchEvent(new Event("change"))}else if(u.key.toLowerCase()==="h")document.getElementById("menuHeatmap")?.click();else if(u.key.toLowerCase()==="y")document.getElementById("menuCapacity")?.click();else if(u.key.toLowerCase()==="i")document.getElementById("menuIntensity")?.click();else if(u.key.toLowerCase()==="d")document.getElementById("menuDeps")?.click();else if(u.key.toLowerCase()==="v"){let X=document.getElementById("viewFocusSelect");X.value=X.value==="project"?"person":"project",X.dispatchEvent(new Event("change"))}else if(u.key.toLowerCase()==="r")document.getElementById("refreshBtn")?.click();else if(u.key.toLowerCase()==="t")ie();else if(u.key.toLowerCase()==="e")document.getElementById("menuExpand")?.click();else if(u.key.toLowerCase()==="c"&&!z)document.getElementById("menuCollapse")?.click();else if(u.key.toLowerCase()==="f"&&!z)u.preventDefault(),document.getElementById("menuFilterHealth")?.click();else if(u.key.toLowerCase()==="b"){u.preventDefault();let X=Array.from(document.querySelectorAll(".issue-bar[data-issue-id]")).filter(S=>S.querySelector(".blocker-badge"));if(X.length===0){Le("No blocked issues");return}let se=document.activeElement?.closest(".issue-bar"),ge=((se?X.indexOf(se):-1)+1)%X.length,d=X[ge];De(d.dataset.issueId),d.focus(),Le("Blocked issue "+(ge+1)+" of "+X.length)}else if(u.key==="ArrowLeft"||u.key==="ArrowRight"){let X=document.activeElement?.closest(".issue-bar:not(.parent-bar)");if(!X)return;u.preventDefault();let se=parseInt(X.dataset.issueId),fe=X.dataset.startDate,ge=X.dataset.dueDate;if(!fe&&!ge)return;let d=u.key==="ArrowRight"?1:-1,S=(A,l)=>{let h=new Date(A+"T00:00:00");return h.setDate(h.getDate()+l),h.toISOString().slice(0,10)},y=null,C=null;u.shiftKey&&ge?C=S(ge,d):u.altKey&&fe?y=S(fe,d):(fe&&(y=S(fe,d)),ge&&(C=S(ge,d))),(y||C)&&(P(),V.push({issueId:se,oldStartDate:y?fe:null,oldDueDate:C?ge:null,newStartDate:y,newDueDate:C}),te.length=0,de(),v.postMessage({command:"updateDates",issueId:se,startDate:y,dueDate:C}))}else u.key==="/"&&!z?(u.preventDefault(),$()):(u.key==="?"||u.shiftKey&&u.key==="/")&&(u.preventDefault(),Q())});let F=null;function $(){F&&F.remove(),F=document.createElement("div"),F.className="quick-search",F.innerHTML=`
      <input type="text" placeholder="Search issues..." autofocus />
    `,document.body.appendChild(F);let u=F.querySelector("input");u.focus();let ue=Array.from(document.querySelectorAll(".issue-label"));u.addEventListener("input",()=>{let z=u.value.toLowerCase();ue.forEach(X=>{let se=X.getAttribute("aria-label")?.toLowerCase()||"",fe=z&&se.includes(z);X.classList.toggle("search-match",fe)})}),u.addEventListener("keydown",z=>{if(z.key==="Escape")H();else if(z.key==="Enter"){let X=document.querySelector(".issue-label.search-match");X&&(H(),X.focus(),De(X.dataset.issueId))}}),u.addEventListener("blur",()=>setTimeout(H,150))}function H(){F&&(F.remove(),F=null,document.querySelectorAll(".search-match").forEach(u=>u.classList.remove("search-match")))}let L=null;function Q(){if(L){L.remove(),L=null;return}L=document.createElement("div"),L.className="keyboard-help",L.innerHTML=`
      <div class="keyboard-help-content">
        <h3>Keyboard Shortcuts</h3>
        <div class="shortcut-grid">
          <div class="shortcut-section">
            <h4>Navigation</h4>
            <div><kbd>\u2191</kbd><kbd>\u2193</kbd> Move between issues</div>
            <div><kbd>Home</kbd><kbd>End</kbd> First/last issue</div>
            <div><kbd>PgUp</kbd><kbd>PgDn</kbd> Jump 10 rows</div>
            <div><kbd>Tab</kbd> Label \u2192 Bar</div>
            <div><kbd>Shift+Tab</kbd> Bar \u2192 Label</div>
          </div>
          <div class="shortcut-section">
            <h4>Date Editing</h4>
            <div><kbd>\u2190</kbd><kbd>\u2192</kbd> Move bar \xB11 day</div>
            <div><kbd>Shift+\u2190/\u2192</kbd> Resize end</div>
            <div><kbd>Alt+\u2190/\u2192</kbd> Resize start</div>
            <div><kbd>Ctrl+Z</kbd> Undo</div>
            <div><kbd>Ctrl+Y</kbd> Redo</div>
          </div>
          <div class="shortcut-section">
            <h4>View</h4>
            <div><kbd>1-5</kbd> Zoom levels</div>
            <div><kbd>H</kbd> Heatmap</div>
            <div><kbd>D</kbd> Dependencies</div>
            <div><kbd>C</kbd> Critical path</div>
            <div><kbd>T</kbd> Today</div>
          </div>
          <div class="shortcut-section">
            <h4>Health & Other</h4>
            <div><kbd>F</kbd> Cycle health filter</div>
            <div><kbd>B</kbd> Next blocked issue</div>
            <div><kbd>/</kbd> Quick search</div>
            <div><kbd>S</kbd> Cycle sort</div>
            <div><kbd>R</kbd> Refresh</div>
            <div><kbd>Esc</kbd> Clear/cancel</div>
          </div>
        </div>
        <p class="keyboard-help-close">Press <kbd>?</kbd> or <kbd>Esc</kbd> to close</p>
      </div>
    `,document.body.appendChild(L),L.addEventListener("click",u=>{u.target===L&&Q()})}G("keydown",u=>{u.key==="Escape"&&L&&(u.stopImmediatePropagation(),Q())})}var ae=acquireVsCodeApi(),tt=!1;function Je(E){tt&&typeof performance<"u"&&performance.mark(E)}function lt(E,v,G){if(tt&&typeof performance<"u")try{performance.measure(E,v,G);let W=performance.getEntriesByName(E,"measure");W.length>0&&console.log(`[Gantt Perf] ${E}: ${W[W.length-1].duration.toFixed(2)}ms`),performance.clearMarks(v),performance.clearMarks(G),performance.clearMeasures(E)}catch{}}function Et(){if(tt){let E=document.getElementById("ganttRoot"),v=E?E.querySelectorAll("*").length:0,G=E?E.querySelectorAll("svg *").length:0;console.log(`[Gantt Perf] DOM nodes: ${v}, SVG elements: ${G}`)}}function Lt(E){if(!E)return;let v=document.documentElement;v.style.setProperty("--gantt-header-height",`${E.headerHeight}px`),v.style.setProperty("--gantt-label-width",`${E.labelWidth}px`),v.style.setProperty("--gantt-id-column-width",`${E.idColumnWidth}px`),v.style.setProperty("--gantt-start-date-column-width",`${E.startDateColumnWidth}px`),v.style.setProperty("--gantt-status-column-width",`${E.statusColumnWidth}px`),v.style.setProperty("--gantt-due-date-column-width",`${E.dueDateColumnWidth}px`),v.style.setProperty("--gantt-assignee-column-width",`${E.assigneeColumnWidth}px`),v.style.setProperty("--gantt-sticky-left-width",`${E.stickyLeftWidth}px`)}function Dt({addDocListener:E,addWinListener:v}){let G=document.getElementById("ganttRoot"),W=document.getElementById("ganttTooltip"),ce=W?.querySelector(".gantt-tooltip-content");if(!G||!W||!ce)return;let V=l=>l?String(l).replace(/\r\n/g,`
`).trimEnd():"";function te(){G.querySelectorAll("svg title").forEach(l=>{let h=l.parentElement,B=V(l.textContent);h&&B&&(h.dataset.tooltip=B),l.remove()})}function P(){G.querySelectorAll("[title]").forEach(l=>{if(l.tagName.toLowerCase()==="title")return;let h=V(l.getAttribute("title"));l.removeAttribute("title"),h&&(l.dataset.tooltip=h)})}function de(){G.querySelectorAll("[data-toolbar-tooltip]").forEach(l=>{let h=V(l.dataset.toolbarTooltip);delete l.dataset.toolbarTooltip,h&&(l.dataset.tooltip=h)})}function Le(){te(),P(),de()}function De(l){let h=l.findIndex(K=>K.trim().startsWith("#"));return h>=0?h:l.filter(K=>K.trim()).length>1?l.findIndex(K=>K.trim()):-1}function ie(l){ce.textContent="";let h=V(l);if(!h)return;let B=h.split(`
`),K=De(B),J=!1;B.forEach((ne,_)=>{let Me=ne.trim();if(!Me){if(!J){let N=document.createElement("div");N.className="gantt-tooltip-spacer",ce.appendChild(N),J=!0}return}if(Me==="---"){let N=document.createElement("div");N.className="gantt-tooltip-divider",ce.appendChild(N),J=!1;return}let Ae=Me.match(/^cf:([^:]+):(.*)$/);if(Ae){let N=Ae[1].trim(),m=Ae[2].trim(),xe=document.createElement("div");xe.className="gantt-tooltip-line";let Oe=document.createElement("span");Oe.className="gantt-tooltip-key",Oe.textContent=`${N}: `,xe.appendChild(Oe),m&&xe.appendChild(document.createTextNode(m)),ce.appendChild(xe),J=!1;return}let Pe=document.createElement("div");Pe.className="gantt-tooltip-line",_===K&&Pe.classList.add("gantt-tooltip-title");let Be=Me.match(/^Open in Browser:\s*(\S+)/);if(Be&&/^https?:\/\//i.test(Be[1])){Pe.appendChild(document.createTextNode("Open in Browser: "));let N=document.createElement("a");N.href=Be[1],N.textContent=Be[1],N.target="_blank",N.rel="noopener noreferrer",Pe.appendChild(N)}else Pe.textContent=ne;ce.appendChild(Pe),J=!1});let he=ce.lastElementChild;he&&he.classList.contains("gantt-tooltip-spacer")&&he.remove()}let F=null,$=null,H=null,L={x:0,y:0};function Q(l){L={x:l.clientX,y:l.clientY}}function u(){$&&(clearTimeout($),$=null)}function ue(){H&&(clearTimeout(H),H=null)}function z(l){return l&&(l===W||W.contains(l))}function X(l){return l&&F&&(l===F||F.contains(l))}function se(){if(!L)return!1;let l=document.elementFromPoint(L.x,L.y);return z(l)||X(l)}let fe=300;function ge(l){ue(),H=setTimeout(()=>{H=null,!(!F||F!==l)&&se()&&y(l,L.x,L.y)},fe)}function d(){u(),$=setTimeout(()=>{F&&(se()||C())},300)}function S(l,h){let J=W.getBoundingClientRect(),he=l+8,ne=h+8;he+J.width>window.innerWidth-8&&(he=l-J.width-8),ne+J.height>window.innerHeight-8&&(ne=h-J.height-8),he=Math.max(8,Math.min(he,window.innerWidth-J.width-8)),ne=Math.max(8,Math.min(ne,window.innerHeight-J.height-8)),W.style.left=`${Math.round(he)}px`,W.style.top=`${Math.round(ne)}px`}function y(l,h,B){let K=l.dataset.tooltip;K&&(ie(K),W.classList.add("visible"),W.setAttribute("aria-hidden","false"),S(h,B))}function C(l=!1){ue(),u(),W.classList.remove("visible"),W.setAttribute("aria-hidden","true"),l||(F=null)}function A(l){if(!l||l===W||W.contains(l))return null;let h=l.closest?.("[data-tooltip], [title]");if(!h||!G.contains(h))return null;if(h.hasAttribute("title")){let B=V(h.getAttribute("title"));h.removeAttribute("title"),B&&(h.dataset.tooltip=B)}return h.dataset.tooltip?h:null}Le(),E("pointerover",l=>{if(Q(l),z(l.target)){u(),ue();return}let h=A(l.target);if(!h){ue();return}u(),F!==h?(F=h,W.classList.contains("visible")&&C(!0),ge(h)):W.classList.contains("visible")||ge(h)},!0),E("pointermove",l=>{F&&(Q(l),$&&se()&&u())},!0),E("pointerout",l=>{if(!F||(Q(l),ue(),!X(l.target)&&!z(l.target)))return;let h=l.relatedTarget;z(h)||X(h)||d()},!0),E("scroll",()=>{F&&C()},!0),E("keydown",()=>{F&&C()},!0),v("blur",()=>{F&&C()})}function St(E){if(!E)return;E.state&&(tt=E.state.perfDebug??!1),Je("render-start");let v=document.getElementById("ganttRoot");v&&(Lt(E.state),Je("innerHTML-start"),v.innerHTML=E.html||"",Je("innerHTML-end"),lt("innerHTML","innerHTML-start","innerHTML-end"),At(E.state),Je("render-end"),lt("render","render-start","render-end"),Et())}window.addEventListener("message",E=>{let v=E.data;if(v){if(v.command==="render"){St(v.payload);return}window.__ganttHandleExtensionMessage&&window.__ganttHandleExtensionMessage(v)}});var wt=window.__GANTT_INITIAL_PAYLOAD__;wt&&St(wt);ae.postMessage({command:"webviewReady"});function At(E){if(Je("initializeGantt-start"),!E)return;let{timelineWidth:v,minDateMs:G,maxDateMs:W,totalDays:ce,extendedRelationTypes:V,redmineBaseUrl:te,minimapBarsData:P,minimapHeight:de,minimapBarHeight:Le,minimapTodayX:De,extScrollLeft:ie,extScrollTop:F,labelWidth:$,leftExtrasWidth:H,healthFilter:L,sortBy:Q,sortOrder:u,selectedCollapseKey:ue,barHeight:z,todayX:X,todayInRange:se,isDraftMode:fe,draftQueueCount:ge}=E,d=v/ce,S=fe,y=document.getElementById("dragConfirmOk");y&&(y.textContent=fe?"Queue to Draft":"Save to Redmine");let C=document.getElementById("draftBadge");if(C){if(fe){C.classList.remove("hidden");let e=ge??0;C.textContent=e,C.dataset.tooltip=e===1?"1 change queued - click to review":e+" changes queued - click to review"}else C.classList.add("hidden");C.addEventListener("click",()=>{ae.postMessage({command:"openDraftReview"})})}let A=document.getElementById("draftModeToggle");A&&A.addEventListener("click",()=>{ae.postMessage({command:"toggleDraftMode"})}),window._ganttCleanup&&window._ganttCleanup();let l=[],h=[];function B(e,s,a){document.addEventListener(e,s,a),l.push({type:e,handler:s,options:a})}function K(e,s,a){window.addEventListener(e,s,a),h.push({type:e,handler:s,options:a})}window._ganttCleanup=()=>{l.forEach(e=>document.removeEventListener(e.type,e.handler,e.options)),h.forEach(e=>window.removeEventListener(e.type,e.handler,e.options)),window.__ganttHandleExtensionMessage=null};function J(e){setTimeout(()=>{document.addEventListener("click",function s(a){e.contains(a.target)||(e.remove(),document.removeEventListener("click",s))})},0)}function he(e){return Math.round(e/d)*d}function ne(e){let s=document.getElementById("liveRegion");s&&(s.textContent=e)}let _=document.getElementById("ganttScroll"),Me=document.getElementById("ganttLeftHeader"),Ae=document.getElementById("ganttLabels"),Pe=document.getElementById("ganttTimeline"),Be=document.getElementById("menuUndo"),N=document.getElementById("menuRedo"),m=document.getElementById("minimapSvg"),xe=document.getElementById("minimapViewport"),{updateMinimapPosition:Oe,updateMinimapViewport:We}=pt({timelineWidth:v,minimapBarsData:P,minimapHeight:de,minimapBarHeight:Le,minimapTodayX:De,ganttScroll:_,minimapSvg:m,minimapViewport:xe,addDocListener:B}),Te=ae.getState()||{undoStack:[],redoStack:[],labelWidth:$,scrollLeft:null,scrollTop:null,centerDateMs:null},Ce=Te.undoStack||[],Fe=Te.redoStack||[],He=Te.scrollLeft??(ie>0?ie:null),_e=Te.scrollTop??(F>0?F:null),be=Te.centerDateMs;function Ye(){if(!_)return null;let s=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,a=_.clientWidth-s,b=(_.scrollLeft+a/2)/v;return G+b*(W-G)}function Ke(e){if(!_)return;let a=(e-G)/(W-G)*v,b=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,O=_.clientWidth-b;_.scrollLeft=Math.max(0,a-O/2)}function p(){ae.setState({undoStack:Ce,redoStack:Fe,labelWidth:Ae?.offsetWidth||$,scrollLeft:null,scrollTop:_?.scrollTop??null,centerDateMs:Ye()})}let c=p;function q(){Be&&Be.toggleAttribute("disabled",Ce.length===0),N&&N.toggleAttribute("disabled",Fe.length===0),p()}if(Te.labelWidth&&Me&&Ae){Me.style.width=Te.labelWidth+"px",Ae.style.width=Te.labelWidth+"px";let e=document.querySelector(".capacity-ribbon-label");e&&(e.style.width=Te.labelWidth+H+"px")}let Z=!0,Y=!1,le=e=>{Y=e},ve=null;_&&_.addEventListener("scroll",()=>{cancelAnimationFrame(ve),ve=requestAnimationFrame(()=>{We(),Z||p()})},{passive:!0}),requestAnimationFrame(()=>q()),window.__ganttHandleExtensionMessage=e=>{if(e.command==="setHeatmapState"){let s=document.querySelector(".heatmap-layer"),a=document.querySelector(".weekend-layer"),f=document.getElementById("menuHeatmap");e.enabled?(s&&s.classList.remove("hidden"),a&&a.classList.add("hidden"),f&&f.classList.add("active")):(s&&s.classList.add("hidden"),a&&a.classList.remove("hidden"),f&&f.classList.remove("active"))}else if(e.command==="setDependenciesState"){let s=document.querySelector(".dependency-layer"),a=document.getElementById("menuDeps");e.enabled?(s&&s.classList.remove("hidden"),a&&a.classList.add("active")):(s&&s.classList.add("hidden"),a&&a.classList.remove("active"))}else if(e.command==="setCapacityRibbonState"){let s=document.querySelector(".capacity-ribbon"),a=document.getElementById("menuCapacity");e.enabled?(s&&s.classList.remove("hidden"),a&&a.classList.add("active")):(s&&s.classList.add("hidden"),a&&a.classList.remove("active"))}else if(e.command==="setIntensityState"){let s=document.querySelector(".gantt-container"),a=document.getElementById("menuIntensity");e.enabled?(s?.classList.add("intensity-enabled"),a&&a.classList.add("active")):(s?.classList.remove("intensity-enabled"),a&&a.classList.remove("active"))}else if(e.command==="setDraftModeState"){S=e.enabled;let s=document.getElementById("dragConfirmOk");s&&(s.textContent=e.enabled?"Queue to Draft":"Save to Redmine");let a=document.getElementById("draftModeToggle");a&&(a.classList.toggle("active",e.enabled),a.textContent=e.enabled?"Disable Draft Mode":"Enable Draft Mode");let f=document.getElementById("draftBadge");if(f)if(e.enabled){f.classList.remove("hidden");let b=e.queueCount??0;f.textContent=b,f.dataset.tooltip=b===1?"1 change queued - click to review":b+" changes queued - click to review"}else f.classList.add("hidden")}else if(e.command==="setDraftQueueCount"){let s=document.getElementById("draftBadge");if(s){let a=e.count;s.textContent=a,s.dataset.tooltip=a===1?"1 change queued - click to review":a+" changes queued - click to review"}}else if(e.command==="pushUndoAction")Ce.push(e.action),Fe.length=0,q(),p();else if(e.command==="updateRelationId"){let s=e.stack==="undo"?Ce:Fe;if(s.length>0){let a=s[s.length-1];a.type==="relation"&&(a.relationId=e.newRelationId,p())}}else if(e.command==="scrollToIssue"){let s=e.issueId,a=document.querySelector('.issue-label[data-issue-id="'+s+'"]'),f=document.querySelector('.issue-bar[data-issue-id="'+s+'"]'),b=document.getElementById("ganttScroll"),ke=document.querySelector(".gantt-header-row")?.getBoundingClientRect().height||60;if(!b)return;let qe=b.scrollTop,Ee=b.scrollLeft;if(a){let $e=a.closest(".gantt-row");if($e){let je=$e.offsetTop,Ue=$e.getBoundingClientRect().height,Ve=b.clientHeight-ke;qe=Math.max(0,je-ke-(Ve-Ue)/2)}a.focus(),a.classList.add("highlighted"),setTimeout(()=>a.classList.remove("highlighted"),2e3)}if(f){let $e=parseFloat(f.getAttribute("data-start-x")||"0"),Ue=parseFloat(f.getAttribute("data-end-x")||"0")-$e,Ve=b.clientWidth,kt=document.querySelector(".gantt-sticky-left")?.getBoundingClientRect().width||0,ht=Ve-kt;Ue<=ht-100?Ee=$e-(ht-Ue)/2:Ee=$e-50,Ee=Math.max(0,Ee),f.classList.add("highlighted"),setTimeout(()=>f.classList.remove("highlighted"),2e3)}b.scrollTo({left:Ee,top:qe,behavior:"smooth"})}},document.getElementById("lookbackSelect")?.addEventListener("change",e=>{ae.postMessage({command:"setLookback",years:e.target.value})}),document.getElementById("zoomSelect")?.addEventListener("change",e=>{c(),ae.postMessage({command:"setZoom",zoomLevel:e.target.value})}),document.getElementById("viewFocusSelect")?.addEventListener("change",e=>{ae.postMessage({command:"setViewFocus",focus:e.target.value})}),document.getElementById("projectSelector")?.addEventListener("change",e=>{let s=e.target.value,a=s?parseInt(s,10):null;ae.postMessage({command:"setSelectedProject",projectId:a})}),document.getElementById("focusSelector")?.addEventListener("change",e=>{let s=e.target.value;ae.postMessage({command:"setSelectedAssignee",assignee:s||null})}),document.getElementById("filterAssignee")?.addEventListener("change",e=>{let s=e.target.value;ae.postMessage({command:"setFilter",filter:{assignee:s}})}),document.getElementById("filterStatus")?.addEventListener("change",e=>{let s=e.target.value;ae.postMessage({command:"setFilter",filter:{status:s}})}),document.getElementById("menuFilterHealth")?.addEventListener("click",()=>{let e=["all","critical","warning","healthy"],s=L,f=(e.indexOf(s)+1)%e.length;ae.postMessage({command:"setHealthFilter",health:e[f]})}),document.querySelectorAll(".gantt-col-header.sortable").forEach(e=>{e.addEventListener("click",()=>{let s=e.dataset.sort;s===Q?u==="asc"?ae.postMessage({command:"setSort",sortOrder:"desc"}):ae.postMessage({command:"setSort",sortBy:null}):ae.postMessage({command:"setSort",sortBy:s,sortOrder:"asc"})})}),document.getElementById("menuHeatmap")?.addEventListener("click",()=>{document.getElementById("menuHeatmap")?.hasAttribute("disabled")||(p(),ae.postMessage({command:"toggleWorkloadHeatmap"}))}),document.getElementById("menuCapacity")?.addEventListener("click",()=>{document.getElementById("menuCapacity")?.hasAttribute("disabled")||(p(),ae.postMessage({command:"toggleCapacityRibbon"}))}),document.getElementById("menuIntensity")?.addEventListener("click",()=>{document.getElementById("menuIntensity")?.hasAttribute("disabled")||(p(),ae.postMessage({command:"toggleIntensity"}))}),document.getElementById("overloadBadge")?.addEventListener("click",e=>{e.stopPropagation();let s=e.currentTarget,a=parseInt(s.dataset.firstOverloadMs||"0",10);a>0&&(Ke(a),p())}),document.querySelectorAll(".capacity-day-bar-group").forEach(e=>{e.addEventListener("click",s=>{let a=parseInt(s.currentTarget.dataset.dateMs||"0",10);a>0&&(Ke(a),p())})}),document.getElementById("menuDeps")?.addEventListener("click",()=>{p(),ae.postMessage({command:"toggleDependencies"})});let Xe=document.querySelector(".gantt-container");function st(){let e=new Map,s=new Map;return document.querySelectorAll(".dependency-arrow").forEach(a=>{if(!(a.classList.contains("rel-blocks")||a.classList.contains("rel-precedes")))return;let b=a.dataset.from,O=a.dataset.to;e.has(b)||e.set(b,[]),e.get(b).push(O),s.has(O)||s.set(O,[]),s.get(O).push(b)}),{graph:e,reverseGraph:s}}let pe=null;function nt(e,s,a){let f=new Set([e]),b=[e];for(;b.length>0;){let ke=b.shift(),qe=s.get(ke)||[];for(let Ee of qe)f.has(Ee)||(f.add(Ee),b.push(Ee))}let O=[e];for(;O.length>0;){let ke=O.shift(),qe=a.get(ke)||[];for(let Ee of qe)f.has(Ee)||(f.add(Ee),O.push(Ee))}return f}function Ze(e){if(et(),!e)return;pe=e;let{graph:s,reverseGraph:a}=st(),f=nt(e,s,a);Xe.classList.add("focus-mode"),document.querySelectorAll(".issue-bar").forEach(b=>{f.has(b.dataset.issueId)&&b.classList.add("focus-highlighted")}),document.querySelectorAll(".issue-label").forEach(b=>{f.has(b.dataset.issueId)&&b.classList.add("focus-highlighted")}),document.querySelectorAll(".dependency-arrow").forEach(b=>{f.has(b.dataset.from)&&f.has(b.dataset.to)&&b.classList.add("focus-highlighted")}),ne(`Focus: ${f.size} issue${f.size!==1?"s":""} in dependency chain`)}function et(){pe=null,Xe.classList.remove("focus-mode"),document.querySelectorAll(".focus-highlighted").forEach(e=>e.classList.remove("focus-highlighted"))}let Ge=()=>pe,t=new Set,o=null,n=document.getElementById("selectionCount"),i=Array.from(document.querySelectorAll(".issue-bar")),r=new Map;i.forEach(e=>{let s=e.dataset.issueId;s&&(r.has(s)||r.set(s,[]),r.get(s).push(e))});function D(e){e.forEach(s=>{let a=r.get(s);a&&a.forEach(f=>f.classList.toggle("selected",t.has(s)))}),t.size>0?(n.textContent=`${t.size} selected`,n.classList.remove("hidden"),Xe.classList.add("multi-select-mode")):(n.classList.add("hidden"),Xe.classList.remove("multi-select-mode"))}function k(){i.forEach(e=>{e.classList.toggle("selected",t.has(e.dataset.issueId))}),t.size>0?(n.textContent=`${t.size} selected`,n.classList.remove("hidden"),Xe.classList.add("multi-select-mode")):(n.classList.add("hidden"),Xe.classList.remove("multi-select-mode"))}function w(){let e=[...t];t.clear(),o=null,D(e)}function R(e){t.has(e)?t.delete(e):t.add(e),o=e,D([e])}function I(e,s){let a=i.findIndex(qe=>qe.dataset.issueId===e),f=i.findIndex(qe=>qe.dataset.issueId===s);if(a===-1||f===-1)return;let b=Math.min(a,f),O=Math.max(a,f),ke=[];for(let qe=b;qe<=O;qe++){let Ee=i[qe].dataset.issueId;t.has(Ee)||(t.add(Ee),ke.push(Ee))}D(ke)}function x(){i.forEach(e=>t.add(e.dataset.issueId)),k(),ne(`Selected all ${t.size} issues`)}i.forEach(e=>{e.addEventListener("mousedown",s=>{if(!s.ctrlKey&&!s.metaKey&&!s.shiftKey||s.target.classList.contains("drag-handle")||s.target.classList.contains("link-handle"))return;s.preventDefault(),s.stopPropagation();let a=e.dataset.issueId;s.shiftKey&&o?I(o,a):R(a)})}),B("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="a"&&(e.preventDefault(),x()),e.key==="Escape"&&t.size>0&&(e.stopImmediatePropagation(),w(),ne("Selection cleared"))}),document.getElementById("refreshBtn")?.addEventListener("click",()=>{document.getElementById("loadingOverlay")?.classList.add("visible"),ae.postMessage({command:"refresh"})}),document.getElementById("draftBadge")?.addEventListener("click",()=>{ae.postMessage({command:"openDraftReview"})});function g(e,s,a,f,b){document.querySelector(".relation-picker")?.remove();let O=document.createElement("div");O.className="relation-picker";let ke=150,qe=100,Ee=Math.min(e,window.innerWidth-ke-10),$e=Math.min(s,window.innerHeight-qe-10);O.style.left=Math.max(10,Ee)+"px",O.style.top=Math.max(10,$e)+"px";let je=document.createElement("div");je.style.padding="6px 12px",je.style.fontSize="11px",je.style.opacity="0.7",je.textContent=`#${f} \u2192 #${b}`,O.appendChild(je);let Ue=document.createElement("button");Ue.textContent="\u{1F5D1}\uFE0F Delete relation",Ue.addEventListener("click",()=>{p(),ae.postMessage({command:"deleteRelation",relationId:a}),O.remove()}),O.appendChild(Ue);let Ve=document.createElement("button");Ve.textContent="Cancel",Ve.addEventListener("click",()=>O.remove()),O.appendChild(Ve),document.body.appendChild(O),J(O)}let M=new Map,T=new Map,j=new Map,oe=new Map,me=new Map,ee=!1;function we(){document.querySelectorAll(".issue-bar").forEach(e=>{let s=e.dataset.issueId;s&&(M.has(s)||M.set(s,[]),M.get(s).push(e))}),document.querySelectorAll(".issue-label").forEach(e=>{let s=e.dataset.issueId;s&&(T.has(s)||T.set(s,[]),T.get(s).push(e))}),document.querySelectorAll(".dependency-arrow").forEach(e=>{let s=e.dataset.from,a=e.dataset.to;s&&(j.has(s)||j.set(s,[]),j.get(s).push(e)),a&&(j.has(a)||j.set(a,[]),j.get(a).push(e))}),document.querySelectorAll(".project-label").forEach(e=>{let s=e.dataset.collapseKey;s&&(oe.has(s)||oe.set(s,[]),oe.get(s).push(e))}),document.querySelectorAll(".aggregate-bars").forEach(e=>{let s=e.dataset.collapseKey;s&&(me.has(s)||me.set(s,[]),me.get(s).push(e))}),ee=!0}typeof requestIdleCallback<"u"?requestIdleCallback(()=>we(),{timeout:100}):setTimeout(we,0);let ye=[];function Re(){document.body.classList.remove("hover-focus","dependency-hover"),ye.forEach(e=>e.classList.remove("hover-highlighted","hover-source")),ye=[]}function U(e){document.body.classList.add("hover-focus");let s=ee?M.get(e)||[]:document.querySelectorAll('.issue-bar[data-issue-id="'+e+'"]'),a=ee?T.get(e)||[]:document.querySelectorAll('.issue-label[data-issue-id="'+e+'"]'),f=ee?j.get(e)||[]:document.querySelectorAll('.dependency-arrow[data-from="'+e+'"], .dependency-arrow[data-to="'+e+'"]');s.forEach(b=>{b.classList.add("hover-highlighted"),ye.push(b)}),a.forEach(b=>{b.classList.add("hover-highlighted"),ye.push(b)}),f.forEach(b=>{b.classList.add("hover-highlighted"),ye.push(b)})}function re(e){document.body.classList.add("hover-focus");let s=ee?oe.get(e)||[]:document.querySelectorAll('.project-label[data-collapse-key="'+e+'"]'),a=ee?me.get(e)||[]:document.querySelectorAll('.aggregate-bars[data-collapse-key="'+e+'"]');s.forEach(f=>{f.classList.add("hover-highlighted"),ye.push(f)}),a.forEach(f=>{f.classList.add("hover-highlighted"),ye.push(f)})}let Se=document.querySelector(".gantt-timeline svg"),Qe=document.querySelector(".gantt-labels svg");if(Se&&(Se.addEventListener("mouseenter",e=>{let s=e.target.closest(".issue-bar"),a=e.target.closest(".aggregate-bars"),f=e.target.closest(".dependency-arrow");if(s){let b=s.dataset.issueId;b&&U(b)}else if(a){let b=a.dataset.collapseKey;b&&re(b)}else if(f){let b=f.dataset.from,O=f.dataset.to;document.body.classList.add("dependency-hover"),f.classList.add("hover-source"),ye.push(f),b&&U(b),O&&U(O)}},!0),Se.addEventListener("mouseleave",e=>{let s=e.target.closest(".issue-bar"),a=e.target.closest(".aggregate-bars"),f=e.target.closest(".dependency-arrow");(s||a||f)&&Re()},!0)),Qe&&(Qe.addEventListener("mouseenter",e=>{let s=e.target.closest(".issue-label"),a=e.target.closest(".project-label");if(s){let f=s.dataset.issueId;f&&U(f)}else if(a){let f=a.dataset.collapseKey;f&&re(f)}},!0),Qe.addEventListener("mouseleave",e=>{let s=e.target.closest(".issue-label"),a=e.target.closest(".project-label");(s||a)&&Re()},!0)),Se){let s=function(){document.querySelectorAll(".dependency-arrow.selected").forEach(a=>a.classList.remove("selected")),document.body.classList.remove("arrow-selection-mode"),document.querySelectorAll(".arrow-connected").forEach(a=>a.classList.remove("arrow-connected")),e=null};var It=s;Se.addEventListener("contextmenu",a=>{let f=a.target.closest(".dependency-arrow");if(!f)return;a.preventDefault();let b=parseInt(f.dataset.relationId),O=f.dataset.from,ke=f.dataset.to;g(a.clientX,a.clientY,b,O,ke)});let e=null;Se.addEventListener("click",a=>{let f=a.target.closest(".dependency-arrow");if(e&&(e.classList.remove("selected"),document.body.classList.remove("arrow-selection-mode"),document.querySelectorAll(".arrow-connected").forEach(ke=>ke.classList.remove("arrow-connected")),e=null),!f)return;a.stopPropagation(),e=f,f.classList.add("selected"),document.body.classList.add("arrow-selection-mode");let b=f.dataset.from,O=f.dataset.to;document.querySelectorAll(`.issue-bar[data-issue-id="${b}"], .issue-bar[data-issue-id="${O}"]`).forEach(ke=>ke.classList.add("arrow-connected")),document.querySelectorAll(`.issue-label[data-issue-id="${b}"], .issue-label[data-issue-id="${O}"]`).forEach(ke=>ke.classList.add("arrow-connected")),ne(`Selected relation from #${b} to #${O}`)}),window._ganttArrowClickHandler&&document.removeEventListener("click",window._ganttArrowClickHandler),window._ganttArrowClickHandler=a=>{(e||document.querySelector(".dependency-arrow.selected"))&&!a.target.closest(".dependency-arrow")&&!a.target.closest(".blocks-badge-group")&&!a.target.closest(".blocker-badge")&&s()},document.addEventListener("click",window._ganttArrowClickHandler),window._ganttArrowKeyHandler&&document.removeEventListener("keydown",window._ganttArrowKeyHandler),window._ganttArrowKeyHandler=a=>{let f=e||document.querySelector(".dependency-arrow.selected");a.key==="Escape"&&f&&(a.stopImmediatePropagation(),s())},document.addEventListener("keydown",window._ganttArrowKeyHandler)}yt({vscode:ae,menuUndo:Be,menuRedo:N,addDocListener:B,closeOnOutsideClick:J,announce:ne,saveState:p,updateUndoRedoButtons:q,undoStack:Ce,redoStack:Fe,selectedIssues:t,clearSelection:w,allIssueBars:i,redmineBaseUrl:te,extendedRelationTypes:V,minDateMs:G,maxDateMs:W,timelineWidth:v,dayWidth:d,barHeight:z,ganttScroll:_,snapToDay:he,focusOnDependencyChain:Ze,clearFocus:et,getFocusedIssueId:Ge,scrollToAndHighlight:ct,setAllowScrollChange:le,isDraftModeEnabled:()=>S,isPerfDebugEnabled:()=>tt}),bt({vscode:ae,addDocListener:B,addWinListener:K,announce:ne,barHeight:z,selectedCollapseKey:ue});function Ne(){if(!se){ae.postMessage({command:"todayOutOfRange"});return}if(_){let s=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,a=_.clientWidth-s;_.scrollLeft=Math.max(0,X-a/2)}}function ct(e){if(!e)return;Y=!0;let s=document.querySelector('.issue-label[data-issue-id="'+e+'"]'),a=document.querySelector('.issue-bar[data-issue-id="'+e+'"]');if(s&&(s.scrollIntoView({behavior:"smooth",block:"center"}),s.classList.add("highlighted"),setTimeout(()=>s.classList.remove("highlighted"),1500)),a&&_){let f=a.getBoundingClientRect(),b=_.getBoundingClientRect(),O=_.scrollLeft+f.left-b.left-100;_.scrollTo({left:Math.max(0,O),behavior:"smooth"}),a.classList.add("highlighted"),setTimeout(()=>a.classList.remove("highlighted"),1500)}}vt({vscode:ae,addDocListener:B,menuUndo:Be,menuRedo:N,undoStack:Ce,redoStack:Fe,saveState:p,updateUndoRedoButtons:q,announce:ne,scrollToAndHighlight:ct,scrollToToday:Ne}),Dt({addDocListener:B,addWinListener:K,ganttScroll:_}),requestAnimationFrame(()=>{if(be!==null&&_){let e=Math.max(G,Math.min(W,be));Ke(e),_e!==null&&(_.scrollTop=_e),be=null,_e=null}else He!==null&&_?(_.scrollLeft=He,_e!==null&&(_.scrollTop=_e),He=null,_e=null):Ne();We(),Z=!1}),document.getElementById("todayBtn")?.addEventListener("click",Ne);let dt=document.getElementById("resizeHandle"),ut=document.getElementById("resizeHandleHeader"),at=!1,ft=0,mt=0,ot=null;function gt(e,s){at=!0,ot=s,ft=e.clientX,mt=Ae.offsetWidth,s.classList.add("dragging"),document.body.classList.add("cursor-col-resize","user-select-none"),e.preventDefault()}dt?.addEventListener("mousedown",e=>gt(e,dt)),ut?.addEventListener("mousedown",e=>gt(e,ut));let rt=!1,it=null;B("mousemove",e=>{at&&(it=e,!rt&&(rt=!0,requestAnimationFrame(()=>{if(rt=!1,!it)return;let s=it.clientX-ft,a=Math.min(600,Math.max(120,mt+s));if(Me&&(Me.style.width=a+"px"),Ae){Ae.style.width=a+"px";let b=Ae.querySelector("svg");b&&b.setAttribute("width",String(a))}let f=document.querySelector(".capacity-ribbon-label");f&&(f.style.width=a+H+"px"),Oe()})))}),B("mouseup",()=>{at&&(at=!1,ot?.classList.remove("dragging"),ot=null,document.body.classList.remove("cursor-col-resize","user-select-none"),p())}),requestAnimationFrame(()=>{document.getElementById("loadingOverlay")?.classList.remove("visible")}),Je("initializeGantt-end"),lt("initializeGantt","initializeGantt-start","initializeGantt-end")}})();
