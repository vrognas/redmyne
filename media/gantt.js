"use strict";(()=>{function pt({timelineWidth:L,minimapBarsData:w,minimapHeight:j,minimapBarHeight:W,minimapTodayX:ie,ganttScroll:U,minimapSvg:Z,minimapViewport:R,addDocListener:le}){function ke(){let q=document.querySelector(".gantt-body .gantt-sticky-left"),A=document.querySelector(".gantt-container");q&&A&&A.style.setProperty("--sticky-left-width",q.offsetWidth+"px")}requestAnimationFrame(ke),Z&&requestAnimationFrame(()=>{let q=j/(w.length+1);if(w.forEach((A,G)=>{let u=document.createElementNS("http://www.w3.org/2000/svg","rect");u.setAttribute("class",A.classes),u.setAttribute("x",(A.startPct*L).toString()),u.setAttribute("y",(q*(G+.5)).toString()),u.setAttribute("width",Math.max(2,(A.endPct-A.startPct)*L).toString()),u.setAttribute("height",W.toString()),u.setAttribute("rx","1"),u.setAttribute("fill",A.color),Z.insertBefore(u,R)}),ie>0&&ie<L){let A=document.createElementNS("http://www.w3.org/2000/svg","line");A.setAttribute("class","minimap-today"),A.setAttribute("x1",ie.toString()),A.setAttribute("y1","0"),A.setAttribute("x2",ie.toString()),A.setAttribute("y2",j.toString()),Z.insertBefore(A,R)}});function Ee(){if(!U||!R||!L||!U.scrollWidth||!U.clientWidth)return;let q=Math.max(1,U.scrollWidth-U.clientWidth),A=Math.min(1,U.scrollLeft/q),G=Math.min(1,U.clientWidth/U.scrollWidth),u=Math.max(20,G*L),ce=A*(L-u);isNaN(ce)||isNaN(u)||(R.setAttribute("x",ce.toString()),R.setAttribute("width",u.toString()))}let ae=!1,P=0;function $(q,A=!1){if(!U||!Z||!R)return;let G=Z.getBoundingClientRect(),ce=parseFloat(R.getAttribute("width")||"0")/L*G.width,z=q.clientX-G.left;A?z-=P:z-=ce/2;let T=Math.max(0,Math.min(1,z/(G.width-ce))),ee=Math.max(0,U.scrollWidth-U.clientWidth);U.scrollLeft=T*ee}return Z&&R&&(R.addEventListener("mousedown",q=>{q.stopPropagation(),ae=!0;let A=Z.getBoundingClientRect(),u=parseFloat(R.getAttribute("x")||"0")/L*A.width;P=q.clientX-A.left-u}),Z.addEventListener("mousedown",q=>{if(q.target===R)return;ae=!0;let A=Z.getBoundingClientRect();P=parseFloat(R.getAttribute("width")||"0")/100*A.width/2,$(q,!0)}),le("mousemove",q=>{ae&&$(q,!0)}),le("mouseup",()=>{ae=!1})),{updateMinimapPosition:ke,updateMinimapViewport:Ee}}function yt(L){let{vscode:w,menuUndo:j,menuRedo:W,addDocListener:ie,closeOnOutsideClick:U,announce:Z,saveState:R,updateUndoRedoButtons:le,undoStack:ke,redoStack:Ee,selectedIssues:ae,clearSelection:P,allIssueBars:$,redmineBaseUrl:q,extendedRelationTypes:A,minDateMs:G,maxDateMs:u,timelineWidth:ce,dayWidth:z,barHeight:T,ganttScroll:ee,snapToDay:de,focusOnDependencyChain:ue,clearFocus:d,getFocusedIssueId:S,scrollToAndHighlight:p,setAllowScrollChange:M,isDraftModeEnabled:I,isPerfDebugEnabled:l}=L;function g(t,o,n){document.querySelector(".relation-picker")?.remove();let r=ae.size>1&&ae.has(n),i=r?Array.from(ae).map(X=>parseInt(X)):[parseInt(n)],E=document.createElement("div");E.className="relation-picker";let D=160,k=180,B=Math.min(t,window.innerWidth-D-10),y=Math.min(o,window.innerHeight-k-10);E.style.left=Math.max(10,B)+"px",E.style.top=Math.max(10,y)+"px";let H=document.createElement("div");H.style.padding="6px 12px",H.style.fontSize="11px",H.style.opacity="0.7",H.textContent=r?i.length+" issues selected":"#"+n,E.appendChild(H),(r?[{label:"Set % Done...",command:"bulkSetDoneRatio",bulk:!0},{label:"Clear Selection",command:"clearSelection",local:!0}]:[{label:"Update Issue...",command:"openIssue"},{label:"Open in Browser",command:"openInBrowser"},{label:"Show in Issues",command:"showInIssues"},{label:"Log Time",command:"logTime"},{label:"Set % Done",command:"setDoneRatio"},{label:"Toggle Auto-update %",command:"toggleAutoUpdate"},{label:"Toggle Ad-hoc Budget",command:"toggleAdHoc"},{label:"Toggle Precedence",command:"togglePrecedence"},{label:"Set Internal Estimate",command:"setInternalEstimate"},{label:"Copy Link",command:"copyLink",local:!0},{label:"Copy URL",command:"copyUrl"}]).forEach(X=>{let Y=document.createElement("button");Y.textContent=X.label,Y.addEventListener("click",async()=>{if(X.command==="copyLink"){let Me=document.querySelector('.issue-bar[data-issue-id="'+n+'"]')?.dataset?.subject||"Issue #"+n,pe=q+"/issues/"+n,ye='<a href="'+pe+'">#'+n+" "+Me+"</a>",Fe=pe;try{await navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([Fe],{type:"text/plain"}),"text/html":new Blob([ye],{type:"text/html"})})]),w.postMessage({command:"showStatus",message:"Copied #"+n+" link"})}catch{await navigator.clipboard.writeText(Fe),w.postMessage({command:"showStatus",message:"Copied #"+n+" URL"})}}else X.local?P():X.bulk?w.postMessage({command:X.command,issueIds:i}):w.postMessage({command:X.command,issueId:parseInt(n)});E.remove()}),E.appendChild(Y)}),document.body.appendChild(E),U(E)}function C(t){let o=G+t/ce*(u-G);return new Date(o).toISOString().slice(0,10)}function K(t){let o=G+t/ce*(u-G)-864e5;return new Date(o).toISOString().slice(0,10)}let V=document.getElementById("dragDateTooltip"),fe=null;function te(t){let o=new Date(t+"T00:00:00"),n=o.toLocaleDateString("en-US",{month:"short"}),r=o.getDate(),i=o.toLocaleDateString("en-US",{weekday:"short"});return n+" "+r+" ("+i+")"}function F(t,o){let n=new Date(t+"T00:00:00"),r=new Date(o+"T00:00:00"),i=n.toLocaleDateString("en-US",{month:"short"}),E=r.toLocaleDateString("en-US",{month:"short"});return i===E?i+" "+n.getDate()+"-"+r.getDate():i+" "+n.getDate()+"-"+E+" "+r.getDate()}function Ae(t){V.textContent=t,V.style.display="block",fe=t}function Le(t){t!==fe&&(V.textContent=t,fe=t)}function Re(t,o){let n=o-28,r=!1;n<40&&(n=o+20,r=!0),V.style.left=t+"px",V.style.top=n+"px",V.classList.toggle("flipped",r)}function Ce(){V.style.display="none",fe=null}let oe=4,m=4;function xe(t,o){l&&l()&&console.log("[Arrow Debug]",t,o)}function We(t,o,n,r,i){let E=n>t,D=Math.abs(n-t),k=D<30,B=Math.abs(o-r)<5,y=r>o,H;B&&E?H="sameRow-right":!B&&k?H="nearlyVertical":E?H="diffRow-right":B?H="sameRow-left":H="diffRow-left";let v;if(B&&E)v="M "+t+" "+o+" H "+n;else if(!B&&k){let J=(o+r)/2;v="M "+t+" "+o+" H "+(t+8-m)+" q "+m+" 0 "+m+" "+(y?m:-m)+" V "+(J+(y?-m:m))+" q 0 "+(y?m:-m)+" "+-m+" "+(y?m:-m)+" H "+(n-8+m)+" q "+-m+" 0 "+-m+" "+(y?m:-m)+" V "+(r+(y?-m:m))+" q 0 "+(y?m:-m)+" "+m+" "+(y?m:-m)+" H "+n}else if(E){let Y=Math.min(t+8,(t+n)/2);v="M "+t+" "+o+" H "+(Y-m)+" q "+m+" 0 "+m+" "+(y?m:-m)+" V "+(r+(y?-m:m))+" q 0 "+(y?m:-m)+" "+m+" "+(y?m:-m)+" H "+n}else if(B){let J=o-T;v="M "+t+" "+o+" V "+(J+m)+" q 0 "+-m+" "+-m+" "+-m+" H "+(n-12+m)+" q "+-m+" 0 "+-m+" "+m+" V "+r+" H "+n}else{let J=(o+r)/2;v="M "+t+" "+o+" H "+(t+8-m)+" q "+m+" 0 "+m+" "+(y?m:-m)+" V "+(J+(y?-m:m))+" q 0 "+(y?m:-m)+" "+-m+" "+(y?m:-m)+" H "+(n-8+m)+" q "+-m+" 0 "+-m+" "+(y?m:-m)+" V "+(r+(y?-m:m))+" q 0 "+(y?m:-m)+" "+m+" "+(y?m:-m)+" H "+n}let X="M "+(n-oe)+" "+(r-oe*.6)+" L "+n+" "+r+" L "+(n-oe)+" "+(r+oe*.6);return xe("calcArrowPath",{inputs:{x1:t,y1:o,x2:n,y2:r,isScheduling:i},conditions:{goingRight:E,horizontalDist:D,nearlyVertical:k,sameRow:B,goingDown:y},pathCase:H,path:v.substring(0,80)+(v.length>80?"...":"")}),{path:v,arrowHead:X}}function _e(t){let o=[],n='.dependency-arrow[data-from="'+t+'"], .dependency-arrow[data-to="'+t+'"]';return document.querySelectorAll(n).forEach(r=>{let i=r.getAttribute("data-from"),E=r.getAttribute("data-to"),k=(r.getAttribute("class")||"").match(/rel-(\w+)/),B=k?k[1]:"relates",y=["blocks","precedes","finish_to_start","start_to_start","finish_to_finish","start_to_finish"].includes(B),H=document.querySelector('.issue-bar[data-issue-id="'+i+'"]'),v=document.querySelector('.issue-bar[data-issue-id="'+E+'"]');!H||!v||o.push({element:r,fromId:i,toId:E,isScheduling:y,fromBar:H,toBar:v,linePath:r.querySelector(".arrow-line"),hitPath:r.querySelector(".arrow-hit-area"),headPath:r.querySelector(".arrow-head")})}),o}function qe(t,o,n,r){t.forEach(i=>{let E=i.linePath?i.linePath.getAttribute("d"):null,D=i.fromId==o?n:parseFloat(i.fromBar.dataset.startX),k=i.fromId==o?r:parseFloat(i.fromBar.dataset.endX),B=parseFloat(i.fromBar.dataset.centerY),y=i.toId==o?n:parseFloat(i.toBar.dataset.startX),H=i.toId==o?r:parseFloat(i.toBar.dataset.endX),v=parseFloat(i.toBar.dataset.centerY),X,Y,J,Me;i.isScheduling?(X=k+2,Y=B,J=y-2,Me=v):(X=(D+k)/2,Y=B,J=(y+H)/2,Me=v),xe("updateArrowPositions",{arrow:i.fromId+" -> "+i.toId,isScheduling:i.isScheduling,draggedId:o,barData:{fromStartX:i.fromBar.dataset.startX,fromEndX:i.fromBar.dataset.endX,fromY:i.fromBar.dataset.centerY,toStartX:i.toBar.dataset.startX,toEndX:i.toBar.dataset.endX,toY:i.toBar.dataset.centerY},computed:{fromStartX:D,fromEndX:k,fromY:B,toStartX:y,toEndX:H,toY:v},coords:{x1:X,y1:Y,x2:J,y2:Me},originalPath:E?E.substring(0,60)+"...":null});let{path:pe,arrowHead:ye}=We(X,Y,J,Me,i.isScheduling);i.linePath&&i.linePath.setAttribute("d",pe),i.hitPath&&i.hitPath.setAttribute("d",pe),i.headPath&&i.headPath.setAttribute("d",ye)})}let Ie=document.getElementById("dragConfirmOverlay"),Pe=document.getElementById("dragConfirmMessage"),Te=document.getElementById("dragConfirmOk"),Oe=document.getElementById("dragConfirmCancel"),ge=null;function Ye(t,o,n){!Ie||!Pe||(Pe.textContent=t,ge={onConfirm:o,onCancel:n},M(!0),Ie.style.display="flex",Te&&Te.focus())}function Ke(){Ie&&(Ie.style.display="none"),ge=null}function h(){ee&&x&&(ee.scrollLeft=x.left,ee.scrollTop=x.top),x=null}Te?.addEventListener("click",()=>{ge?.onConfirm&&ge.onConfirm(),x=null,Ke()}),Oe?.addEventListener("click",()=>{ge?.onCancel&&ge.onCancel(),h(),Ke()}),Ie?.addEventListener("click",t=>{t.target===Ie&&(ge?.onCancel&&ge.onCancel(),h(),Ke())}),ie("keydown",t=>{ge&&(t.key==="Escape"?(t.preventDefault(),ge.onCancel&&ge.onCancel(),h(),Ke()):t.key==="Enter"&&(t.preventDefault(),ge.onConfirm&&ge.onConfirm(),x=null,Ke()))});let c=null,x=null,Q=!1;document.querySelectorAll(".drag-handle").forEach(t=>{t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation(),x={left:ee?.scrollLeft,top:ee?.scrollTop};let n=t.closest(".issue-bar"),r=t.classList.contains("drag-left"),i=parseInt(n.dataset.issueId),E=parseFloat(n.dataset.startX),D=parseFloat(n.dataset.endX),k=n.dataset.startDate||null,B=n.dataset.dueDate||null,y=n.querySelector(".bar-outline"),H=n.querySelector(".bar-main"),v=n.querySelector(".drag-left"),X=n.querySelector(".drag-right");n.classList.add("dragging");let Y=n.querySelector(".bar-labels"),J=Y?.classList.contains("labels-left"),Me=_e(i),pe=n.querySelector(".link-handle");xe("dragStart (resize)",{issueId:i,isLeft:r,connectedArrowCount:Me.length,arrows:Me.map(be=>({from:be.fromId,to:be.toId,isScheduling:be.isScheduling,currentPath:be.linePath?be.linePath.getAttribute("d")?.substring(0,60)+"...":null}))}),c={issueId:i,isLeft:r,isMove:!1,initialMouseX:o.clientX,startX:E,endX:D,oldStartDate:k,oldDueDate:B,barOutline:y,barMain:H,leftHandle:v,rightHandle:X,bar:n,barLabels:Y,labelsOnLeft:J,connectedArrows:Me,linkHandle:pe};let ye=r?E:D,Fe=r?k:B;Fe&&(Ae((r?"Start: ":"Due: ")+te(Fe)),Re(o.clientX,o.clientY))})}),document.querySelectorAll(".bar-outline").forEach(t=>{t.addEventListener("mousedown",o=>{if(o.target.classList.contains("drag-handle")||o.ctrlKey||o.metaKey||o.shiftKey)return;o.preventDefault(),o.stopPropagation(),x={left:ee?.scrollLeft,top:ee?.scrollTop};let n=t.closest(".issue-bar");if(!n)return;let r=n.dataset.issueId,i=ae.size>1&&ae.has(r),D=(i?$.filter(v=>ae.has(v.dataset.issueId)):[n]).map(v=>({issueId:v.dataset.issueId,startX:parseFloat(v.dataset.startX),endX:parseFloat(v.dataset.endX),oldStartDate:v.dataset.startDate||null,oldDueDate:v.dataset.dueDate||null,barOutline:v.querySelector(".bar-outline"),barMain:v.querySelector(".bar-main"),leftHandle:v.querySelector(".drag-left"),rightHandle:v.querySelector(".drag-right"),bar:v,barLabels:v.querySelector(".bar-labels"),labelsOnLeft:v.querySelector(".bar-labels")?.classList.contains("labels-left"),connectedArrows:_e(v.dataset.issueId),linkHandle:v.querySelector(".link-handle")}));D.forEach(v=>v.bar.classList.add("dragging"));let k=n.querySelector(".bar-labels"),B=k?.classList.contains("labels-left"),y=_e(r),H=n.querySelector(".link-handle");xe("dragStart (move)",{issueId:r,isBulkDrag:i,connectedArrowCount:y.length,arrows:y.map(v=>({from:v.fromId,to:v.toId,isScheduling:v.isScheduling,currentPath:v.linePath?v.linePath.getAttribute("d")?.substring(0,60)+"...":null}))}),c={issueId:parseInt(r),isLeft:!1,isMove:!0,isBulkDrag:i,bulkBars:D,initialMouseX:o.clientX,startX:parseFloat(n.dataset.startX),endX:parseFloat(n.dataset.endX),oldStartDate:n.dataset.startDate||null,oldDueDate:n.dataset.dueDate||null,barOutline:t,barMain:n.querySelector(".bar-main"),leftHandle:n.querySelector(".drag-left"),rightHandle:n.querySelector(".drag-right"),bar:n,barLabels:k,labelsOnLeft:B,connectedArrows:y,linkHandle:H},!i&&n.dataset.startDate&&n.dataset.dueDate&&(Ae(F(n.dataset.startDate,n.dataset.dueDate)),Re(o.clientX,o.clientY))})});let _=null,re=null,he=null;function De(){_&&(_.fromBar.classList.remove("linking-source"),document.querySelectorAll(".link-target").forEach(t=>t.classList.remove("link-target")),re&&(re.remove(),re=null),_=null,he=null,document.body.classList.remove("cursor-crosshair"))}function ze(t,o,n,r,i="end",E="start"){document.querySelector(".relation-picker")?.remove();let D=document.createElement("div");D.className="relation-picker";let k=180,B=200,y=Math.min(t,window.innerWidth-k-10),H=Math.min(o,window.innerHeight-B-10);D.style.left=Math.max(10,y)+"px",D.style.top=Math.max(10,H)+"px";let X={end_start:"finish_to_start",end_end:"finish_to_finish",start_start:"start_to_start",start_end:"start_to_finish"}[`${i}_${E}`]||"finish_to_start",Y=[{value:"blocks",label:"\u{1F6AB} Blocks",cssClass:"rel-line-blocks",tooltip:"Target cannot be closed until this issue is closed"},{value:"precedes",label:"\u27A1\uFE0F Precedes",cssClass:"rel-line-scheduling",tooltip:"This issue must complete before target can start"},{value:"relates",label:"\u{1F517} Relates to",cssClass:"rel-line-informational",tooltip:"Simple link between issues (no constraints)"},{value:"duplicates",label:"\u{1F4CB} Duplicates",cssClass:"rel-line-informational",tooltip:"Closing target will automatically close this issue"},{value:"copied_to",label:"\u{1F4C4} Copied to",cssClass:"rel-line-informational",tooltip:"This issue was copied to create the target issue"}],J=[{value:"finish_to_start",label:"\u23E9 Finish\u2192Start",cssClass:"rel-line-scheduling",tooltip:"Target starts after this issue finishes (FS)"},{value:"start_to_start",label:"\u25B6\uFE0F Start\u2192Start",cssClass:"rel-line-scheduling",tooltip:"Target starts when this issue starts (SS)"},{value:"finish_to_finish",label:"\u23F9\uFE0F Finish\u2192Finish",cssClass:"rel-line-scheduling",tooltip:"Target finishes when this issue finishes (FF)"},{value:"start_to_finish",label:"\u23EA Start\u2192Finish",cssClass:"rel-line-scheduling",tooltip:"Target finishes when this issue starts (SF)"}];(A?[...Y,...J]:Y).forEach(pe=>{let ye=document.createElement("button");pe.value===X&&ye.classList.add("suggested");let Fe=document.createElement("span");Fe.className="color-swatch "+pe.cssClass,ye.appendChild(Fe),ye.appendChild(document.createTextNode(pe.label)),ye.title=pe.tooltip+(pe.value===X?" (suggested based on anchors)":""),ye.addEventListener("click",()=>{R(),w.postMessage({command:"createRelation",issueId:n,targetIssueId:r,relationType:pe.value}),D.remove()}),D.appendChild(ye)}),document.body.appendChild(D),U(D)}let He=".drag-handle, .link-handle, .bar-outline, .blocks-badge-group, .blocker-badge, .progress-badge-group, .flex-badge-group";document.querySelectorAll(".issue-bar").forEach(t=>{t.addEventListener("click",o=>{o.target.closest(He)||c||_||Q||(S()&&d(),p(t.dataset.issueId))}),t.addEventListener("dblclick",o=>{c||_||Q||(o.preventDefault(),ue(t.dataset.issueId))})});function st(t,o){if(document.querySelectorAll(".dependency-arrow.selected").forEach(r=>r.classList.remove("selected")),document.querySelectorAll(".arrow-connected").forEach(r=>r.classList.remove("arrow-connected")),t.length===0)return;document.body.classList.add("arrow-selection-mode");let n=new Set;t.forEach(r=>{r.classList.add("selected"),n.add(r.dataset.from),n.add(r.dataset.to)}),n.forEach(r=>{document.querySelectorAll(`.issue-bar[data-issue-id="${r}"], .issue-label[data-issue-id="${r}"]`).forEach(i=>i.classList.add("arrow-connected"))}),Z(`Highlighted ${t.length} dependency arrow(s) for #${o}`)}document.querySelectorAll(".blocks-badge-group").forEach(t=>{t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation()}),t.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();let n=t.closest(".issue-bar");if(!n)return;let r=n.dataset.issueId,i=Array.from(document.querySelectorAll(`.dependency-arrow[data-from="${r}"]`));st(i,r)})}),document.querySelectorAll(".blocker-badge").forEach(t=>{t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation()}),t.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();let n=t.closest(".issue-bar");if(!n)return;let r=n.dataset.issueId,i=Array.from(document.querySelectorAll(`.dependency-arrow[data-to="${r}"]`));st(i,r)})});let me=Array.from(document.querySelectorAll(".issue-bar")),nt=10;me.forEach((t,o)=>{t.addEventListener("keydown",n=>{if(n.key==="Enter"||n.key===" ")n.preventDefault(),p(t.dataset.issueId);else if(n.key==="ArrowDown"&&o<me.length-1)n.preventDefault(),me[o+1].focus(),Z(`Issue ${me[o+1].getAttribute("aria-label")}`);else if(n.key==="ArrowUp"&&o>0)n.preventDefault(),me[o-1].focus(),Z(`Issue ${me[o-1].getAttribute("aria-label")}`);else if(n.key==="Home")n.preventDefault(),me[0].focus(),Z(`First issue: ${me[0].getAttribute("aria-label")}`);else if(n.key==="End")n.preventDefault(),me[me.length-1].focus(),Z(`Last issue: ${me[me.length-1].getAttribute("aria-label")}`);else if(n.key==="PageDown"){n.preventDefault();let r=Math.min(o+nt,me.length-1);me[r].focus(),Z(`Issue ${me[r].getAttribute("aria-label")}`)}else if(n.key==="PageUp"){n.preventDefault();let r=Math.max(o-nt,0);me[r].focus(),Z(`Issue ${me[r].getAttribute("aria-label")}`)}else if(n.key==="Tab"&&n.shiftKey){let r=t.dataset.issueId,i=document.querySelector(`.issue-label[data-issue-id="${r}"]`);i&&(n.preventDefault(),i.focus(),Z(`Label for issue #${r}`))}})}),document.querySelectorAll(".link-handle").forEach(t=>{t.addEventListener("mousedown",o=>{o.stopPropagation(),o.preventDefault();let n=t.closest(".issue-bar"),r=parseInt(n.dataset.issueId),i=parseFloat(t.dataset.cx),E=parseFloat(t.dataset.cy);n.classList.add("linking-source"),document.body.classList.add("cursor-crosshair");let D=document.querySelector("#ganttTimeline svg");if(!document.getElementById("temp-arrow-head")){let B=document.createElementNS("http://www.w3.org/2000/svg","defs");B.innerHTML=`
            <marker id="temp-arrow-head" markerWidth="10" markerHeight="7"
                    refX="9" refY="3.5" orient="auto" markerUnits="strokeWidth">
              <polygon points="0 0, 10 3.5, 0 7" fill="var(--vscode-focusBorder)"/>
            </marker>`,D.insertBefore(B,D.firstChild)}re=document.createElementNS("http://www.w3.org/2000/svg","path"),re.classList.add("temp-link-arrow"),re.setAttribute("stroke","var(--vscode-focusBorder)"),re.setAttribute("stroke-width","2"),re.setAttribute("fill","none"),re.setAttribute("marker-end","url(#temp-arrow-head)"),D.appendChild(re);let k=t.dataset.anchor||"end";_={fromId:r,fromBar:n,startX:i,startY:E,fromAnchor:k}})}),ie("keydown",t=>{if(t.key==="Escape"){let o=document.querySelector(".relation-picker");if(o){t.stopImmediatePropagation(),o.remove();return}if(_){t.stopImmediatePropagation(),De();return}S()&&(t.stopImmediatePropagation(),d(),Z("Focus cleared"))}});let Ze=!1,et=null;ie("mousemove",t=>{!c&&!_||(et=t,!Ze&&(Ze=!0,requestAnimationFrame(()=>{Ze=!1;let o=et;if(o){if(c){let n=o.clientX-c.initialMouseX;if(c.isMove&&c.isBulkDrag&&c.bulkBars){let r=de(n)-de(0);c.bulkBars.forEach(i=>{let E=i.endX-i.startX,D=Math.max(0,Math.min(i.startX+r,ce-E)),k=D+E,B=k-D;i.barOutline.setAttribute("x",D),i.barOutline.setAttribute("width",B),i.barMain&&(i.barMain.setAttribute("x",D),i.barMain.setAttribute("width",B));let y=i.leftHandle.querySelector("rect"),H=i.rightHandle.querySelector("rect");if(y&&y.setAttribute("x",D),H&&H.setAttribute("x",k-14),i.leftHandle.querySelectorAll(".drag-grip circle").forEach((v,X)=>v.setAttribute("cx",D+9)),i.rightHandle.querySelectorAll(".drag-grip circle").forEach((v,X)=>v.setAttribute("cx",k-9)),i.newStartX=D,i.newEndX=k,i.barLabels){let v=i.labelsOnLeft?D-i.startX:k-i.endX;i.barLabels.setAttribute("transform","translate("+v+", 0)")}i.connectedArrows&&qe(i.connectedArrows,i.issueId,D,k),i.linkHandle&&i.linkHandle.querySelectorAll("circle").forEach(v=>v.setAttribute("cx",String(k+8)))}),c.snappedDelta=r}else{let r=c.startX,i=c.endX,E=c.endX-c.startX;c.isMove?(r=de(Math.max(0,Math.min(c.startX+n,ce-E))),i=r+E):c.isLeft?r=de(Math.max(0,Math.min(c.startX+n,c.endX-z))):i=de(Math.max(c.startX+z,Math.min(c.endX+n,ce)));let D=i-r;c.barOutline.setAttribute("x",r),c.barOutline.setAttribute("width",D),c.barMain&&(c.barMain.setAttribute("x",r),c.barMain.setAttribute("width",D));let k=c.leftHandle.querySelector("rect"),B=c.rightHandle.querySelector("rect");if(k&&k.setAttribute("x",r),B&&B.setAttribute("x",i-14),c.leftHandle.querySelectorAll(".drag-grip circle").forEach(y=>y.setAttribute("cx",r+9)),c.rightHandle.querySelectorAll(".drag-grip circle").forEach(y=>y.setAttribute("cx",i-9)),c.newStartX=r,c.newEndX=i,c.barLabels){let y=c.labelsOnLeft?r-c.startX:i-c.endX;c.barLabels.setAttribute("transform","translate("+y+", 0)")}if(c.connectedArrows&&qe(c.connectedArrows,c.issueId,r,i),c.linkHandle&&c.linkHandle.querySelectorAll("circle").forEach(y=>y.setAttribute("cx",String(i+8))),c.isMove&&!c.isBulkDrag){let y=C(r),H=K(i),X=y!==c.oldStartDate?F(c.oldStartDate,c.oldDueDate)+" \u2192 "+F(y,H):F(y,H);Le(X),Re(o.clientX,o.clientY)}else if(!c.isMove){let y=c.isLeft?r:i,H=c.isLeft?C(y):K(y);Le((c.isLeft?"Start: ":"Due: ")+te(H)),Re(o.clientX,o.clientY)}}}if(_&&re){let r=document.querySelector("#ganttTimeline svg").getBoundingClientRect(),i=o.clientX-r.left,E=o.clientY-r.top,D=`M ${_.startX} ${_.startY} L ${i} ${E}`;re.setAttribute("d",D);let k=document.elementFromPoint(o.clientX,o.clientY)?.closest(".issue-bar");he&&he!==k&&he.classList.remove("link-target"),k&&k!==_.fromBar?(k.classList.add("link-target"),he=k):he=null}}})))});function Ge(t){if(!t)return;let{bar:o,barOutline:n,barMain:r,leftHandle:i,rightHandle:E,barLabels:D,startX:k,endX:B,connectedArrows:y,issueId:H,linkHandle:v}=t,X=B-k;if(n&&(n.setAttribute("x",String(k)),n.setAttribute("width",String(X))),r&&(r.setAttribute("x",String(k)),r.setAttribute("width",String(X))),i){let Y=i.querySelector("rect");Y&&Y.setAttribute("x",String(k)),i.querySelectorAll(".drag-grip circle").forEach(J=>J.setAttribute("cx",k+9))}if(E){let Y=E.querySelector("rect");Y&&Y.setAttribute("x",String(B-14)),E.querySelectorAll(".drag-grip circle").forEach(J=>J.setAttribute("cx",B-9))}D&&D.removeAttribute("transform"),y&&y.length>0&&qe(y,H,k,B),v&&v.querySelectorAll("circle").forEach(Y=>Y.setAttribute("cx",String(B+8))),o&&o.classList.remove("dragging")}ie("mouseup",t=>{if(c){let{issueId:o,isLeft:n,isMove:r,isBulkDrag:i,bulkBars:E,newStartX:D,newEndX:k,bar:B,startX:y,endX:H,oldStartDate:v,oldDueDate:X,barOutline:Y,barMain:J,leftHandle:Me,rightHandle:pe,barLabels:ye,connectedArrows:Fe}=c,be={...c};if(i&&E&&r){E.forEach(N=>N.bar.classList.remove("dragging"));let Xe=[];if(E.forEach(N=>{if(N.newStartX!==void 0&&N.newStartX!==N.startX){let ne=C(N.newStartX),ve=K(N.newEndX);(ne!==N.oldStartDate||ve!==N.oldDueDate)&&Xe.push({issueId:parseInt(N.issueId),oldStartDate:N.oldStartDate,oldDueDate:N.oldDueDate,newStartDate:ne,newDueDate:ve,barData:N})}}),Xe.length>0){Ce();let N=()=>{ke.push({type:"bulk",changes:Xe.map(ne=>({issueId:ne.issueId,oldStartDate:ne.oldStartDate,oldDueDate:ne.oldDueDate,newStartDate:ne.newStartDate,newDueDate:ne.newDueDate}))}),Ee.length=0,le(),R(),Xe.forEach(ne=>{w.postMessage({command:"updateDates",issueId:ne.issueId,startDate:ne.newStartDate,dueDate:ne.newDueDate})})};if(I&&I())N();else{let ne="Move "+Xe.length+" issue(s) to new dates?";Ye(ne,N,()=>{E.forEach(ve=>Ge(ve))})}}else Ce(),E.forEach(N=>Ge(N));c=null,Q=!0,requestAnimationFrame(()=>Q=!1);return}if(B.classList.remove("dragging"),Ce(),D!==void 0||k!==void 0){let Xe=null,N=null;r?D!==y&&(Xe=C(D),N=K(k)):n?Xe=D!==y?C(D):null:N=k!==H?K(k):null;let ne=Xe&&Xe!==v?Xe:null,ve=N&&N!==X?N:null;if(ne||ve){let Qe=()=>{ke.push({issueId:o,oldStartDate:ne?v:null,oldDueDate:ve?X:null,newStartDate:ne,newDueDate:ve}),Ee.length=0,le(),R(),w.postMessage({command:"updateDates",issueId:o,startDate:ne,dueDate:ve})};if(I&&I())Qe();else{let Ne="Issue #"+o+": ";ne&&ve?Ne+=F(v,X)+" \u2192 "+F(ne,ve):ne?Ne+="Start: "+te(v)+" \u2192 "+te(ne):Ne+="Due: "+te(X)+" \u2192 "+te(ve),Ye(Ne,Qe,()=>{Ge(be)})}}else Ge(be)}else Ge(be);c=null,Q=!0,requestAnimationFrame(()=>Q=!1)}if(_){let o=_.fromId,n=_.fromAnchor;if(he){let r=parseInt(he.dataset.issueId);if(o!==r){let E=document.querySelector("#ganttTimeline svg").getBoundingClientRect(),D=t.clientX-E.left,k=he.querySelector(".bar-outline"),B=parseFloat(k.getAttribute("x")),y=B+parseFloat(k.getAttribute("width")),H=(B+y)/2,v=D<H?"start":"end";ze(t.clientX,t.clientY,o,r,n,v)}}De()}ge||h()}),j?.addEventListener("click",()=>{if(j.hasAttribute("disabled")||ke.length===0)return;let t=ke.pop();if(Ee.push(t),le(),R(),t.type==="relation")t.operation==="create"?w.postMessage({command:"undoRelation",operation:"delete",relationId:t.relationId,datesBefore:t.datesBefore}):w.postMessage({command:"undoRelation",operation:"create",issueId:t.issueId,targetIssueId:t.targetIssueId,relationType:t.relationType});else if(t.type==="bulk"){let o=I&&I();t.changes.forEach(n=>{o?w.postMessage({command:"removeDraft",issueId:n.issueId,startDate:n.oldStartDate,dueDate:n.oldDueDate}):w.postMessage({command:"updateDates",issueId:n.issueId,startDate:n.oldStartDate,dueDate:n.oldDueDate})})}else I&&I()?w.postMessage({command:"removeDraft",issueId:t.issueId,startDate:t.oldStartDate,dueDate:t.oldDueDate}):w.postMessage({command:"updateDates",issueId:t.issueId,startDate:t.oldStartDate,dueDate:t.oldDueDate})}),W?.addEventListener("click",()=>{if(W.hasAttribute("disabled")||Ee.length===0)return;let t=Ee.pop();ke.push(t),le(),R(),t.type==="relation"?t.operation==="create"?w.postMessage({command:"redoRelation",operation:"create",issueId:t.issueId,targetIssueId:t.targetIssueId,relationType:t.relationType}):w.postMessage({command:"redoRelation",operation:"delete",relationId:t.relationId}):t.type==="bulk"?t.changes.forEach(o=>{w.postMessage({command:"updateDates",issueId:o.issueId,startDate:o.newStartDate,dueDate:o.newDueDate})}):w.postMessage({command:"updateDates",issueId:t.issueId,startDate:t.newStartDate,dueDate:t.newDueDate})})}function bt(L){let{vscode:w,addDocListener:j,addWinListener:W,announce:ie,barHeight:U,selectedCollapseKey:Z}=L;document.querySelectorAll(".collapse-toggle").forEach(d=>{d.addEventListener("click",S=>{S.stopPropagation();let M=d.closest("[data-collapse-key]")?.dataset.collapseKey;M&&ue(M)})}),document.getElementById("menuExpand")?.addEventListener("click",()=>{let S=document.getElementById("ganttScroll")?.dataset.allExpandableKeys,p=S?JSON.parse(S):[];w.postMessage({command:"expandAll",keys:p})}),document.getElementById("menuCollapse")?.addEventListener("click",()=>{w.postMessage({command:"collapseAll"})});let R=Array.from(document.querySelectorAll(".project-label, .issue-label, .time-group-label")),le=null,ke=Z??null;function Ee(d){return!d.classList.contains("gantt-row-hidden")&&d.getAttribute("visibility")!=="hidden"}function ae(d,S){let p=d+S;for(;p>=0&&p<R.length;){if(Ee(R[p]))return{label:R[p],index:p};p+=S}return null}function P(d){let S=document.getElementById("ganttScroll"),p=document.querySelector(".gantt-header-row");if(!S||!d)return;let M=p?.getBoundingClientRect().height||60,I=d.closest(".gantt-row");if(!I)return;let l=I.getBoundingClientRect().top,g=I.getBoundingClientRect().height,C=S.getBoundingClientRect(),K=C.top+M,V=C.bottom;l<K?S.scrollBy({top:l-K-4,behavior:"smooth"}):l+g>V&&S.scrollBy({top:l+g-V+4,behavior:"smooth"})}function $(d,S=!1,p=!1,M=!1){le&&le.classList.remove("active"),le=d,d&&(d.classList.add("active"),M||d.focus(),p&&P(d),S||w.postMessage({command:"setSelectedKey",collapseKey:d.dataset.collapseKey}))}W("focus",()=>{le&&Ee(le)&&le.focus()}),j("keydown",d=>{d.key==="Escape"&&le&&(le.classList.remove("active"),le.blur(),le=null,w.postMessage({command:"setSelectedKey",collapseKey:null}))});let q=new Map,A=new Map,G=new Map;function u(d){let S=d.dataset.originalY;if(G.has(S))return G.get(S);let p=JSON.parse(d.dataset.rowContributions||"{}");return G.set(S,p),p}function ce(){q.clear(),document.querySelectorAll("[data-collapse-key][data-original-y]").forEach(S=>{let p=S.dataset.collapseKey,M=parseFloat(S.dataset.originalY);q.has(p)||q.set(p,{originalY:M,elements:[]}),q.get(p).elements.push(S)})}function z(){A.clear(),document.querySelectorAll("[data-collapse-key][data-parent-key]").forEach(S=>{let p=S.dataset.collapseKey;if(A.has(p))return;let M=[],I=S.dataset.parentKey;for(;I;)M.push(I),I=document.querySelector('[data-collapse-key="'+I+'"]')?.dataset.parentKey||null;A.set(p,M)})}ce(),z();function T(d,S){S?(d.setAttribute("visibility","hidden"),d.classList.add("gantt-row-hidden")):(d.removeAttribute("visibility"),d.classList.remove("gantt-row-hidden"))}function ee(d){let S=[];return A.forEach((p,M)=>{p.includes(d)&&S.push(M)}),S}function de(d){let S=[];return A.forEach((p,M)=>{let I=p.indexOf(d);if(I===-1)return;let l=!0;for(let g=0;g<I;g++){let C=p[g],K=document.querySelector('[data-collapse-key="'+C+'"].project-label, [data-collapse-key="'+C+'"].issue-label, [data-collapse-key="'+C+'"].time-group-label');if(!K||K.dataset.expanded!=="true"){l=!1;break}}l&&S.push(M)}),S}function ue(d,S){let p=document.querySelector('[data-collapse-key="'+d+'"].project-label, [data-collapse-key="'+d+'"].time-group-label, [data-collapse-key="'+d+'"].issue-label');if(!p||p.dataset.hasChildren!=="true")return;let M=p.dataset.expanded==="true",I=S==="expand"?!0:S==="collapse"?!1:!M;if(I===M)return;p.dataset.expanded=I?"true":"false";let l=p.querySelector(".collapse-toggle");l&&l.classList.toggle("expanded",I);let g=ee(d),C=I?de(d):[];if(g.length===0){w.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:I});return}let K=new Set(g),V=new Set(C),fe=q.get(d),te=fe?.originalY??0,F=new Set,Ae=0,Le=0,Ce=I?C:de(d),oe=new Set(Ce);if(document.querySelectorAll(".zebra-stripe").forEach(h=>{let c=u(h);d in c&&Le===0&&(Le=parseFloat(h.dataset.originalY||"0"));for(let[x,Q]of Object.entries(c))oe.has(x)&&!F.has(x)&&(Ae+=parseFloat(Q),F.add(x))}),Ae===0&&Ce.length>0){w.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:I}),w.postMessage({command:"requestRerender"});return}let m=I?Ae:-Ae,xe=te;if(fe&&fe.elements.length>0){let c=(fe.elements[0].getAttribute("transform")||"").match(/translate\([^,]+,\s*([-\d.]+)/);c&&(xe=parseFloat(c[1]))}let We=xe+U;I?C.forEach(h=>{let c=q.get(h);c&&(c.elements.forEach(x=>{let _=(x.getAttribute("transform")||"").match(/translate\(([-\d.]+)/),re=_?_[1]:"0";x.setAttribute("transform","translate("+re+", "+We+")"),T(x,!1)}),We+=U)}):g.forEach(h=>{let c=q.get(h);c&&c.elements.forEach(x=>{T(x,!0)})}),q.forEach(({originalY:h,elements:c},x)=>{h>te&&!K.has(x)&&c.forEach(Q=>{let _=Q.getAttribute("transform")||"",re=_.match(/translate\(([-\d.]+)/),he=re?re[1]:"0",De=_.match(/translate\([^,]+,\s*([-\d.]+)/),He=(De?parseFloat(De[1]):h)+m;Q.setAttribute("transform","translate("+he+", "+He+")")})});let _e=document.querySelector(".gantt-labels svg");if(_e){let c=parseFloat(_e.getAttribute("height")||"0")+m;_e.setAttribute("height",String(c))}[".gantt-col-status svg",".gantt-col-id svg",".gantt-col-start svg",".gantt-col-due svg",".gantt-col-assignee svg"].forEach(h=>{let c=document.querySelector(h);if(!c)return;let Q=parseFloat(c.getAttribute("height")||"0")+m;c.setAttribute("height",String(Q))});let Ie=document.querySelector(".gantt-timeline svg");if(Ie){let c=parseFloat(Ie.getAttribute("height")||"0")+m;Ie.setAttribute("height",c)}let Pe=new Set;document.querySelectorAll('.project-label[data-has-children="true"], .time-group-label[data-has-children="true"], .issue-label[data-has-children="true"]').forEach(h=>{h.dataset.expanded==="false"&&Pe.add(h.dataset.collapseKey)});let Te=new Map,Oe=document.querySelectorAll(".zebra-stripe");Oe.forEach(h=>{let c=parseFloat(h.dataset.originalY||"0");if(Te.has(c))return;let x=u(h),Q=Object.keys(x),_=Q.length>0&&Q.every(De=>K.has(De)),re=Q.some(De=>K.has(De)),he=c>Le;if(_)Te.set(c,{action:"toggle-visibility",hide:!I});else if(re)if(I){let De=0;for(let[ze,He]of Object.entries(x))(!K.has(ze)||V.has(ze))&&(De+=parseFloat(He));Te.set(c,{action:"expand",newHeight:De})}else{let De=0;for(let[ze,He]of Object.entries(x))K.has(ze)||(De+=parseFloat(He));Te.set(c,{action:"shrink",newHeight:De})}else if(he){let De=parseFloat(h.getAttribute("y")||String(c));Te.set(c,{action:"shift",newY:De+m})}}),Oe.forEach(h=>{let c=parseFloat(h.dataset.originalY||"0"),x=Te.get(c);if(x)switch(x.action){case"toggle-visibility":T(h,x.hide);break;case"shrink":h.setAttribute("height",String(x.newHeight));break;case"expand":h.setAttribute("height",String(x.newHeight));break;case"shift":h.setAttribute("y",String(x.newY));break}});let ge=Array.from(document.querySelectorAll(".zebra-stripe")).filter(h=>h.getAttribute("visibility")!=="hidden"),Ye=new Map;ge.forEach(h=>{let c=parseFloat(h.getAttribute("y")||"0");Ye.has(c)||Ye.set(c,[]),Ye.get(c).push(h)}),Array.from(Ye.keys()).sort((h,c)=>h-c).forEach((h,c)=>{let x=c%2===0?"0.03":"0.06";Ye.get(h).forEach(Q=>Q.setAttribute("opacity",x))}),document.querySelectorAll(".indent-guide-line").forEach(h=>{let c=h.dataset.forParent,x=A.get(c)||[],Q=Pe.has(c)||x.some(_=>Pe.has(_));if(T(h,Q),!Q){let _=q.get(c);if(_&&_.originalY>te){let re=parseFloat(h.getAttribute("y1")||"0"),he=parseFloat(h.getAttribute("y2")||"0");h.setAttribute("y1",re+m),h.setAttribute("y2",he+m)}}}),document.querySelectorAll(".dependency-arrow").forEach(h=>{let c=h.dataset.from,x=h.dataset.to,Q=document.querySelector('.issue-bar[data-issue-id="'+c+'"]'),_=document.querySelector('.issue-bar[data-issue-id="'+x+'"]'),re=Q?.classList.contains("gantt-row-hidden"),he=_?.classList.contains("gantt-row-hidden");T(h,re||he)}),w.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:I})}if(ke){let d=R.find(S=>S.dataset.collapseKey===ke);d&&$(d,!0)}R.forEach((d,S)=>{d.addEventListener("click",p=>{if(p.target.closest?.(".collapse-toggle")||p.target.closest?.(".chevron-hit-area"))return;let M=d.dataset.issueId,I=d.classList.contains("project-label"),l=d.classList.contains("time-group-label"),g=d.dataset.collapseKey;if((I||l)&&g){$(d),d.dataset.hasChildren==="true"&&ue(g);return}let C=p.target.classList?.contains("issue-text")||p.target.closest(".issue-text");M&&C?($(d,!1,!1,!0),w.postMessage({command:"openIssue",issueId:parseInt(M,10)})):d.dataset.hasChildren==="true"&&g?($(d),ue(g)):$(d)}),d.addEventListener("keydown",p=>{let M=d.dataset.collapseKey,I=d.dataset.issueId?parseInt(d.dataset.issueId,10):NaN;switch(p.key){case"Enter":case" ":p.preventDefault(),isNaN(I)||w.postMessage({command:"openIssue",issueId:I});break;case"ArrowUp":{p.preventDefault();let l=ae(S,-1);l&&$(l.label,!1,!0);break}case"ArrowDown":{p.preventDefault();let l=ae(S,1);l&&$(l.label,!1,!0);break}case"ArrowLeft":if(p.preventDefault(),d.dataset.hasChildren==="true"&&d.dataset.expanded==="true")ue(M,"collapse");else if(d.dataset.parentKey){let l=R.find(g=>g.dataset.collapseKey===d.dataset.parentKey);l&&$(l,!1,!0)}break;case"ArrowRight":if(p.preventDefault(),d.dataset.hasChildren==="true"&&d.dataset.expanded==="false")ue(M,"expand");else if(d.dataset.hasChildren==="true"&&d.dataset.expanded==="true"){let l=R.find(g=>g.dataset.parentKey===M&&Ee(g));l&&$(l,!1,!0)}break;case"Home":{p.preventDefault();let l=ae(-1,1);l&&$(l.label,!1,!0);break}case"End":{p.preventDefault();let l=ae(R.length,-1);l&&$(l.label,!1,!0);break}case"PageDown":{p.preventDefault();let l=S,g=0;for(;g<10&&l<R.length-1;){let C=ae(l,1);if(!C)break;l=C.index,g++}g>0&&$(R[l],!1,!0);break}case"PageUp":{p.preventDefault();let l=S,g=0;for(;g<10&&l>0;){let C=ae(l,-1);if(!C)break;l=C.index,g++}g>0&&$(R[l],!1,!0);break}case"Tab":if(!p.shiftKey&&!isNaN(I)){let l=document.querySelector(`.issue-bar[data-issue-id="${I}"]`);l&&(p.preventDefault(),l.focus(),ie(`Timeline bar for issue #${I}`))}break}})})}function vt(L){let{vscode:w,addDocListener:j,menuUndo:W,menuRedo:ie,undoStack:U,redoStack:Z,saveState:R,updateUndoRedoButtons:le,announce:ke,scrollToAndHighlight:Ee,scrollToToday:ae}=L;j("keydown",u=>{let z=navigator.platform.toUpperCase().indexOf("MAC")>=0?u.metaKey:u.ctrlKey;if(!(u.target.tagName==="INPUT"||u.target.tagName==="SELECT"||u.target.tagName==="TEXTAREA"))if(z&&u.key==="z"&&!u.shiftKey)u.preventDefault(),W?.click();else if(z&&u.key==="z"&&u.shiftKey)u.preventDefault(),ie?.click();else if(z&&u.key==="y")u.preventDefault(),ie?.click();else if(u.key>="1"&&u.key<="5"){let T=document.getElementById("zoomSelect"),ee=["day","week","month","quarter","year"];T.value=ee[parseInt(u.key)-1],T.dispatchEvent(new Event("change"))}else if(u.key.toLowerCase()==="h")document.getElementById("menuHeatmap")?.click();else if(u.key.toLowerCase()==="y")document.getElementById("menuCapacity")?.click();else if(u.key.toLowerCase()==="i")document.getElementById("menuIntensity")?.click();else if(u.key.toLowerCase()==="d")document.getElementById("menuDeps")?.click();else if(u.key.toLowerCase()==="v"){let T=document.getElementById("viewFocusSelect");T.value=T.value==="project"?"person":"project",T.dispatchEvent(new Event("change"))}else if(u.key.toLowerCase()==="r")document.getElementById("refreshBtn")?.click();else if(u.key.toLowerCase()==="t")ae();else if(u.key.toLowerCase()==="e")document.getElementById("menuExpand")?.click();else if(u.key.toLowerCase()==="c"&&!z)document.getElementById("menuCollapse")?.click();else if(u.key.toLowerCase()==="f"&&!z)u.preventDefault(),document.getElementById("menuFilterHealth")?.click();else if(u.key.toLowerCase()==="b"){u.preventDefault();let T=Array.from(document.querySelectorAll(".issue-bar[data-issue-id]")).filter(S=>S.querySelector(".blocker-badge"));if(T.length===0){ke("No blocked issues");return}let ee=document.activeElement?.closest(".issue-bar"),ue=((ee?T.indexOf(ee):-1)+1)%T.length,d=T[ue];Ee(d.dataset.issueId),d.focus(),ke("Blocked issue "+(ue+1)+" of "+T.length)}else if(u.key==="ArrowLeft"||u.key==="ArrowRight"){let T=document.activeElement?.closest(".issue-bar:not(.parent-bar)");if(!T)return;u.preventDefault();let ee=parseInt(T.dataset.issueId),de=T.dataset.startDate,ue=T.dataset.dueDate;if(!de&&!ue)return;let d=u.key==="ArrowRight"?1:-1,S=(I,l)=>{let g=new Date(I+"T00:00:00");return g.setDate(g.getDate()+l),g.toISOString().slice(0,10)},p=null,M=null;u.shiftKey&&ue?M=S(ue,d):u.altKey&&de?p=S(de,d):(de&&(p=S(de,d)),ue&&(M=S(ue,d))),(p||M)&&(R(),U.push({issueId:ee,oldStartDate:p?de:null,oldDueDate:M?ue:null,newStartDate:p,newDueDate:M}),Z.length=0,le(),w.postMessage({command:"updateDates",issueId:ee,startDate:p,dueDate:M}))}else u.key==="/"&&!z?(u.preventDefault(),$()):(u.key==="?"||u.shiftKey&&u.key==="/")&&(u.preventDefault(),G())});let P=null;function $(){P&&P.remove(),P=document.createElement("div"),P.className="quick-search",P.innerHTML=`
      <input type="text" placeholder="Search issues..." autofocus />
    `,document.body.appendChild(P);let u=P.querySelector("input");u.focus();let ce=Array.from(document.querySelectorAll(".issue-label"));u.addEventListener("input",()=>{let z=u.value.toLowerCase();ce.forEach(T=>{let ee=T.getAttribute("aria-label")?.toLowerCase()||"",de=z&&ee.includes(z);T.classList.toggle("search-match",de)})}),u.addEventListener("keydown",z=>{if(z.key==="Escape")q();else if(z.key==="Enter"){let T=document.querySelector(".issue-label.search-match");T&&(q(),T.focus(),Ee(T.dataset.issueId))}}),u.addEventListener("blur",()=>setTimeout(q,150))}function q(){P&&(P.remove(),P=null,document.querySelectorAll(".search-match").forEach(u=>u.classList.remove("search-match")))}let A=null;function G(){if(A){A.remove(),A=null;return}A=document.createElement("div"),A.className="keyboard-help",A.innerHTML=`
      <div class="keyboard-help-content">
        <h3>Keyboard Shortcuts</h3>
        <div class="shortcut-grid">
          <div class="shortcut-section">
            <h4>Navigation</h4>
            <div><kbd>\u2191</kbd><kbd>\u2193</kbd> Move between issues</div>
            <div><kbd>Home</kbd><kbd>End</kbd> First/last issue</div>
            <div><kbd>PgUp</kbd><kbd>PgDn</kbd> Jump 10 rows</div>
            <div><kbd>Tab</kbd> Label \u2192 Bar</div>
            <div><kbd>Shift+Tab</kbd> Bar \u2192 Label</div>
          </div>
          <div class="shortcut-section">
            <h4>Date Editing</h4>
            <div><kbd>\u2190</kbd><kbd>\u2192</kbd> Move bar \xB11 day</div>
            <div><kbd>Shift+\u2190/\u2192</kbd> Resize end</div>
            <div><kbd>Alt+\u2190/\u2192</kbd> Resize start</div>
            <div><kbd>Ctrl+Z</kbd> Undo</div>
            <div><kbd>Ctrl+Y</kbd> Redo</div>
          </div>
          <div class="shortcut-section">
            <h4>View</h4>
            <div><kbd>1-5</kbd> Zoom levels</div>
            <div><kbd>H</kbd> Heatmap</div>
            <div><kbd>D</kbd> Dependencies</div>
            <div><kbd>C</kbd> Critical path</div>
            <div><kbd>T</kbd> Today</div>
          </div>
          <div class="shortcut-section">
            <h4>Health & Other</h4>
            <div><kbd>F</kbd> Cycle health filter</div>
            <div><kbd>B</kbd> Next blocked issue</div>
            <div><kbd>/</kbd> Quick search</div>
            <div><kbd>S</kbd> Cycle sort</div>
            <div><kbd>R</kbd> Refresh</div>
            <div><kbd>Esc</kbd> Clear/cancel</div>
          </div>
        </div>
        <p class="keyboard-help-close">Press <kbd>?</kbd> or <kbd>Esc</kbd> to close</p>
      </div>
    `,document.body.appendChild(A),A.addEventListener("click",u=>{u.target===A&&G()})}j("keydown",u=>{u.key==="Escape"&&A&&(u.stopImmediatePropagation(),G())})}var se=acquireVsCodeApi(),tt=!1;function Je(L){tt&&typeof performance<"u"&&performance.mark(L)}function lt(L,w,j){if(tt&&typeof performance<"u")try{performance.measure(L,w,j);let W=performance.getEntriesByName(L,"measure");W.length>0&&console.log(`[Gantt Perf] ${L}: ${W[W.length-1].duration.toFixed(2)}ms`),performance.clearMarks(w),performance.clearMarks(j),performance.clearMeasures(L)}catch{}}function Et(){if(tt){let L=document.getElementById("ganttRoot"),w=L?L.querySelectorAll("*").length:0,j=L?L.querySelectorAll("svg *").length:0;console.log(`[Gantt Perf] DOM nodes: ${w}, SVG elements: ${j}`)}}function Lt(L){if(!L)return;let w=document.documentElement;w.style.setProperty("--gantt-header-height",`${L.headerHeight}px`),w.style.setProperty("--gantt-label-width",`${L.labelWidth}px`),w.style.setProperty("--gantt-id-column-width",`${L.idColumnWidth}px`),w.style.setProperty("--gantt-start-date-column-width",`${L.startDateColumnWidth}px`),w.style.setProperty("--gantt-status-column-width",`${L.statusColumnWidth}px`),w.style.setProperty("--gantt-due-date-column-width",`${L.dueDateColumnWidth}px`),w.style.setProperty("--gantt-assignee-column-width",`${L.assigneeColumnWidth}px`),w.style.setProperty("--gantt-sticky-left-width",`${L.stickyLeftWidth}px`)}function Dt({addDocListener:L,addWinListener:w}){let j=document.getElementById("ganttRoot"),W=document.getElementById("ganttTooltip"),ie=W?.querySelector(".gantt-tooltip-content");if(!j||!W||!ie)return;let U=l=>l?String(l).replace(/\r\n/g,`
`).trimEnd():"";function Z(){j.querySelectorAll("svg title").forEach(l=>{let g=l.parentElement,C=U(l.textContent);g&&C&&(g.dataset.tooltip=C),l.remove()})}function R(){j.querySelectorAll("[title]").forEach(l=>{if(l.tagName.toLowerCase()==="title")return;let g=U(l.getAttribute("title"));l.removeAttribute("title"),g&&(l.dataset.tooltip=g)})}function le(){j.querySelectorAll("[data-toolbar-tooltip]").forEach(l=>{let g=U(l.dataset.toolbarTooltip);delete l.dataset.toolbarTooltip,g&&(l.dataset.tooltip=g)})}function ke(){Z(),R(),le()}function Ee(l){let g=l.findIndex(K=>K.trim().startsWith("#"));return g>=0?g:l.filter(K=>K.trim()).length>1?l.findIndex(K=>K.trim()):-1}function ae(l){ie.textContent="";let g=U(l);if(!g)return;let C=g.split(`
`),K=Ee(C),V=!1;C.forEach((te,F)=>{let Ae=te.trim();if(!Ae){if(!V){let oe=document.createElement("div");oe.className="gantt-tooltip-spacer",ie.appendChild(oe),V=!0}return}if(Ae==="---"){let oe=document.createElement("div");oe.className="gantt-tooltip-divider",ie.appendChild(oe),V=!1;return}let Le=Ae.match(/^cf:([^:]+):(.*)$/);if(Le){let oe=Le[1].trim(),m=Le[2].trim(),xe=document.createElement("div");xe.className="gantt-tooltip-line";let We=document.createElement("span");We.className="gantt-tooltip-key",We.textContent=`${oe}: `,xe.appendChild(We),m&&xe.appendChild(document.createTextNode(m)),ie.appendChild(xe),V=!1;return}let Re=document.createElement("div");Re.className="gantt-tooltip-line",F===K&&Re.classList.add("gantt-tooltip-title");let Ce=Ae.match(/^Open in Browser:\s*(\S+)/);if(Ce&&/^https?:\/\//i.test(Ce[1])){Re.appendChild(document.createTextNode("Open in Browser: "));let oe=document.createElement("a");oe.href=Ce[1],oe.textContent=Ce[1],oe.target="_blank",oe.rel="noopener noreferrer",Re.appendChild(oe)}else Re.textContent=te;ie.appendChild(Re),V=!1});let fe=ie.lastElementChild;fe&&fe.classList.contains("gantt-tooltip-spacer")&&fe.remove()}let P=null,$=null,q=null,A={x:0,y:0};function G(l){A={x:l.clientX,y:l.clientY}}function u(){$&&(clearTimeout($),$=null)}function ce(){q&&(clearTimeout(q),q=null)}function z(l){return l&&(l===W||W.contains(l))}function T(l){return l&&P&&(l===P||P.contains(l))}function ee(){if(!A)return!1;let l=document.elementFromPoint(A.x,A.y);return z(l)||T(l)}let de=300;function ue(l){ce(),q=setTimeout(()=>{q=null,!(!P||P!==l)&&ee()&&p(l,A.x,A.y)},de)}function d(){u(),$=setTimeout(()=>{P&&(ee()||M())},300)}function S(l,g){let V=W.getBoundingClientRect(),fe=l+8,te=g+8;fe+V.width>window.innerWidth-8&&(fe=l-V.width-8),te+V.height>window.innerHeight-8&&(te=g-V.height-8),fe=Math.max(8,Math.min(fe,window.innerWidth-V.width-8)),te=Math.max(8,Math.min(te,window.innerHeight-V.height-8)),W.style.left=`${Math.round(fe)}px`,W.style.top=`${Math.round(te)}px`}function p(l,g,C){let K=l.dataset.tooltip;K&&(ae(K),W.classList.add("visible"),W.setAttribute("aria-hidden","false"),S(g,C))}function M(l=!1){ce(),u(),W.classList.remove("visible"),W.setAttribute("aria-hidden","true"),l||(P=null)}function I(l){if(!l||l===W||W.contains(l))return null;let g=l.closest?.("[data-tooltip], [title]");if(!g||!j.contains(g))return null;if(g.hasAttribute("title")){let C=U(g.getAttribute("title"));g.removeAttribute("title"),C&&(g.dataset.tooltip=C)}return g.dataset.tooltip?g:null}ke(),L("pointerover",l=>{if(G(l),z(l.target)){u(),ce();return}let g=I(l.target);if(!g){ce();return}u(),P!==g?(P=g,W.classList.contains("visible")&&M(!0),ue(g)):W.classList.contains("visible")||ue(g)},!0),L("pointermove",l=>{P&&(G(l),$&&ee()&&u())},!0),L("pointerout",l=>{if(!P||(G(l),ce(),!T(l.target)&&!z(l.target)))return;let g=l.relatedTarget;z(g)||T(g)||d()},!0),L("scroll",()=>{P&&M()},!0),L("keydown",()=>{P&&M()},!0),w("blur",()=>{P&&M()})}function St(L){if(!L)return;L.state&&(tt=L.state.perfDebug??!1),Je("render-start");let w=document.getElementById("ganttRoot");w&&(Lt(L.state),Je("innerHTML-start"),w.innerHTML=L.html||"",Je("innerHTML-end"),lt("innerHTML","innerHTML-start","innerHTML-end"),At(L.state),Je("render-end"),lt("render","render-start","render-end"),Et())}window.addEventListener("message",L=>{let w=L.data;if(w){if(w.command==="render"){St(w.payload);return}window.__ganttHandleExtensionMessage&&window.__ganttHandleExtensionMessage(w)}});var wt=window.__GANTT_INITIAL_PAYLOAD__;wt&&St(wt);se.postMessage({command:"webviewReady"});function At(L){if(Je("initializeGantt-start"),!L)return;let{timelineWidth:w,minDateMs:j,maxDateMs:W,totalDays:ie,extendedRelationTypes:U,redmineBaseUrl:Z,minimapBarsData:R,minimapHeight:le,minimapBarHeight:ke,minimapTodayX:Ee,extScrollLeft:ae,extScrollTop:P,labelWidth:$,leftExtrasWidth:q,healthFilter:A,sortBy:G,sortOrder:u,selectedCollapseKey:ce,barHeight:z,todayX:T,todayInRange:ee,isDraftMode:de,draftQueueCount:ue}=L,d=w/ie,S=de,p=document.getElementById("dragConfirmOk");p&&(p.textContent=de?"Queue to Draft":"Save to Redmine");let M=document.getElementById("draftBadge");if(M){if(de){M.classList.remove("hidden");let e=ue??0;M.textContent=e,M.dataset.tooltip=e===1?"1 change queued - click to review":e+" changes queued - click to review"}else M.classList.add("hidden");M.addEventListener("click",()=>{se.postMessage({command:"openDraftReview"})})}let I=document.getElementById("draftModeToggle");I&&I.addEventListener("click",()=>{se.postMessage({command:"toggleDraftMode"})}),window._ganttCleanup&&window._ganttCleanup();let l=[],g=[];function C(e,s,a){document.addEventListener(e,s,a),l.push({type:e,handler:s,options:a})}function K(e,s,a){window.addEventListener(e,s,a),g.push({type:e,handler:s,options:a})}window._ganttCleanup=()=>{l.forEach(e=>document.removeEventListener(e.type,e.handler,e.options)),g.forEach(e=>window.removeEventListener(e.type,e.handler,e.options)),window.__ganttHandleExtensionMessage=null};function V(e){setTimeout(()=>{document.addEventListener("click",function s(a){e.contains(a.target)||(e.remove(),document.removeEventListener("click",s))})},0)}function fe(e){return Math.round(e/d)*d}function te(e){let s=document.getElementById("liveRegion");s&&(s.textContent=e)}let F=document.getElementById("ganttScroll"),Ae=document.getElementById("ganttLeftHeader"),Le=document.getElementById("ganttLabels"),Re=document.getElementById("ganttTimeline"),Ce=document.getElementById("menuUndo"),oe=document.getElementById("menuRedo"),m=document.getElementById("minimapSvg"),xe=document.getElementById("minimapViewport"),{updateMinimapPosition:We,updateMinimapViewport:_e}=pt({timelineWidth:w,minimapBarsData:R,minimapHeight:le,minimapBarHeight:ke,minimapTodayX:Ee,ganttScroll:F,minimapSvg:m,minimapViewport:xe,addDocListener:C}),qe=se.getState()||{undoStack:[],redoStack:[],labelWidth:$,scrollLeft:null,scrollTop:null,centerDateMs:null},Ie=qe.undoStack||[],Pe=qe.redoStack||[],Te=qe.scrollLeft??(ae>0?ae:null),Oe=qe.scrollTop??(P>0?P:null),ge=qe.centerDateMs;function Ye(){if(!F)return null;let s=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,a=F.clientWidth-s,b=(F.scrollLeft+a/2)/w;return j+b*(W-j)}function Ke(e){if(!F)return;let a=(e-j)/(W-j)*w,b=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,O=F.clientWidth-b;F.scrollLeft=Math.max(0,a-O/2)}function h(){se.setState({undoStack:Ie,redoStack:Pe,labelWidth:Le?.offsetWidth||$,scrollLeft:null,scrollTop:F?.scrollTop??null,centerDateMs:Ye()})}let c=h;function x(){Ce&&Ce.toggleAttribute("disabled",Ie.length===0),oe&&oe.toggleAttribute("disabled",Pe.length===0),h()}if(qe.labelWidth&&Ae&&Le){Ae.style.width=qe.labelWidth+"px",Le.style.width=qe.labelWidth+"px";let e=document.querySelector(".capacity-ribbon-label");e&&(e.style.width=qe.labelWidth+q+"px")}let Q=!0,_=!1,re=e=>{_=e},he=null;F&&F.addEventListener("scroll",()=>{cancelAnimationFrame(he),he=requestAnimationFrame(()=>{_e(),Q||h()})},{passive:!0}),requestAnimationFrame(()=>x()),window.__ganttHandleExtensionMessage=e=>{if(e.command==="setHeatmapState"){let s=document.querySelector(".heatmap-layer"),a=document.querySelector(".weekend-layer"),f=document.getElementById("menuHeatmap");e.enabled?(s&&s.classList.remove("hidden"),a&&a.classList.add("hidden"),f&&f.classList.add("active")):(s&&s.classList.add("hidden"),a&&a.classList.remove("hidden"),f&&f.classList.remove("active"))}else if(e.command==="setDependenciesState"){let s=document.querySelector(".dependency-layer"),a=document.getElementById("menuDeps");e.enabled?(s&&s.classList.remove("hidden"),a&&a.classList.add("active")):(s&&s.classList.add("hidden"),a&&a.classList.remove("active"))}else if(e.command==="setCapacityRibbonState"){let s=document.querySelector(".capacity-ribbon"),a=document.getElementById("menuCapacity");e.enabled?(s&&s.classList.remove("hidden"),a&&a.classList.add("active")):(s&&s.classList.add("hidden"),a&&a.classList.remove("active"))}else if(e.command==="setIntensityState"){let s=document.querySelector(".gantt-container"),a=document.getElementById("menuIntensity");e.enabled?(s?.classList.add("intensity-enabled"),a&&a.classList.add("active")):(s?.classList.remove("intensity-enabled"),a&&a.classList.remove("active"))}else if(e.command==="setDraftModeState"){S=e.enabled;let s=document.getElementById("dragConfirmOk");s&&(s.textContent=e.enabled?"Queue to Draft":"Save to Redmine");let a=document.getElementById("draftModeToggle");a&&(a.classList.toggle("active",e.enabled),a.textContent=e.enabled?"Disable Draft Mode":"Enable Draft Mode");let f=document.getElementById("draftBadge");if(f)if(e.enabled){f.classList.remove("hidden");let b=e.queueCount??0;f.textContent=b,f.dataset.tooltip=b===1?"1 change queued - click to review":b+" changes queued - click to review"}else f.classList.add("hidden")}else if(e.command==="setDraftQueueCount"){let s=document.getElementById("draftBadge");if(s){let a=e.count;s.textContent=a,s.dataset.tooltip=a===1?"1 change queued - click to review":a+" changes queued - click to review"}}else if(e.command==="pushUndoAction")Ie.push(e.action),Pe.length=0,x(),h();else if(e.command==="updateRelationId"){let s=e.stack==="undo"?Ie:Pe;if(s.length>0){let a=s[s.length-1];a.type==="relation"&&(a.relationId=e.newRelationId,h())}}else if(e.command==="scrollToIssue"){let s=e.issueId,a=document.querySelector('.issue-label[data-issue-id="'+s+'"]'),f=document.querySelector('.issue-bar[data-issue-id="'+s+'"]'),b=document.getElementById("ganttScroll"),we=document.querySelector(".gantt-header-row")?.getBoundingClientRect().height||60;if(!b)return;let Be=b.scrollTop,Se=b.scrollLeft;if(a){let $e=a.closest(".gantt-row");if($e){let je=$e.offsetTop,Ue=$e.getBoundingClientRect().height,Ve=b.clientHeight-we;Be=Math.max(0,je-we-(Ve-Ue)/2)}a.focus(),a.classList.add("highlighted"),setTimeout(()=>a.classList.remove("highlighted"),2e3)}if(f){let $e=parseFloat(f.getAttribute("data-start-x")||"0"),Ue=parseFloat(f.getAttribute("data-end-x")||"0")-$e,Ve=b.clientWidth,kt=document.querySelector(".gantt-sticky-left")?.getBoundingClientRect().width||0,ht=Ve-kt;Ue<=ht-100?Se=$e-(ht-Ue)/2:Se=$e-50,Se=Math.max(0,Se),f.classList.add("highlighted"),setTimeout(()=>f.classList.remove("highlighted"),2e3)}b.scrollTo({left:Se,top:Be,behavior:"smooth"})}},document.getElementById("lookbackSelect")?.addEventListener("change",e=>{se.postMessage({command:"setLookback",years:e.target.value})}),document.getElementById("zoomSelect")?.addEventListener("change",e=>{c(),se.postMessage({command:"setZoom",zoomLevel:e.target.value})}),document.getElementById("viewFocusSelect")?.addEventListener("change",e=>{se.postMessage({command:"setViewFocus",focus:e.target.value})}),document.getElementById("projectSelector")?.addEventListener("change",e=>{let s=e.target.value,a=s?parseInt(s,10):null;se.postMessage({command:"setSelectedProject",projectId:a})}),document.getElementById("focusSelector")?.addEventListener("change",e=>{let s=e.target.value;se.postMessage({command:"setSelectedAssignee",assignee:s||null})}),document.getElementById("filterAssignee")?.addEventListener("change",e=>{let s=e.target.value;se.postMessage({command:"setFilter",filter:{assignee:s}})}),document.getElementById("filterStatus")?.addEventListener("change",e=>{let s=e.target.value;se.postMessage({command:"setFilter",filter:{status:s}})}),document.getElementById("menuFilterHealth")?.addEventListener("click",()=>{let e=["all","critical","warning","healthy"],s=A,f=(e.indexOf(s)+1)%e.length;se.postMessage({command:"setHealthFilter",health:e[f]})}),document.querySelectorAll(".gantt-col-header.sortable").forEach(e=>{e.addEventListener("click",()=>{let s=e.dataset.sort;s===G?u==="asc"?se.postMessage({command:"setSort",sortOrder:"desc"}):se.postMessage({command:"setSort",sortBy:null}):se.postMessage({command:"setSort",sortBy:s,sortOrder:"asc"})})}),document.getElementById("menuHeatmap")?.addEventListener("click",()=>{document.getElementById("menuHeatmap")?.hasAttribute("disabled")||(h(),se.postMessage({command:"toggleWorkloadHeatmap"}))}),document.getElementById("menuCapacity")?.addEventListener("click",()=>{document.getElementById("menuCapacity")?.hasAttribute("disabled")||(h(),se.postMessage({command:"toggleCapacityRibbon"}))}),document.getElementById("menuIntensity")?.addEventListener("click",()=>{document.getElementById("menuIntensity")?.hasAttribute("disabled")||(h(),se.postMessage({command:"toggleIntensity"}))}),document.getElementById("overloadBadge")?.addEventListener("click",e=>{e.stopPropagation();let s=e.currentTarget,a=parseInt(s.dataset.firstOverloadMs||"0",10);a>0&&(Ke(a),h())}),document.querySelectorAll(".capacity-day-bar-group").forEach(e=>{e.addEventListener("click",s=>{let a=parseInt(s.currentTarget.dataset.dateMs||"0",10);a>0&&(Ke(a),h())})}),document.getElementById("menuDeps")?.addEventListener("click",()=>{h(),se.postMessage({command:"toggleDependencies"})});let He=document.querySelector(".gantt-container");function st(){let e=new Map,s=new Map;return document.querySelectorAll(".dependency-arrow").forEach(a=>{if(!(a.classList.contains("rel-blocks")||a.classList.contains("rel-precedes")))return;let b=a.dataset.from,O=a.dataset.to;e.has(b)||e.set(b,[]),e.get(b).push(O),s.has(O)||s.set(O,[]),s.get(O).push(b)}),{graph:e,reverseGraph:s}}let me=null;function nt(e,s,a){let f=new Set([e]),b=[e];for(;b.length>0;){let we=b.shift(),Be=s.get(we)||[];for(let Se of Be)f.has(Se)||(f.add(Se),b.push(Se))}let O=[e];for(;O.length>0;){let we=O.shift(),Be=a.get(we)||[];for(let Se of Be)f.has(Se)||(f.add(Se),O.push(Se))}return f}function Ze(e){if(et(),!e)return;me=e;let{graph:s,reverseGraph:a}=st(),f=nt(e,s,a);He.classList.add("focus-mode"),document.querySelectorAll(".issue-bar").forEach(b=>{f.has(b.dataset.issueId)&&b.classList.add("focus-highlighted")}),document.querySelectorAll(".issue-label").forEach(b=>{f.has(b.dataset.issueId)&&b.classList.add("focus-highlighted")}),document.querySelectorAll(".dependency-arrow").forEach(b=>{f.has(b.dataset.from)&&f.has(b.dataset.to)&&b.classList.add("focus-highlighted")}),te(`Focus: ${f.size} issue${f.size!==1?"s":""} in dependency chain`)}function et(){me=null,He.classList.remove("focus-mode"),document.querySelectorAll(".focus-highlighted").forEach(e=>e.classList.remove("focus-highlighted"))}let Ge=()=>me,t=new Set,o=null,n=document.getElementById("selectionCount"),r=Array.from(document.querySelectorAll(".issue-bar")),i=new Map;r.forEach(e=>{let s=e.dataset.issueId;s&&(i.has(s)||i.set(s,[]),i.get(s).push(e))});function E(e){e.forEach(s=>{let a=i.get(s);a&&a.forEach(f=>f.classList.toggle("selected",t.has(s)))}),t.size>0?(n.textContent=`${t.size} selected`,n.classList.remove("hidden"),He.classList.add("multi-select-mode")):(n.classList.add("hidden"),He.classList.remove("multi-select-mode"))}function D(){r.forEach(e=>{e.classList.toggle("selected",t.has(e.dataset.issueId))}),t.size>0?(n.textContent=`${t.size} selected`,n.classList.remove("hidden"),He.classList.add("multi-select-mode")):(n.classList.add("hidden"),He.classList.remove("multi-select-mode"))}function k(){let e=[...t];t.clear(),o=null,E(e)}function B(e){t.has(e)?t.delete(e):t.add(e),o=e,E([e])}function y(e,s){let a=r.findIndex(Be=>Be.dataset.issueId===e),f=r.findIndex(Be=>Be.dataset.issueId===s);if(a===-1||f===-1)return;let b=Math.min(a,f),O=Math.max(a,f),we=[];for(let Be=b;Be<=O;Be++){let Se=r[Be].dataset.issueId;t.has(Se)||(t.add(Se),we.push(Se))}E(we)}function H(){r.forEach(e=>t.add(e.dataset.issueId)),D(),te(`Selected all ${t.size} issues`)}r.forEach(e=>{e.addEventListener("mousedown",s=>{if(!s.ctrlKey&&!s.metaKey&&!s.shiftKey||s.target.classList.contains("drag-handle")||s.target.classList.contains("link-handle"))return;s.preventDefault(),s.stopPropagation();let a=e.dataset.issueId;s.shiftKey&&o?y(o,a):B(a)})}),C("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="a"&&(e.preventDefault(),H()),e.key==="Escape"&&t.size>0&&(e.stopImmediatePropagation(),k(),te("Selection cleared"))}),document.getElementById("refreshBtn")?.addEventListener("click",()=>{document.getElementById("loadingOverlay")?.classList.add("visible"),se.postMessage({command:"refresh"})}),document.getElementById("draftBadge")?.addEventListener("click",()=>{se.postMessage({command:"openDraftReview"})});function v(e,s,a,f,b){document.querySelector(".relation-picker")?.remove();let O=document.createElement("div");O.className="relation-picker";let we=150,Be=100,Se=Math.min(e,window.innerWidth-we-10),$e=Math.min(s,window.innerHeight-Be-10);O.style.left=Math.max(10,Se)+"px",O.style.top=Math.max(10,$e)+"px";let je=document.createElement("div");je.style.padding="6px 12px",je.style.fontSize="11px",je.style.opacity="0.7",je.textContent=`#${f} \u2192 #${b}`,O.appendChild(je);let Ue=document.createElement("button");Ue.textContent="\u{1F5D1}\uFE0F Delete relation",Ue.addEventListener("click",()=>{h(),se.postMessage({command:"deleteRelation",relationId:a}),O.remove()}),O.appendChild(Ue);let Ve=document.createElement("button");Ve.textContent="Cancel",Ve.addEventListener("click",()=>O.remove()),O.appendChild(Ve),document.body.appendChild(O),V(O)}let X=new Map,Y=new Map,J=new Map,Me=new Map,pe=new Map,ye=!1;function Fe(){document.querySelectorAll(".issue-bar").forEach(e=>{let s=e.dataset.issueId;s&&(X.has(s)||X.set(s,[]),X.get(s).push(e))}),document.querySelectorAll(".issue-label").forEach(e=>{let s=e.dataset.issueId;s&&(Y.has(s)||Y.set(s,[]),Y.get(s).push(e))}),document.querySelectorAll(".dependency-arrow").forEach(e=>{let s=e.dataset.from,a=e.dataset.to;s&&(J.has(s)||J.set(s,[]),J.get(s).push(e)),a&&(J.has(a)||J.set(a,[]),J.get(a).push(e))}),document.querySelectorAll(".project-label").forEach(e=>{let s=e.dataset.collapseKey;s&&(Me.has(s)||Me.set(s,[]),Me.get(s).push(e))}),document.querySelectorAll(".aggregate-bars").forEach(e=>{let s=e.dataset.collapseKey;s&&(pe.has(s)||pe.set(s,[]),pe.get(s).push(e))}),ye=!0}typeof requestIdleCallback<"u"?requestIdleCallback(()=>Fe(),{timeout:100}):setTimeout(Fe,0);let be=[];function Xe(){document.body.classList.remove("hover-focus","dependency-hover"),be.forEach(e=>e.classList.remove("hover-highlighted","hover-source")),be=[]}function N(e){document.body.classList.add("hover-focus");let s=ye?X.get(e)||[]:document.querySelectorAll('.issue-bar[data-issue-id="'+e+'"]'),a=ye?Y.get(e)||[]:document.querySelectorAll('.issue-label[data-issue-id="'+e+'"]'),f=ye?J.get(e)||[]:document.querySelectorAll('.dependency-arrow[data-from="'+e+'"], .dependency-arrow[data-to="'+e+'"]');s.forEach(b=>{b.classList.add("hover-highlighted"),be.push(b)}),a.forEach(b=>{b.classList.add("hover-highlighted"),be.push(b)}),f.forEach(b=>{b.classList.add("hover-highlighted"),be.push(b)})}function ne(e){document.body.classList.add("hover-focus");let s=ye?Me.get(e)||[]:document.querySelectorAll('.project-label[data-collapse-key="'+e+'"]'),a=ye?pe.get(e)||[]:document.querySelectorAll('.aggregate-bars[data-collapse-key="'+e+'"]');s.forEach(f=>{f.classList.add("hover-highlighted"),be.push(f)}),a.forEach(f=>{f.classList.add("hover-highlighted"),be.push(f)})}let ve=document.querySelector(".gantt-timeline svg"),Qe=document.querySelector(".gantt-labels svg");if(ve&&(ve.addEventListener("mouseenter",e=>{let s=e.target.closest(".issue-bar"),a=e.target.closest(".aggregate-bars"),f=e.target.closest(".dependency-arrow");if(s){let b=s.dataset.issueId;b&&N(b)}else if(a){let b=a.dataset.collapseKey;b&&ne(b)}else if(f){let b=f.dataset.from,O=f.dataset.to;document.body.classList.add("dependency-hover"),f.classList.add("hover-source"),be.push(f),b&&N(b),O&&N(O)}},!0),ve.addEventListener("mouseleave",e=>{let s=e.target.closest(".issue-bar"),a=e.target.closest(".aggregate-bars"),f=e.target.closest(".dependency-arrow");(s||a||f)&&Xe()},!0)),Qe&&(Qe.addEventListener("mouseenter",e=>{let s=e.target.closest(".issue-label"),a=e.target.closest(".project-label");if(s){let f=s.dataset.issueId;f&&N(f)}else if(a){let f=a.dataset.collapseKey;f&&ne(f)}},!0),Qe.addEventListener("mouseleave",e=>{let s=e.target.closest(".issue-label"),a=e.target.closest(".project-label");(s||a)&&Xe()},!0)),ve){let s=function(){document.querySelectorAll(".dependency-arrow.selected").forEach(a=>a.classList.remove("selected")),document.body.classList.remove("arrow-selection-mode"),document.querySelectorAll(".arrow-connected").forEach(a=>a.classList.remove("arrow-connected")),e=null};var It=s;ve.addEventListener("contextmenu",a=>{let f=a.target.closest(".dependency-arrow");if(!f)return;a.preventDefault();let b=parseInt(f.dataset.relationId),O=f.dataset.from,we=f.dataset.to;v(a.clientX,a.clientY,b,O,we)});let e=null;ve.addEventListener("click",a=>{let f=a.target.closest(".dependency-arrow");if(e&&(e.classList.remove("selected"),document.body.classList.remove("arrow-selection-mode"),document.querySelectorAll(".arrow-connected").forEach(we=>we.classList.remove("arrow-connected")),e=null),!f)return;a.stopPropagation(),e=f,f.classList.add("selected"),document.body.classList.add("arrow-selection-mode");let b=f.dataset.from,O=f.dataset.to;document.querySelectorAll(`.issue-bar[data-issue-id="${b}"], .issue-bar[data-issue-id="${O}"]`).forEach(we=>we.classList.add("arrow-connected")),document.querySelectorAll(`.issue-label[data-issue-id="${b}"], .issue-label[data-issue-id="${O}"]`).forEach(we=>we.classList.add("arrow-connected")),te(`Selected relation from #${b} to #${O}`)}),window._ganttArrowClickHandler&&document.removeEventListener("click",window._ganttArrowClickHandler),window._ganttArrowClickHandler=a=>{(e||document.querySelector(".dependency-arrow.selected"))&&!a.target.closest(".dependency-arrow")&&!a.target.closest(".blocks-badge-group")&&!a.target.closest(".blocker-badge")&&s()},document.addEventListener("click",window._ganttArrowClickHandler),window._ganttArrowKeyHandler&&document.removeEventListener("keydown",window._ganttArrowKeyHandler),window._ganttArrowKeyHandler=a=>{let f=e||document.querySelector(".dependency-arrow.selected");a.key==="Escape"&&f&&(a.stopImmediatePropagation(),s())},document.addEventListener("keydown",window._ganttArrowKeyHandler)}yt({vscode:se,menuUndo:Ce,menuRedo:oe,addDocListener:C,closeOnOutsideClick:V,announce:te,saveState:h,updateUndoRedoButtons:x,undoStack:Ie,redoStack:Pe,selectedIssues:t,clearSelection:k,allIssueBars:r,redmineBaseUrl:Z,extendedRelationTypes:U,minDateMs:j,maxDateMs:W,timelineWidth:w,dayWidth:d,barHeight:z,ganttScroll:F,snapToDay:fe,focusOnDependencyChain:Ze,clearFocus:et,getFocusedIssueId:Ge,scrollToAndHighlight:ct,setAllowScrollChange:re,isDraftModeEnabled:()=>S,isPerfDebugEnabled:()=>tt}),bt({vscode:se,addDocListener:C,addWinListener:K,announce:te,barHeight:z,selectedCollapseKey:ce});function Ne(){if(!ee){se.postMessage({command:"todayOutOfRange"});return}if(F){let s=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,a=F.clientWidth-s;F.scrollLeft=Math.max(0,T-a/2)}}function ct(e){if(!e)return;_=!0;let s=document.querySelector('.issue-label[data-issue-id="'+e+'"]'),a=document.querySelector('.issue-bar[data-issue-id="'+e+'"]');if(s&&(s.scrollIntoView({behavior:"smooth",block:"center"}),s.classList.add("highlighted"),setTimeout(()=>s.classList.remove("highlighted"),1500)),a&&F){let f=a.getBoundingClientRect(),b=F.getBoundingClientRect(),O=F.scrollLeft+f.left-b.left-100;F.scrollTo({left:Math.max(0,O),behavior:"smooth"}),a.classList.add("highlighted"),setTimeout(()=>a.classList.remove("highlighted"),1500)}}vt({vscode:se,addDocListener:C,menuUndo:Ce,menuRedo:oe,undoStack:Ie,redoStack:Pe,saveState:h,updateUndoRedoButtons:x,announce:te,scrollToAndHighlight:ct,scrollToToday:Ne}),Dt({addDocListener:C,addWinListener:K,ganttScroll:F}),requestAnimationFrame(()=>{if(ge!==null&&F){let e=Math.max(j,Math.min(W,ge));Ke(e),Oe!==null&&(F.scrollTop=Oe),ge=null,Oe=null}else Te!==null&&F?(F.scrollLeft=Te,Oe!==null&&(F.scrollTop=Oe),Te=null,Oe=null):Ne();_e(),Q=!1}),document.getElementById("todayBtn")?.addEventListener("click",Ne);let dt=document.getElementById("resizeHandle"),ut=document.getElementById("resizeHandleHeader"),at=!1,ft=0,mt=0,ot=null;function gt(e,s){at=!0,ot=s,ft=e.clientX,mt=Le.offsetWidth,s.classList.add("dragging"),document.body.classList.add("cursor-col-resize","user-select-none"),e.preventDefault()}dt?.addEventListener("mousedown",e=>gt(e,dt)),ut?.addEventListener("mousedown",e=>gt(e,ut));let rt=!1,it=null;C("mousemove",e=>{at&&(it=e,!rt&&(rt=!0,requestAnimationFrame(()=>{if(rt=!1,!it)return;let s=it.clientX-ft,a=Math.min(600,Math.max(120,mt+s));if(Ae&&(Ae.style.width=a+"px"),Le){Le.style.width=a+"px";let b=Le.querySelector("svg");b&&b.setAttribute("width",String(a))}let f=document.querySelector(".capacity-ribbon-label");f&&(f.style.width=a+q+"px"),We()})))}),C("mouseup",()=>{at&&(at=!1,ot?.classList.remove("dragging"),ot=null,document.body.classList.remove("cursor-col-resize","user-select-none"),h())}),requestAnimationFrame(()=>{document.getElementById("loadingOverlay")?.classList.remove("visible")}),Je("initializeGantt-end"),lt("initializeGantt","initializeGantt-start","initializeGantt-end")}})();
