"use strict";(()=>{function gt({timelineWidth:E,minimapBarsData:p,minimapHeight:G,minimapBarHeight:K,minimapTodayX:le,ganttScroll:ne,minimapSvg:V,minimapViewport:P,addDocListener:ce}){function ve(){let B=document.querySelector(".gantt-body .gantt-sticky-left"),D=document.querySelector(".gantt-container");B&&D&&D.style.setProperty("--sticky-left-width",B.offsetWidth+"px")}requestAnimationFrame(ve),V&&requestAnimationFrame(()=>{let B=G/(p.length+1);if(p.forEach((D,_)=>{let u=document.createElementNS("http://www.w3.org/2000/svg","rect");u.setAttribute("class",D.classes),u.setAttribute("x",(D.startPct*E).toString()),u.setAttribute("y",(B*(_+.5)).toString()),u.setAttribute("width",Math.max(2,(D.endPct-D.startPct)*E).toString()),u.setAttribute("height",K.toString()),u.setAttribute("rx","1"),u.setAttribute("fill",D.color),V.insertBefore(u,P)}),le>0&&le<E){let D=document.createElementNS("http://www.w3.org/2000/svg","line");D.setAttribute("class","minimap-today"),D.setAttribute("x1",le.toString()),D.setAttribute("y1","0"),D.setAttribute("x2",le.toString()),D.setAttribute("y2",G.toString()),V.insertBefore(D,P)}});function we(){if(!ne||!P)return;let B=Math.max(1,ne.scrollWidth-ne.clientWidth),D=Math.min(1,ne.scrollLeft/B),_=Math.min(1,ne.clientWidth/ne.scrollWidth),u=Math.max(20,_*E),fe=D*(E-u);P.setAttribute("x",fe.toString()),P.setAttribute("width",u.toString())}let R=!1,Q=0;function N(B,D=!1){if(!ne||!V||!P)return;let _=V.getBoundingClientRect(),fe=parseFloat(P.getAttribute("width")||"0")/E*_.width,j=B.clientX-_.left;D?j-=Q:j-=fe/2;let T=Math.max(0,Math.min(1,j/(_.width-fe))),ae=Math.max(0,ne.scrollWidth-ne.clientWidth);ne.scrollLeft=T*ae}return V&&P&&(P.addEventListener("mousedown",B=>{B.stopPropagation(),R=!0;let D=V.getBoundingClientRect(),u=parseFloat(P.getAttribute("x")||"0")/E*D.width;Q=B.clientX-D.left-u}),V.addEventListener("mousedown",B=>{if(B.target===P)return;R=!0;let D=V.getBoundingClientRect();Q=parseFloat(P.getAttribute("width")||"0")/100*D.width/2,N(B,!0)}),ce("mousemove",B=>{R&&N(B,!0)}),ce("mouseup",()=>{R=!1})),{updateMinimapPosition:ve,updateMinimapViewport:we}}function ht(E){let{vscode:p,menuUndo:G,menuRedo:K,addDocListener:le,closeOnOutsideClick:ne,announce:V,saveState:P,updateUndoRedoButtons:ce,undoStack:ve,redoStack:we,selectedIssues:R,clearSelection:Q,allIssueBars:N,redmineBaseUrl:B,extendedRelationTypes:D,minDateMs:_,maxDateMs:u,timelineWidth:fe,dayWidth:j,barHeight:T,ganttScroll:ae,snapToDay:oe,focusOnDependencyChain:ge,clearFocus:d,getFocusedIssueId:v,scrollToAndHighlight:m,setAllowScrollChange:H,isDraftMode:l}=E;function c(s,o,n){document.querySelector(".relation-picker")?.remove();let r=R.size>1&&R.has(n),i=r?Array.from(R).map(q=>parseInt(q)):[parseInt(n)],A=document.createElement("div");A.className="relation-picker";let x=160,L=180,z=Math.min(s,window.innerWidth-x-10),w=Math.min(o,window.innerHeight-L-10);A.style.left=Math.max(10,z)+"px",A.style.top=Math.max(10,w)+"px";let F=document.createElement("div");F.style.padding="6px 12px",F.style.fontSize="11px",F.style.opacity="0.7",F.textContent=r?i.length+" issues selected":"#"+n,A.appendChild(F),(r?[{label:"Set % Done...",command:"bulkSetDoneRatio",bulk:!0},{label:"Clear Selection",command:"clearSelection",local:!0}]:[{label:"Update Issue...",command:"openIssue"},{label:"Open in Browser",command:"openInBrowser"},{label:"Show in Issues",command:"showInIssues"},{label:"Log Time",command:"logTime"},{label:"Set % Done",command:"setDoneRatio"},{label:"Toggle Auto-update %",command:"toggleAutoUpdate"},{label:"Toggle Ad-hoc Budget",command:"toggleAdHoc"},{label:"Toggle Precedence",command:"togglePrecedence"},{label:"Set Internal Estimate",command:"setInternalEstimate"},{label:"Copy Link",command:"copyLink",local:!0},{label:"Copy URL",command:"copyUrl"}]).forEach(q=>{let O=document.createElement("button");O.textContent=q.label,O.addEventListener("click",async()=>{if(q.command==="copyLink"){let He=document.querySelector('.issue-bar[data-issue-id="'+n+'"]')?.dataset?.subject||"Issue #"+n,Xe=B+"/issues/"+n,Ke='<a href="'+Xe+'">#'+n+" "+He+"</a>",$e=Xe;try{await navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([$e],{type:"text/plain"}),"text/html":new Blob([Ke],{type:"text/html"})})]),p.postMessage({command:"showStatus",message:"Copied #"+n+" link"})}catch{await navigator.clipboard.writeText($e),p.postMessage({command:"showStatus",message:"Copied #"+n+" URL"})}}else q.local?Q():q.bulk?p.postMessage({command:q.command,issueIds:i}):p.postMessage({command:q.command,issueId:parseInt(n)});A.remove()}),A.appendChild(O)}),document.body.appendChild(A),ne(A)}function k(s){let o=_+s/fe*(u-_);return new Date(o).toISOString().slice(0,10)}function X(s){let o=_+s/fe*(u-_)-864e5;return new Date(o).toISOString().slice(0,10)}let $=document.getElementById("dragDateTooltip"),J=null;function M(s){let o=new Date(s+"T00:00:00"),n=o.toLocaleDateString("en-US",{month:"short"}),r=o.getDate(),i=o.toLocaleDateString("en-US",{weekday:"short"});return n+" "+r+" ("+i+")"}function ke(s,o){let n=new Date(s+"T00:00:00"),r=new Date(o+"T00:00:00"),i=n.toLocaleDateString("en-US",{month:"short"}),A=r.toLocaleDateString("en-US",{month:"short"});return i===A?i+" "+n.getDate()+"-"+r.getDate():i+" "+n.getDate()+"-"+A+" "+r.getDate()}function Se(s){$.textContent=s,$.style.display="block",J=s}function qe(s){s!==J&&($.textContent=s,J=s)}function he(s,o){let n=o-28,r=!1;n<40&&(n=o+20,r=!0),$.style.left=s+"px",$.style.top=n+"px",$.classList.toggle("flipped",r)}function Ae(){$.style.display="none",J=null}let de=4,g=4;function Le(s,o,n,r,i){let A=n>s,L=Math.abs(n-s)<30,z=Math.abs(o-r)<5,w=r>o,F;if(z&&A)F="M "+s+" "+o+" H "+n;else if(!z&&L){let O=(o+r)/2;F="M "+s+" "+o+" H "+(s+8-g)+" q "+g+" 0 "+g+" "+(w?g:-g)+" V "+(O+(w?-g:g))+" q 0 "+(w?g:-g)+" "+-g+" "+(w?g:-g)+" H "+(n-8+g)+" q "+-g+" 0 "+-g+" "+(w?g:-g)+" V "+(r+(w?-g:g))+" q 0 "+(w?g:-g)+" "+g+" "+(w?g:-g)+" H "+n}else if(A){let q=Math.min(s+8,(s+n)/2);F="M "+s+" "+o+" H "+(q-g)+" q "+g+" 0 "+g+" "+(w?g:-g)+" V "+(r+(w?-g:g))+" q 0 "+(w?g:-g)+" "+g+" "+(w?g:-g)+" H "+n}else if(z){let O=o-T;F="M "+s+" "+o+" V "+(O+g)+" q 0 "+-g+" "+-g+" "+-g+" H "+(n-12+g)+" q "+-g+" 0 "+-g+" "+g+" V "+r+" H "+n}else{let O=(o+r)/2;F="M "+s+" "+o+" V "+(O+(w?-g:g))+" q 0 "+(w?g:-g)+" "+-g+" "+(w?g:-g)+" H "+(n-12+g)+" q "+-g+" 0 "+-g+" "+(w?g:-g)+" V "+r+" H "+n}let I="M "+(n-de)+" "+(r-de*.6)+" L "+n+" "+r+" L "+(n-de)+" "+(r+de*.6);return{path:F,arrowHead:I}}function xe(s){let o=[],n='.dependency-arrow[data-from="'+s+'"], .dependency-arrow[data-to="'+s+'"]';return document.querySelectorAll(n).forEach(r=>{let i=r.getAttribute("data-from"),A=r.getAttribute("data-to"),L=(r.getAttribute("class")||"").match(/rel-(\w+)/),z=L?L[1]:"relates",w=["blocks","precedes","finish_to_start","start_to_start","finish_to_finish","start_to_finish"].includes(z),F=document.querySelector('.issue-bar[data-issue-id="'+i+'"]'),I=document.querySelector('.issue-bar[data-issue-id="'+A+'"]');!F||!I||o.push({element:r,fromId:i,toId:A,isScheduling:w,fromBar:F,toBar:I,linePath:r.querySelector(".arrow-line"),hitPath:r.querySelector(".arrow-hit-area"),headPath:r.querySelector(".arrow-head")})}),o}function De(s,o,n,r){s.forEach(i=>{let A=i.fromId==o?n:parseFloat(i.fromBar.dataset.startX),x=i.fromId==o?r:parseFloat(i.fromBar.dataset.endX),L=parseFloat(i.fromBar.dataset.centerY),z=i.toId==o?n:parseFloat(i.toBar.dataset.startX),w=i.toId==o?r:parseFloat(i.toBar.dataset.endX),F=parseFloat(i.toBar.dataset.centerY),I,q,O,me;i.isScheduling?(I=x+2,q=L,O=z-2,me=F):(I=(A+x)/2,q=L,O=(z+w)/2,me=F);let{path:He,arrowHead:Xe}=Le(I,q,O,me,i.isScheduling);i.linePath&&i.linePath.setAttribute("d",He),i.hitPath&&i.hitPath.setAttribute("d",He),i.headPath&&i.headPath.setAttribute("d",Xe)})}let Ee=document.getElementById("dragConfirmOverlay"),Pe=document.getElementById("dragConfirmMessage"),Re=document.getElementById("dragConfirmOk"),Te=document.getElementById("dragConfirmCancel"),re=null;function Ue(s,o,n){!Ee||!Pe||(Pe.textContent=s,re={onConfirm:o,onCancel:n},H(!0),Ee.style.display="flex",Re&&Re.focus())}function Fe(){Ee&&(Ee.style.display="none"),re=null}function ee(){ae&&b&&(ae.scrollLeft=b.left,ae.scrollTop=b.top),b=null}Re?.addEventListener("click",()=>{re?.onConfirm&&re.onConfirm(),b=null,Fe()}),Te?.addEventListener("click",()=>{re?.onCancel&&re.onCancel(),ee(),Fe()}),Ee?.addEventListener("click",s=>{s.target===Ee&&(re?.onCancel&&re.onCancel(),ee(),Fe())}),le("keydown",s=>{re&&(s.key==="Escape"?(s.preventDefault(),re.onCancel&&re.onCancel(),ee(),Fe()):s.key==="Enter"&&(s.preventDefault(),re.onConfirm&&re.onConfirm(),b=null,Fe()))});let y=null,b=null,S=!1;document.querySelectorAll(".drag-handle").forEach(s=>{s.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation(),b={left:ae?.scrollLeft,top:ae?.scrollTop};let n=s.closest(".issue-bar"),r=s.classList.contains("drag-left"),i=parseInt(n.dataset.issueId),A=parseFloat(n.dataset.startX),x=parseFloat(n.dataset.endX),L=n.dataset.startDate||null,z=n.dataset.dueDate||null,w=n.querySelector(".bar-outline"),F=n.querySelector(".bar-main"),I=n.querySelector(".drag-left"),q=n.querySelector(".drag-right");n.classList.add("dragging");let O=n.querySelector(".bar-labels"),me=O?.classList.contains("labels-left"),He=xe(i),Xe=n.querySelector(".link-handle");y={issueId:i,isLeft:r,isMove:!1,initialMouseX:o.clientX,startX:A,endX:x,oldStartDate:L,oldDueDate:z,barOutline:w,barMain:F,leftHandle:I,rightHandle:q,bar:n,barLabels:O,labelsOnLeft:me,connectedArrows:He,linkHandle:Xe};let Ke=r?A:x,$e=r?L:z;$e&&(Se((r?"Start: ":"Due: ")+M($e)),he(o.clientX,o.clientY))})}),document.querySelectorAll(".bar-outline").forEach(s=>{s.addEventListener("mousedown",o=>{if(o.target.classList.contains("drag-handle")||o.ctrlKey||o.metaKey||o.shiftKey)return;o.preventDefault(),o.stopPropagation(),b={left:ae?.scrollLeft,top:ae?.scrollTop};let n=s.closest(".issue-bar");if(!n)return;let r=n.dataset.issueId,i=R.size>1&&R.has(r),x=(i?N.filter(I=>R.has(I.dataset.issueId)):[n]).map(I=>({issueId:I.dataset.issueId,startX:parseFloat(I.dataset.startX),endX:parseFloat(I.dataset.endX),oldStartDate:I.dataset.startDate||null,oldDueDate:I.dataset.dueDate||null,barOutline:I.querySelector(".bar-outline"),barMain:I.querySelector(".bar-main"),leftHandle:I.querySelector(".drag-left"),rightHandle:I.querySelector(".drag-right"),bar:I,barLabels:I.querySelector(".bar-labels"),labelsOnLeft:I.querySelector(".bar-labels")?.classList.contains("labels-left"),connectedArrows:xe(I.dataset.issueId),linkHandle:I.querySelector(".link-handle")}));x.forEach(I=>I.bar.classList.add("dragging"));let L=n.querySelector(".bar-labels"),z=L?.classList.contains("labels-left"),w=xe(r),F=n.querySelector(".link-handle");y={issueId:parseInt(r),isLeft:!1,isMove:!0,isBulkDrag:i,bulkBars:x,initialMouseX:o.clientX,startX:parseFloat(n.dataset.startX),endX:parseFloat(n.dataset.endX),oldStartDate:n.dataset.startDate||null,oldDueDate:n.dataset.dueDate||null,barOutline:s,barMain:n.querySelector(".bar-main"),leftHandle:n.querySelector(".drag-left"),rightHandle:n.querySelector(".drag-right"),bar:n,barLabels:L,labelsOnLeft:z,connectedArrows:w,linkHandle:F},!i&&n.dataset.startDate&&n.dataset.dueDate&&(Se(ke(n.dataset.startDate,n.dataset.dueDate)),he(o.clientX,o.clientY))})});let C=null,Y=null,te=null;function Ce(){C&&(C.fromBar.classList.remove("linking-source"),document.querySelectorAll(".link-target").forEach(s=>s.classList.remove("link-target")),Y&&(Y.remove(),Y=null),C=null,te=null,document.body.classList.remove("cursor-crosshair"))}function Oe(s,o,n,r){document.querySelector(".relation-picker")?.remove();let i=document.createElement("div");i.className="relation-picker";let A=180,x=200,L=Math.min(s,window.innerWidth-A-10),z=Math.min(o,window.innerHeight-x-10);i.style.left=Math.max(10,L)+"px",i.style.top=Math.max(10,z)+"px";let w=[{value:"blocks",label:"\u{1F6AB} Blocks",cssClass:"rel-line-blocks",tooltip:"Target cannot be closed until this issue is closed"},{value:"precedes",label:"\u27A1\uFE0F Precedes",cssClass:"rel-line-scheduling",tooltip:"This issue must complete before target can start"},{value:"relates",label:"\u{1F517} Relates to",cssClass:"rel-line-informational",tooltip:"Simple link between issues (no constraints)"},{value:"duplicates",label:"\u{1F4CB} Duplicates",cssClass:"rel-line-informational",tooltip:"Closing target will automatically close this issue"},{value:"copied_to",label:"\u{1F4C4} Copied to",cssClass:"rel-line-informational",tooltip:"This issue was copied to create the target issue"}],F=[{value:"finish_to_start",label:"\u23E9 Finish\u2192Start",cssClass:"rel-line-scheduling",tooltip:"Target starts after this issue finishes (FS)"},{value:"start_to_start",label:"\u25B6\uFE0F Start\u2192Start",cssClass:"rel-line-scheduling",tooltip:"Target starts when this issue starts (SS)"},{value:"finish_to_finish",label:"\u23F9\uFE0F Finish\u2192Finish",cssClass:"rel-line-scheduling",tooltip:"Target finishes when this issue finishes (FF)"},{value:"start_to_finish",label:"\u23EA Start\u2192Finish",cssClass:"rel-line-scheduling",tooltip:"Target finishes when this issue starts (SF)"}];(D?[...w,...F]:w).forEach(q=>{let O=document.createElement("button"),me=document.createElement("span");me.className="color-swatch "+q.cssClass,O.appendChild(me),O.appendChild(document.createTextNode(q.label)),O.title=q.tooltip,O.addEventListener("click",()=>{P(),p.postMessage({command:"createRelation",issueId:n,targetIssueId:r,relationType:q.value}),i.remove()}),i.appendChild(O)}),document.body.appendChild(i),ne(i)}let ue=".drag-handle, .link-handle, .bar-outline, .blocks-badge-group, .blocker-badge, .progress-badge-group, .flex-badge-group";document.querySelectorAll(".issue-bar").forEach(s=>{s.addEventListener("click",o=>{o.target.closest(ue)||y||C||S||(v()&&d(),m(s.dataset.issueId))}),s.addEventListener("dblclick",o=>{y||C||S||(o.preventDefault(),ge(s.dataset.issueId))})});function We(s,o){if(document.querySelectorAll(".dependency-arrow.selected").forEach(r=>r.classList.remove("selected")),document.querySelectorAll(".arrow-connected").forEach(r=>r.classList.remove("arrow-connected")),s.length===0)return;document.body.classList.add("arrow-selection-mode");let n=new Set;s.forEach(r=>{r.classList.add("selected"),n.add(r.dataset.from),n.add(r.dataset.to)}),n.forEach(r=>{document.querySelectorAll(`.issue-bar[data-issue-id="${r}"], .issue-label[data-issue-id="${r}"]`).forEach(i=>i.classList.add("arrow-connected"))}),V(`Highlighted ${s.length} dependency arrow(s) for #${o}`)}document.querySelectorAll(".blocks-badge-group").forEach(s=>{s.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation()}),s.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();let n=s.closest(".issue-bar");if(!n)return;let r=n.dataset.issueId,i=Array.from(document.querySelectorAll(`.dependency-arrow[data-from="${r}"]`));We(i,r)})}),document.querySelectorAll(".blocker-badge").forEach(s=>{s.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation()}),s.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();let n=s.closest(".issue-bar");if(!n)return;let r=n.dataset.issueId,i=Array.from(document.querySelectorAll(`.dependency-arrow[data-to="${r}"]`));We(i,r)})});let Z=Array.from(document.querySelectorAll(".issue-bar")),et=10;Z.forEach((s,o)=>{s.addEventListener("keydown",n=>{if(n.key==="Enter"||n.key===" ")n.preventDefault(),m(s.dataset.issueId);else if(n.key==="ArrowDown"&&o<Z.length-1)n.preventDefault(),Z[o+1].focus(),V(`Issue ${Z[o+1].getAttribute("aria-label")}`);else if(n.key==="ArrowUp"&&o>0)n.preventDefault(),Z[o-1].focus(),V(`Issue ${Z[o-1].getAttribute("aria-label")}`);else if(n.key==="Home")n.preventDefault(),Z[0].focus(),V(`First issue: ${Z[0].getAttribute("aria-label")}`);else if(n.key==="End")n.preventDefault(),Z[Z.length-1].focus(),V(`Last issue: ${Z[Z.length-1].getAttribute("aria-label")}`);else if(n.key==="PageDown"){n.preventDefault();let r=Math.min(o+et,Z.length-1);Z[r].focus(),V(`Issue ${Z[r].getAttribute("aria-label")}`)}else if(n.key==="PageUp"){n.preventDefault();let r=Math.max(o-et,0);Z[r].focus(),V(`Issue ${Z[r].getAttribute("aria-label")}`)}else if(n.key==="Tab"&&n.shiftKey){let r=s.dataset.issueId,i=document.querySelector(`.issue-label[data-issue-id="${r}"]`);i&&(n.preventDefault(),i.focus(),V(`Label for issue #${r}`))}})}),document.querySelectorAll(".link-handle").forEach(s=>{s.addEventListener("mousedown",o=>{o.stopPropagation(),o.preventDefault();let n=s.closest(".issue-bar"),r=parseInt(n.dataset.issueId),i=parseFloat(s.dataset.cx),A=parseFloat(s.dataset.cy);n.classList.add("linking-source"),document.body.classList.add("cursor-crosshair");let x=document.querySelector("#ganttTimeline svg");if(!document.getElementById("temp-arrow-head")){let L=document.createElementNS("http://www.w3.org/2000/svg","defs");L.innerHTML=`
            <marker id="temp-arrow-head" markerWidth="10" markerHeight="7"
                    refX="9" refY="3.5" orient="auto" markerUnits="strokeWidth">
              <polygon points="0 0, 10 3.5, 0 7" fill="var(--vscode-focusBorder)"/>
            </marker>`,x.insertBefore(L,x.firstChild)}Y=document.createElementNS("http://www.w3.org/2000/svg","path"),Y.classList.add("temp-link-arrow"),Y.setAttribute("stroke","var(--vscode-focusBorder)"),Y.setAttribute("stroke-width","2"),Y.setAttribute("fill","none"),Y.setAttribute("marker-end","url(#temp-arrow-head)"),x.appendChild(Y),C={fromId:r,fromBar:n,startX:i,startY:A}})}),le("keydown",s=>{if(s.key==="Escape"){let o=document.querySelector(".relation-picker");if(o){s.stopImmediatePropagation(),o.remove();return}if(C){s.stopImmediatePropagation(),Ce();return}v()&&(s.stopImmediatePropagation(),d(),V("Focus cleared"))}});let Je=!1,Ze=null;le("mousemove",s=>{!y&&!C||(Ze=s,!Je&&(Je=!0,requestAnimationFrame(()=>{Je=!1;let o=Ze;if(o){if(y){let n=o.clientX-y.initialMouseX;if(y.isMove&&y.isBulkDrag&&y.bulkBars){let r=oe(n)-oe(0);y.bulkBars.forEach(i=>{let A=i.endX-i.startX,x=Math.max(0,Math.min(i.startX+r,fe-A)),L=x+A,z=L-x;i.barOutline.setAttribute("x",x),i.barOutline.setAttribute("width",z),i.barMain&&(i.barMain.setAttribute("x",x),i.barMain.setAttribute("width",z));let w=i.leftHandle.querySelector("rect"),F=i.rightHandle.querySelector("rect");if(w&&w.setAttribute("x",x),F&&F.setAttribute("x",L-14),i.leftHandle.querySelectorAll(".drag-grip circle").forEach((I,q)=>I.setAttribute("cx",x+9)),i.rightHandle.querySelectorAll(".drag-grip circle").forEach((I,q)=>I.setAttribute("cx",L-9)),i.newStartX=x,i.newEndX=L,i.barLabels){let I=i.labelsOnLeft?x-i.startX:L-i.endX;i.barLabels.setAttribute("transform","translate("+I+", 0)")}i.connectedArrows&&De(i.connectedArrows,i.issueId,x,L),i.linkHandle&&i.linkHandle.querySelectorAll("circle").forEach(I=>I.setAttribute("cx",String(L+8)))}),y.snappedDelta=r}else{let r=y.startX,i=y.endX,A=y.endX-y.startX;y.isMove?(r=oe(Math.max(0,Math.min(y.startX+n,fe-A))),i=r+A):y.isLeft?r=oe(Math.max(0,Math.min(y.startX+n,y.endX-j))):i=oe(Math.max(y.startX+j,Math.min(y.endX+n,fe)));let x=i-r;y.barOutline.setAttribute("x",r),y.barOutline.setAttribute("width",x),y.barMain&&(y.barMain.setAttribute("x",r),y.barMain.setAttribute("width",x));let L=y.leftHandle.querySelector("rect"),z=y.rightHandle.querySelector("rect");if(L&&L.setAttribute("x",r),z&&z.setAttribute("x",i-14),y.leftHandle.querySelectorAll(".drag-grip circle").forEach(w=>w.setAttribute("cx",r+9)),y.rightHandle.querySelectorAll(".drag-grip circle").forEach(w=>w.setAttribute("cx",i-9)),y.newStartX=r,y.newEndX=i,y.barLabels){let w=y.labelsOnLeft?r-y.startX:i-y.endX;y.barLabels.setAttribute("transform","translate("+w+", 0)")}if(y.connectedArrows&&De(y.connectedArrows,y.issueId,r,i),y.linkHandle&&y.linkHandle.querySelectorAll("circle").forEach(w=>w.setAttribute("cx",String(i+8))),y.isMove&&!y.isBulkDrag){let w=k(r),F=X(i),q=w!==y.oldStartDate?ke(y.oldStartDate,y.oldDueDate)+" \u2192 "+ke(w,F):ke(w,F);qe(q),he(o.clientX,o.clientY)}else if(!y.isMove){let w=y.isLeft?r:i,F=y.isLeft?k(w):X(w);qe((y.isLeft?"Start: ":"Due: ")+M(F)),he(o.clientX,o.clientY)}}}if(C&&Y){let r=document.querySelector("#ganttTimeline svg").getBoundingClientRect(),i=o.clientX-r.left,A=o.clientY-r.top,x=`M ${C.startX} ${C.startY} L ${i} ${A}`;Y.setAttribute("d",x);let L=document.elementFromPoint(o.clientX,o.clientY)?.closest(".issue-bar");te&&te!==L&&te.classList.remove("link-target"),L&&L!==C.fromBar?(L.classList.add("link-target"),te=L):te=null}}})))});function je(s){if(!s)return;let{bar:o,barOutline:n,barMain:r,leftHandle:i,rightHandle:A,barLabels:x,startX:L,endX:z,connectedArrows:w,issueId:F,linkHandle:I}=s,q=z-L;if(n&&(n.setAttribute("x",String(L)),n.setAttribute("width",String(q))),r&&(r.setAttribute("x",String(L)),r.setAttribute("width",String(q))),i){let O=i.querySelector("rect");O&&O.setAttribute("x",String(L)),i.querySelectorAll(".drag-grip circle").forEach(me=>me.setAttribute("cx",L+9))}if(A){let O=A.querySelector("rect");O&&O.setAttribute("x",String(z-14)),A.querySelectorAll(".drag-grip circle").forEach(me=>me.setAttribute("cx",z-9))}x&&x.removeAttribute("transform"),w&&w.length>0&&De(w,F,L,z),I&&I.querySelectorAll("circle").forEach(O=>O.setAttribute("cx",String(z+8))),o&&o.classList.remove("dragging")}le("mouseup",s=>{if(y){let{issueId:o,isLeft:n,isMove:r,isBulkDrag:i,bulkBars:A,newStartX:x,newEndX:L,bar:z,startX:w,endX:F,oldStartDate:I,oldDueDate:q,barOutline:O,barMain:me,leftHandle:He,rightHandle:Xe,barLabels:Ke,connectedArrows:$e}=y,Be={...y};if(i&&A&&r){A.forEach(U=>U.bar.classList.remove("dragging"));let Me=[];if(A.forEach(U=>{if(U.newStartX!==void 0&&U.newStartX!==U.startX){let se=k(U.newStartX),pe=X(U.newEndX);(se!==U.oldStartDate||pe!==U.oldDueDate)&&Me.push({issueId:parseInt(U.issueId),oldStartDate:U.oldStartDate,oldDueDate:U.oldDueDate,newStartDate:se,newDueDate:pe,barData:U})}}),Me.length>0){Ae();let U=()=>{ve.push({type:"bulk",changes:Me.map(se=>({issueId:se.issueId,oldStartDate:se.oldStartDate,oldDueDate:se.oldDueDate,newStartDate:se.newStartDate,newDueDate:se.newDueDate}))}),we.length=0,ce(),P(),Me.forEach(se=>{p.postMessage({command:"updateDates",issueId:se.issueId,startDate:se.newStartDate,dueDate:se.newDueDate})})};if(l)U();else{let se="Move "+Me.length+" issue(s) to new dates?";Ue(se,U,()=>{A.forEach(pe=>je(pe))})}}else Ae(),A.forEach(U=>je(U));y=null,S=!0,requestAnimationFrame(()=>S=!1);return}if(z.classList.remove("dragging"),Ae(),x!==void 0||L!==void 0){let Me=null,U=null;r?x!==w&&(Me=k(x),U=X(L)):n?Me=x!==w?k(x):null:U=L!==F?X(L):null;let se=Me&&Me!==I?Me:null,pe=U&&U!==q?U:null;if(se||pe){let Ve=()=>{ve.push({issueId:o,oldStartDate:se?I:null,oldDueDate:pe?q:null,newStartDate:se,newDueDate:pe}),we.length=0,ce(),P(),p.postMessage({command:"updateDates",issueId:o,startDate:se,dueDate:pe})};if(l)Ve();else{let ze="Issue #"+o+": ";se&&pe?ze+=ke(I,q)+" \u2192 "+ke(se,pe):se?ze+="Start: "+M(I)+" \u2192 "+M(se):ze+="Due: "+M(q)+" \u2192 "+M(pe),Ue(ze,Ve,()=>{je(Be)})}}else je(Be)}else je(Be);y=null,S=!0,requestAnimationFrame(()=>S=!1)}if(C){let o=C.fromId;if(te){let n=parseInt(te.dataset.issueId);o!==n&&Oe(s.clientX,s.clientY,o,n)}Ce()}re||ee()}),G?.addEventListener("click",()=>{if(G.hasAttribute("disabled")||ve.length===0)return;let s=ve.pop();we.push(s),ce(),P(),s.type==="relation"?s.operation==="create"?p.postMessage({command:"undoRelation",operation:"delete",relationId:s.relationId,datesBefore:s.datesBefore}):p.postMessage({command:"undoRelation",operation:"create",issueId:s.issueId,targetIssueId:s.targetIssueId,relationType:s.relationType}):s.type==="bulk"?s.changes.forEach(o=>{p.postMessage({command:"updateDates",issueId:o.issueId,startDate:o.oldStartDate,dueDate:o.oldDueDate})}):p.postMessage({command:"updateDates",issueId:s.issueId,startDate:s.oldStartDate,dueDate:s.oldDueDate})}),K?.addEventListener("click",()=>{if(K.hasAttribute("disabled")||we.length===0)return;let s=we.pop();ve.push(s),ce(),P(),s.type==="relation"?s.operation==="create"?p.postMessage({command:"redoRelation",operation:"create",issueId:s.issueId,targetIssueId:s.targetIssueId,relationType:s.relationType}):p.postMessage({command:"redoRelation",operation:"delete",relationId:s.relationId}):s.type==="bulk"?s.changes.forEach(o=>{p.postMessage({command:"updateDates",issueId:o.issueId,startDate:o.newStartDate,dueDate:o.newDueDate})}):p.postMessage({command:"updateDates",issueId:s.issueId,startDate:s.newStartDate,dueDate:s.newDueDate})})}function pt(E){let{vscode:p,addDocListener:G,addWinListener:K,announce:le,barHeight:ne,selectedCollapseKey:V}=E;document.querySelectorAll(".collapse-toggle").forEach(d=>{d.addEventListener("click",v=>{v.stopPropagation();let H=d.closest("[data-collapse-key]")?.dataset.collapseKey;H&&ge(H)})}),document.getElementById("menuExpand")?.addEventListener("click",()=>{let v=document.getElementById("ganttScroll")?.dataset.allExpandableKeys,m=v?JSON.parse(v):[];p.postMessage({command:"expandAll",keys:m})}),document.getElementById("menuCollapse")?.addEventListener("click",()=>{p.postMessage({command:"collapseAll"})});let P=Array.from(document.querySelectorAll(".project-label, .issue-label, .time-group-label")),ce=null,ve=V??null;function we(d){return!d.classList.contains("gantt-row-hidden")&&d.getAttribute("visibility")!=="hidden"}function R(d,v){let m=d+v;for(;m>=0&&m<P.length;){if(we(P[m]))return{label:P[m],index:m};m+=v}return null}function Q(d){let v=document.getElementById("ganttScroll"),m=document.querySelector(".gantt-header-row");if(!v||!d)return;let H=m?.getBoundingClientRect().height||60,l=d.closest(".gantt-row");if(!l)return;let c=l.getBoundingClientRect().top,k=l.getBoundingClientRect().height,X=v.getBoundingClientRect(),$=X.top+H,J=X.bottom;c<$?v.scrollBy({top:c-$-4,behavior:"smooth"}):c+k>J&&v.scrollBy({top:c+k-J+4,behavior:"smooth"})}function N(d,v=!1,m=!1,H=!1){ce&&ce.classList.remove("active"),ce=d,d&&(d.classList.add("active"),H||d.focus(),m&&Q(d),v||p.postMessage({command:"setSelectedKey",collapseKey:d.dataset.collapseKey}))}K("focus",()=>{ce&&we(ce)&&ce.focus()}),G("keydown",d=>{d.key==="Escape"&&ce&&(ce.classList.remove("active"),ce.blur(),ce=null,p.postMessage({command:"setSelectedKey",collapseKey:null}))});let B=new Map,D=new Map,_=new Map;function u(d){let v=d.dataset.originalY;if(_.has(v))return _.get(v);let m=JSON.parse(d.dataset.rowContributions||"{}");return _.set(v,m),m}function fe(){B.clear(),document.querySelectorAll("[data-collapse-key][data-original-y]").forEach(v=>{let m=v.dataset.collapseKey,H=parseFloat(v.dataset.originalY);B.has(m)||B.set(m,{originalY:H,elements:[]}),B.get(m).elements.push(v)})}function j(){D.clear(),document.querySelectorAll("[data-collapse-key][data-parent-key]").forEach(v=>{let m=v.dataset.collapseKey;if(D.has(m))return;let H=[],l=v.dataset.parentKey;for(;l;)H.push(l),l=document.querySelector('[data-collapse-key="'+l+'"]')?.dataset.parentKey||null;D.set(m,H)})}fe(),j();function T(d,v){v?(d.setAttribute("visibility","hidden"),d.classList.add("gantt-row-hidden")):(d.removeAttribute("visibility"),d.classList.remove("gantt-row-hidden"))}function ae(d){let v=[];return D.forEach((m,H)=>{m.includes(d)&&v.push(H)}),v}function oe(d){let v=[];return D.forEach((m,H)=>{let l=m.indexOf(d);if(l===-1)return;let c=!0;for(let k=0;k<l;k++){let X=m[k],$=document.querySelector('[data-collapse-key="'+X+'"].project-label, [data-collapse-key="'+X+'"].issue-label, [data-collapse-key="'+X+'"].time-group-label');if(!$||$.dataset.expanded!=="true"){c=!1;break}}c&&v.push(H)}),v}function ge(d,v){let m=document.querySelector('[data-collapse-key="'+d+'"].project-label, [data-collapse-key="'+d+'"].time-group-label, [data-collapse-key="'+d+'"].issue-label');if(!m||m.dataset.hasChildren!=="true")return;let H=m.dataset.expanded==="true",l=v==="expand"?!0:v==="collapse"?!1:!H;if(l===H)return;m.dataset.expanded=l?"true":"false";let c=m.querySelector(".collapse-toggle");c&&c.classList.toggle("expanded",l);let k=ae(d),X=l?oe(d):[];if(k.length===0){p.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:l});return}let $=new Set(k),J=new Set(X),M=B.get(d),ke=M?.originalY??0,Se=new Set,qe=0,he=0,de=l?X:oe(d),g=new Set(de);if(document.querySelectorAll(".zebra-stripe").forEach(b=>{let S=u(b);d in S&&he===0&&(he=parseFloat(b.dataset.originalY||"0"));for(let[C,Y]of Object.entries(S))g.has(C)&&!Se.has(C)&&(qe+=parseFloat(Y),Se.add(C))}),qe===0&&de.length>0){p.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:l}),p.postMessage({command:"requestRerender"});return}let Le=l?qe:-qe,xe=ke;if(M&&M.elements.length>0){let S=(M.elements[0].getAttribute("transform")||"").match(/translate\([^,]+,\s*([-\d.]+)/);S&&(xe=parseFloat(S[1]))}let De=xe+ne;l?X.forEach(b=>{let S=B.get(b);S&&(S.elements.forEach(C=>{let te=(C.getAttribute("transform")||"").match(/translate\(([-\d.]+)/),Ce=te?te[1]:"0";C.setAttribute("transform","translate("+Ce+", "+De+")"),T(C,!1)}),De+=ne)}):k.forEach(b=>{let S=B.get(b);S&&S.elements.forEach(C=>{T(C,!0)})}),B.forEach(({originalY:b,elements:S},C)=>{b>ke&&!$.has(C)&&S.forEach(Y=>{let te=Y.getAttribute("transform")||"",Ce=te.match(/translate\(([-\d.]+)/),Oe=Ce?Ce[1]:"0",ue=te.match(/translate\([^,]+,\s*([-\d.]+)/),Z=(ue?parseFloat(ue[1]):b)+Le;Y.setAttribute("transform","translate("+Oe+", "+Z+")")})});let Ee=document.querySelector(".gantt-labels svg");if(Ee){let S=parseFloat(Ee.getAttribute("height")||"0")+Le;Ee.setAttribute("height",String(S))}[".gantt-col-status svg",".gantt-col-id svg",".gantt-col-start svg",".gantt-col-due svg",".gantt-col-assignee svg"].forEach(b=>{let S=document.querySelector(b);if(!S)return;let Y=parseFloat(S.getAttribute("height")||"0")+Le;S.setAttribute("height",String(Y))});let Re=document.querySelector(".gantt-timeline svg");if(Re){let S=parseFloat(Re.getAttribute("height")||"0")+Le;Re.setAttribute("height",S)}let Te=new Set;document.querySelectorAll('.project-label[data-has-children="true"], .time-group-label[data-has-children="true"], .issue-label[data-has-children="true"]').forEach(b=>{b.dataset.expanded==="false"&&Te.add(b.dataset.collapseKey)});let re=new Map,Ue=document.querySelectorAll(".zebra-stripe");Ue.forEach(b=>{let S=parseFloat(b.dataset.originalY||"0");if(re.has(S))return;let C=u(b),Y=Object.keys(C),te=Y.length>0&&Y.every(ue=>$.has(ue)),Ce=Y.some(ue=>$.has(ue)),Oe=S>he;if(te)re.set(S,{action:"toggle-visibility",hide:!l});else if(Ce)if(l){let ue=0;for(let[We,Z]of Object.entries(C))(!$.has(We)||J.has(We))&&(ue+=parseFloat(Z));re.set(S,{action:"expand",newHeight:ue})}else{let ue=0;for(let[We,Z]of Object.entries(C))$.has(We)||(ue+=parseFloat(Z));re.set(S,{action:"shrink",newHeight:ue})}else if(Oe){let ue=parseFloat(b.getAttribute("y")||String(S));re.set(S,{action:"shift",newY:ue+Le})}}),Ue.forEach(b=>{let S=parseFloat(b.dataset.originalY||"0"),C=re.get(S);if(C)switch(C.action){case"toggle-visibility":T(b,C.hide);break;case"shrink":b.setAttribute("height",String(C.newHeight));break;case"expand":b.setAttribute("height",String(C.newHeight));break;case"shift":b.setAttribute("y",String(C.newY));break}});let Fe=Array.from(document.querySelectorAll(".zebra-stripe")).filter(b=>b.getAttribute("visibility")!=="hidden"),ee=new Map;Fe.forEach(b=>{let S=parseFloat(b.getAttribute("y")||"0");ee.has(S)||ee.set(S,[]),ee.get(S).push(b)}),Array.from(ee.keys()).sort((b,S)=>b-S).forEach((b,S)=>{let C=S%2===0?"0.03":"0.06";ee.get(b).forEach(Y=>Y.setAttribute("opacity",C))}),document.querySelectorAll(".indent-guide-line").forEach(b=>{let S=b.dataset.forParent,C=D.get(S)||[],Y=Te.has(S)||C.some(te=>Te.has(te));if(T(b,Y),!Y){let te=B.get(S);if(te&&te.originalY>ke){let Ce=parseFloat(b.getAttribute("y1")||"0"),Oe=parseFloat(b.getAttribute("y2")||"0");b.setAttribute("y1",Ce+Le),b.setAttribute("y2",Oe+Le)}}}),document.querySelectorAll(".dependency-arrow").forEach(b=>{let S=b.dataset.from,C=b.dataset.to,Y=document.querySelector('.issue-bar[data-issue-id="'+S+'"]'),te=document.querySelector('.issue-bar[data-issue-id="'+C+'"]'),Ce=Y?.classList.contains("gantt-row-hidden"),Oe=te?.classList.contains("gantt-row-hidden");T(b,Ce||Oe)}),p.postMessage({command:"collapseStateSync",collapseKey:d,isExpanded:l})}if(ve){let d=P.find(v=>v.dataset.collapseKey===ve);d&&N(d,!0)}P.forEach((d,v)=>{d.addEventListener("click",m=>{if(m.target.closest?.(".collapse-toggle")||m.target.closest?.(".chevron-hit-area"))return;let H=d.dataset.issueId,l=d.classList.contains("project-label"),c=d.classList.contains("time-group-label"),k=d.dataset.collapseKey;if((l||c)&&k){N(d),d.dataset.hasChildren==="true"&&ge(k);return}let X=m.target.classList?.contains("issue-text")||m.target.closest(".issue-text");H&&X?(N(d,!1,!1,!0),p.postMessage({command:"openIssue",issueId:parseInt(H,10)})):d.dataset.hasChildren==="true"&&k?(N(d),ge(k)):N(d)}),d.addEventListener("keydown",m=>{let H=d.dataset.collapseKey,l=d.dataset.issueId?parseInt(d.dataset.issueId,10):NaN;switch(m.key){case"Enter":case" ":m.preventDefault(),isNaN(l)||p.postMessage({command:"openIssue",issueId:l});break;case"ArrowUp":{m.preventDefault();let c=R(v,-1);c&&N(c.label,!1,!0);break}case"ArrowDown":{m.preventDefault();let c=R(v,1);c&&N(c.label,!1,!0);break}case"ArrowLeft":if(m.preventDefault(),d.dataset.hasChildren==="true"&&d.dataset.expanded==="true")ge(H,"collapse");else if(d.dataset.parentKey){let c=P.find(k=>k.dataset.collapseKey===d.dataset.parentKey);c&&N(c,!1,!0)}break;case"ArrowRight":if(m.preventDefault(),d.dataset.hasChildren==="true"&&d.dataset.expanded==="false")ge(H,"expand");else if(d.dataset.hasChildren==="true"&&d.dataset.expanded==="true"){let c=P.find(k=>k.dataset.parentKey===H&&we(k));c&&N(c,!1,!0)}break;case"Home":{m.preventDefault();let c=R(-1,1);c&&N(c.label,!1,!0);break}case"End":{m.preventDefault();let c=R(P.length,-1);c&&N(c.label,!1,!0);break}case"PageDown":{m.preventDefault();let c=v,k=0;for(;k<10&&c<P.length-1;){let X=R(c,1);if(!X)break;c=X.index,k++}k>0&&N(P[c],!1,!0);break}case"PageUp":{m.preventDefault();let c=v,k=0;for(;k<10&&c>0;){let X=R(c,-1);if(!X)break;c=X.index,k++}k>0&&N(P[c],!1,!0);break}case"Tab":if(!m.shiftKey&&!isNaN(l)){let c=document.querySelector(`.issue-bar[data-issue-id="${l}"]`);c&&(m.preventDefault(),c.focus(),le(`Timeline bar for issue #${l}`))}break}})})}function yt(E){let{vscode:p,addDocListener:G,menuUndo:K,menuRedo:le,undoStack:ne,redoStack:V,saveState:P,updateUndoRedoButtons:ce,announce:ve,scrollToAndHighlight:we,scrollToToday:R}=E;G("keydown",u=>{let j=navigator.platform.toUpperCase().indexOf("MAC")>=0?u.metaKey:u.ctrlKey;if(!(u.target.tagName==="INPUT"||u.target.tagName==="SELECT"||u.target.tagName==="TEXTAREA"))if(j&&u.key==="z"&&!u.shiftKey)u.preventDefault(),K?.click();else if(j&&u.key==="z"&&u.shiftKey)u.preventDefault(),le?.click();else if(j&&u.key==="y")u.preventDefault(),le?.click();else if(u.key>="1"&&u.key<="5"){let T=document.getElementById("zoomSelect"),ae=["day","week","month","quarter","year"];T.value=ae[parseInt(u.key)-1],T.dispatchEvent(new Event("change"))}else if(u.key.toLowerCase()==="h")document.getElementById("menuHeatmap")?.click();else if(u.key.toLowerCase()==="y")document.getElementById("menuCapacity")?.click();else if(u.key.toLowerCase()==="i")document.getElementById("menuIntensity")?.click();else if(u.key.toLowerCase()==="d")document.getElementById("menuDeps")?.click();else if(u.key.toLowerCase()==="v"){let T=document.getElementById("viewFocusSelect");T.value=T.value==="project"?"person":"project",T.dispatchEvent(new Event("change"))}else if(u.key.toLowerCase()==="r")document.getElementById("refreshBtn")?.click();else if(u.key.toLowerCase()==="t")R();else if(u.key.toLowerCase()==="e")document.getElementById("menuExpand")?.click();else if(u.key.toLowerCase()==="c"&&!j)document.getElementById("menuCollapse")?.click();else if(u.key.toLowerCase()==="f"&&!j)u.preventDefault(),document.getElementById("menuFilterHealth")?.click();else if(u.key.toLowerCase()==="b"){u.preventDefault();let T=Array.from(document.querySelectorAll(".issue-bar[data-issue-id]")).filter(v=>v.querySelector(".blocker-badge"));if(T.length===0){ve("No blocked issues");return}let ae=document.activeElement?.closest(".issue-bar"),ge=((ae?T.indexOf(ae):-1)+1)%T.length,d=T[ge];we(d.dataset.issueId),d.focus(),ve("Blocked issue "+(ge+1)+" of "+T.length)}else if(u.key==="ArrowLeft"||u.key==="ArrowRight"){let T=document.activeElement?.closest(".issue-bar:not(.parent-bar)");if(!T)return;u.preventDefault();let ae=parseInt(T.dataset.issueId),oe=T.dataset.startDate,ge=T.dataset.dueDate;if(!oe&&!ge)return;let d=u.key==="ArrowRight"?1:-1,v=(l,c)=>{let k=new Date(l+"T00:00:00");return k.setDate(k.getDate()+c),k.toISOString().slice(0,10)},m=null,H=null;u.shiftKey&&ge?H=v(ge,d):u.altKey&&oe?m=v(oe,d):(oe&&(m=v(oe,d)),ge&&(H=v(ge,d))),(m||H)&&(P(),ne.push({issueId:ae,oldStartDate:m?oe:null,oldDueDate:H?ge:null,newStartDate:m,newDueDate:H}),V.length=0,ce(),p.postMessage({command:"updateDates",issueId:ae,startDate:m,dueDate:H}))}else u.key==="/"&&!j?(u.preventDefault(),N()):(u.key==="?"||u.shiftKey&&u.key==="/")&&(u.preventDefault(),_())});let Q=null;function N(){Q&&Q.remove(),Q=document.createElement("div"),Q.className="quick-search",Q.innerHTML=`
      <input type="text" placeholder="Search issues..." autofocus />
    `,document.body.appendChild(Q);let u=Q.querySelector("input");u.focus();let fe=Array.from(document.querySelectorAll(".issue-label"));u.addEventListener("input",()=>{let j=u.value.toLowerCase();fe.forEach(T=>{let ae=T.getAttribute("aria-label")?.toLowerCase()||"",oe=j&&ae.includes(j);T.classList.toggle("search-match",oe)})}),u.addEventListener("keydown",j=>{if(j.key==="Escape")B();else if(j.key==="Enter"){let T=document.querySelector(".issue-label.search-match");T&&(B(),T.focus(),we(T.dataset.issueId))}}),u.addEventListener("blur",()=>setTimeout(B,150))}function B(){Q&&(Q.remove(),Q=null,document.querySelectorAll(".search-match").forEach(u=>u.classList.remove("search-match")))}let D=null;function _(){if(D){D.remove(),D=null;return}D=document.createElement("div"),D.className="keyboard-help",D.innerHTML=`
      <div class="keyboard-help-content">
        <h3>Keyboard Shortcuts</h3>
        <div class="shortcut-grid">
          <div class="shortcut-section">
            <h4>Navigation</h4>
            <div><kbd>\u2191</kbd><kbd>\u2193</kbd> Move between issues</div>
            <div><kbd>Home</kbd><kbd>End</kbd> First/last issue</div>
            <div><kbd>PgUp</kbd><kbd>PgDn</kbd> Jump 10 rows</div>
            <div><kbd>Tab</kbd> Label \u2192 Bar</div>
            <div><kbd>Shift+Tab</kbd> Bar \u2192 Label</div>
          </div>
          <div class="shortcut-section">
            <h4>Date Editing</h4>
            <div><kbd>\u2190</kbd><kbd>\u2192</kbd> Move bar \xB11 day</div>
            <div><kbd>Shift+\u2190/\u2192</kbd> Resize end</div>
            <div><kbd>Alt+\u2190/\u2192</kbd> Resize start</div>
            <div><kbd>Ctrl+Z</kbd> Undo</div>
            <div><kbd>Ctrl+Y</kbd> Redo</div>
          </div>
          <div class="shortcut-section">
            <h4>View</h4>
            <div><kbd>1-5</kbd> Zoom levels</div>
            <div><kbd>H</kbd> Heatmap</div>
            <div><kbd>D</kbd> Dependencies</div>
            <div><kbd>C</kbd> Critical path</div>
            <div><kbd>T</kbd> Today</div>
          </div>
          <div class="shortcut-section">
            <h4>Health & Other</h4>
            <div><kbd>F</kbd> Cycle health filter</div>
            <div><kbd>B</kbd> Next blocked issue</div>
            <div><kbd>/</kbd> Quick search</div>
            <div><kbd>S</kbd> Cycle sort</div>
            <div><kbd>R</kbd> Refresh</div>
            <div><kbd>Esc</kbd> Clear/cancel</div>
          </div>
        </div>
        <p class="keyboard-help-close">Press <kbd>?</kbd> or <kbd>Esc</kbd> to close</p>
      </div>
    `,document.body.appendChild(D),D.addEventListener("click",u=>{u.target===D&&_()})}G("keydown",u=>{u.key==="Escape"&&D&&(u.stopImmediatePropagation(),_())})}var ie=acquireVsCodeApi(),st=!1;function Qe(E){st&&typeof performance<"u"&&performance.mark(E)}function rt(E,p,G){if(st&&typeof performance<"u")try{performance.measure(E,p,G);let K=performance.getEntriesByName(E,"measure");K.length>0&&console.log(`[Gantt Perf] ${E}: ${K[K.length-1].duration.toFixed(2)}ms`),performance.clearMarks(p),performance.clearMarks(G),performance.clearMeasures(E)}catch{}}function St(){if(st){let E=document.getElementById("ganttRoot"),p=E?E.querySelectorAll("*").length:0,G=E?E.querySelectorAll("svg *").length:0;console.log(`[Gantt Perf] DOM nodes: ${p}, SVG elements: ${G}`)}}function kt(E){if(!E)return;let p=document.documentElement;p.style.setProperty("--gantt-header-height",`${E.headerHeight}px`),p.style.setProperty("--gantt-label-width",`${E.labelWidth}px`),p.style.setProperty("--gantt-id-column-width",`${E.idColumnWidth}px`),p.style.setProperty("--gantt-start-date-column-width",`${E.startDateColumnWidth}px`),p.style.setProperty("--gantt-status-column-width",`${E.statusColumnWidth}px`),p.style.setProperty("--gantt-due-date-column-width",`${E.dueDateColumnWidth}px`),p.style.setProperty("--gantt-assignee-column-width",`${E.assigneeColumnWidth}px`),p.style.setProperty("--gantt-sticky-left-width",`${E.stickyLeftWidth}px`)}function Et({addDocListener:E,addWinListener:p}){let G=document.getElementById("ganttRoot"),K=document.getElementById("ganttTooltip"),le=K?.querySelector(".gantt-tooltip-content");if(!G||!K||!le)return;let ne=l=>l?String(l).replace(/\r\n/g,`
`).trimEnd():"";function V(){G.querySelectorAll("svg title").forEach(l=>{let c=l.parentElement,k=ne(l.textContent);c&&k&&(c.dataset.tooltip=k),l.remove()})}function P(){G.querySelectorAll("[title]").forEach(l=>{if(l.tagName.toLowerCase()==="title")return;let c=ne(l.getAttribute("title"));l.removeAttribute("title"),c&&(l.dataset.tooltip=c)})}function ce(){V(),P()}function ve(l){let c=l.findIndex(X=>X.trim().startsWith("#"));return c>=0?c:l.filter(X=>X.trim()).length>1?l.findIndex(X=>X.trim()):-1}function we(l){le.textContent="";let c=ne(l);if(!c)return;let k=c.split(`
`),X=ve(k),$=!1;k.forEach((M,ke)=>{let Se=M.trim();if(!Se){if(!$){let de=document.createElement("div");de.className="gantt-tooltip-spacer",le.appendChild(de),$=!0}return}if(Se==="---"){let de=document.createElement("div");de.className="gantt-tooltip-divider",le.appendChild(de),$=!1;return}let qe=Se.match(/^cf:([^:]+):(.*)$/);if(qe){let de=qe[1].trim(),g=qe[2].trim(),Le=document.createElement("div");Le.className="gantt-tooltip-line";let xe=document.createElement("span");xe.className="gantt-tooltip-key",xe.textContent=`${de}: `,Le.appendChild(xe),g&&Le.appendChild(document.createTextNode(g)),le.appendChild(Le),$=!1;return}let he=document.createElement("div");he.className="gantt-tooltip-line",ke===X&&he.classList.add("gantt-tooltip-title");let Ae=Se.match(/^Open in Browser:\s*(\S+)/);if(Ae&&/^https?:\/\//i.test(Ae[1])){he.appendChild(document.createTextNode("Open in Browser: "));let de=document.createElement("a");de.href=Ae[1],de.textContent=Ae[1],de.target="_blank",de.rel="noopener noreferrer",he.appendChild(de)}else he.textContent=M;le.appendChild(he),$=!1});let J=le.lastElementChild;J&&J.classList.contains("gantt-tooltip-spacer")&&J.remove()}let R=null,Q=null,N=null,B={x:0,y:0};function D(l){B={x:l.clientX,y:l.clientY}}function _(){Q&&(clearTimeout(Q),Q=null)}function u(){N&&(clearTimeout(N),N=null)}function fe(l){return l&&(l===K||K.contains(l))}function j(l){return l&&R&&(l===R||R.contains(l))}function T(){if(!B)return!1;let l=document.elementFromPoint(B.x,B.y);return fe(l)||j(l)}let ae=300;function oe(l){u(),N=setTimeout(()=>{N=null,!(!R||R!==l)&&T()&&v(l,B.x,B.y)},ae)}function ge(){_(),Q=setTimeout(()=>{R&&(T()||m())},300)}function d(l,c){let $=K.getBoundingClientRect(),J=l+8,M=c+8;J+$.width>window.innerWidth-8&&(J=l-$.width-8),M+$.height>window.innerHeight-8&&(M=c-$.height-8),J=Math.max(8,Math.min(J,window.innerWidth-$.width-8)),M=Math.max(8,Math.min(M,window.innerHeight-$.height-8)),K.style.left=`${Math.round(J)}px`,K.style.top=`${Math.round(M)}px`}function v(l,c,k){let X=l.dataset.tooltip;X&&(we(X),K.classList.add("visible"),K.setAttribute("aria-hidden","false"),d(c,k))}function m(l=!1){u(),_(),K.classList.remove("visible"),K.setAttribute("aria-hidden","true"),l||(R=null)}function H(l){if(!l||l===K||K.contains(l))return null;let c=l.closest?.("[data-tooltip], [title]");if(!c||!G.contains(c))return null;if(c.hasAttribute("title")){let k=ne(c.getAttribute("title"));c.removeAttribute("title"),k&&(c.dataset.tooltip=k)}return c.dataset.tooltip?c:null}ce(),E("pointerover",l=>{if(D(l),fe(l.target)){_(),u();return}let c=H(l.target);if(!c){u();return}_(),R!==c?(R=c,K.classList.contains("visible")&&m(!0),oe(c)):K.classList.contains("visible")||oe(c)},!0),E("pointermove",l=>{R&&(D(l),Q&&T()&&_())},!0),E("pointerout",l=>{if(!R||(D(l),u(),!j(l.target)&&!fe(l.target)))return;let c=l.relatedTarget;fe(c)||j(c)||ge()},!0),E("scroll",()=>{R&&m()},!0),E("keydown",()=>{R&&m()},!0),p("blur",()=>{R&&m()})}function vt(E){if(!E)return;E.state&&(st=E.state.perfDebug??!1),Qe("render-start");let p=document.getElementById("ganttRoot");p&&(kt(E.state),Qe("innerHTML-start"),p.innerHTML=E.html||"",Qe("innerHTML-end"),rt("innerHTML","innerHTML-start","innerHTML-end"),Lt(E.state),Qe("render-end"),rt("render","render-start","render-end"),St())}window.addEventListener("message",E=>{let p=E.data;if(p){if(p.command==="render"){vt(p.payload);return}window.__ganttHandleExtensionMessage&&window.__ganttHandleExtensionMessage(p)}});var bt=window.__GANTT_INITIAL_PAYLOAD__;bt&&vt(bt);ie.postMessage({command:"webviewReady"});function Lt(E){if(Qe("initializeGantt-start"),!E)return;let{timelineWidth:p,minDateMs:G,maxDateMs:K,totalDays:le,extendedRelationTypes:ne,redmineBaseUrl:V,minimapBarsData:P,minimapHeight:ce,minimapBarHeight:ve,minimapTodayX:we,extScrollLeft:R,extScrollTop:Q,labelWidth:N,leftExtrasWidth:B,healthFilter:D,sortBy:_,sortOrder:u,selectedCollapseKey:fe,barHeight:j,todayX:T,todayInRange:ae,isDraftMode:oe,draftQueueCount:ge}=E,d=p/le,v=document.getElementById("dragConfirmOk");v&&(v.textContent=oe?"Queue to Draft":"Save to Redmine");let m=document.getElementById("draftBadge");m&&(oe?(m.classList.remove("hidden"),m.textContent=(ge??0)+" queued"):m.classList.add("hidden")),window._ganttCleanup&&window._ganttCleanup();let H=[],l=[];function c(e,t,a){document.addEventListener(e,t,a),H.push({type:e,handler:t,options:a})}function k(e,t,a){window.addEventListener(e,t,a),l.push({type:e,handler:t,options:a})}window._ganttCleanup=()=>{H.forEach(e=>document.removeEventListener(e.type,e.handler,e.options)),l.forEach(e=>window.removeEventListener(e.type,e.handler,e.options)),window.__ganttHandleExtensionMessage=null};function X(e){setTimeout(()=>{document.addEventListener("click",function t(a){e.contains(a.target)||(e.remove(),document.removeEventListener("click",t))})},0)}function $(e){return Math.round(e/d)*d}function J(e){let t=document.getElementById("liveRegion");t&&(t.textContent=e)}let M=document.getElementById("ganttScroll"),ke=document.getElementById("ganttLeftHeader"),Se=document.getElementById("ganttLabels"),qe=document.getElementById("ganttTimeline"),he=document.getElementById("menuUndo"),Ae=document.getElementById("menuRedo"),de=document.getElementById("minimapSvg"),g=document.getElementById("minimapViewport"),{updateMinimapPosition:Le,updateMinimapViewport:xe}=gt({timelineWidth:p,minimapBarsData:P,minimapHeight:ce,minimapBarHeight:ve,minimapTodayX:we,ganttScroll:M,minimapSvg:de,minimapViewport:g,addDocListener:c}),De=ie.getState()||{undoStack:[],redoStack:[],labelWidth:N,scrollLeft:null,scrollTop:null,centerDateMs:null},Ee=De.undoStack||[],Pe=De.redoStack||[],Re=De.scrollLeft??(R>0?R:null),Te=De.scrollTop??(Q>0?Q:null),re=De.centerDateMs;function Ue(){if(!M)return null;let t=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,a=M.clientWidth-t,h=(M.scrollLeft+a/2)/p;return G+h*(K-G)}function Fe(e){if(!M)return;let a=(e-G)/(K-G)*p,h=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,W=M.clientWidth-h;M.scrollLeft=Math.max(0,a-W/2)}function ee(){ie.setState({undoStack:Ee,redoStack:Pe,labelWidth:Se?.offsetWidth||N,scrollLeft:null,scrollTop:M?.scrollTop??null,centerDateMs:Ue()})}let y=ee;function b(){he&&he.toggleAttribute("disabled",Ee.length===0),Ae&&Ae.toggleAttribute("disabled",Pe.length===0),ee()}if(De.labelWidth&&ke&&Se){ke.style.width=De.labelWidth+"px",Se.style.width=De.labelWidth+"px";let e=document.querySelector(".capacity-ribbon-label");e&&(e.style.width=De.labelWidth+B+"px")}let S=!0,C=!1,Y=e=>{C=e},te=null;M&&M.addEventListener("scroll",()=>{cancelAnimationFrame(te),te=requestAnimationFrame(()=>{xe(),S||ee()})},{passive:!0}),requestAnimationFrame(()=>b()),window.__ganttHandleExtensionMessage=e=>{if(e.command==="setHeatmapState"){let t=document.querySelector(".heatmap-layer"),a=document.querySelector(".weekend-layer"),f=document.getElementById("menuHeatmap");e.enabled?(t&&t.classList.remove("hidden"),a&&a.classList.add("hidden"),f&&f.classList.add("active")):(t&&t.classList.add("hidden"),a&&a.classList.remove("hidden"),f&&f.classList.remove("active"))}else if(e.command==="setDependenciesState"){let t=document.querySelector(".dependency-layer"),a=document.getElementById("menuDeps");e.enabled?(t&&t.classList.remove("hidden"),a&&a.classList.add("active")):(t&&t.classList.add("hidden"),a&&a.classList.remove("active"))}else if(e.command==="setCapacityRibbonState"){let t=document.querySelector(".capacity-ribbon"),a=document.getElementById("menuCapacity");e.enabled?(t&&t.classList.remove("hidden"),a&&a.classList.add("active")):(t&&t.classList.add("hidden"),a&&a.classList.remove("active"))}else if(e.command==="setIntensityState"){let t=document.querySelector(".gantt-container"),a=document.getElementById("menuIntensity");e.enabled?(t?.classList.add("intensity-enabled"),a&&a.classList.add("active")):(t?.classList.remove("intensity-enabled"),a&&a.classList.remove("active"))}else if(e.command==="setDraftModeState"){let t=document.getElementById("dragConfirmOk");t&&(t.textContent=e.enabled?"Queue to Draft":"Save to Redmine");let a=document.getElementById("draftBadge");a&&(e.enabled?(a.classList.remove("hidden"),a.textContent=(e.queueCount??0)+" queued"):a.classList.add("hidden"))}else if(e.command==="setDraftQueueCount"){let t=document.getElementById("draftBadge");t&&(t.textContent=e.count+" queued")}else if(e.command==="pushUndoAction")Ee.push(e.action),Pe.length=0,b(),ee();else if(e.command==="updateRelationId"){let t=e.stack==="undo"?Ee:Pe;if(t.length>0){let a=t[t.length-1];a.type==="relation"&&(a.relationId=e.newRelationId,ee())}}else if(e.command==="scrollToIssue"){let t=e.issueId,a=document.querySelector('.issue-label[data-issue-id="'+t+'"]'),f=document.querySelector('.issue-bar[data-issue-id="'+t+'"]'),h=document.getElementById("ganttScroll"),ye=document.querySelector(".gantt-header-row")?.getBoundingClientRect().height||60;if(!h)return;let Ie=h.scrollTop,be=h.scrollLeft;if(a){let Ye=a.closest(".gantt-row");if(Ye){let _e=Ye.offsetTop,Ne=Ye.getBoundingClientRect().height,Ge=h.clientHeight-ye;Ie=Math.max(0,_e-ye-(Ge-Ne)/2)}a.focus(),a.classList.add("highlighted"),setTimeout(()=>a.classList.remove("highlighted"),2e3)}if(f){let Ye=parseFloat(f.getAttribute("data-start-x")||"0"),Ne=parseFloat(f.getAttribute("data-end-x")||"0")-Ye,Ge=h.clientWidth,wt=document.querySelector(".gantt-sticky-left")?.getBoundingClientRect().width||0,mt=Ge-wt;Ne<=mt-100?be=Ye-(mt-Ne)/2:be=Ye-50,be=Math.max(0,be),f.classList.add("highlighted"),setTimeout(()=>f.classList.remove("highlighted"),2e3)}h.scrollTo({left:be,top:Ie,behavior:"smooth"})}},document.getElementById("lookbackSelect")?.addEventListener("change",e=>{ie.postMessage({command:"setLookback",years:e.target.value})}),document.getElementById("zoomSelect")?.addEventListener("change",e=>{y(),ie.postMessage({command:"setZoom",zoomLevel:e.target.value})}),document.getElementById("viewFocusSelect")?.addEventListener("change",e=>{ie.postMessage({command:"setViewFocus",focus:e.target.value})}),document.getElementById("projectSelector")?.addEventListener("change",e=>{let t=e.target.value,a=t?parseInt(t,10):null;ie.postMessage({command:"setSelectedProject",projectId:a})}),document.getElementById("focusSelector")?.addEventListener("change",e=>{let t=e.target.value;ie.postMessage({command:"setSelectedAssignee",assignee:t||null})}),document.getElementById("filterAssignee")?.addEventListener("change",e=>{let t=e.target.value;ie.postMessage({command:"setFilter",filter:{assignee:t}})}),document.getElementById("filterStatus")?.addEventListener("change",e=>{let t=e.target.value;ie.postMessage({command:"setFilter",filter:{status:t}})}),document.getElementById("menuFilterHealth")?.addEventListener("click",()=>{let e=["all","critical","warning","healthy"],t=D,f=(e.indexOf(t)+1)%e.length;ie.postMessage({command:"setHealthFilter",health:e[f]})}),document.querySelectorAll(".gantt-col-header.sortable").forEach(e=>{e.addEventListener("click",()=>{let t=e.dataset.sort;t===_?u==="asc"?ie.postMessage({command:"setSort",sortOrder:"desc"}):ie.postMessage({command:"setSort",sortBy:null}):ie.postMessage({command:"setSort",sortBy:t,sortOrder:"asc"})})}),document.getElementById("menuHeatmap")?.addEventListener("click",()=>{document.getElementById("menuHeatmap")?.hasAttribute("disabled")||(ee(),ie.postMessage({command:"toggleWorkloadHeatmap"}))}),document.getElementById("menuCapacity")?.addEventListener("click",()=>{document.getElementById("menuCapacity")?.hasAttribute("disabled")||(ee(),ie.postMessage({command:"toggleCapacityRibbon"}))}),document.getElementById("menuIntensity")?.addEventListener("click",()=>{document.getElementById("menuIntensity")?.hasAttribute("disabled")||(ee(),ie.postMessage({command:"toggleIntensity"}))}),document.getElementById("overloadBadge")?.addEventListener("click",e=>{e.stopPropagation();let t=e.currentTarget,a=parseInt(t.dataset.firstOverloadMs||"0",10);a>0&&(Fe(a),ee())}),document.querySelectorAll(".capacity-day-bar-group").forEach(e=>{e.addEventListener("click",t=>{let a=parseInt(t.currentTarget.dataset.dateMs||"0",10);a>0&&(Fe(a),ee())})}),document.getElementById("menuDeps")?.addEventListener("click",()=>{ee(),ie.postMessage({command:"toggleDependencies"})});let ue=document.querySelector(".gantt-container");function We(){let e=new Map,t=new Map;return document.querySelectorAll(".dependency-arrow").forEach(a=>{if(!(a.classList.contains("rel-blocks")||a.classList.contains("rel-precedes")))return;let h=a.dataset.from,W=a.dataset.to;e.has(h)||e.set(h,[]),e.get(h).push(W),t.has(W)||t.set(W,[]),t.get(W).push(h)}),{graph:e,reverseGraph:t}}let Z=null;function et(e,t,a){let f=new Set([e]),h=[e];for(;h.length>0;){let ye=h.shift(),Ie=t.get(ye)||[];for(let be of Ie)f.has(be)||(f.add(be),h.push(be))}let W=[e];for(;W.length>0;){let ye=W.shift(),Ie=a.get(ye)||[];for(let be of Ie)f.has(be)||(f.add(be),W.push(be))}return f}function Je(e){if(Ze(),!e)return;Z=e;let{graph:t,reverseGraph:a}=We(),f=et(e,t,a);ue.classList.add("focus-mode"),document.querySelectorAll(".issue-bar").forEach(h=>{f.has(h.dataset.issueId)&&h.classList.add("focus-highlighted")}),document.querySelectorAll(".issue-label").forEach(h=>{f.has(h.dataset.issueId)&&h.classList.add("focus-highlighted")}),document.querySelectorAll(".dependency-arrow").forEach(h=>{f.has(h.dataset.from)&&f.has(h.dataset.to)&&h.classList.add("focus-highlighted")}),J(`Focus: ${f.size} issue${f.size!==1?"s":""} in dependency chain`)}function Ze(){Z=null,ue.classList.remove("focus-mode"),document.querySelectorAll(".focus-highlighted").forEach(e=>e.classList.remove("focus-highlighted"))}let je=()=>Z,s=new Set,o=null,n=document.getElementById("selectionCount"),r=Array.from(document.querySelectorAll(".issue-bar")),i=new Map;r.forEach(e=>{let t=e.dataset.issueId;t&&(i.has(t)||i.set(t,[]),i.get(t).push(e))});function A(e){e.forEach(t=>{let a=i.get(t);a&&a.forEach(f=>f.classList.toggle("selected",s.has(t)))}),s.size>0?(n.textContent=`${s.size} selected`,n.classList.remove("hidden"),ue.classList.add("multi-select-mode")):(n.classList.add("hidden"),ue.classList.remove("multi-select-mode"))}function x(){r.forEach(e=>{e.classList.toggle("selected",s.has(e.dataset.issueId))}),s.size>0?(n.textContent=`${s.size} selected`,n.classList.remove("hidden"),ue.classList.add("multi-select-mode")):(n.classList.add("hidden"),ue.classList.remove("multi-select-mode"))}function L(){let e=[...s];s.clear(),o=null,A(e)}function z(e){s.has(e)?s.delete(e):s.add(e),o=e,A([e])}function w(e,t){let a=r.findIndex(Ie=>Ie.dataset.issueId===e),f=r.findIndex(Ie=>Ie.dataset.issueId===t);if(a===-1||f===-1)return;let h=Math.min(a,f),W=Math.max(a,f),ye=[];for(let Ie=h;Ie<=W;Ie++){let be=r[Ie].dataset.issueId;s.has(be)||(s.add(be),ye.push(be))}A(ye)}function F(){r.forEach(e=>s.add(e.dataset.issueId)),x(),J(`Selected all ${s.size} issues`)}r.forEach(e=>{e.addEventListener("mousedown",t=>{if(!t.ctrlKey&&!t.metaKey&&!t.shiftKey||t.target.classList.contains("drag-handle")||t.target.classList.contains("link-handle"))return;t.preventDefault(),t.stopPropagation();let a=e.dataset.issueId;t.shiftKey&&o?w(o,a):z(a)})}),c("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="a"&&(e.preventDefault(),F()),e.key==="Escape"&&s.size>0&&(e.stopImmediatePropagation(),L(),J("Selection cleared"))}),document.getElementById("refreshBtn")?.addEventListener("click",()=>{document.getElementById("loadingOverlay")?.classList.add("visible"),ie.postMessage({command:"refresh"})}),document.getElementById("draftBadge")?.addEventListener("click",()=>{ie.postMessage({command:"openDraftReview"})});function I(e,t,a,f,h){document.querySelector(".relation-picker")?.remove();let W=document.createElement("div");W.className="relation-picker";let ye=150,Ie=100,be=Math.min(e,window.innerWidth-ye-10),Ye=Math.min(t,window.innerHeight-Ie-10);W.style.left=Math.max(10,be)+"px",W.style.top=Math.max(10,Ye)+"px";let _e=document.createElement("div");_e.style.padding="6px 12px",_e.style.fontSize="11px",_e.style.opacity="0.7",_e.textContent=`#${f} \u2192 #${h}`,W.appendChild(_e);let Ne=document.createElement("button");Ne.textContent="\u{1F5D1}\uFE0F Delete relation",Ne.addEventListener("click",()=>{ee(),ie.postMessage({command:"deleteRelation",relationId:a}),W.remove()}),W.appendChild(Ne);let Ge=document.createElement("button");Ge.textContent="Cancel",Ge.addEventListener("click",()=>W.remove()),W.appendChild(Ge),document.body.appendChild(W),X(W)}let q=new Map,O=new Map,me=new Map,He=new Map,Xe=new Map,Ke=!1;function $e(){document.querySelectorAll(".issue-bar").forEach(e=>{let t=e.dataset.issueId;t&&(q.has(t)||q.set(t,[]),q.get(t).push(e))}),document.querySelectorAll(".issue-label").forEach(e=>{let t=e.dataset.issueId;t&&(O.has(t)||O.set(t,[]),O.get(t).push(e))}),document.querySelectorAll(".dependency-arrow").forEach(e=>{let t=e.dataset.from,a=e.dataset.to;t&&(me.has(t)||me.set(t,[]),me.get(t).push(e)),a&&(me.has(a)||me.set(a,[]),me.get(a).push(e))}),document.querySelectorAll(".project-label").forEach(e=>{let t=e.dataset.collapseKey;t&&(He.has(t)||He.set(t,[]),He.get(t).push(e))}),document.querySelectorAll(".aggregate-bars").forEach(e=>{let t=e.dataset.collapseKey;t&&(Xe.has(t)||Xe.set(t,[]),Xe.get(t).push(e))}),Ke=!0}typeof requestIdleCallback<"u"?requestIdleCallback(()=>$e(),{timeout:100}):setTimeout($e,0);let Be=[];function Me(){document.body.classList.remove("hover-focus","dependency-hover"),Be.forEach(e=>e.classList.remove("hover-highlighted","hover-source")),Be=[]}function U(e){document.body.classList.add("hover-focus");let t=Ke?q.get(e)||[]:document.querySelectorAll('.issue-bar[data-issue-id="'+e+'"]'),a=Ke?O.get(e)||[]:document.querySelectorAll('.issue-label[data-issue-id="'+e+'"]'),f=Ke?me.get(e)||[]:document.querySelectorAll('.dependency-arrow[data-from="'+e+'"], .dependency-arrow[data-to="'+e+'"]');t.forEach(h=>{h.classList.add("hover-highlighted"),Be.push(h)}),a.forEach(h=>{h.classList.add("hover-highlighted"),Be.push(h)}),f.forEach(h=>{h.classList.add("hover-highlighted"),Be.push(h)})}function se(e){document.body.classList.add("hover-focus");let t=Ke?He.get(e)||[]:document.querySelectorAll('.project-label[data-collapse-key="'+e+'"]'),a=Ke?Xe.get(e)||[]:document.querySelectorAll('.aggregate-bars[data-collapse-key="'+e+'"]');t.forEach(f=>{f.classList.add("hover-highlighted"),Be.push(f)}),a.forEach(f=>{f.classList.add("hover-highlighted"),Be.push(f)})}let pe=document.querySelector(".gantt-timeline svg"),Ve=document.querySelector(".gantt-labels svg");if(pe&&(pe.addEventListener("mouseenter",e=>{let t=e.target.closest(".issue-bar"),a=e.target.closest(".aggregate-bars"),f=e.target.closest(".dependency-arrow");if(t){let h=t.dataset.issueId;h&&U(h)}else if(a){let h=a.dataset.collapseKey;h&&se(h)}else if(f){let h=f.dataset.from,W=f.dataset.to;document.body.classList.add("dependency-hover"),f.classList.add("hover-source"),Be.push(f),h&&U(h),W&&U(W)}},!0),pe.addEventListener("mouseleave",e=>{let t=e.target.closest(".issue-bar"),a=e.target.closest(".aggregate-bars"),f=e.target.closest(".dependency-arrow");(t||a||f)&&Me()},!0)),Ve&&(Ve.addEventListener("mouseenter",e=>{let t=e.target.closest(".issue-label"),a=e.target.closest(".project-label");if(t){let f=t.dataset.issueId;f&&U(f)}else if(a){let f=a.dataset.collapseKey;f&&se(f)}},!0),Ve.addEventListener("mouseleave",e=>{let t=e.target.closest(".issue-label"),a=e.target.closest(".project-label");(t||a)&&Me()},!0)),pe){let t=function(){document.querySelectorAll(".dependency-arrow.selected").forEach(a=>a.classList.remove("selected")),document.body.classList.remove("arrow-selection-mode"),document.querySelectorAll(".arrow-connected").forEach(a=>a.classList.remove("arrow-connected")),e=null};var Dt=t;pe.addEventListener("contextmenu",a=>{let f=a.target.closest(".dependency-arrow");if(!f)return;a.preventDefault();let h=parseInt(f.dataset.relationId),W=f.dataset.from,ye=f.dataset.to;I(a.clientX,a.clientY,h,W,ye)});let e=null;pe.addEventListener("click",a=>{let f=a.target.closest(".dependency-arrow");if(e&&(e.classList.remove("selected"),document.body.classList.remove("arrow-selection-mode"),document.querySelectorAll(".arrow-connected").forEach(ye=>ye.classList.remove("arrow-connected")),e=null),!f)return;a.stopPropagation(),e=f,f.classList.add("selected"),document.body.classList.add("arrow-selection-mode");let h=f.dataset.from,W=f.dataset.to;document.querySelectorAll(`.issue-bar[data-issue-id="${h}"], .issue-bar[data-issue-id="${W}"]`).forEach(ye=>ye.classList.add("arrow-connected")),document.querySelectorAll(`.issue-label[data-issue-id="${h}"], .issue-label[data-issue-id="${W}"]`).forEach(ye=>ye.classList.add("arrow-connected")),J(`Selected relation from #${h} to #${W}`)}),window._ganttArrowClickHandler&&document.removeEventListener("click",window._ganttArrowClickHandler),window._ganttArrowClickHandler=a=>{(e||document.querySelector(".dependency-arrow.selected"))&&!a.target.closest(".dependency-arrow")&&!a.target.closest(".blocks-badge-group")&&!a.target.closest(".blocker-badge")&&t()},document.addEventListener("click",window._ganttArrowClickHandler),window._ganttArrowKeyHandler&&document.removeEventListener("keydown",window._ganttArrowKeyHandler),window._ganttArrowKeyHandler=a=>{let f=e||document.querySelector(".dependency-arrow.selected");a.key==="Escape"&&f&&(a.stopImmediatePropagation(),t())},document.addEventListener("keydown",window._ganttArrowKeyHandler)}ht({vscode:ie,menuUndo:he,menuRedo:Ae,addDocListener:c,closeOnOutsideClick:X,announce:J,saveState:ee,updateUndoRedoButtons:b,undoStack:Ee,redoStack:Pe,selectedIssues:s,clearSelection:L,allIssueBars:r,redmineBaseUrl:V,extendedRelationTypes:ne,minDateMs:G,maxDateMs:K,timelineWidth:p,dayWidth:d,barHeight:j,ganttScroll:M,snapToDay:$,focusOnDependencyChain:Je,clearFocus:Ze,getFocusedIssueId:je,scrollToAndHighlight:it,setAllowScrollChange:Y,isDraftMode:oe}),pt({vscode:ie,addDocListener:c,addWinListener:k,announce:J,barHeight:j,selectedCollapseKey:fe});function ze(){if(!ae){ie.postMessage({command:"todayOutOfRange"});return}if(M){let t=document.querySelector(".gantt-body .gantt-sticky-left")?.offsetWidth??0,a=M.clientWidth-t;M.scrollLeft=Math.max(0,T-a/2)}}function it(e){if(!e)return;C=!0;let t=document.querySelector('.issue-label[data-issue-id="'+e+'"]'),a=document.querySelector('.issue-bar[data-issue-id="'+e+'"]');if(t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("highlighted"),setTimeout(()=>t.classList.remove("highlighted"),1500)),a&&M){let f=a.getBoundingClientRect(),h=M.getBoundingClientRect(),W=M.scrollLeft+f.left-h.left-100;M.scrollTo({left:Math.max(0,W),behavior:"smooth"}),a.classList.add("highlighted"),setTimeout(()=>a.classList.remove("highlighted"),1500)}}yt({vscode:ie,addDocListener:c,menuUndo:he,menuRedo:Ae,undoStack:Ee,redoStack:Pe,saveState:ee,updateUndoRedoButtons:b,announce:J,scrollToAndHighlight:it,scrollToToday:ze}),Et({addDocListener:c,addWinListener:k,ganttScroll:M}),requestAnimationFrame(()=>{if(re!==null&&M){let e=Math.max(G,Math.min(K,re));Fe(e),Te!==null&&(M.scrollTop=Te),re=null,Te=null}else Re!==null&&M?(M.scrollLeft=Re,Te!==null&&(M.scrollTop=Te),Re=null,Te=null):ze();xe(),S=!1}),document.getElementById("todayBtn")?.addEventListener("click",ze);let lt=document.getElementById("resizeHandle"),ct=document.getElementById("resizeHandleHeader"),tt=!1,dt=0,ut=0,nt=null;function ft(e,t){tt=!0,nt=t,dt=e.clientX,ut=Se.offsetWidth,t.classList.add("dragging"),document.body.classList.add("cursor-col-resize","user-select-none"),e.preventDefault()}lt?.addEventListener("mousedown",e=>ft(e,lt)),ct?.addEventListener("mousedown",e=>ft(e,ct));let at=!1,ot=null;c("mousemove",e=>{tt&&(ot=e,!at&&(at=!0,requestAnimationFrame(()=>{if(at=!1,!ot)return;let t=ot.clientX-dt,a=Math.min(600,Math.max(120,ut+t));if(ke&&(ke.style.width=a+"px"),Se){Se.style.width=a+"px";let h=Se.querySelector("svg");h&&h.setAttribute("width",String(a))}let f=document.querySelector(".capacity-ribbon-label");f&&(f.style.width=a+B+"px"),Le()})))}),c("mouseup",()=>{tt&&(tt=!1,nt?.classList.remove("dragging"),nt=null,document.body.classList.remove("cursor-col-resize","user-select-none"),ee())}),requestAnimationFrame(()=>{document.getElementById("loadingOverlay")?.classList.remove("visible")}),Qe("initializeGantt-end"),rt("initializeGantt","initializeGantt-start","initializeGantt-end")}})();
